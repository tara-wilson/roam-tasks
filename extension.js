/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ var __webpack_modules__ = ({

/***/ "./node_modules/@tanstack/react-virtual/dist/esm/index.js"
/*!****************************************************************!*\
  !*** ./node_modules/@tanstack/react-virtual/dist/esm/index.js ***!
  \****************************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Virtualizer: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.Virtualizer),\n/* harmony export */   approxEqual: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.approxEqual),\n/* harmony export */   debounce: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.debounce),\n/* harmony export */   defaultKeyExtractor: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.defaultKeyExtractor),\n/* harmony export */   defaultRangeExtractor: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.defaultRangeExtractor),\n/* harmony export */   elementScroll: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.elementScroll),\n/* harmony export */   measureElement: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.measureElement),\n/* harmony export */   memo: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.memo),\n/* harmony export */   notUndefined: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.notUndefined),\n/* harmony export */   observeElementOffset: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeElementOffset),\n/* harmony export */   observeElementRect: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeElementRect),\n/* harmony export */   observeWindowOffset: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeWindowOffset),\n/* harmony export */   observeWindowRect: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeWindowRect),\n/* harmony export */   useVirtualizer: () => (/* binding */ useVirtualizer),\n/* harmony export */   useWindowVirtualizer: () => (/* binding */ useWindowVirtualizer),\n/* harmony export */   windowScroll: () => (/* reexport safe */ _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.windowScroll)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"react\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ \"react-dom\");\n/* harmony import */ var _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @tanstack/virtual-core */ \"./node_modules/@tanstack/virtual-core/dist/esm/index.js\");\n\n\n\n\nconst useIsomorphicLayoutEffect = typeof document !== \"undefined\" ? react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect : react__WEBPACK_IMPORTED_MODULE_0__.useEffect;\nfunction useVirtualizerBase({\n  useFlushSync = true,\n  ...options\n}) {\n  const rerender = react__WEBPACK_IMPORTED_MODULE_0__.useReducer(() => ({}), {})[1];\n  const resolvedOptions = {\n    ...options,\n    onChange: (instance2, sync) => {\n      var _a;\n      if (useFlushSync && sync) {\n        (0,react_dom__WEBPACK_IMPORTED_MODULE_1__.flushSync)(rerender);\n      } else {\n        rerender();\n      }\n      (_a = options.onChange) == null ? void 0 : _a.call(options, instance2, sync);\n    }\n  };\n  const [instance] = react__WEBPACK_IMPORTED_MODULE_0__.useState(\n    () => new _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.Virtualizer(resolvedOptions)\n  );\n  instance.setOptions(resolvedOptions);\n  useIsomorphicLayoutEffect(() => {\n    return instance._didMount();\n  }, []);\n  useIsomorphicLayoutEffect(() => {\n    return instance._willUpdate();\n  });\n  return instance;\n}\nfunction useVirtualizer(options) {\n  return useVirtualizerBase({\n    observeElementRect: _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeElementRect,\n    observeElementOffset: _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeElementOffset,\n    scrollToFn: _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.elementScroll,\n    ...options\n  });\n}\nfunction useWindowVirtualizer(options) {\n  return useVirtualizerBase({\n    getScrollElement: () => typeof document !== \"undefined\" ? window : null,\n    observeElementRect: _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeWindowRect,\n    observeElementOffset: _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.observeWindowOffset,\n    scrollToFn: _tanstack_virtual_core__WEBPACK_IMPORTED_MODULE_2__.windowScroll,\n    initialOffset: () => typeof document !== \"undefined\" ? window.scrollY : 0,\n    ...options\n  });\n}\n\n//# sourceMappingURL=index.js.map\n\n\n//# sourceURL=webpack://better-tasks/./node_modules/@tanstack/react-virtual/dist/esm/index.js?\n}");

/***/ },

/***/ "./node_modules/@tanstack/virtual-core/dist/esm/index.js"
/*!***************************************************************!*\
  !*** ./node_modules/@tanstack/virtual-core/dist/esm/index.js ***!
  \***************************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Virtualizer: () => (/* binding */ Virtualizer),\n/* harmony export */   approxEqual: () => (/* reexport safe */ _utils_js__WEBPACK_IMPORTED_MODULE_0__.approxEqual),\n/* harmony export */   debounce: () => (/* reexport safe */ _utils_js__WEBPACK_IMPORTED_MODULE_0__.debounce),\n/* harmony export */   defaultKeyExtractor: () => (/* binding */ defaultKeyExtractor),\n/* harmony export */   defaultRangeExtractor: () => (/* binding */ defaultRangeExtractor),\n/* harmony export */   elementScroll: () => (/* binding */ elementScroll),\n/* harmony export */   measureElement: () => (/* binding */ measureElement),\n/* harmony export */   memo: () => (/* reexport safe */ _utils_js__WEBPACK_IMPORTED_MODULE_0__.memo),\n/* harmony export */   notUndefined: () => (/* reexport safe */ _utils_js__WEBPACK_IMPORTED_MODULE_0__.notUndefined),\n/* harmony export */   observeElementOffset: () => (/* binding */ observeElementOffset),\n/* harmony export */   observeElementRect: () => (/* binding */ observeElementRect),\n/* harmony export */   observeWindowOffset: () => (/* binding */ observeWindowOffset),\n/* harmony export */   observeWindowRect: () => (/* binding */ observeWindowRect),\n/* harmony export */   windowScroll: () => (/* binding */ windowScroll)\n/* harmony export */ });\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./node_modules/@tanstack/virtual-core/dist/esm/utils.js\");\n\nconst getRect = (element) => {\n  const { offsetWidth, offsetHeight } = element;\n  return { width: offsetWidth, height: offsetHeight };\n};\nconst defaultKeyExtractor = (index) => index;\nconst defaultRangeExtractor = (range) => {\n  const start = Math.max(range.startIndex - range.overscan, 0);\n  const end = Math.min(range.endIndex + range.overscan, range.count - 1);\n  const arr = [];\n  for (let i = start; i <= end; i++) {\n    arr.push(i);\n  }\n  return arr;\n};\nconst observeElementRect = (instance, cb) => {\n  const element = instance.scrollElement;\n  if (!element) {\n    return;\n  }\n  const targetWindow = instance.targetWindow;\n  if (!targetWindow) {\n    return;\n  }\n  const handler = (rect) => {\n    const { width, height } = rect;\n    cb({ width: Math.round(width), height: Math.round(height) });\n  };\n  handler(getRect(element));\n  if (!targetWindow.ResizeObserver) {\n    return () => {\n    };\n  }\n  const observer = new targetWindow.ResizeObserver((entries) => {\n    const run = () => {\n      const entry = entries[0];\n      if (entry == null ? void 0 : entry.borderBoxSize) {\n        const box = entry.borderBoxSize[0];\n        if (box) {\n          handler({ width: box.inlineSize, height: box.blockSize });\n          return;\n        }\n      }\n      handler(getRect(element));\n    };\n    instance.options.useAnimationFrameWithResizeObserver ? requestAnimationFrame(run) : run();\n  });\n  observer.observe(element, { box: \"border-box\" });\n  return () => {\n    observer.unobserve(element);\n  };\n};\nconst addEventListenerOptions = {\n  passive: true\n};\nconst observeWindowRect = (instance, cb) => {\n  const element = instance.scrollElement;\n  if (!element) {\n    return;\n  }\n  const handler = () => {\n    cb({ width: element.innerWidth, height: element.innerHeight });\n  };\n  handler();\n  element.addEventListener(\"resize\", handler, addEventListenerOptions);\n  return () => {\n    element.removeEventListener(\"resize\", handler);\n  };\n};\nconst supportsScrollend = typeof window == \"undefined\" ? true : \"onscrollend\" in window;\nconst observeElementOffset = (instance, cb) => {\n  const element = instance.scrollElement;\n  if (!element) {\n    return;\n  }\n  const targetWindow = instance.targetWindow;\n  if (!targetWindow) {\n    return;\n  }\n  let offset = 0;\n  const fallback = instance.options.useScrollendEvent && supportsScrollend ? () => void 0 : (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.debounce)(\n    targetWindow,\n    () => {\n      cb(offset, false);\n    },\n    instance.options.isScrollingResetDelay\n  );\n  const createHandler = (isScrolling) => () => {\n    const { horizontal, isRtl } = instance.options;\n    offset = horizontal ? element[\"scrollLeft\"] * (isRtl && -1 || 1) : element[\"scrollTop\"];\n    fallback();\n    cb(offset, isScrolling);\n  };\n  const handler = createHandler(true);\n  const endHandler = createHandler(false);\n  element.addEventListener(\"scroll\", handler, addEventListenerOptions);\n  const registerScrollendEvent = instance.options.useScrollendEvent && supportsScrollend;\n  if (registerScrollendEvent) {\n    element.addEventListener(\"scrollend\", endHandler, addEventListenerOptions);\n  }\n  return () => {\n    element.removeEventListener(\"scroll\", handler);\n    if (registerScrollendEvent) {\n      element.removeEventListener(\"scrollend\", endHandler);\n    }\n  };\n};\nconst observeWindowOffset = (instance, cb) => {\n  const element = instance.scrollElement;\n  if (!element) {\n    return;\n  }\n  const targetWindow = instance.targetWindow;\n  if (!targetWindow) {\n    return;\n  }\n  let offset = 0;\n  const fallback = instance.options.useScrollendEvent && supportsScrollend ? () => void 0 : (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.debounce)(\n    targetWindow,\n    () => {\n      cb(offset, false);\n    },\n    instance.options.isScrollingResetDelay\n  );\n  const createHandler = (isScrolling) => () => {\n    offset = element[instance.options.horizontal ? \"scrollX\" : \"scrollY\"];\n    fallback();\n    cb(offset, isScrolling);\n  };\n  const handler = createHandler(true);\n  const endHandler = createHandler(false);\n  element.addEventListener(\"scroll\", handler, addEventListenerOptions);\n  const registerScrollendEvent = instance.options.useScrollendEvent && supportsScrollend;\n  if (registerScrollendEvent) {\n    element.addEventListener(\"scrollend\", endHandler, addEventListenerOptions);\n  }\n  return () => {\n    element.removeEventListener(\"scroll\", handler);\n    if (registerScrollendEvent) {\n      element.removeEventListener(\"scrollend\", endHandler);\n    }\n  };\n};\nconst measureElement = (element, entry, instance) => {\n  if (entry == null ? void 0 : entry.borderBoxSize) {\n    const box = entry.borderBoxSize[0];\n    if (box) {\n      const size = Math.round(\n        box[instance.options.horizontal ? \"inlineSize\" : \"blockSize\"]\n      );\n      return size;\n    }\n  }\n  return element[instance.options.horizontal ? \"offsetWidth\" : \"offsetHeight\"];\n};\nconst windowScroll = (offset, {\n  adjustments = 0,\n  behavior\n}, instance) => {\n  var _a, _b;\n  const toOffset = offset + adjustments;\n  (_b = (_a = instance.scrollElement) == null ? void 0 : _a.scrollTo) == null ? void 0 : _b.call(_a, {\n    [instance.options.horizontal ? \"left\" : \"top\"]: toOffset,\n    behavior\n  });\n};\nconst elementScroll = (offset, {\n  adjustments = 0,\n  behavior\n}, instance) => {\n  var _a, _b;\n  const toOffset = offset + adjustments;\n  (_b = (_a = instance.scrollElement) == null ? void 0 : _a.scrollTo) == null ? void 0 : _b.call(_a, {\n    [instance.options.horizontal ? \"left\" : \"top\"]: toOffset,\n    behavior\n  });\n};\nclass Virtualizer {\n  constructor(opts) {\n    this.unsubs = [];\n    this.scrollElement = null;\n    this.targetWindow = null;\n    this.isScrolling = false;\n    this.currentScrollToIndex = null;\n    this.measurementsCache = [];\n    this.itemSizeCache = /* @__PURE__ */ new Map();\n    this.laneAssignments = /* @__PURE__ */ new Map();\n    this.pendingMeasuredCacheIndexes = [];\n    this.prevLanes = void 0;\n    this.lanesChangedFlag = false;\n    this.lanesSettling = false;\n    this.scrollRect = null;\n    this.scrollOffset = null;\n    this.scrollDirection = null;\n    this.scrollAdjustments = 0;\n    this.elementsCache = /* @__PURE__ */ new Map();\n    this.observer = /* @__PURE__ */ (() => {\n      let _ro = null;\n      const get = () => {\n        if (_ro) {\n          return _ro;\n        }\n        if (!this.targetWindow || !this.targetWindow.ResizeObserver) {\n          return null;\n        }\n        return _ro = new this.targetWindow.ResizeObserver((entries) => {\n          entries.forEach((entry) => {\n            const run = () => {\n              this._measureElement(entry.target, entry);\n            };\n            this.options.useAnimationFrameWithResizeObserver ? requestAnimationFrame(run) : run();\n          });\n        });\n      };\n      return {\n        disconnect: () => {\n          var _a;\n          (_a = get()) == null ? void 0 : _a.disconnect();\n          _ro = null;\n        },\n        observe: (target) => {\n          var _a;\n          return (_a = get()) == null ? void 0 : _a.observe(target, { box: \"border-box\" });\n        },\n        unobserve: (target) => {\n          var _a;\n          return (_a = get()) == null ? void 0 : _a.unobserve(target);\n        }\n      };\n    })();\n    this.range = null;\n    this.setOptions = (opts2) => {\n      Object.entries(opts2).forEach(([key, value]) => {\n        if (typeof value === \"undefined\") delete opts2[key];\n      });\n      this.options = {\n        debug: false,\n        initialOffset: 0,\n        overscan: 1,\n        paddingStart: 0,\n        paddingEnd: 0,\n        scrollPaddingStart: 0,\n        scrollPaddingEnd: 0,\n        horizontal: false,\n        getItemKey: defaultKeyExtractor,\n        rangeExtractor: defaultRangeExtractor,\n        onChange: () => {\n        },\n        measureElement,\n        initialRect: { width: 0, height: 0 },\n        scrollMargin: 0,\n        gap: 0,\n        indexAttribute: \"data-index\",\n        initialMeasurementsCache: [],\n        lanes: 1,\n        isScrollingResetDelay: 150,\n        enabled: true,\n        isRtl: false,\n        useScrollendEvent: false,\n        useAnimationFrameWithResizeObserver: false,\n        ...opts2\n      };\n    };\n    this.notify = (sync) => {\n      var _a, _b;\n      (_b = (_a = this.options).onChange) == null ? void 0 : _b.call(_a, this, sync);\n    };\n    this.maybeNotify = (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.memo)(\n      () => {\n        this.calculateRange();\n        return [\n          this.isScrolling,\n          this.range ? this.range.startIndex : null,\n          this.range ? this.range.endIndex : null\n        ];\n      },\n      (isScrolling) => {\n        this.notify(isScrolling);\n      },\n      {\n        key:  true && \"maybeNotify\",\n        debug: () => this.options.debug,\n        initialDeps: [\n          this.isScrolling,\n          this.range ? this.range.startIndex : null,\n          this.range ? this.range.endIndex : null\n        ]\n      }\n    );\n    this.cleanup = () => {\n      this.unsubs.filter(Boolean).forEach((d) => d());\n      this.unsubs = [];\n      this.observer.disconnect();\n      this.scrollElement = null;\n      this.targetWindow = null;\n    };\n    this._didMount = () => {\n      return () => {\n        this.cleanup();\n      };\n    };\n    this._willUpdate = () => {\n      var _a;\n      const scrollElement = this.options.enabled ? this.options.getScrollElement() : null;\n      if (this.scrollElement !== scrollElement) {\n        this.cleanup();\n        if (!scrollElement) {\n          this.maybeNotify();\n          return;\n        }\n        this.scrollElement = scrollElement;\n        if (this.scrollElement && \"ownerDocument\" in this.scrollElement) {\n          this.targetWindow = this.scrollElement.ownerDocument.defaultView;\n        } else {\n          this.targetWindow = ((_a = this.scrollElement) == null ? void 0 : _a.window) ?? null;\n        }\n        this.elementsCache.forEach((cached) => {\n          this.observer.observe(cached);\n        });\n        this.unsubs.push(\n          this.options.observeElementRect(this, (rect) => {\n            this.scrollRect = rect;\n            this.maybeNotify();\n          })\n        );\n        this.unsubs.push(\n          this.options.observeElementOffset(this, (offset, isScrolling) => {\n            this.scrollAdjustments = 0;\n            this.scrollDirection = isScrolling ? this.getScrollOffset() < offset ? \"forward\" : \"backward\" : null;\n            this.scrollOffset = offset;\n            this.isScrolling = isScrolling;\n            this.maybeNotify();\n          })\n        );\n        this._scrollToOffset(this.getScrollOffset(), {\n          adjustments: void 0,\n          behavior: void 0\n        });\n      }\n    };\n    this.getSize = () => {\n      if (!this.options.enabled) {\n        this.scrollRect = null;\n        return 0;\n      }\n      this.scrollRect = this.scrollRect ?? this.options.initialRect;\n      return this.scrollRect[this.options.horizontal ? \"width\" : \"height\"];\n    };\n    this.getScrollOffset = () => {\n      if (!this.options.enabled) {\n        this.scrollOffset = null;\n        return 0;\n      }\n      this.scrollOffset = this.scrollOffset ?? (typeof this.options.initialOffset === \"function\" ? this.options.initialOffset() : this.options.initialOffset);\n      return this.scrollOffset;\n    };\n    this.getFurthestMeasurement = (measurements, index) => {\n      const furthestMeasurementsFound = /* @__PURE__ */ new Map();\n      const furthestMeasurements = /* @__PURE__ */ new Map();\n      for (let m = index - 1; m >= 0; m--) {\n        const measurement = measurements[m];\n        if (furthestMeasurementsFound.has(measurement.lane)) {\n          continue;\n        }\n        const previousFurthestMeasurement = furthestMeasurements.get(\n          measurement.lane\n        );\n        if (previousFurthestMeasurement == null || measurement.end > previousFurthestMeasurement.end) {\n          furthestMeasurements.set(measurement.lane, measurement);\n        } else if (measurement.end < previousFurthestMeasurement.end) {\n          furthestMeasurementsFound.set(measurement.lane, true);\n        }\n        if (furthestMeasurementsFound.size === this.options.lanes) {\n          break;\n        }\n      }\n      return furthestMeasurements.size === this.options.lanes ? Array.from(furthestMeasurements.values()).sort((a, b) => {\n        if (a.end === b.end) {\n          return a.index - b.index;\n        }\n        return a.end - b.end;\n      })[0] : void 0;\n    };\n    this.getMeasurementOptions = (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.memo)(\n      () => [\n        this.options.count,\n        this.options.paddingStart,\n        this.options.scrollMargin,\n        this.options.getItemKey,\n        this.options.enabled,\n        this.options.lanes\n      ],\n      (count, paddingStart, scrollMargin, getItemKey, enabled, lanes) => {\n        const lanesChanged = this.prevLanes !== void 0 && this.prevLanes !== lanes;\n        if (lanesChanged) {\n          this.lanesChangedFlag = true;\n        }\n        this.prevLanes = lanes;\n        this.pendingMeasuredCacheIndexes = [];\n        return {\n          count,\n          paddingStart,\n          scrollMargin,\n          getItemKey,\n          enabled,\n          lanes\n        };\n      },\n      {\n        key: false\n      }\n    );\n    this.getMeasurements = (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.memo)(\n      () => [this.getMeasurementOptions(), this.itemSizeCache],\n      ({ count, paddingStart, scrollMargin, getItemKey, enabled, lanes }, itemSizeCache) => {\n        if (!enabled) {\n          this.measurementsCache = [];\n          this.itemSizeCache.clear();\n          this.laneAssignments.clear();\n          return [];\n        }\n        if (this.laneAssignments.size > count) {\n          for (const index of this.laneAssignments.keys()) {\n            if (index >= count) {\n              this.laneAssignments.delete(index);\n            }\n          }\n        }\n        if (this.lanesChangedFlag) {\n          this.lanesChangedFlag = false;\n          this.lanesSettling = true;\n          this.measurementsCache = [];\n          this.itemSizeCache.clear();\n          this.laneAssignments.clear();\n          this.pendingMeasuredCacheIndexes = [];\n        }\n        if (this.measurementsCache.length === 0 && !this.lanesSettling) {\n          this.measurementsCache = this.options.initialMeasurementsCache;\n          this.measurementsCache.forEach((item) => {\n            this.itemSizeCache.set(item.key, item.size);\n          });\n        }\n        const min = this.lanesSettling ? 0 : this.pendingMeasuredCacheIndexes.length > 0 ? Math.min(...this.pendingMeasuredCacheIndexes) : 0;\n        this.pendingMeasuredCacheIndexes = [];\n        if (this.lanesSettling && this.measurementsCache.length === count) {\n          this.lanesSettling = false;\n        }\n        const measurements = this.measurementsCache.slice(0, min);\n        const laneLastIndex = new Array(lanes).fill(\n          void 0\n        );\n        for (let m = 0; m < min; m++) {\n          const item = measurements[m];\n          if (item) {\n            laneLastIndex[item.lane] = m;\n          }\n        }\n        for (let i = min; i < count; i++) {\n          const key = getItemKey(i);\n          const cachedLane = this.laneAssignments.get(i);\n          let lane;\n          let start;\n          if (cachedLane !== void 0 && this.options.lanes > 1) {\n            lane = cachedLane;\n            const prevIndex = laneLastIndex[lane];\n            const prevInLane = prevIndex !== void 0 ? measurements[prevIndex] : void 0;\n            start = prevInLane ? prevInLane.end + this.options.gap : paddingStart + scrollMargin;\n          } else {\n            const furthestMeasurement = this.options.lanes === 1 ? measurements[i - 1] : this.getFurthestMeasurement(measurements, i);\n            start = furthestMeasurement ? furthestMeasurement.end + this.options.gap : paddingStart + scrollMargin;\n            lane = furthestMeasurement ? furthestMeasurement.lane : i % this.options.lanes;\n            if (this.options.lanes > 1) {\n              this.laneAssignments.set(i, lane);\n            }\n          }\n          const measuredSize = itemSizeCache.get(key);\n          const size = typeof measuredSize === \"number\" ? measuredSize : this.options.estimateSize(i);\n          const end = start + size;\n          measurements[i] = {\n            index: i,\n            start,\n            size,\n            end,\n            key,\n            lane\n          };\n          laneLastIndex[lane] = i;\n        }\n        this.measurementsCache = measurements;\n        return measurements;\n      },\n      {\n        key:  true && \"getMeasurements\",\n        debug: () => this.options.debug\n      }\n    );\n    this.calculateRange = (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.memo)(\n      () => [\n        this.getMeasurements(),\n        this.getSize(),\n        this.getScrollOffset(),\n        this.options.lanes\n      ],\n      (measurements, outerSize, scrollOffset, lanes) => {\n        return this.range = measurements.length > 0 && outerSize > 0 ? calculateRange({\n          measurements,\n          outerSize,\n          scrollOffset,\n          lanes\n        }) : null;\n      },\n      {\n        key:  true && \"calculateRange\",\n        debug: () => this.options.debug\n      }\n    );\n    this.getVirtualIndexes = (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.memo)(\n      () => {\n        let startIndex = null;\n        let endIndex = null;\n        const range = this.calculateRange();\n        if (range) {\n          startIndex = range.startIndex;\n          endIndex = range.endIndex;\n        }\n        this.maybeNotify.updateDeps([this.isScrolling, startIndex, endIndex]);\n        return [\n          this.options.rangeExtractor,\n          this.options.overscan,\n          this.options.count,\n          startIndex,\n          endIndex\n        ];\n      },\n      (rangeExtractor, overscan, count, startIndex, endIndex) => {\n        return startIndex === null || endIndex === null ? [] : rangeExtractor({\n          startIndex,\n          endIndex,\n          overscan,\n          count\n        });\n      },\n      {\n        key:  true && \"getVirtualIndexes\",\n        debug: () => this.options.debug\n      }\n    );\n    this.indexFromElement = (node) => {\n      const attributeName = this.options.indexAttribute;\n      const indexStr = node.getAttribute(attributeName);\n      if (!indexStr) {\n        console.warn(\n          `Missing attribute name '${attributeName}={index}' on measured element.`\n        );\n        return -1;\n      }\n      return parseInt(indexStr, 10);\n    };\n    this._measureElement = (node, entry) => {\n      const index = this.indexFromElement(node);\n      const item = this.measurementsCache[index];\n      if (!item) {\n        return;\n      }\n      const key = item.key;\n      const prevNode = this.elementsCache.get(key);\n      if (prevNode !== node) {\n        if (prevNode) {\n          this.observer.unobserve(prevNode);\n        }\n        this.observer.observe(node);\n        this.elementsCache.set(key, node);\n      }\n      if (node.isConnected) {\n        this.resizeItem(index, this.options.measureElement(node, entry, this));\n      }\n    };\n    this.resizeItem = (index, size) => {\n      const item = this.measurementsCache[index];\n      if (!item) {\n        return;\n      }\n      const itemSize = this.itemSizeCache.get(item.key) ?? item.size;\n      const delta = size - itemSize;\n      if (delta !== 0) {\n        if (this.shouldAdjustScrollPositionOnItemSizeChange !== void 0 ? this.shouldAdjustScrollPositionOnItemSizeChange(item, delta, this) : item.start < this.getScrollOffset() + this.scrollAdjustments) {\n          if ( true && this.options.debug) {\n            console.info(\"correction\", delta);\n          }\n          this._scrollToOffset(this.getScrollOffset(), {\n            adjustments: this.scrollAdjustments += delta,\n            behavior: void 0\n          });\n        }\n        this.pendingMeasuredCacheIndexes.push(item.index);\n        this.itemSizeCache = new Map(this.itemSizeCache.set(item.key, size));\n        this.notify(false);\n      }\n    };\n    this.measureElement = (node) => {\n      if (!node) {\n        this.elementsCache.forEach((cached, key) => {\n          if (!cached.isConnected) {\n            this.observer.unobserve(cached);\n            this.elementsCache.delete(key);\n          }\n        });\n        return;\n      }\n      this._measureElement(node, void 0);\n    };\n    this.getVirtualItems = (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.memo)(\n      () => [this.getVirtualIndexes(), this.getMeasurements()],\n      (indexes, measurements) => {\n        const virtualItems = [];\n        for (let k = 0, len = indexes.length; k < len; k++) {\n          const i = indexes[k];\n          const measurement = measurements[i];\n          virtualItems.push(measurement);\n        }\n        return virtualItems;\n      },\n      {\n        key:  true && \"getVirtualItems\",\n        debug: () => this.options.debug\n      }\n    );\n    this.getVirtualItemForOffset = (offset) => {\n      const measurements = this.getMeasurements();\n      if (measurements.length === 0) {\n        return void 0;\n      }\n      return (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.notUndefined)(\n        measurements[findNearestBinarySearch(\n          0,\n          measurements.length - 1,\n          (index) => (0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.notUndefined)(measurements[index]).start,\n          offset\n        )]\n      );\n    };\n    this.getMaxScrollOffset = () => {\n      if (!this.scrollElement) return 0;\n      if (\"scrollHeight\" in this.scrollElement) {\n        return this.options.horizontal ? this.scrollElement.scrollWidth - this.scrollElement.clientWidth : this.scrollElement.scrollHeight - this.scrollElement.clientHeight;\n      } else {\n        const doc = this.scrollElement.document.documentElement;\n        return this.options.horizontal ? doc.scrollWidth - this.scrollElement.innerWidth : doc.scrollHeight - this.scrollElement.innerHeight;\n      }\n    };\n    this.getOffsetForAlignment = (toOffset, align, itemSize = 0) => {\n      if (!this.scrollElement) return 0;\n      const size = this.getSize();\n      const scrollOffset = this.getScrollOffset();\n      if (align === \"auto\") {\n        align = toOffset >= scrollOffset + size ? \"end\" : \"start\";\n      }\n      if (align === \"center\") {\n        toOffset += (itemSize - size) / 2;\n      } else if (align === \"end\") {\n        toOffset -= size;\n      }\n      const maxOffset = this.getMaxScrollOffset();\n      return Math.max(Math.min(maxOffset, toOffset), 0);\n    };\n    this.getOffsetForIndex = (index, align = \"auto\") => {\n      index = Math.max(0, Math.min(index, this.options.count - 1));\n      const item = this.measurementsCache[index];\n      if (!item) {\n        return void 0;\n      }\n      const size = this.getSize();\n      const scrollOffset = this.getScrollOffset();\n      if (align === \"auto\") {\n        if (item.end >= scrollOffset + size - this.options.scrollPaddingEnd) {\n          align = \"end\";\n        } else if (item.start <= scrollOffset + this.options.scrollPaddingStart) {\n          align = \"start\";\n        } else {\n          return [scrollOffset, align];\n        }\n      }\n      if (align === \"end\" && index === this.options.count - 1) {\n        return [this.getMaxScrollOffset(), align];\n      }\n      const toOffset = align === \"end\" ? item.end + this.options.scrollPaddingEnd : item.start - this.options.scrollPaddingStart;\n      return [\n        this.getOffsetForAlignment(toOffset, align, item.size),\n        align\n      ];\n    };\n    this.isDynamicMode = () => this.elementsCache.size > 0;\n    this.scrollToOffset = (toOffset, { align = \"start\", behavior } = {}) => {\n      if (behavior === \"smooth\" && this.isDynamicMode()) {\n        console.warn(\n          \"The `smooth` scroll behavior is not fully supported with dynamic size.\"\n        );\n      }\n      this._scrollToOffset(this.getOffsetForAlignment(toOffset, align), {\n        adjustments: void 0,\n        behavior\n      });\n    };\n    this.scrollToIndex = (index, { align: initialAlign = \"auto\", behavior } = {}) => {\n      if (behavior === \"smooth\" && this.isDynamicMode()) {\n        console.warn(\n          \"The `smooth` scroll behavior is not fully supported with dynamic size.\"\n        );\n      }\n      index = Math.max(0, Math.min(index, this.options.count - 1));\n      this.currentScrollToIndex = index;\n      let attempts = 0;\n      const maxAttempts = 10;\n      const tryScroll = (currentAlign) => {\n        if (!this.targetWindow) return;\n        const offsetInfo = this.getOffsetForIndex(index, currentAlign);\n        if (!offsetInfo) {\n          console.warn(\"Failed to get offset for index:\", index);\n          return;\n        }\n        const [offset, align] = offsetInfo;\n        this._scrollToOffset(offset, { adjustments: void 0, behavior });\n        this.targetWindow.requestAnimationFrame(() => {\n          const verify = () => {\n            if (this.currentScrollToIndex !== index) return;\n            const currentOffset = this.getScrollOffset();\n            const afterInfo = this.getOffsetForIndex(index, align);\n            if (!afterInfo) {\n              console.warn(\"Failed to get offset for index:\", index);\n              return;\n            }\n            if (!(0,_utils_js__WEBPACK_IMPORTED_MODULE_0__.approxEqual)(afterInfo[0], currentOffset)) {\n              scheduleRetry(align);\n            }\n          };\n          if (this.isDynamicMode()) {\n            this.targetWindow.requestAnimationFrame(verify);\n          } else {\n            verify();\n          }\n        });\n      };\n      const scheduleRetry = (align) => {\n        if (!this.targetWindow) return;\n        if (this.currentScrollToIndex !== index) return;\n        attempts++;\n        if (attempts < maxAttempts) {\n          if ( true && this.options.debug) {\n            console.info(\"Schedule retry\", attempts, maxAttempts);\n          }\n          this.targetWindow.requestAnimationFrame(() => tryScroll(align));\n        } else {\n          console.warn(\n            `Failed to scroll to index ${index} after ${maxAttempts} attempts.`\n          );\n        }\n      };\n      tryScroll(initialAlign);\n    };\n    this.scrollBy = (delta, { behavior } = {}) => {\n      if (behavior === \"smooth\" && this.isDynamicMode()) {\n        console.warn(\n          \"The `smooth` scroll behavior is not fully supported with dynamic size.\"\n        );\n      }\n      this._scrollToOffset(this.getScrollOffset() + delta, {\n        adjustments: void 0,\n        behavior\n      });\n    };\n    this.getTotalSize = () => {\n      var _a;\n      const measurements = this.getMeasurements();\n      let end;\n      if (measurements.length === 0) {\n        end = this.options.paddingStart;\n      } else if (this.options.lanes === 1) {\n        end = ((_a = measurements[measurements.length - 1]) == null ? void 0 : _a.end) ?? 0;\n      } else {\n        const endByLane = Array(this.options.lanes).fill(null);\n        let endIndex = measurements.length - 1;\n        while (endIndex >= 0 && endByLane.some((val) => val === null)) {\n          const item = measurements[endIndex];\n          if (endByLane[item.lane] === null) {\n            endByLane[item.lane] = item.end;\n          }\n          endIndex--;\n        }\n        end = Math.max(...endByLane.filter((val) => val !== null));\n      }\n      return Math.max(\n        end - this.options.scrollMargin + this.options.paddingEnd,\n        0\n      );\n    };\n    this._scrollToOffset = (offset, {\n      adjustments,\n      behavior\n    }) => {\n      this.options.scrollToFn(offset, { behavior, adjustments }, this);\n    };\n    this.measure = () => {\n      this.itemSizeCache = /* @__PURE__ */ new Map();\n      this.laneAssignments = /* @__PURE__ */ new Map();\n      this.notify(false);\n    };\n    this.setOptions(opts);\n  }\n}\nconst findNearestBinarySearch = (low, high, getCurrentValue, value) => {\n  while (low <= high) {\n    const middle = (low + high) / 2 | 0;\n    const currentValue = getCurrentValue(middle);\n    if (currentValue < value) {\n      low = middle + 1;\n    } else if (currentValue > value) {\n      high = middle - 1;\n    } else {\n      return middle;\n    }\n  }\n  if (low > 0) {\n    return low - 1;\n  } else {\n    return 0;\n  }\n};\nfunction calculateRange({\n  measurements,\n  outerSize,\n  scrollOffset,\n  lanes\n}) {\n  const lastIndex = measurements.length - 1;\n  const getOffset = (index) => measurements[index].start;\n  if (measurements.length <= lanes) {\n    return {\n      startIndex: 0,\n      endIndex: lastIndex\n    };\n  }\n  let startIndex = findNearestBinarySearch(\n    0,\n    lastIndex,\n    getOffset,\n    scrollOffset\n  );\n  let endIndex = startIndex;\n  if (lanes === 1) {\n    while (endIndex < lastIndex && measurements[endIndex].end < scrollOffset + outerSize) {\n      endIndex++;\n    }\n  } else if (lanes > 1) {\n    const endPerLane = Array(lanes).fill(0);\n    while (endIndex < lastIndex && endPerLane.some((pos) => pos < scrollOffset + outerSize)) {\n      const item = measurements[endIndex];\n      endPerLane[item.lane] = item.end;\n      endIndex++;\n    }\n    const startPerLane = Array(lanes).fill(scrollOffset + outerSize);\n    while (startIndex >= 0 && startPerLane.some((pos) => pos >= scrollOffset)) {\n      const item = measurements[startIndex];\n      startPerLane[item.lane] = item.start;\n      startIndex--;\n    }\n    startIndex = Math.max(0, startIndex - startIndex % lanes);\n    endIndex = Math.min(lastIndex, endIndex + (lanes - 1 - endIndex % lanes));\n  }\n  return { startIndex, endIndex };\n}\n\n//# sourceMappingURL=index.js.map\n\n\n//# sourceURL=webpack://better-tasks/./node_modules/@tanstack/virtual-core/dist/esm/index.js?\n}");

/***/ },

/***/ "./node_modules/@tanstack/virtual-core/dist/esm/utils.js"
/*!***************************************************************!*\
  !*** ./node_modules/@tanstack/virtual-core/dist/esm/utils.js ***!
  \***************************************************************/
(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   approxEqual: () => (/* binding */ approxEqual),\n/* harmony export */   debounce: () => (/* binding */ debounce),\n/* harmony export */   memo: () => (/* binding */ memo),\n/* harmony export */   notUndefined: () => (/* binding */ notUndefined)\n/* harmony export */ });\nfunction memo(getDeps, fn, opts) {\n  let deps = opts.initialDeps ?? [];\n  let result;\n  let isInitial = true;\n  function memoizedFunction() {\n    var _a, _b, _c;\n    let depTime;\n    if (opts.key && ((_a = opts.debug) == null ? void 0 : _a.call(opts))) depTime = Date.now();\n    const newDeps = getDeps();\n    const depsChanged = newDeps.length !== deps.length || newDeps.some((dep, index) => deps[index] !== dep);\n    if (!depsChanged) {\n      return result;\n    }\n    deps = newDeps;\n    let resultTime;\n    if (opts.key && ((_b = opts.debug) == null ? void 0 : _b.call(opts))) resultTime = Date.now();\n    result = fn(...newDeps);\n    if (opts.key && ((_c = opts.debug) == null ? void 0 : _c.call(opts))) {\n      const depEndTime = Math.round((Date.now() - depTime) * 100) / 100;\n      const resultEndTime = Math.round((Date.now() - resultTime) * 100) / 100;\n      const resultFpsPercentage = resultEndTime / 16;\n      const pad = (str, num) => {\n        str = String(str);\n        while (str.length < num) {\n          str = \" \" + str;\n        }\n        return str;\n      };\n      console.info(\n        `%câ± ${pad(resultEndTime, 5)} /${pad(depEndTime, 5)} ms`,\n        `\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(\n          0,\n          Math.min(120 - 120 * resultFpsPercentage, 120)\n        )}deg 100% 31%);`,\n        opts == null ? void 0 : opts.key\n      );\n    }\n    if ((opts == null ? void 0 : opts.onChange) && !(isInitial && opts.skipInitialOnChange)) {\n      opts.onChange(result);\n    }\n    isInitial = false;\n    return result;\n  }\n  memoizedFunction.updateDeps = (newDeps) => {\n    deps = newDeps;\n  };\n  return memoizedFunction;\n}\nfunction notUndefined(value, msg) {\n  if (value === void 0) {\n    throw new Error(`Unexpected undefined${msg ? `: ${msg}` : \"\"}`);\n  } else {\n    return value;\n  }\n}\nconst approxEqual = (a, b) => Math.abs(a - b) < 1.01;\nconst debounce = (targetWindow, fn, ms) => {\n  let timeoutId;\n  return function(...args) {\n    targetWindow.clearTimeout(timeoutId);\n    timeoutId = targetWindow.setTimeout(() => fn.apply(this, args), ms);\n  };\n};\n\n//# sourceMappingURL=utils.js.map\n\n\n//# sourceURL=webpack://better-tasks/./node_modules/@tanstack/virtual-core/dist/esm/utils.js?\n}");

/***/ },

/***/ "./node_modules/izitoast/dist/js/iziToast.js"
/*!***************************************************!*\
  !*** ./node_modules/izitoast/dist/js/iziToast.js ***!
  \***************************************************/
(module, exports, __webpack_require__) {

eval("{var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*\r\n* iziToast | v1.4.0\r\n* http://izitoast.marcelodolce.com\r\n* by Marcelo Dolce.\r\n*/\r\n(function (root, factory) {\r\n\tif(true) {\r\n\t\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory(root)),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n\t} else // removed by dead control flow\n{}\r\n})(typeof __webpack_require__.g !== 'undefined' ? __webpack_require__.g : window || this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\t//\r\n\t// Variables\r\n\t//\r\n\tvar $iziToast = {},\r\n\t\tPLUGIN_NAME = 'iziToast',\r\n\t\tBODY = document.querySelector('body'),\r\n\t\tISMOBILE = (/Mobi/.test(navigator.userAgent)) ? true : false,\r\n\t\tISCHROME = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor),\r\n\t\tISFIREFOX = typeof InstallTrigger !== 'undefined',\r\n\t\tACCEPTSTOUCH = 'ontouchstart' in document.documentElement,\r\n\t\tPOSITIONS = ['bottomRight','bottomLeft','bottomCenter','topRight','topLeft','topCenter','center'],\r\n\t\tTHEMES = {\r\n\t\t\tinfo: {\r\n\t\t\t\tcolor: 'blue',\r\n\t\t\t\ticon: 'ico-info'\r\n\t\t\t},\r\n\t\t\tsuccess: {\r\n\t\t\t\tcolor: 'green',\r\n\t\t\t\ticon: 'ico-success'\r\n\t\t\t},\r\n\t\t\twarning: {\r\n\t\t\t\tcolor: 'orange',\r\n\t\t\t\ticon: 'ico-warning'\r\n\t\t\t},\r\n\t\t\terror: {\r\n\t\t\t\tcolor: 'red',\r\n\t\t\t\ticon: 'ico-error'\r\n\t\t\t},\r\n\t\t\tquestion: {\r\n\t\t\t\tcolor: 'yellow',\r\n\t\t\t\ticon: 'ico-question'\r\n\t\t\t}\r\n\t\t},\r\n\t\tMOBILEWIDTH = 568,\r\n\t\tCONFIG = {};\r\n\r\n\t$iziToast.children = {};\r\n\r\n\t// Default settings\r\n\tvar defaults = {\r\n\t\tid: null, \r\n\t\tclass: '',\r\n\t\ttitle: '',\r\n\t\ttitleColor: '',\r\n\t\ttitleSize: '',\r\n\t\ttitleLineHeight: '',\r\n\t\tmessage: '',\r\n\t\tmessageColor: '',\r\n\t\tmessageSize: '',\r\n\t\tmessageLineHeight: '',\r\n\t\tbackgroundColor: '',\r\n\t\ttheme: 'light', // dark\r\n\t\tcolor: '', // blue, red, green, yellow\r\n\t\ticon: '',\r\n\t\ticonText: '',\r\n\t\ticonColor: '',\r\n\t\ticonUrl: null,\r\n\t\timage: '',\r\n\t\timageWidth: 50,\r\n\t\tmaxWidth: null,\r\n\t\tzindex: null,\r\n\t\tlayout: 1,\r\n\t\tballoon: false,\r\n\t\tclose: true,\r\n\t\tcloseOnEscape: false,\r\n\t\tcloseOnClick: false,\r\n\t\tdisplayMode: 0,\r\n\t\tposition: 'bottomRight', // bottomRight, bottomLeft, topRight, topLeft, topCenter, bottomCenter, center\r\n\t\ttarget: '',\r\n\t\ttargetFirst: true,\r\n\t\ttimeout: 5000,\r\n\t\trtl: false,\r\n\t\tanimateInside: true,\r\n\t\tdrag: true,\r\n\t\tpauseOnHover: true,\r\n\t\tresetOnHover: false,\r\n\t\tprogressBar: true,\r\n\t\tprogressBarColor: '',\r\n\t\tprogressBarEasing: 'linear',\r\n\t\toverlay: false,\r\n\t\toverlayClose: false,\r\n\t\toverlayColor: 'rgba(0, 0, 0, 0.6)',\r\n\t\ttransitionIn: 'fadeInUp', // bounceInLeft, bounceInRight, bounceInUp, bounceInDown, fadeIn, fadeInDown, fadeInUp, fadeInLeft, fadeInRight, flipInX\r\n\t\ttransitionOut: 'fadeOut', // fadeOut, fadeOutUp, fadeOutDown, fadeOutLeft, fadeOutRight, flipOutX\r\n\t\ttransitionInMobile: 'fadeInUp',\r\n\t\ttransitionOutMobile: 'fadeOutDown',\r\n\t\tbuttons: {},\r\n\t\tinputs: {},\r\n\t\tonOpening: function () {},\r\n\t\tonOpened: function () {},\r\n\t\tonClosing: function () {},\r\n\t\tonClosed: function () {}\r\n\t};\r\n\r\n\t//\r\n\t// Methods\r\n\t//\r\n\r\n\r\n\t/**\r\n\t * Polyfill for remove() method\r\n\t */\r\n\tif(!('remove' in Element.prototype)) {\r\n\t    Element.prototype.remove = function() {\r\n\t        if(this.parentNode) {\r\n\t            this.parentNode.removeChild(this);\r\n\t        }\r\n\t    };\r\n\t}\r\n\r\n\t/*\r\n     * Polyfill for CustomEvent for IE >= 9\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Polyfill\r\n     */\r\n    if(typeof window.CustomEvent !== 'function') {\r\n        var CustomEventPolyfill = function (event, params) {\r\n            params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n            var evt = document.createEvent('CustomEvent');\r\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\r\n            return evt;\r\n        };\r\n\r\n        CustomEventPolyfill.prototype = window.Event.prototype;\r\n\r\n        window.CustomEvent = CustomEventPolyfill;\r\n    }\r\n\r\n\t/**\r\n\t * A simple forEach() implementation for Arrays, Objects and NodeLists\r\n\t * @private\r\n\t * @param {Array|Object|NodeList} collection Collection of items to iterate\r\n\t * @param {Function} callback Callback function for each iteration\r\n\t * @param {Array|Object|NodeList} scope Object/NodeList/Array that forEach is iterating over (aka `this`)\r\n\t */\r\n\tvar forEach = function (collection, callback, scope) {\r\n\t\tif(Object.prototype.toString.call(collection) === '[object Object]') {\r\n\t\t\tfor (var prop in collection) {\r\n\t\t\t\tif(Object.prototype.hasOwnProperty.call(collection, prop)) {\r\n\t\t\t\t\tcallback.call(scope, collection[prop], prop, collection);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(collection){\r\n\t\t\t\tfor (var i = 0, len = collection.length; i < len; i++) {\r\n\t\t\t\t\tcallback.call(scope, collection[i], i, collection);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Merge defaults with user options\r\n\t * @private\r\n\t * @param {Object} defaults Default settings\r\n\t * @param {Object} options User options\r\n\t * @returns {Object} Merged values of defaults and options\r\n\t */\r\n\tvar extend = function (defaults, options) {\r\n\t\tvar extended = {};\r\n\t\tforEach(defaults, function (value, prop) {\r\n\t\t\textended[prop] = defaults[prop];\r\n\t\t});\r\n\t\tforEach(options, function (value, prop) {\r\n\t\t\textended[prop] = options[prop];\r\n\t\t});\r\n\t\treturn extended;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Create a fragment DOM elements\r\n\t * @private\r\n\t */\r\n\tvar createFragElem = function(htmlStr) {\r\n\t\tvar frag = document.createDocumentFragment(),\r\n\t\t\ttemp = document.createElement('div');\r\n\t\ttemp.innerHTML = htmlStr;\r\n\t\twhile (temp.firstChild) {\r\n\t\t\tfrag.appendChild(temp.firstChild);\r\n\t\t}\r\n\t\treturn frag;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Generate new ID\r\n\t * @private\r\n\t */\r\n\tvar generateId = function(params) {\r\n\t\tvar newId = btoa(encodeURIComponent(params));\r\n\t\treturn newId.replace(/=/g, \"\");\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Check if is a color\r\n\t * @private\r\n\t */\r\n\tvar isColor = function(color){\r\n\t\tif( color.substring(0,1) == '#' || color.substring(0,3) == 'rgb' || color.substring(0,3) == 'hsl' ){\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Check if is a Base64 string\r\n\t * @private\r\n\t */\r\n\tvar isBase64 = function(str) {\r\n\t    try {\r\n\t        return btoa(atob(str)) == str;\r\n\t    } catch (err) {\r\n\t        return false;\r\n\t    }\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Drag method of toasts\r\n\t * @private\r\n\t */\r\n\tvar drag = function() {\r\n\t    \r\n\t    return {\r\n\t        move: function(toast, instance, settings, xpos) {\r\n\r\n\t        \tvar opacity,\r\n\t        \t\topacityRange = 0.3,\r\n\t        \t\tdistance = 180;\r\n\t            \r\n\t            if(xpos !== 0){\r\n\t            \t\r\n\t            \ttoast.classList.add(PLUGIN_NAME+'-dragged');\r\n\r\n\t            \ttoast.style.transform = 'translateX('+xpos + 'px)';\r\n\r\n\t\t            if(xpos > 0){\r\n\t\t            \topacity = (distance-xpos) / distance;\r\n\t\t            \tif(opacity < opacityRange){\r\n\t\t\t\t\t\t\tinstance.hide(extend(settings, { transitionOut: 'fadeOutRight', transitionOutMobile: 'fadeOutRight' }), toast, 'drag');\r\n\t\t\t\t\t\t}\r\n\t\t            } else {\r\n\t\t            \topacity = (distance+xpos) / distance;\r\n\t\t            \tif(opacity < opacityRange){\r\n\t\t\t\t\t\t\tinstance.hide(extend(settings, { transitionOut: 'fadeOutLeft', transitionOutMobile: 'fadeOutLeft' }), toast, 'drag');\r\n\t\t\t\t\t\t}\r\n\t\t            }\r\n\t\t\t\t\ttoast.style.opacity = opacity;\r\n\t\t\t\r\n\t\t\t\t\tif(opacity < opacityRange){\r\n\r\n\t\t\t\t\t\tif(ISCHROME || ISFIREFOX)\r\n\t\t\t\t\t\t\ttoast.style.left = xpos+'px';\r\n\r\n\t\t\t\t\t\ttoast.parentNode.style.opacity = opacityRange;\r\n\r\n\t\t                this.stopMoving(toast, null);\r\n\t\t\t\t\t}\r\n\t            }\r\n\r\n\t\t\t\t\r\n\t        },\r\n\t        startMoving: function(toast, instance, settings, e) {\r\n\r\n\t            e = e || window.event;\r\n\t            var posX = ((ACCEPTSTOUCH) ? e.touches[0].clientX : e.clientX),\r\n\t                toastLeft = toast.style.transform.replace('px)', '');\r\n\t                toastLeft = toastLeft.replace('translateX(', '');\r\n\t            var offsetX = posX - toastLeft;\r\n\r\n\t\t\t\tif(settings.transitionIn){\r\n\t\t\t\t\ttoast.classList.remove(settings.transitionIn);\r\n\t\t\t\t}\r\n\t\t\t\tif(settings.transitionInMobile){\r\n\t\t\t\t\ttoast.classList.remove(settings.transitionInMobile);\r\n\t\t\t\t}\r\n\t\t\t\ttoast.style.transition = '';\r\n\r\n\t            if(ACCEPTSTOUCH) {\r\n\t                document.ontouchmove = function(e) {\r\n\t                    e.preventDefault();\r\n\t                    e = e || window.event;\r\n\t                    var posX = e.touches[0].clientX,\r\n\t                        finalX = posX - offsetX;\r\n                        drag.move(toast, instance, settings, finalX);\r\n\t                };\r\n\t            } else {\r\n\t                document.onmousemove = function(e) {\r\n\t                    e.preventDefault();\r\n\t                    e = e || window.event;\r\n\t                    var posX = e.clientX,\r\n\t                        finalX = posX - offsetX;\r\n                        drag.move(toast, instance, settings, finalX);\r\n\t                };\r\n\t            }\r\n\r\n\t        },\r\n\t        stopMoving: function(toast, e) {\r\n\r\n\t            if(ACCEPTSTOUCH) {\r\n\t                document.ontouchmove = function() {};\r\n\t            } else {\r\n\t            \tdocument.onmousemove = function() {};\r\n\t            }\r\n\r\n\t\t\t\ttoast.style.opacity = '';\r\n\t\t\t\ttoast.style.transform = '';\r\n\r\n\t            if(toast.classList.contains(PLUGIN_NAME+'-dragged')){\r\n\t            \t\r\n\t            \ttoast.classList.remove(PLUGIN_NAME+'-dragged');\r\n\r\n\t\t\t\t\ttoast.style.transition = 'transform 0.4s ease, opacity 0.4s ease';\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\ttoast.style.transition = '';\r\n\t\t\t\t\t}, 400);\r\n\t            }\r\n\r\n\t        }\r\n\t    };\r\n\r\n\t}();\r\n\r\n\r\n\r\n\r\n\r\n\t$iziToast.setSetting = function (ref, option, value) {\r\n\r\n\t\t$iziToast.children[ref][option] = value;\r\n\r\n\t};\r\n\r\n\r\n\t$iziToast.getSetting = function (ref, option) {\r\n\r\n\t\treturn $iziToast.children[ref][option];\r\n\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Destroy the current initialization.\r\n\t * @public\r\n\t */\r\n\t$iziToast.destroy = function () {\r\n\r\n\t\tforEach(document.querySelectorAll('.'+PLUGIN_NAME+'-overlay'), function(element, index) {\r\n\t\t\telement.remove();\r\n\t\t});\r\n\r\n\t\tforEach(document.querySelectorAll('.'+PLUGIN_NAME+'-wrapper'), function(element, index) {\r\n\t\t\telement.remove();\r\n\t\t});\r\n\r\n\t\tforEach(document.querySelectorAll('.'+PLUGIN_NAME), function(element, index) {\r\n\t\t\telement.remove();\r\n\t\t});\r\n\r\n\t\tthis.children = {};\r\n\r\n\t\t// Remove event listeners\r\n\t\tdocument.removeEventListener(PLUGIN_NAME+'-opened', {}, false);\r\n\t\tdocument.removeEventListener(PLUGIN_NAME+'-opening', {}, false);\r\n\t\tdocument.removeEventListener(PLUGIN_NAME+'-closing', {}, false);\r\n\t\tdocument.removeEventListener(PLUGIN_NAME+'-closed', {}, false);\r\n\t\tdocument.removeEventListener('keyup', {}, false);\r\n\r\n\t\t// Reset variables\r\n\t\tCONFIG = {};\r\n\t};\r\n\r\n\t/**\r\n\t * Initialize Plugin\r\n\t * @public\r\n\t * @param {Object} options User settings\r\n\t */\r\n\t$iziToast.settings = function (options) {\r\n\r\n\t\t// Destroy any existing initializations\r\n\t\t$iziToast.destroy();\r\n\r\n\t\tCONFIG = options;\r\n\t\tdefaults = extend(defaults, options || {});\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Building themes functions.\r\n\t * @public\r\n\t * @param {Object} options User settings\r\n\t */\r\n\tforEach(THEMES, function (theme, name) {\r\n\r\n\t\t$iziToast[name] = function (options) {\r\n\r\n\t\t\tvar settings = extend(CONFIG, options || {});\r\n\t\t\tsettings = extend(theme, settings || {});\r\n\r\n\t\t\tthis.show(settings);\r\n\t\t};\r\n\r\n\t});\r\n\r\n\r\n\t/**\r\n\t * Do the calculation to move the progress bar\r\n\t * @private\r\n\t */\r\n\t$iziToast.progress = function (options, $toast, callback) {\r\n\r\n\r\n\t\tvar that = this,\r\n\t\t\tref = $toast.getAttribute('data-iziToast-ref'),\r\n\t\t\tsettings = extend(this.children[ref], options || {}),\r\n\t\t\t$elem = $toast.querySelector('.'+PLUGIN_NAME+'-progressbar div');\r\n\r\n\t    return {\r\n\t        start: function() {\r\n\r\n\t        \tif(typeof settings.time.REMAINING == 'undefined'){\r\n\r\n\t        \t\t$toast.classList.remove(PLUGIN_NAME+'-reseted');\r\n\r\n\t\t        \tif($elem !== null){\r\n\t\t\t\t\t\t$elem.style.transition = 'width '+ settings.timeout +'ms '+settings.progressBarEasing;\r\n\t\t\t\t\t\t$elem.style.width = '0%';\r\n\t\t\t\t\t}\r\n\r\n\t\t        \tsettings.time.START = new Date().getTime();\r\n\t\t        \tsettings.time.END = settings.time.START + settings.timeout;\r\n\t\t\t\t\tsettings.time.TIMER = setTimeout(function() {\r\n\r\n\t\t\t\t\t\tclearTimeout(settings.time.TIMER);\r\n\r\n\t\t\t\t\t\tif(!$toast.classList.contains(PLUGIN_NAME+'-closing')){\r\n\r\n\t\t\t\t\t\t\tthat.hide(settings, $toast, 'timeout');\r\n\r\n\t\t\t\t\t\t\tif(typeof callback === 'function'){\r\n\t\t\t\t\t\t\t\tcallback.apply(that);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}, settings.timeout);\t\t\t\r\n\t\t        \tthat.setSetting(ref, 'time', settings.time);\r\n\t        \t}\r\n\t        },\r\n\t        pause: function() {\r\n\r\n\t        \tif(typeof settings.time.START !== 'undefined' && !$toast.classList.contains(PLUGIN_NAME+'-paused') && !$toast.classList.contains(PLUGIN_NAME+'-reseted')){\r\n\r\n        \t\t\t$toast.classList.add(PLUGIN_NAME+'-paused');\r\n\r\n\t\t\t\t\tsettings.time.REMAINING = settings.time.END - new Date().getTime();\r\n\r\n\t\t\t\t\tclearTimeout(settings.time.TIMER);\r\n\r\n\t\t\t\t\tthat.setSetting(ref, 'time', settings.time);\r\n\r\n\t\t\t\t\tif($elem !== null){\r\n\t\t\t\t\t\tvar computedStyle = window.getComputedStyle($elem),\r\n\t\t\t\t\t\t\tpropertyWidth = computedStyle.getPropertyValue('width');\r\n\r\n\t\t\t\t\t\t$elem.style.transition = 'none';\r\n\t\t\t\t\t\t$elem.style.width = propertyWidth;\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(typeof callback === 'function'){\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tcallback.apply(that);\t\t\t\t\t\t\r\n\t\t\t\t\t\t}, 10);\r\n\t\t\t\t\t}\r\n        \t\t}\r\n\t        },\r\n\t        resume: function() {\r\n\r\n\t\t\t\tif(typeof settings.time.REMAINING !== 'undefined'){\r\n\r\n\t\t\t\t\t$toast.classList.remove(PLUGIN_NAME+'-paused');\r\n\r\n\t\t        \tif($elem !== null){\r\n\t\t\t\t\t\t$elem.style.transition = 'width '+ settings.time.REMAINING +'ms '+settings.progressBarEasing;\r\n\t\t\t\t\t\t$elem.style.width = '0%';\r\n\t\t\t\t\t}\r\n\r\n\t\t        \tsettings.time.END = new Date().getTime() + settings.time.REMAINING;\r\n\t\t\t\t\tsettings.time.TIMER = setTimeout(function() {\r\n\r\n\t\t\t\t\t\tclearTimeout(settings.time.TIMER);\r\n\r\n\t\t\t\t\t\tif(!$toast.classList.contains(PLUGIN_NAME+'-closing')){\r\n\r\n\t\t\t\t\t\t\tthat.hide(settings, $toast, 'timeout');\r\n\r\n\t\t\t\t\t\t\tif(typeof callback === 'function'){\r\n\t\t\t\t\t\t\t\tcallback.apply(that);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t}, settings.time.REMAINING);\r\n\r\n\t\t\t\t\tthat.setSetting(ref, 'time', settings.time);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.start();\r\n\t\t\t\t}\r\n\t        },\r\n\t        reset: function(){\r\n\r\n\t\t\t\tclearTimeout(settings.time.TIMER);\r\n\r\n\t\t\t\tdelete settings.time.REMAINING;\r\n\r\n\t\t\t\tthat.setSetting(ref, 'time', settings.time);\r\n\r\n\t\t\t\t$toast.classList.add(PLUGIN_NAME+'-reseted');\r\n\r\n\t\t\t\t$toast.classList.remove(PLUGIN_NAME+'-paused');\r\n\r\n\t\t\t\tif($elem !== null){\r\n\t\t\t\t\t$elem.style.transition = 'none';\r\n\t\t\t\t\t$elem.style.width = '100%';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof callback === 'function'){\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tcallback.apply(that);\t\t\t\t\t\t\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t}\r\n\t        }\r\n\t    };\r\n\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Close the specific Toast\r\n\t * @public\r\n\t * @param {Object} options User settings\r\n\t */\r\n\t$iziToast.hide = function (options, $toast, closedBy) {\r\n\r\n\t\tif(typeof $toast != 'object'){\r\n\t\t\t$toast = document.querySelector($toast);\r\n\t\t}\t\t\r\n\r\n\t\tvar that = this,\r\n\t\t\tsettings = extend(this.children[$toast.getAttribute('data-iziToast-ref')], options || {});\r\n\t\t\tsettings.closedBy = closedBy || null;\r\n\r\n\t\tdelete settings.time.REMAINING;\r\n\r\n\t\t$toast.classList.add(PLUGIN_NAME+'-closing');\r\n\r\n\t\t// Overlay\r\n\t\t(function(){\r\n\r\n\t\t\tvar $overlay = document.querySelector('.'+PLUGIN_NAME+'-overlay');\r\n\t\t\tif($overlay !== null){\r\n\t\t\t\tvar refs = $overlay.getAttribute('data-iziToast-ref');\t\t\r\n\t\t\t\t\trefs = refs.split(',');\r\n\t\t\t\tvar index = refs.indexOf(String(settings.ref));\r\n\r\n\t\t\t\tif(index !== -1){\r\n\t\t\t\t\trefs.splice(index, 1);\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t$overlay.setAttribute('data-iziToast-ref', refs.join());\r\n\r\n\t\t\t\tif(refs.length === 0){\r\n\t\t\t\t\t$overlay.classList.remove('fadeIn');\r\n\t\t\t\t\t$overlay.classList.add('fadeOut');\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t$overlay.remove();\r\n\t\t\t\t\t}, 700);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t})();\r\n\r\n\t\tif(settings.transitionIn){\r\n\t\t\t$toast.classList.remove(settings.transitionIn);\r\n\t\t} \r\n\r\n\t\tif(settings.transitionInMobile){\r\n\t\t\t$toast.classList.remove(settings.transitionInMobile);\r\n\t\t}\r\n\r\n\t\tif(ISMOBILE || window.innerWidth <= MOBILEWIDTH){\r\n\t\t\tif(settings.transitionOutMobile)\r\n\t\t\t\t$toast.classList.add(settings.transitionOutMobile);\r\n\t\t} else {\r\n\t\t\tif(settings.transitionOut)\r\n\t\t\t\t$toast.classList.add(settings.transitionOut);\r\n\t\t}\r\n\t\tvar H = $toast.parentNode.offsetHeight;\r\n\t\t\t\t$toast.parentNode.style.height = H+'px';\r\n\t\t\t\t$toast.style.pointerEvents = 'none';\r\n\t\t\r\n\t\tif(!ISMOBILE || window.innerWidth > MOBILEWIDTH){\r\n\t\t\t$toast.parentNode.style.transitionDelay = '0.2s';\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tvar event = new CustomEvent(PLUGIN_NAME+'-closing', {detail: settings, bubbles: true, cancelable: true});\r\n\t\t\tdocument.dispatchEvent(event);\r\n\t\t} catch(ex){\r\n\t\t\tconsole.warn(ex);\r\n\t\t}\r\n\r\n\t\tsetTimeout(function() {\r\n\t\t\t\r\n\t\t\t$toast.parentNode.style.height = '0px';\r\n\t\t\t$toast.parentNode.style.overflow = '';\r\n\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\t\r\n\t\t\t\tdelete that.children[settings.ref];\r\n\r\n\t\t\t\t$toast.parentNode.remove();\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tvar event = new CustomEvent(PLUGIN_NAME+'-closed', {detail: settings, bubbles: true, cancelable: true});\r\n\t\t\t\t\tdocument.dispatchEvent(event);\r\n\t\t\t\t} catch(ex){\r\n\t\t\t\t\tconsole.warn(ex);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof settings.onClosed !== 'undefined'){\r\n\t\t\t\t\tsettings.onClosed.apply(null, [settings, $toast, closedBy]);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, 1000);\r\n\t\t}, 200);\r\n\r\n\r\n\t\tif(typeof settings.onClosing !== 'undefined'){\r\n\t\t\tsettings.onClosing.apply(null, [settings, $toast, closedBy]);\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Create and show the Toast\r\n\t * @public\r\n\t * @param {Object} options User settings\r\n\t */\r\n\t$iziToast.show = function (options) {\r\n\r\n\t\tvar that = this;\r\n\r\n\t\t// Merge user options with defaults\r\n\t\tvar settings = extend(CONFIG, options || {});\r\n\t\t\tsettings = extend(defaults, settings);\r\n\t\t\tsettings.time = {};\r\n\r\n\t\tif(settings.id === null){\r\n\t\t\tsettings.id = generateId(settings.title+settings.message+settings.color);\r\n\t\t}\r\n\r\n\t\tif(settings.displayMode === 1 || settings.displayMode == 'once'){\r\n\t\t\ttry {\r\n\t\t\t\tif(document.querySelectorAll('.'+PLUGIN_NAME+'#'+settings.id).length > 0){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} catch (exc) {\r\n\t\t\t\tconsole.warn('['+PLUGIN_NAME+'] Could not find an element with this selector: '+'#'+settings.id+'. Try to set an valid id.');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(settings.displayMode === 2 || settings.displayMode == 'replace'){\r\n\t\t\ttry {\r\n\t\t\t\tforEach(document.querySelectorAll('.'+PLUGIN_NAME+'#'+settings.id), function(element, index) {\r\n\t\t\t\t\tthat.hide(settings, element, 'replaced');\r\n\t\t\t\t});\r\n\t\t\t} catch (exc) {\r\n\t\t\t\tconsole.warn('['+PLUGIN_NAME+'] Could not find an element with this selector: '+'#'+settings.id+'. Try to set an valid id.');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsettings.ref = new Date().getTime() + Math.floor((Math.random() * 10000000) + 1);\r\n\r\n\t\t$iziToast.children[settings.ref] = settings;\r\n\r\n\t\tvar $DOM = {\r\n\t\t\tbody: document.querySelector('body'),\r\n\t\t\toverlay: document.createElement('div'),\r\n\t\t\ttoast: document.createElement('div'),\r\n\t\t\ttoastBody: document.createElement('div'),\r\n\t\t\ttoastTexts: document.createElement('div'),\r\n\t\t\ttoastCapsule: document.createElement('div'),\r\n\t\t\tcover: document.createElement('div'),\r\n\t\t\tbuttons: document.createElement('div'),\r\n\t\t\tinputs: document.createElement('div'),\r\n\t\t\ticon: !settings.iconUrl ? document.createElement('i') : document.createElement('img'),\r\n\t\t\twrapper: null\r\n\t\t};\r\n\r\n\t\t$DOM.toast.setAttribute('data-iziToast-ref', settings.ref);\r\n\t\t$DOM.toast.appendChild($DOM.toastBody);\r\n\t\t$DOM.toastCapsule.appendChild($DOM.toast);\r\n\r\n\t\t// CSS Settings\r\n\t\t(function(){\r\n\r\n\t\t\t$DOM.toast.classList.add(PLUGIN_NAME);\r\n\t\t\t$DOM.toast.classList.add(PLUGIN_NAME+'-opening');\r\n\t\t\t$DOM.toastCapsule.classList.add(PLUGIN_NAME+'-capsule');\r\n\t\t\t$DOM.toastBody.classList.add(PLUGIN_NAME + '-body');\r\n\t\t\t$DOM.toastTexts.classList.add(PLUGIN_NAME + '-texts');\r\n\r\n\t\t\tif(ISMOBILE || window.innerWidth <= MOBILEWIDTH){\r\n\t\t\t\tif(settings.transitionInMobile)\r\n\t\t\t\t\t$DOM.toast.classList.add(settings.transitionInMobile);\r\n\t\t\t} else {\r\n\t\t\t\tif(settings.transitionIn)\r\n\t\t\t\t\t$DOM.toast.classList.add(settings.transitionIn);\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.class){\r\n\t\t\t\tvar classes = settings.class.split(' ');\r\n\t\t\t\tforEach(classes, function (value, index) {\r\n\t\t\t\t\t$DOM.toast.classList.add(value);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.id){ $DOM.toast.id = settings.id; }\r\n\r\n\t\t\tif(settings.rtl){\r\n\t\t\t\t$DOM.toast.classList.add(PLUGIN_NAME + '-rtl');\r\n\t\t\t\t$DOM.toast.setAttribute('dir', 'rtl');\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.layout > 1){ $DOM.toast.classList.add(PLUGIN_NAME+'-layout'+settings.layout); }\r\n\r\n\t\t\tif(settings.balloon){ $DOM.toast.classList.add(PLUGIN_NAME+'-balloon'); }\r\n\r\n\t\t\tif(settings.maxWidth){\r\n\t\t\t\tif( !isNaN(settings.maxWidth) ){\r\n\t\t\t\t\t$DOM.toast.style.maxWidth = settings.maxWidth+'px';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.toast.style.maxWidth = settings.maxWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.theme !== '' || settings.theme !== 'light') {\r\n\r\n\t\t\t\t$DOM.toast.classList.add(PLUGIN_NAME+'-theme-'+settings.theme);\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.color) { //#, rgb, rgba, hsl\r\n\t\t\t\t\r\n\t\t\t\tif( isColor(settings.color) ){\r\n\t\t\t\t\t$DOM.toast.style.background = settings.color;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.toast.classList.add(PLUGIN_NAME+'-color-'+settings.color);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.backgroundColor) {\r\n\t\t\t\t$DOM.toast.style.background = settings.backgroundColor;\r\n\t\t\t\tif(settings.balloon){\r\n\t\t\t\t\t$DOM.toast.style.borderColor = settings.backgroundColor;\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t// Cover image\r\n\t\t(function(){\r\n\t\t\tif(settings.image) {\r\n\t\t\t\t$DOM.cover.classList.add(PLUGIN_NAME + '-cover');\r\n\t\t\t\t$DOM.cover.style.width = settings.imageWidth + 'px';\r\n\r\n\t\t\t\tif(isBase64(settings.image.replace(/ /g,''))){\r\n\t\t\t\t\t$DOM.cover.style.backgroundImage = 'url(data:image/png;base64,' + settings.image.replace(/ /g,'') + ')';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.cover.style.backgroundImage = 'url(' + settings.image + ')';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.rtl){\r\n\t\t\t\t\t$DOM.toastBody.style.marginRight = (settings.imageWidth + 10) + 'px';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.toastBody.style.marginLeft = (settings.imageWidth + 10) + 'px';\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t$DOM.toast.appendChild($DOM.cover);\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t// Button close\r\n\t\t(function(){\r\n\t\t\tif(settings.close){\r\n\t\t\t\t\r\n\t\t\t\t$DOM.buttonClose = document.createElement('button');\r\n\t\t\t\t$DOM.buttonClose.type = 'button';\r\n\t\t\t\t$DOM.buttonClose.classList.add(PLUGIN_NAME + '-close');\r\n\t\t\t\t$DOM.buttonClose.addEventListener('click', function (e) {\r\n\t\t\t\t\tvar button = e.target;\r\n\t\t\t\t\tthat.hide(settings, $DOM.toast, 'button');\r\n\t\t\t\t});\r\n\t\t\t\t$DOM.toast.appendChild($DOM.buttonClose);\r\n\t\t\t} else {\r\n\t\t\t\tif(settings.rtl){\r\n\t\t\t\t\t$DOM.toast.style.paddingLeft = '18px';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.toast.style.paddingRight = '18px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t// Progress Bar & Timeout\r\n\t\t(function(){\r\n\r\n\t\t\tif(settings.progressBar){\r\n\t\t\t\t$DOM.progressBar = document.createElement('div');\r\n\t\t\t\t$DOM.progressBarDiv = document.createElement('div');\r\n\t\t\t\t$DOM.progressBar.classList.add(PLUGIN_NAME + '-progressbar');\r\n\t\t\t\t$DOM.progressBarDiv.style.background = settings.progressBarColor;\r\n\t\t\t\t$DOM.progressBar.appendChild($DOM.progressBarDiv);\r\n\t\t\t\t$DOM.toast.appendChild($DOM.progressBar);\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.timeout) {\r\n\r\n\t\t\t\tif(settings.pauseOnHover && !settings.resetOnHover){\r\n\t\t\t\t\t\r\n\t\t\t\t\t$DOM.toast.addEventListener('mouseenter', function (e) {\r\n\t\t\t\t\t\tthat.progress(settings, $DOM.toast).pause();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$DOM.toast.addEventListener('mouseleave', function (e) {\r\n\t\t\t\t\t\tthat.progress(settings, $DOM.toast).resume();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.resetOnHover){\r\n\r\n\t\t\t\t\t$DOM.toast.addEventListener('mouseenter', function (e) {\r\n\t\t\t\t\t\tthat.progress(settings, $DOM.toast).reset();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$DOM.toast.addEventListener('mouseleave', function (e) {\r\n\t\t\t\t\t\tthat.progress(settings, $DOM.toast).start();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t// Icon\r\n\t\t(function(){\r\n\r\n\t\t\tif(settings.iconUrl) {\r\n\r\n\t\t\t\t$DOM.icon.setAttribute('class', PLUGIN_NAME + '-icon');\r\n\t\t\t\t$DOM.icon.setAttribute('src', settings.iconUrl);\r\n\r\n\t\t\t} else if(settings.icon) {\r\n\t\t\t\t$DOM.icon.setAttribute('class', PLUGIN_NAME + '-icon ' + settings.icon);\r\n\t\t\t\t\r\n\t\t\t\tif(settings.iconText){\r\n\t\t\t\t\t$DOM.icon.appendChild(document.createTextNode(settings.iconText));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(settings.iconColor){\r\n\t\t\t\t\t$DOM.icon.style.color = settings.iconColor;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.icon || settings.iconUrl) {\r\n\r\n\t\t\t\tif(settings.rtl){\r\n\t\t\t\t\t$DOM.toastBody.style.paddingRight = '33px';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.toastBody.style.paddingLeft = '33px';\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$DOM.toastBody.appendChild($DOM.icon);\r\n\t\t\t}\r\n\r\n\t\t})();\r\n\r\n\t\t// Title & Message\r\n\t\t(function(){\r\n\t\t\tif(settings.title.length > 0) {\r\n\r\n\t\t\t\t$DOM.strong = document.createElement('strong');\r\n\t\t\t\t$DOM.strong.classList.add(PLUGIN_NAME + '-title');\r\n\t\t\t\t$DOM.strong.appendChild(createFragElem(settings.title));\r\n\t\t\t\t$DOM.toastTexts.appendChild($DOM.strong);\r\n\r\n\t\t\t\tif(settings.titleColor) {\r\n\t\t\t\t\t$DOM.strong.style.color = settings.titleColor;\r\n\t\t\t\t}\r\n\t\t\t\tif(settings.titleSize) {\r\n\t\t\t\t\tif( !isNaN(settings.titleSize) ){\r\n\t\t\t\t\t\t$DOM.strong.style.fontSize = settings.titleSize+'px';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$DOM.strong.style.fontSize = settings.titleSize;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(settings.titleLineHeight) {\r\n\t\t\t\t\tif( !isNaN(settings.titleSize) ){\r\n\t\t\t\t\t\t$DOM.strong.style.lineHeight = settings.titleLineHeight+'px';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$DOM.strong.style.lineHeight = settings.titleLineHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.message.length > 0) {\r\n\r\n\t\t\t\t$DOM.p = document.createElement('p');\r\n\t\t\t\t$DOM.p.classList.add(PLUGIN_NAME + '-message');\r\n\t\t\t\t$DOM.p.appendChild(createFragElem(settings.message));\r\n\t\t\t\t$DOM.toastTexts.appendChild($DOM.p);\r\n\r\n\t\t\t\tif(settings.messageColor) {\r\n\t\t\t\t\t$DOM.p.style.color = settings.messageColor;\r\n\t\t\t\t}\r\n\t\t\t\tif(settings.messageSize) {\r\n\t\t\t\t\tif( !isNaN(settings.titleSize) ){\r\n\t\t\t\t\t\t$DOM.p.style.fontSize = settings.messageSize+'px';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$DOM.p.style.fontSize = settings.messageSize;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(settings.messageLineHeight) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif( !isNaN(settings.titleSize) ){\r\n\t\t\t\t\t\t$DOM.p.style.lineHeight = settings.messageLineHeight+'px';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$DOM.p.style.lineHeight = settings.messageLineHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.title.length > 0 && settings.message.length > 0) {\r\n\t\t\t\tif(settings.rtl){\r\n\t\t\t\t\t$DOM.strong.style.marginLeft = '10px';\r\n\t\t\t\t} else if(settings.layout !== 2 && !settings.rtl) {\r\n\t\t\t\t\t$DOM.strong.style.marginRight = '10px';\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t$DOM.toastBody.appendChild($DOM.toastTexts);\r\n\r\n\t\t// Inputs\r\n\t\tvar $inputs;\r\n\t\t(function(){\r\n\t\t\tif(settings.inputs.length > 0) {\r\n\r\n\t\t\t\t$DOM.inputs.classList.add(PLUGIN_NAME + '-inputs');\r\n\r\n\t\t\t\tforEach(settings.inputs, function (value, index) {\r\n\t\t\t\t\t$DOM.inputs.appendChild(createFragElem(value[0]));\r\n\r\n\t\t\t\t\t$inputs = $DOM.inputs.childNodes;\r\n\r\n\t\t\t\t\t$inputs[index].classList.add(PLUGIN_NAME + '-inputs-child');\r\n\r\n\t\t\t\t\tif(value[3]){\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t$inputs[index].focus();\r\n\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$inputs[index].addEventListener(value[1], function (e) {\r\n\t\t\t\t\t\tvar ts = value[2];\r\n\t\t\t\t\t\treturn ts(that, $DOM.toast, this, e);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\t$DOM.toastBody.appendChild($DOM.inputs);\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t// Buttons\r\n\t\t(function(){\r\n\t\t\tif(settings.buttons.length > 0) {\r\n\r\n\t\t\t\t$DOM.buttons.classList.add(PLUGIN_NAME + '-buttons');\r\n\r\n\t\t\t\tforEach(settings.buttons, function (value, index) {\r\n\t\t\t\t\t$DOM.buttons.appendChild(createFragElem(value[0]));\r\n\r\n\t\t\t\t\tvar $btns = $DOM.buttons.childNodes;\r\n\r\n\t\t\t\t\t$btns[index].classList.add(PLUGIN_NAME + '-buttons-child');\r\n\r\n\t\t\t\t\tif(value[2]){\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t$btns[index].focus();\r\n\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$btns[index].addEventListener('click', function (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tvar ts = value[1];\r\n\t\t\t\t\t\treturn ts(that, $DOM.toast, this, e, $inputs);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t$DOM.toastBody.appendChild($DOM.buttons);\r\n\t\t})();\r\n\r\n\t\tif(settings.message.length > 0 && (settings.inputs.length > 0 || settings.buttons.length > 0)) {\r\n\t\t\t$DOM.p.style.marginBottom = '0';\r\n\t\t}\r\n\r\n\t\tif(settings.inputs.length > 0 || settings.buttons.length > 0){\r\n\t\t\tif(settings.rtl){\r\n\t\t\t\t$DOM.toastTexts.style.marginLeft = '10px';\r\n\t\t\t} else {\r\n\t\t\t\t$DOM.toastTexts.style.marginRight = '10px';\r\n\t\t\t}\r\n\t\t\tif(settings.inputs.length > 0 && settings.buttons.length > 0){\r\n\t\t\t\tif(settings.rtl){\r\n\t\t\t\t\t$DOM.inputs.style.marginLeft = '8px';\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.inputs.style.marginRight = '8px';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Wrap\r\n\t\t(function(){\r\n\t\t\t$DOM.toastCapsule.style.visibility = 'hidden';\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tvar H = $DOM.toast.offsetHeight;\r\n\t\t\t\tvar style = $DOM.toast.currentStyle || window.getComputedStyle($DOM.toast);\r\n\t\t\t\tvar marginTop = style.marginTop;\r\n\t\t\t\t\tmarginTop = marginTop.split('px');\r\n\t\t\t\t\tmarginTop = parseInt(marginTop[0]);\r\n\t\t\t\tvar marginBottom = style.marginBottom;\r\n\t\t\t\t\tmarginBottom = marginBottom.split('px');\r\n\t\t\t\t\tmarginBottom = parseInt(marginBottom[0]);\r\n\r\n\t\t\t\t$DOM.toastCapsule.style.visibility = '';\r\n\t\t\t\t$DOM.toastCapsule.style.height = (H+marginBottom+marginTop)+'px';\r\n\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t$DOM.toastCapsule.style.height = 'auto';\r\n\t\t\t\t\tif(settings.target){\r\n\t\t\t\t\t\t$DOM.toastCapsule.style.overflow = 'visible';\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 500);\r\n\r\n\t\t\t\tif(settings.timeout) {\r\n\t\t\t\t\tthat.progress(settings, $DOM.toast).start();\r\n\t\t\t\t}\r\n\t\t\t}, 100);\r\n\t\t})();\r\n\r\n\t\t// Target\r\n\t\t(function(){\r\n\t\t\tvar position = settings.position;\r\n\r\n\t\t\tif(settings.target){\r\n\r\n\t\t\t\t$DOM.wrapper = document.querySelector(settings.target);\r\n\t\t\t\t$DOM.wrapper.classList.add(PLUGIN_NAME + '-target');\r\n\r\n\t\t\t\tif(settings.targetFirst) {\r\n\t\t\t\t\t$DOM.wrapper.insertBefore($DOM.toastCapsule, $DOM.wrapper.firstChild);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.wrapper.appendChild($DOM.toastCapsule);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif( POSITIONS.indexOf(settings.position) == -1 ){\r\n\t\t\t\t\tconsole.warn('['+PLUGIN_NAME+'] Incorrect position.\\nIt can be â€º ' + POSITIONS);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(ISMOBILE || window.innerWidth <= MOBILEWIDTH){\r\n\t\t\t\t\tif(settings.position == 'bottomLeft' || settings.position == 'bottomRight' || settings.position == 'bottomCenter'){\r\n\t\t\t\t\t\tposition = PLUGIN_NAME+'-wrapper-bottomCenter';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(settings.position == 'topLeft' || settings.position == 'topRight' || settings.position == 'topCenter'){\r\n\t\t\t\t\t\tposition = PLUGIN_NAME+'-wrapper-topCenter';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tposition = PLUGIN_NAME+'-wrapper-center';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tposition = PLUGIN_NAME+'-wrapper-'+position;\r\n\t\t\t\t}\r\n\t\t\t\t$DOM.wrapper = document.querySelector('.' + PLUGIN_NAME + '-wrapper.'+position);\r\n\r\n\t\t\t\tif(!$DOM.wrapper) {\r\n\t\t\t\t\t$DOM.wrapper = document.createElement('div');\r\n\t\t\t\t\t$DOM.wrapper.classList.add(PLUGIN_NAME + '-wrapper');\r\n\t\t\t\t\t$DOM.wrapper.classList.add(position);\r\n\t\t\t\t\tdocument.body.appendChild($DOM.wrapper);\r\n\t\t\t\t}\r\n\t\t\t\tif(settings.position == 'topLeft' || settings.position == 'topCenter' || settings.position == 'topRight'){\r\n\t\t\t\t\t$DOM.wrapper.insertBefore($DOM.toastCapsule, $DOM.wrapper.firstChild);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.wrapper.appendChild($DOM.toastCapsule);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!isNaN(settings.zindex)) {\r\n\t\t\t\t$DOM.wrapper.style.zIndex = settings.zindex;\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('['+PLUGIN_NAME+'] Invalid zIndex.');\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t// Overlay\r\n\t\t(function(){\r\n\r\n\t\t\tif(settings.overlay) {\r\n\r\n\t\t\t\tif( document.querySelector('.'+PLUGIN_NAME+'-overlay.fadeIn') !== null ){\r\n\r\n\t\t\t\t\t$DOM.overlay = document.querySelector('.'+PLUGIN_NAME+'-overlay');\r\n\t\t\t\t\t$DOM.overlay.setAttribute('data-iziToast-ref', $DOM.overlay.getAttribute('data-iziToast-ref') + ',' + settings.ref);\r\n\r\n\t\t\t\t\tif(!isNaN(settings.zindex) && settings.zindex !== null) {\r\n\t\t\t\t\t\t$DOM.overlay.style.zIndex = settings.zindex-1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t$DOM.overlay.classList.add(PLUGIN_NAME+'-overlay');\r\n\t\t\t\t\t$DOM.overlay.classList.add('fadeIn');\r\n\t\t\t\t\t$DOM.overlay.style.background = settings.overlayColor;\r\n\t\t\t\t\t$DOM.overlay.setAttribute('data-iziToast-ref', settings.ref);\r\n\t\t\t\t\tif(!isNaN(settings.zindex) && settings.zindex !== null) {\r\n\t\t\t\t\t\t$DOM.overlay.style.zIndex = settings.zindex-1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdocument.querySelector('body').appendChild($DOM.overlay);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.overlayClose) {\r\n\r\n\t\t\t\t\t$DOM.overlay.removeEventListener('click', {});\r\n\t\t\t\t\t$DOM.overlay.addEventListener('click', function (e) {\r\n\t\t\t\t\t\tthat.hide(settings, $DOM.toast, 'overlay');\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$DOM.overlay.removeEventListener('click', {});\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t})();\r\n\r\n\t\t// Inside animations\r\n\t\t(function(){\r\n\t\t\tif(settings.animateInside){\r\n\t\t\t\t$DOM.toast.classList.add(PLUGIN_NAME+'-animateInside');\r\n\t\t\t\r\n\t\t\t\tvar animationTimes = [200, 100, 300];\r\n\t\t\t\tif(settings.transitionIn == 'bounceInLeft' || settings.transitionIn == 'bounceInRight'){\r\n\t\t\t\t\tanimationTimes = [400, 200, 400];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.title.length > 0) {\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t$DOM.strong.classList.add('slideIn');\r\n\t\t\t\t\t}, animationTimes[0]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.message.length > 0) {\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t$DOM.p.classList.add('slideIn');\r\n\t\t\t\t\t}, animationTimes[1]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.icon || settings.iconUrl) {\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t$DOM.icon.classList.add('revealIn');\r\n\t\t\t\t\t}, animationTimes[2]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar counter = 150;\r\n\t\t\t\tif(settings.buttons.length > 0 && $DOM.buttons) {\r\n\r\n\t\t\t\t\tsetTimeout(function(){\r\n\r\n\t\t\t\t\t\tforEach($DOM.buttons.childNodes, function(element, index) {\r\n\r\n\t\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\t\telement.classList.add('revealIn');\r\n\t\t\t\t\t\t\t}, counter);\r\n\t\t\t\t\t\t\tcounter = counter + 150;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}, settings.inputs.length > 0 ? 150 : 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(settings.inputs.length > 0 && $DOM.inputs) {\r\n\t\t\t\t\tcounter = 150;\r\n\t\t\t\t\tforEach($DOM.inputs.childNodes, function(element, index) {\r\n\r\n\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\telement.classList.add('revealIn');\r\n\t\t\t\t\t\t}, counter);\r\n\t\t\t\t\t\tcounter = counter + 150;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\tsettings.onOpening.apply(null, [settings, $DOM.toast]);\r\n\r\n\t\ttry {\r\n\t\t\tvar event = new CustomEvent(PLUGIN_NAME + '-opening', {detail: settings, bubbles: true, cancelable: true});\r\n\t\t\tdocument.dispatchEvent(event);\r\n\t\t} catch(ex){\r\n\t\t\tconsole.warn(ex);\r\n\t\t}\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\t$DOM.toast.classList.remove(PLUGIN_NAME+'-opening');\r\n\t\t\t$DOM.toast.classList.add(PLUGIN_NAME+'-opened');\r\n\r\n\t\t\ttry {\r\n\t\t\t\tvar event = new CustomEvent(PLUGIN_NAME + '-opened', {detail: settings, bubbles: true, cancelable: true});\r\n\t\t\t\tdocument.dispatchEvent(event);\r\n\t\t\t} catch(ex){\r\n\t\t\t\tconsole.warn(ex);\r\n\t\t\t}\r\n\r\n\t\t\tsettings.onOpened.apply(null, [settings, $DOM.toast]);\r\n\t\t}, 1000);\r\n\r\n\t\tif(settings.drag){\r\n\r\n\t\t\tif(ACCEPTSTOUCH) {\r\n\r\n\t\t\t    $DOM.toast.addEventListener('touchstart', function(e) {\r\n\t\t\t        drag.startMoving(this, that, settings, e);\r\n\t\t\t    }, false);\r\n\r\n\t\t\t    $DOM.toast.addEventListener('touchend', function(e) {\r\n\t\t\t        drag.stopMoving(this, e);\r\n\t\t\t    }, false);\r\n\t\t\t} else {\r\n\r\n\t\t\t    $DOM.toast.addEventListener('mousedown', function(e) {\r\n\t\t\t    \te.preventDefault();\r\n\t\t\t        drag.startMoving(this, that, settings, e);\r\n\t\t\t    }, false);\r\n\r\n\t\t\t    $DOM.toast.addEventListener('mouseup', function(e) {\r\n\t\t\t    \te.preventDefault();\r\n\t\t\t        drag.stopMoving(this, e);\r\n\t\t\t    }, false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(settings.closeOnEscape) {\r\n\r\n\t\t\tdocument.addEventListener('keyup', function (evt) {\r\n\t\t\t\tevt = evt || window.event;\r\n\t\t\t\tif(evt.keyCode == 27) {\r\n\t\t\t\t    that.hide(settings, $DOM.toast, 'esc');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(settings.closeOnClick) {\r\n\t\t\t$DOM.toast.addEventListener('click', function (evt) {\r\n\t\t\t\tthat.hide(settings, $DOM.toast, 'toast');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthat.toast = $DOM.toast;\t\t\r\n\t};\r\n\t\r\n\r\n\treturn $iziToast;\r\n});\n\n//# sourceURL=webpack://better-tasks/./node_modules/izitoast/dist/js/iziToast.js?\n}");

/***/ },

/***/ "./src/context-store.js"
/*!******************************!*\
  !*** ./src/context-store.js ***!
  \******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addContextOption: () => (/* binding */ addContextOption),\n/* harmony export */   getContextAttrName: () => (/* binding */ getContextAttrName),\n/* harmony export */   getContextOptions: () => (/* binding */ getContextOptions),\n/* harmony export */   initContextStore: () => (/* binding */ initContextStore),\n/* harmony export */   normalizeContextValue: () => (/* binding */ normalizeContextValue),\n/* harmony export */   refreshContextOptions: () => (/* binding */ refreshContextOptions),\n/* harmony export */   removeContextOption: () => (/* binding */ removeContextOption),\n/* harmony export */   subscribeToContextOptions: () => (/* binding */ subscribeToContextOptions)\n/* harmony export */ });\n/* harmony import */ var _picklist_excludes__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./picklist-excludes */ \"./src/picklist-excludes.js\");\nfunction _regeneratorValues(e) { if (null != e) { var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"], r = 0; if (t) return t.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) return { next: function next() { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e }; } }; } throw new TypeError(_typeof(e) + \" is not iterable\"); }\nfunction _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nvar DEFAULT_CONTEXT_ATTR = \"BT_attrContext\";\nvar CACHE_TTL_MS = 8 * 60 * 1000;\n\nvar extensionAPI = null;\nvar lastRefreshed = 0;\nvar refreshPromise = null;\nvar values = [];\nvar subscribers = new Set();\nfunction sanitizeAttrName(value, fallback) {\n  if (value == null) return fallback;\n  var trimmed = String(value).trim().replace(/:+$/, \"\");\n  return trimmed || fallback;\n}\nfunction escapeForQuery(str) {\n  return String(str || \"\").replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"');\n}\nfunction normalizeContextValue(raw) {\n  if (typeof raw !== \"string\") return \"\";\n  var v = raw.trim();\n  if (!v) return \"\";\n  if (v.startsWith(\"#\") || v.startsWith(\"@\")) v = v.slice(1).trim();\n  var pageMatch = v.match(/^\\[\\[(.*)\\]\\]$/);\n  if (pageMatch) v = pageMatch[1].trim();\n  return v;\n}\nfunction getContextAttrName() {\n  var _extensionAPI, _extensionAPI$get;\n  var configured = (_extensionAPI = extensionAPI) === null || _extensionAPI === void 0 || (_extensionAPI = _extensionAPI.settings) === null || _extensionAPI === void 0 || (_extensionAPI$get = _extensionAPI.get) === null || _extensionAPI$get === void 0 ? void 0 : _extensionAPI$get.call(_extensionAPI, \"bt-attr-context\");\n  return sanitizeAttrName(configured !== null && configured !== void 0 ? configured : DEFAULT_CONTEXT_ATTR, DEFAULT_CONTEXT_ATTR);\n}\nfunction getPicklistExcludeConfig() {\n  var _extensionAPI2, _extensionAPI2$get, _extensionAPI3, _extensionAPI3$get;\n  var enabledRaw = (_extensionAPI2 = extensionAPI) === null || _extensionAPI2 === void 0 || (_extensionAPI2 = _extensionAPI2.settings) === null || _extensionAPI2 === void 0 || (_extensionAPI2$get = _extensionAPI2.get) === null || _extensionAPI2$get === void 0 ? void 0 : _extensionAPI2$get.call(_extensionAPI2, \"bt_excludePicklistPagesEnabled\");\n  var enabled = enabledRaw === true || enabledRaw === \"true\" || enabledRaw === \"1\";\n  var raw = ((_extensionAPI3 = extensionAPI) === null || _extensionAPI3 === void 0 || (_extensionAPI3 = _extensionAPI3.settings) === null || _extensionAPI3 === void 0 || (_extensionAPI3$get = _extensionAPI3.get) === null || _extensionAPI3$get === void 0 ? void 0 : _extensionAPI3$get.call(_extensionAPI3, \"bt_excludePicklistPages\")) || \"\";\n  return {\n    enabled: enabled,\n    excluded: (0,_picklist_excludes__WEBPACK_IMPORTED_MODULE_0__.parseExcludedPicklistPages)(raw)\n  };\n}\nfunction notifySubscribers() {\n  var snapshot = values.slice();\n  subscribers.forEach(function (cb) {\n    try {\n      cb(snapshot);\n    } catch (err) {\n      console.warn(\"[BetterTasks] context-store subscriber failed\", err);\n    }\n  });\n}\nfunction setValues(next) {\n  values = Array.from(new Set((next || []).map(normalizeContextValue).filter(Boolean))).sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  notifySubscribers();\n}\nfunction getContextOptions() {\n  return values.slice();\n}\nfunction addContextOption(name) {\n  var normalized = normalizeContextValue(name);\n  if (!normalized || values.includes(normalized)) return;\n  values = [].concat(_toConsumableArray(values), [normalized]).sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  notifySubscribers();\n}\nfunction removeContextOption(name) {\n  var normalized = normalizeContextValue(name);\n  if (!normalized) return;\n  var next = values.filter(function (v) {\n    return v !== normalized;\n  });\n  if (next.length === values.length) return;\n  values = next;\n  notifySubscribers();\n}\nfunction queryContextFromGraph() {\n  return _queryContextFromGraph.apply(this, arguments);\n}\nfunction _queryContextFromGraph() {\n  _queryContextFromGraph = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n    var _window$roamAlphaAPI;\n    var _ref,\n      _ref$includeRegex,\n      includeRegex,\n      attrName,\n      excludeCfg,\n      safeAttr,\n      defaultSafe,\n      labels,\n      pull,\n      refQuery,\n      inlineRegexQuery,\n      refRows,\n      rows,\n      pattern,\n      regexRows,\n      getField,\n      getPageTitleFromEntry,\n      out,\n      _iterator2,\n      _step2,\n      _loop,\n      _ret,\n      _args2 = arguments,\n      _t,\n      _t2,\n      _t3;\n    return _regenerator().w(function (_context2) {\n      while (1) switch (_context2.p = _context2.n) {\n        case 0:\n          _ref = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {}, _ref$includeRegex = _ref.includeRegex, includeRegex = _ref$includeRegex === void 0 ? true : _ref$includeRegex;\n          attrName = getContextAttrName();\n          if (!(!attrName || typeof window === \"undefined\" || !((_window$roamAlphaAPI = window.roamAlphaAPI) !== null && _window$roamAlphaAPI !== void 0 && _window$roamAlphaAPI.q))) {\n            _context2.n = 1;\n            break;\n          }\n          return _context2.a(2, []);\n        case 1:\n          excludeCfg = getPicklistExcludeConfig();\n          _context2.p = 2;\n          safeAttr = escapeForQuery(attrName);\n          defaultSafe = escapeForQuery(DEFAULT_CONTEXT_ATTR);\n          labels = Array.from(new Set([safeAttr, defaultSafe])).filter(Boolean);\n          pull = \"[:block/string {:block/refs [:node/title]} {:block/page [:node/title]}]\";\n          refQuery = \"\\n      [:find (pull ?c \".concat(pull, \") ?pageTitle\\n       :in $ [?label ...]\\n       :where\\n         [?attr :node/title ?label]\\n         [?c :block/refs ?attr]\\n         [?c :block/page ?p]\\n         [?p :node/title ?pageTitle]]\");\n          inlineRegexQuery = \"\\n      [:find (pull ?c \".concat(pull, \") ?pageTitle\\n       :in $ ?pattern\\n       :where\\n         [?c :block/string ?s]\\n         [(re-pattern ?pattern) ?rp]\\n         [(re-find ?rp ?s)]\\n         [?c :block/page ?p]\\n         [?p :node/title ?pageTitle]]\");\n          _context2.n = 3;\n          return window.roamAlphaAPI.q(refQuery, labels);\n        case 3:\n          refRows = _context2.v;\n          rows = _toConsumableArray(refRows || []);\n          if (!includeRegex) {\n            _context2.n = 7;\n            break;\n          }\n          pattern = \"(?i)^\\\\s*(?:\".concat(labels.join(\"|\"), \")\\\\s*::\");\n          _context2.p = 4;\n          _context2.n = 5;\n          return window.roamAlphaAPI.q(inlineRegexQuery, pattern);\n        case 5:\n          regexRows = _context2.v;\n          if (Array.isArray(regexRows)) rows = [].concat(_toConsumableArray(rows), _toConsumableArray(regexRows || []));\n          _context2.n = 7;\n          break;\n        case 6:\n          _context2.p = 6;\n          _t = _context2.v;\n          console.warn(\"[BetterTasks] context-store regex query failed\", _t);\n        case 7:\n          getField = function getField(obj, candidates) {\n            var _iterator = _createForOfIteratorHelper(candidates),\n              _step;\n            try {\n              for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                var key = _step.value;\n                if (obj && obj[key] != null) return obj[key];\n              }\n            } catch (err) {\n              _iterator.e(err);\n            } finally {\n              _iterator.f();\n            }\n            return undefined;\n          };\n          getPageTitleFromEntry = function getPageTitleFromEntry(entryObj) {\n            var raw = getField(entryObj, [\"block/page\", \"page\", \":block/page\"]);\n            var pageObj = Array.isArray(raw) ? raw[0] : raw;\n            if (!pageObj || _typeof(pageObj) !== \"object\") return \"\";\n            return pageObj[\"node/title\"] || pageObj[\":node/title\"] || \"\";\n          };\n          out = [];\n          _iterator2 = _createForOfIteratorHelper(rows || []);\n          _context2.p = 8;\n          _loop = /*#__PURE__*/_regenerator().m(function _loop() {\n            var row, entry, pageTitleFromQuery, pageTitle, excluded, stringVal, refsVal, refs, refTitles, attrTitleSet, nonAttrRef, parts, valuePart, normalized;\n            return _regenerator().w(function (_context) {\n              while (1) switch (_context.n) {\n                case 0:\n                  row = _step2.value;\n                  entry = (row === null || row === void 0 ? void 0 : row[0]) || row;\n                  if (entry) {\n                    _context.n = 1;\n                    break;\n                  }\n                  return _context.a(2, 0);\n                case 1:\n                  pageTitleFromQuery = Array.isArray(row) && typeof row[1] === \"string\" ? row[1] : \"\";\n                  pageTitle = pageTitleFromQuery || getPageTitleFromEntry(entry);\n                  excluded = (0,_picklist_excludes__WEBPACK_IMPORTED_MODULE_0__.shouldExcludePicklistSourcePage)(pageTitle, excludeCfg.enabled, excludeCfg.excluded);\n                  if (!excluded) {\n                    _context.n = 2;\n                    break;\n                  }\n                  return _context.a(2, 0);\n                case 2:\n                  stringVal = getField(entry, [\"block/string\", \"string\", \":block/string\"]) || \"\";\n                  refsVal = getField(entry, [\"block/refs\", \"refs\", \":block/refs\"]) || [];\n                  refs = Array.isArray(refsVal) ? refsVal : [];\n                  refTitles = refs.map(function (ref) {\n                    return (ref === null || ref === void 0 ? void 0 : ref[\"node/title\"]) || (ref === null || ref === void 0 ? void 0 : ref[\":node/title\"]);\n                  }).filter(function (t) {\n                    return typeof t === \"string\";\n                  }).map(function (t) {\n                    return t.trim();\n                  }).filter(Boolean);\n                  attrTitleSet = new Set([attrName, DEFAULT_CONTEXT_ATTR]);\n                  nonAttrRef = refTitles.find(function (title) {\n                    return !attrTitleSet.has(title);\n                  });\n                  if (!nonAttrRef) {\n                    _context.n = 3;\n                    break;\n                  }\n                  out.push(nonAttrRef);\n                  return _context.a(2, 0);\n                case 3:\n                  parts = stringVal.split(\"::\");\n                  if (parts.length >= 2) {\n                    valuePart = parts.slice(1).join(\"::\");\n                    normalized = normalizeContextValue(valuePart);\n                    if (normalized) out.push(normalized);\n                  }\n                case 4:\n                  return _context.a(2);\n              }\n            }, _loop);\n          });\n          _iterator2.s();\n        case 9:\n          if ((_step2 = _iterator2.n()).done) {\n            _context2.n = 12;\n            break;\n          }\n          return _context2.d(_regeneratorValues(_loop()), 10);\n        case 10:\n          _ret = _context2.v;\n          if (!(_ret === 0)) {\n            _context2.n = 11;\n            break;\n          }\n          return _context2.a(3, 11);\n        case 11:\n          _context2.n = 9;\n          break;\n        case 12:\n          _context2.n = 14;\n          break;\n        case 13:\n          _context2.p = 13;\n          _t2 = _context2.v;\n          _iterator2.e(_t2);\n        case 14:\n          _context2.p = 14;\n          _iterator2.f();\n          return _context2.f(14);\n        case 15:\n          return _context2.a(2, out);\n        case 16:\n          _context2.p = 16;\n          _t3 = _context2.v;\n          console.warn(\"[BetterTasks] context-store query failed\", _t3);\n          return _context2.a(2, []);\n      }\n    }, _callee, null, [[8, 13, 14, 15], [4, 6], [2, 16]]);\n  }));\n  return _queryContextFromGraph.apply(this, arguments);\n}\nfunction refreshContextOptions() {\n  return _refreshContextOptions.apply(this, arguments);\n}\nfunction _refreshContextOptions() {\n  _refreshContextOptions = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n    var force,\n      now,\n      _args3 = arguments;\n    return _regenerator().w(function (_context3) {\n      while (1) switch (_context3.n) {\n        case 0:\n          force = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : false;\n          now = Date.now();\n          if (!(!force && refreshPromise)) {\n            _context3.n = 1;\n            break;\n          }\n          return _context3.a(2, refreshPromise);\n        case 1:\n          if (!(!force && now - lastRefreshed < CACHE_TTL_MS && values.length)) {\n            _context3.n = 2;\n            break;\n          }\n          return _context3.a(2, Promise.resolve());\n        case 2:\n          queryContextFromGraph({\n            includeRegex: false\n          }).then(function (list) {\n            if (!list.length) return;\n            setValues(list);\n          });\n          refreshPromise = queryContextFromGraph({\n            includeRegex: true\n          }).then(function (list) {\n            lastRefreshed = Date.now();\n            setValues(list);\n          })[\"finally\"](function () {\n            refreshPromise = null;\n          });\n          return _context3.a(2, refreshPromise);\n      }\n    }, _callee2);\n  }));\n  return _refreshContextOptions.apply(this, arguments);\n}\nfunction subscribeToContextOptions(cb) {\n  if (typeof cb !== \"function\") return function () {};\n  subscribers.add(cb);\n  cb(values.slice());\n  return function () {\n    return subscribers[\"delete\"](cb);\n  };\n}\nfunction initContextStore(api) {\n  extensionAPI = api || null;\n  void refreshContextOptions(true);\n  setTimeout(function () {\n    return void refreshContextOptions(true);\n  }, 500);\n}\n\n\n//# sourceURL=webpack://better-tasks/./src/context-store.js?\n}");

/***/ },

/***/ "./src/dashboard/App.jsx"
/*!*******************************!*\
  !*** ./src/dashboard/App.jsx ***!
  \*******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ DashboardApp)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"react\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ \"react-dom\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var izitoast__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! izitoast */ \"./node_modules/izitoast/dist/js/iziToast.js\");\n/* harmony import */ var izitoast__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(izitoast__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _tanstack_react_virtual__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @tanstack/react-virtual */ \"./node_modules/@tanstack/react-virtual/dist/esm/index.js\");\n/* harmony import */ var _tanstack_react_virtual__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @tanstack/react-virtual */ \"./node_modules/@tanstack/virtual-core/dist/esm/index.js\");\n/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../i18n */ \"./src/i18n.js\");\n/* harmony import */ var _viewsStore__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./viewsStore */ \"./src/dashboard/viewsStore.js\");\nfunction _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(r) { if (Array.isArray(r)) return r; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n\n\n\n\n\n\nfunction resolvePath(obj) {\n  var parts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return parts.reduce(function (acc, key) {\n    return acc && Object.prototype.hasOwnProperty.call(acc, key) ? acc[key] : undefined;\n  }, obj);\n}\nfunction tPath(path) {\n  var lang = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"en\";\n  var parts = Array.isArray(path) ? path : String(path || \"\").split(\".\");\n  var primary = resolvePath(_i18n__WEBPACK_IMPORTED_MODULE_5__.i18n === null || _i18n__WEBPACK_IMPORTED_MODULE_5__.i18n === void 0 ? void 0 : _i18n__WEBPACK_IMPORTED_MODULE_5__.i18n[lang], parts);\n  if (primary !== undefined) return primary;\n  if (lang !== \"en\") {\n    var fallback = resolvePath(_i18n__WEBPACK_IMPORTED_MODULE_5__.i18n === null || _i18n__WEBPACK_IMPORTED_MODULE_5__.i18n === void 0 ? void 0 : _i18n__WEBPACK_IMPORTED_MODULE_5__.i18n.en, parts);\n    if (fallback !== undefined) return fallback;\n  }\n  return undefined;\n}\nfunction formatPriorityEnergyDisplay(value) {\n  if (!value || typeof value !== \"string\") return \"\";\n  var v = value.trim().toLowerCase();\n  if (v === \"low\" || v === \"medium\" || v === \"high\") {\n    return v.charAt(0).toUpperCase() + v.slice(1);\n  }\n  return value;\n}\nvar GTD_STATUS_ORDER = [\"next action\", \"delegated\", \"deferred\", \"someday\"];\nfunction formatGtdStatusDisplay(value) {\n  if (!value) return \"\";\n  return String(value).trim().toLowerCase().split(/\\s+/).filter(Boolean).map(function (word) {\n    return word.charAt(0).toUpperCase() + word.slice(1);\n  }).join(\" \");\n}\nfunction cycleGtdStatus(current) {\n  var normalized = current ? String(current).trim().toLowerCase() : null;\n  var order = [].concat(GTD_STATUS_ORDER, [null]);\n  var idx = order.indexOf(normalized !== null && normalized !== void 0 ? normalized : null);\n  return order[(idx + 1) % order.length];\n}\nvar DEFAULT_FILTERS = {\n  Recurrence: [],\n  Start: [],\n  Defer: [],\n  Due: [],\n  Completion: [\"open\"],\n  completedRange: \"any\",\n  upcomingRange: \"any\",\n  Priority: [],\n  Energy: [],\n  GTD: [],\n  projectText: \"\",\n  waitingText: \"\",\n  contextText: \"\"\n};\nfunction normalizeFiltersForCompare(filters) {\n  var base = _objectSpread(_objectSpread({}, DEFAULT_FILTERS), filters && _typeof(filters) === \"object\" ? filters : {});\n  var keys = Object.keys(base);\n  keys.sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  var out = {};\n  for (var _i = 0, _keys = keys; _i < _keys.length; _i++) {\n    var key = _keys[_i];\n    var value = base[key];\n    if (Array.isArray(value)) {\n      out[key] = value.slice().filter(function (v) {\n        return v != null;\n      }).sort(function (a, b) {\n        return String(a).localeCompare(String(b), undefined, {\n          sensitivity: \"base\"\n        });\n      });\n    } else if (typeof value === \"string\") {\n      out[key] = value;\n    } else if (value == null) {\n      out[key] = value;\n    } else if (typeof value === \"number\" || typeof value === \"boolean\") {\n      out[key] = value;\n    } else {\n      try {\n        out[key] = JSON.parse(JSON.stringify(value));\n      } catch (_) {\n        out[key] = value;\n      }\n    }\n  }\n  return out;\n}\nfunction normalizeDashViewStateForCompare(state) {\n  var filters = normalizeFiltersForCompare(state === null || state === void 0 ? void 0 : state.filters);\n  var grouping = typeof (state === null || state === void 0 ? void 0 : state.grouping) === \"string\" ? state.grouping : \"time\";\n  var query = typeof (state === null || state === void 0 ? void 0 : state.query) === \"string\" ? state.query.trim() : \"\";\n  return {\n    filters: filters,\n    grouping: grouping,\n    query: query\n  };\n}\nvar FILTER_STORAGE_KEY = \"betterTasks.dashboard.filters\";\nvar FILTER_STORAGE_VERSION = 1;\nfunction migrateStoredFilters(payload) {\n  if (!payload || _typeof(payload) !== \"object\") return null;\n  var version = typeof payload.v === \"number\" ? payload.v : null;\n  if (version == null) return payload;\n  if (version === FILTER_STORAGE_VERSION) return payload.filters;\n  switch (version) {\n    default:\n      return null;\n  }\n}\nfunction loadSavedFilters(defaults) {\n  if (typeof window === \"undefined\") return _objectSpread({}, defaults);\n  try {\n    var raw = window.localStorage.getItem(FILTER_STORAGE_KEY);\n    if (!raw) return _objectSpread({}, defaults);\n    var parsed = JSON.parse(raw);\n    if (!parsed || _typeof(parsed) !== \"object\") return _objectSpread({}, defaults);\n    var next = migrateStoredFilters(parsed);\n    if (!next || _typeof(next) !== \"object\") return _objectSpread({}, defaults);\n    return _objectSpread(_objectSpread({}, defaults), next);\n  } catch (err) {\n    console.warn(\"[BetterTasks] failed to load dashboard filters\", err);\n    return _objectSpread({}, defaults);\n  }\n}\nfunction saveFilters(filters) {\n  if (typeof window === \"undefined\") return;\n  try {\n    var payload = {\n      v: FILTER_STORAGE_VERSION,\n      filters: filters || {}\n    };\n    window.localStorage.setItem(FILTER_STORAGE_KEY, JSON.stringify(payload));\n  } catch (err) {\n    console.warn(\"[BetterTasks] failed to save dashboard filters\", err);\n  }\n}\nvar FILTER_SECTIONS_LEFT = [\"Recurrence\", \"Start\", \"Defer\"];\nvar FILTER_SECTIONS_RIGHT = [\"Completion\", \"Priority\", \"Energy\"];\nvar GROUP_LABELS = {\n  overdue: \"Overdue\",\n  today: \"Today\",\n  upcoming: \"Upcoming\",\n  none: \"No Due Date\",\n  recurring: \"Recurring\",\n  \"one-off\": \"One-off\",\n  completed: \"Completed\"\n};\nvar GROUP_ORDER_TIME = [\"overdue\", \"today\", \"upcoming\", \"none\"];\nvar GROUP_ORDER_RECURRENCE = [\"recurring\", \"one-off\"];\nvar INITIAL_SNAPSHOT = {\n  tasks: [],\n  status: \"idle\",\n  error: null,\n  lastUpdated: null\n};\nfunction applyToastA11y(toastEl) {\n  if (!toastEl) return;\n  toastEl.setAttribute(\"role\", \"alert\");\n  toastEl.setAttribute(\"aria-live\", \"polite\");\n  toastEl.setAttribute(\"aria-atomic\", \"true\");\n}\nfunction filtersReducer(state, action) {\n  switch (action.type) {\n    case \"toggle\":\n      {\n        var current = new Set(state[action.section] || []);\n        if (current.has(action.value)) {\n          current[\"delete\"](action.value);\n        } else {\n          current.add(action.value);\n        }\n        return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, action.section, Array.from(current)));\n      }\n    case \"toggleSingle\":\n      {\n        var _current = new Set(state[action.section] || []);\n        var isActive = _current.has(action.value);\n        return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, action.section, isActive ? [] : [action.value]));\n      }\n    case \"setText\":\n      return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, action.section, action.value || \"\"));\n    case \"reset\":\n      return _objectSpread({}, DEFAULT_FILTERS);\n    case \"hydrate\":\n      {\n        var incoming = action.value && _typeof(action.value) === \"object\" ? action.value : {};\n        return _objectSpread(_objectSpread({}, DEFAULT_FILTERS), incoming);\n      }\n    default:\n      return state;\n  }\n}\nfunction useControllerSnapshot(controller) {\n  var _useState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      return controller !== null && controller !== void 0 && controller.getSnapshot ? controller.getSnapshot() : INITIAL_SNAPSHOT;\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    snapshot = _useState2[0],\n    setSnapshot = _useState2[1];\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    var _controller$ensureIni;\n    if (!controller) return undefined;\n    var unsub = controller.subscribe(function (next) {\n      return setSnapshot(_objectSpread(_objectSpread({}, next), {}, {\n        tasks: _toConsumableArray(next.tasks)\n      }));\n    });\n    (_controller$ensureIni = controller.ensureInitialLoad) === null || _controller$ensureIni === void 0 || _controller$ensureIni.call(controller);\n    return unsub;\n  }, [controller]);\n  return snapshot;\n}\nfunction applyFilters(tasks, filters, query) {\n  var queryText = query.trim().toLowerCase();\n  var recurrenceFilter = new Set(filters.Recurrence || filters.recurrence || []);\n  var startFilter = new Set(filters.Start || filters.start || []);\n  var deferFilter = new Set(filters.Defer || filters.defer || []);\n  var dueFilter = new Set(filters.Due || filters.due || []);\n  var dueArr = Array.from(dueFilter);\n  var dueIncludesUpcoming = dueArr.includes(\"upcoming\");\n  var completionFilter = new Set(filters.Completion || filters.completion || []);\n  var completionArr = Array.from(completionFilter);\n  var completedOnly = completionArr.length === 1 && completionArr[0] === \"completed\";\n  var priorityFilter = new Set(filters.Priority || filters.priority || []);\n  var energyFilter = new Set(filters.Energy || filters.energy || []);\n  var gtdFilter = new Set(filters.GTD || filters.gtd || []);\n  var completedRange = typeof filters.completedRange === \"string\" ? filters.completedRange : \"any\";\n  var upcomingRange = typeof filters.upcomingRange === \"string\" ? filters.upcomingRange : \"any\";\n  var projectText = (filters.projectText || \"\").trim();\n  var waitingText = (filters.waitingText || \"\").trim().toLowerCase();\n  var contextText = (filters.contextText || \"\").trim().toLowerCase();\n  var isWithinCompletedRange = function isWithinCompletedRange(date, range) {\n    if (!(date instanceof Date) || Number.isNaN(date.getTime())) return false;\n    if (range === \"any\") return true;\n    var now = new Date();\n    var startOfToday = new Date(now.getTime());\n    startOfToday.setHours(0, 0, 0, 0);\n    var dayMs = 24 * 60 * 60 * 1000;\n    var days = range === \"7d\" ? 7 : range === \"30d\" ? 30 : range === \"90d\" ? 90 : null;\n    if (!days) return true;\n    var threshold = new Date(startOfToday.getTime() - (days - 1) * dayMs);\n    return date >= threshold;\n  };\n  var isWithinUpcomingRange = function isWithinUpcomingRange(date, range) {\n    if (!(date instanceof Date) || Number.isNaN(date.getTime())) return false;\n    if (range === \"any\") return true;\n    var now = new Date();\n    var startOfToday = new Date(now.getTime());\n    startOfToday.setHours(0, 0, 0, 0);\n    var dayMs = 24 * 60 * 60 * 1000;\n    var days = range === \"7d\" ? 7 : range === \"30d\" ? 30 : range === \"90d\" ? 90 : null;\n    if (!days) return true;\n    if (date < startOfToday) return false;\n    var end = new Date(startOfToday.getTime() + days * dayMs - 1);\n    return date <= end;\n  };\n  return tasks.filter(function (task) {\n    if (completionFilter.size) {\n      var value = task.isCompleted ? \"completed\" : \"open\";\n      if (!completionFilter.has(value)) return false;\n    }\n    if (completedOnly && completedRange !== \"any\" && task.isCompleted) {\n      if (!isWithinCompletedRange(task.completedAt, completedRange)) return false;\n    }\n    if (recurrenceFilter.size && !recurrenceFilter.has(task.recurrenceBucket)) return false;\n    if (startFilter.size && !startFilter.has(task.startBucket)) return false;\n    if (deferFilter.size && !deferFilter.has(task.deferBucket)) return false;\n    if (dueFilter.size && !dueFilter.has(task.dueBucket)) return false;\n    if (dueIncludesUpcoming && upcomingRange !== \"any\" && task.dueBucket === \"upcoming\") {\n      if (!isWithinUpcomingRange(task.dueAt, upcomingRange)) return false;\n    }\n    var meta = task.metadata || {};\n    if (priorityFilter.size && !priorityFilter.has(meta.priority || \"\")) return false;\n    if (energyFilter.size && !energyFilter.has(meta.energy || \"\")) return false;\n    var gtdValue = (meta.gtd || \"\").toLowerCase();\n    if (gtdFilter.size && !gtdFilter.has(gtdValue)) return false;\n    if (projectText) {\n      var hay = (meta.project || \"\").trim();\n      if (hay.toLowerCase() !== projectText.toLowerCase()) return false;\n    }\n    if (waitingText) {\n      var _hay = (meta.waitingFor || \"\").toLowerCase();\n      if (!_hay.includes(waitingText)) return false;\n    }\n    if (contextText) {\n      var ctxs = Array.isArray(meta.context) ? meta.context : [];\n      var matches = ctxs.some(function (c) {\n        return typeof c === \"string\" && c.toLowerCase().includes(contextText);\n      });\n      if (!matches) return false;\n    }\n    if (queryText) {\n      var haystack = \"\".concat(task.title, \" \").concat(task.pageTitle || \"\", \" \").concat(task.text).toLowerCase();\n      if (!haystack.includes(queryText)) return false;\n    }\n    return true;\n  });\n}\nfunction groupTasks(tasks, grouping) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var completionFilter = options.completion || [];\n  var completedOnly = completionFilter.length === 1 && completionFilter[0] === \"completed\";\n  var completedTasks = completedOnly ? tasks.filter(function (task) {\n    return task.isCompleted;\n  }) : [];\n  var workingTasks = completedOnly ? tasks.filter(function (task) {\n    return !task.isCompleted;\n  }) : tasks;\n  var labels = options.groupLabels || GROUP_LABELS;\n  var groups = [];\n  if (grouping === \"project\") {\n    var buckets = new Map();\n    var _iterator = _createForOfIteratorHelper(workingTasks),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _task$metadata;\n        var task = _step.value;\n        var project = ((task === null || task === void 0 || (_task$metadata = task.metadata) === null || _task$metadata === void 0 ? void 0 : _task$metadata.project) || \"\").trim();\n        var key = project || \"__none__\";\n        if (!buckets.has(key)) buckets.set(key, []);\n        buckets.get(key).push(task);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n    var keys = Array.from(buckets.keys()).sort(function (a, b) {\n      if (a === \"__none__\") return 1;\n      if (b === \"__none__\") return -1;\n      return String(a).localeCompare(String(b), undefined, {\n        sensitivity: \"base\"\n      });\n    });\n    var _iterator2 = _createForOfIteratorHelper(keys),\n      _step2;\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var _key = _step2.value;\n        var items = buckets.get(_key) || [];\n        var title = _key === \"__none__\" ? labels.noProject || \"No Project\" : _key;\n        if (items.length) groups.push({\n          id: \"project-\".concat(_key),\n          title: title,\n          items: items\n        });\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n    if (completedTasks.length) {\n      groups.unshift({\n        id: \"completed\",\n        title: labels[\"completed\"] || \"Completed\",\n        items: completedTasks\n      });\n    }\n    return groups;\n  }\n  if (grouping === \"recurrence\") {\n    var _iterator3 = _createForOfIteratorHelper(GROUP_ORDER_RECURRENCE),\n      _step3;\n    try {\n      var _loop = function _loop() {\n        var key = _step3.value;\n        var items = workingTasks.filter(function (task) {\n          return task.recurrenceBucket === key;\n        });\n        if (items.length) {\n          groups.push({\n            id: key,\n            title: labels[key] || GROUP_LABELS[key],\n            items: items\n          });\n        }\n      };\n      for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n        _loop();\n      }\n    } catch (err) {\n      _iterator3.e(err);\n    } finally {\n      _iterator3.f();\n    }\n    if (completedTasks.length) {\n      groups.unshift({\n        id: \"completed\",\n        title: labels[\"completed\"] || \"Completed\",\n        items: completedTasks\n      });\n    }\n    return groups;\n  }\n  var _iterator4 = _createForOfIteratorHelper(GROUP_ORDER_TIME),\n    _step4;\n  try {\n    var _loop2 = function _loop2() {\n      var key = _step4.value;\n      var items = workingTasks.filter(function (task) {\n        return task.dueBucket === key;\n      });\n      if (items.length) {\n        groups.push({\n          id: key,\n          title: labels[key] || GROUP_LABELS[key],\n          items: items\n        });\n      }\n    };\n    for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n      _loop2();\n    }\n  } catch (err) {\n    _iterator4.e(err);\n  } finally {\n    _iterator4.f();\n  }\n  if (completedTasks.length) {\n    groups.unshift({\n      id: \"completed\",\n      title: labels[\"completed\"] || \"Completed\",\n      items: completedTasks\n    });\n  }\n  return groups;\n}\nfunction useVirtualRows(groups, expandedMap) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var rows = [];\n    var _iterator5 = _createForOfIteratorHelper(groups),\n      _step5;\n    try {\n      for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n        var group = _step5.value;\n        rows.push({\n          type: \"group\",\n          key: \"group-\".concat(group.id),\n          groupId: group.id,\n          group: group\n        });\n        if (expandedMap[group.id] !== false) {\n          var _iterator6 = _createForOfIteratorHelper(group.items),\n            _step6;\n          try {\n            for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n              var task = _step6.value;\n              rows.push({\n                type: \"task\",\n                key: \"task-\".concat(task.uid),\n                groupId: group.id,\n                task: task\n              });\n            }\n          } catch (err) {\n            _iterator6.e(err);\n          } finally {\n            _iterator6.f();\n          }\n        }\n      }\n    } catch (err) {\n      _iterator5.e(err);\n    } finally {\n      _iterator5.f();\n    }\n    return rows;\n  }, [groups, expandedMap]);\n}\nfunction Pill(_ref) {\n  var icon = _ref.icon,\n    label = _ref.label,\n    value = _ref.value,\n    muted = _ref.muted,\n    onClick = _ref.onClick;\n  if (!value) return null;\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-pill\".concat(muted ? \" bt-pill--muted\" : \"\"),\n    title: label || undefined,\n    onClick: onClick\n  }, icon ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-pill__icon\",\n    \"aria-hidden\": \"true\"\n  }, icon) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-pill__value\"\n  }, value));\n}\nfunction FilterChips(_ref2) {\n  var sectionKey = _ref2.sectionKey,\n    label = _ref2.label,\n    chips = _ref2.chips,\n    activeValues = _ref2.activeValues,\n    onToggle = _ref2.onToggle,\n    _ref2$singleChoice = _ref2.singleChoice,\n    singleChoice = _ref2$singleChoice === void 0 ? false : _ref2$singleChoice;\n  var chipList = Array.isArray(chips) ? chips : [];\n  var active = Array.isArray(activeValues) ? activeValues : [];\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filter-row\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-filter-row__label\"\n  }, label), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filter-row__chips\"\n  }, chipList.map(function (chip) {\n    var isActive = active.includes(chip.value);\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: chip.value,\n      type: \"button\",\n      className: \"bt-chip\".concat(isActive ? \" bt-chip--active\" : \"\"),\n      onClick: function onClick() {\n        return onToggle(sectionKey, chip.value, singleChoice);\n      }\n    }, chip.label);\n  })));\n}\nfunction GroupHeader(_ref3) {\n  var _strings$bulk, _strings$bulk2;\n  var title = _ref3.title,\n    count = _ref3.count,\n    isExpanded = _ref3.isExpanded,\n    onToggle = _ref3.onToggle,\n    selectionActive = _ref3.selectionActive,\n    selectionState = _ref3.selectionState,\n    onToggleSelection = _ref3.onToggleSelection,\n    strings = _ref3.strings;\n  var checkboxIcon = selectionState === \"all\" ? \"â˜‘\" : selectionState === \"partial\" ? \"â—ª\" : \"â˜\";\n  var ariaChecked = selectionState === \"partial\" ? \"mixed\" : selectionState === \"all\";\n  var selectionLabel = selectionState === \"all\" ? strings !== null && strings !== void 0 && (_strings$bulk = strings.bulk) !== null && _strings$bulk !== void 0 && _strings$bulk.deselectGroup ? strings.bulk.deselectGroup(title) : \"Deselect all in \".concat(title) : strings !== null && strings !== void 0 && (_strings$bulk2 = strings.bulk) !== null && _strings$bulk2 !== void 0 && _strings$bulk2.selectGroup ? strings.bulk.selectGroup(title) : \"Select all in \".concat(title);\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-group-header\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-group-header__toggle\",\n    onClick: onToggle,\n    \"aria-expanded\": isExpanded\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-group-header__title\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-group-header__caret\",\n    \"aria-hidden\": \"true\"\n  }, isExpanded ? \"â–¾\" : \"â–¸\"), title)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-group-header__actions\"\n  }, selectionActive ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-group-header__select\",\n    onClick: onToggleSelection,\n    role: \"checkbox\",\n    \"aria-checked\": ariaChecked,\n    \"aria-label\": selectionLabel,\n    title: selectionLabel\n  }, checkboxIcon) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-group-header__count\"\n  }, count)));\n}\nfunction TaskActionsMenu(_ref4) {\n  var task = _ref4.task,\n    controller = _ref4.controller,\n    onOpenChange = _ref4.onOpenChange,\n    strings = _ref4.strings;\n  var _useState3 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    open = _useState4[0],\n    setOpen = _useState4[1];\n  var menuRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var buttonRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var _useState5 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({\n      top: 0,\n      left: 0\n    }),\n    _useState6 = _slicedToArray(_useState5, 2),\n    coords = _useState6[0],\n    setCoords = _useState6[1];\n  var menuSizeRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)({\n    width: 240,\n    height: 200\n  });\n  var metadata = task.metadata || {};\n  var handleEditText = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(key, currentValue) {\n      var _controller$updateMet4;\n      var _controller$refreshPr, _controller$updateMet, selection, _controller$refreshWa, _controller$updateMet2, _selection, _controller$refreshCo, _controller$updateMet3, _selection2, contexts, label, next, trimmed, _t, _t2, _t3, _t4;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.n) {\n          case 0:\n            if (!(key === \"project\")) {\n              _context.n = 6;\n              break;\n            }\n            _context.n = 1;\n            return controller === null || controller === void 0 || (_controller$refreshPr = controller.refreshProjectOptions) === null || _controller$refreshPr === void 0 ? void 0 : _controller$refreshPr.call(controller);\n          case 1:\n            if (!(controller !== null && controller !== void 0 && controller.promptProject)) {\n              _context.n = 3;\n              break;\n            }\n            _context.n = 2;\n            return controller.promptProject({\n              initialValue: currentValue || \"\"\n            });\n          case 2:\n            _t = _context.v;\n            _context.n = 4;\n            break;\n          case 3:\n            _t = currentValue || \"\";\n          case 4:\n            selection = _t;\n            if (!(selection == null)) {\n              _context.n = 5;\n              break;\n            }\n            return _context.a(2);\n          case 5:\n            (_controller$updateMet = controller.updateMetadata) === null || _controller$updateMet === void 0 || _controller$updateMet.call(controller, task.uid, {\n              project: selection || null\n            });\n            return _context.a(2);\n          case 6:\n            if (!(key === \"waitingFor\")) {\n              _context.n = 12;\n              break;\n            }\n            _context.n = 7;\n            return controller === null || controller === void 0 || (_controller$refreshWa = controller.refreshWaitingOptions) === null || _controller$refreshWa === void 0 ? void 0 : _controller$refreshWa.call(controller);\n          case 7:\n            if (!(controller !== null && controller !== void 0 && controller.promptWaiting)) {\n              _context.n = 9;\n              break;\n            }\n            _context.n = 8;\n            return controller.promptWaiting({\n              initialValue: currentValue || \"\"\n            });\n          case 8:\n            _t2 = _context.v;\n            _context.n = 10;\n            break;\n          case 9:\n            _t2 = currentValue || \"\";\n          case 10:\n            _selection = _t2;\n            if (!(_selection == null)) {\n              _context.n = 11;\n              break;\n            }\n            return _context.a(2);\n          case 11:\n            (_controller$updateMet2 = controller.updateMetadata) === null || _controller$updateMet2 === void 0 || _controller$updateMet2.call(controller, task.uid, {\n              waitingFor: _selection || null\n            });\n            return _context.a(2);\n          case 12:\n            if (!(key === \"context\")) {\n              _context.n = 18;\n              break;\n            }\n            _context.n = 13;\n            return controller === null || controller === void 0 || (_controller$refreshCo = controller.refreshContextOptions) === null || _controller$refreshCo === void 0 ? void 0 : _controller$refreshCo.call(controller);\n          case 13:\n            if (!(controller !== null && controller !== void 0 && controller.promptContext)) {\n              _context.n = 15;\n              break;\n            }\n            _context.n = 14;\n            return controller.promptContext({\n              initialValue: currentValue || []\n            });\n          case 14:\n            _t3 = _context.v;\n            _context.n = 16;\n            break;\n          case 15:\n            _t3 = [];\n          case 16:\n            _selection2 = _t3;\n            if (!(_selection2 == null)) {\n              _context.n = 17;\n              break;\n            }\n            return _context.a(2);\n          case 17:\n            contexts = Array.isArray(_selection2) ? _selection2 : [];\n            (_controller$updateMet3 = controller.updateMetadata) === null || _controller$updateMet3 === void 0 || _controller$updateMet3.call(controller, task.uid, {\n              context: contexts\n            });\n            return _context.a(2);\n          case 18:\n            label = key;\n            if (!controller.promptValue) {\n              _context.n = 20;\n              break;\n            }\n            _context.n = 19;\n            return controller.promptValue({\n              title: \"Better Tasks\",\n              message: \"Set \".concat(label),\n              placeholder: label,\n              initial: currentValue || \"\"\n            });\n          case 19:\n            _t4 = _context.v;\n            _context.n = 21;\n            break;\n          case 20:\n            _t4 = null;\n          case 21:\n            next = _t4;\n            if (!(next == null)) {\n              _context.n = 22;\n              break;\n            }\n            return _context.a(2);\n          case 22:\n            trimmed = String(next).trim();\n            (_controller$updateMet4 = controller.updateMetadata) === null || _controller$updateMet4 === void 0 || _controller$updateMet4.call(controller, task.uid, _defineProperty({}, key, trimmed || null));\n          case 23:\n            return _context.a(2);\n        }\n      }, _callee);\n    }));\n    return function handleEditText(_x, _x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var cycleValue = function cycleValue(key) {\n    var _controller$updateMet6;\n    var order = [null, \"low\", \"medium\", \"high\"];\n    var current = metadata[key] || null;\n    var idx = order.indexOf(current);\n    var next = order[(idx + 1) % order.length];\n    (_controller$updateMet6 = controller.updateMetadata) === null || _controller$updateMet6 === void 0 || _controller$updateMet6.call(controller, task.uid, _defineProperty({}, key, next));\n  };\n  var cycleGtd = function cycleGtd() {\n    var _controller$updateMet8;\n    var next = cycleGtdStatus(metadata.gtd || null);\n    (_controller$updateMet8 = controller.updateMetadata) === null || _controller$updateMet8 === void 0 || _controller$updateMet8.call(controller, task.uid, {\n      gtd: next\n    });\n  };\n  var setOpenState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (next) {\n    setOpen(function (prev) {\n      return typeof next === \"function\" ? next(prev) : next;\n    });\n  }, []);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    onOpenChange === null || onOpenChange === void 0 || onOpenChange(open);\n  }, [open, onOpenChange]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    return function () {\n      onOpenChange === null || onOpenChange === void 0 || onOpenChange(false);\n    };\n  }, [onOpenChange]);\n  var updatePosition = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!buttonRef.current) return;\n    var rect = buttonRef.current.getBoundingClientRect();\n    var viewportHeight = window.innerHeight;\n    var viewportWidth = window.innerWidth;\n    var spacing = 8;\n    var _ref6 = menuSizeRef.current || {},\n      _ref6$width = _ref6.width,\n      width = _ref6$width === void 0 ? 240 : _ref6$width,\n      _ref6$height = _ref6.height,\n      height = _ref6$height === void 0 ? 200 : _ref6$height;\n    var openAbove = rect.top - spacing - height >= spacing;\n    if (!openAbove && rect.bottom + spacing + height <= viewportHeight - spacing) {\n      openAbove = false;\n    } else if (!openAbove) {\n      openAbove = rect.top > viewportHeight / 2;\n    }\n    var top = openAbove ? rect.top - height - spacing : rect.bottom + spacing;\n    if (top < spacing) top = spacing;\n    if (top + height + spacing > viewportHeight) {\n      top = Math.max(spacing, viewportHeight - height - spacing);\n    }\n    var left = rect.right - width;\n    if (left < spacing) left = spacing;\n    if (left + width + spacing > viewportWidth) {\n      left = Math.max(spacing, viewportWidth - width - spacing);\n    }\n    setCoords({\n      top: top,\n      left: left\n    });\n  }, []);\n  var actions = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    if (!task || !controller) return [];\n    var list = [];\n    var tm = (strings === null || strings === void 0 ? void 0 : strings.taskMenu) || {};\n    var metaLabels = (strings === null || strings === void 0 ? void 0 : strings.metaLabels) || {};\n    var filterDefs = (strings === null || strings === void 0 ? void 0 : strings.filterDefs) || {};\n    var labelFor = function labelFor(key) {\n      return metaLabels[key] || key;\n    };\n    var valueLabel = function valueLabel(type, value) {\n      if (!value) return \"\";\n      if (type === \"priority\") {\n        var match = (filterDefs.Priority || []).find(function (f) {\n          return f.value === value;\n        });\n        return (match === null || match === void 0 ? void 0 : match.label) || formatPriorityEnergyDisplay(value);\n      }\n      if (type === \"energy\") {\n        var _match = (filterDefs.Energy || []).find(function (f) {\n          return f.value === value;\n        });\n        return (_match === null || _match === void 0 ? void 0 : _match.label) || formatPriorityEnergyDisplay(value);\n      }\n      if (type === \"gtd\") {\n        var _match2 = (filterDefs.GTD || []).find(function (f) {\n          return f.value === value;\n        });\n        return (_match2 === null || _match2 === void 0 ? void 0 : _match2.label) || formatGtdStatusDisplay(value);\n      }\n      return value;\n    };\n    var labels = {\n      repeat: labelFor(\"repeat\") || \"repeat\",\n      start: labelFor(\"start\") || \"start date\",\n      defer: labelFor(\"defer\") || \"defer date\",\n      due: labelFor(\"due\") || \"due date\"\n    };\n    var hasRepeat = !!task.repeatText;\n    var hasStart = task.startAt instanceof Date;\n    var hasDefer = task.deferUntil instanceof Date;\n    var hasDue = task.dueAt instanceof Date;\n    var pushDateActions = function pushDateActions(type, hasValue) {\n      if (hasValue) {\n        list.push({\n          key: \"edit-\".concat(type),\n          label: \"\".concat(tm[\"edit\".concat(type[0].toUpperCase()).concat(type.slice(1))] || \"Edit \".concat(labels[type])),\n          handler: function handler() {\n            return controller.editDate(task.uid, type, {\n              intent: \"menu-edit\"\n            });\n          }\n        });\n        list.push({\n          key: \"remove-\".concat(type),\n          label: \"\".concat(tm[\"remove\".concat(type[0].toUpperCase()).concat(type.slice(1))] || \"Remove \".concat(labels[type])),\n          handler: function handler() {\n            return controller.removeTaskAttribute(task.uid, type);\n          },\n          danger: true\n        });\n      } else {\n        list.push({\n          key: \"add-\".concat(type),\n          label: \"\".concat(tm[\"add\".concat(type[0].toUpperCase()).concat(type.slice(1))] || \"Add \".concat(labels[type])),\n          handler: function handler() {\n            return controller.editDate(task.uid, type, {\n              intent: \"menu-add\"\n            });\n          }\n        });\n      }\n    };\n    if (hasRepeat) {\n      list.push({\n        key: \"edit-repeat\",\n        label: tm.editRepeat || \"Edit repeat\",\n        handler: function handler() {\n          return controller.editRepeat(task.uid);\n        }\n      });\n      list.push({\n        key: \"remove-repeat\",\n        label: tm.removeRepeat || \"Remove repeat\",\n        handler: function handler() {\n          return controller.removeTaskAttribute(task.uid, \"repeat\");\n        },\n        danger: true\n      });\n    } else {\n      list.push({\n        key: \"add-repeat\",\n        label: tm.addRepeat || \"Add repeat\",\n        handler: function handler() {\n          return controller.editRepeat(task.uid);\n        }\n      });\n    }\n    pushDateActions(\"start\", hasStart);\n    pushDateActions(\"defer\", hasDefer);\n    pushDateActions(\"due\", hasDue);\n    var meta = task.metadata || {};\n    list.push({\n      key: \"meta-separator\",\n      label: tm.metaHeading || \"Metadata\",\n      separator: true\n    });\n    list.push({\n      key: \"meta-gtd\",\n      label: \"\".concat(labelFor(\"gtd\"), \": \").concat(meta.gtd ? valueLabel(\"gtd\", meta.gtd) : \"\", \" (\").concat(tm.cycleGtd || \"Click to cycle\", \")\"),\n      handler: function handler() {\n        return cycleGtd();\n      }\n    });\n    if (meta.project) {\n      list.push({\n        key: \"meta-project-edit\",\n        label: \"\".concat(tm.editProject || \"Edit project\", \" (\").concat(meta.project, \")\"),\n        handler: function handler() {\n          return handleEditText(\"project\", meta.project);\n        }\n      });\n      list.push({\n        key: \"meta-project-remove\",\n        label: tm.removeProject || \"Remove project\",\n        handler: function handler() {\n          var _controller$updateMet9;\n          return (_controller$updateMet9 = controller.updateMetadata) === null || _controller$updateMet9 === void 0 ? void 0 : _controller$updateMet9.call(controller, task.uid, {\n            project: null\n          });\n        },\n        danger: true\n      });\n    } else {\n      list.push({\n        key: \"meta-project-add\",\n        label: tm.setProject || \"Set project\",\n        handler: function handler() {\n          return handleEditText(\"project\", meta.project);\n        }\n      });\n    }\n    if (meta.context && meta.context.length) {\n      list.push({\n        key: \"meta-context-edit\",\n        label: \"\".concat(tm.editContext || \"Edit context\", \" (\").concat(meta.context.join(\", \"), \")\"),\n        handler: function handler() {\n          return handleEditText(\"context\", (meta.context || []).join(\", \"));\n        }\n      });\n      list.push({\n        key: \"meta-context-remove\",\n        label: tm.removeContext || \"Remove context\",\n        handler: function handler() {\n          var _controller$updateMet0;\n          return (_controller$updateMet0 = controller.updateMetadata) === null || _controller$updateMet0 === void 0 ? void 0 : _controller$updateMet0.call(controller, task.uid, {\n            context: []\n          });\n        },\n        danger: true\n      });\n    } else {\n      list.push({\n        key: \"meta-context-add\",\n        label: tm.setContext || \"Set context\",\n        handler: function handler() {\n          return handleEditText(\"context\", (meta.context || []).join(\", \"));\n        }\n      });\n    }\n    if (meta.waitingFor) {\n      list.push({\n        key: \"meta-waiting-edit\",\n        label: \"\".concat(tm.editWaiting || \"Edit waiting-for\", \" (\").concat(meta.waitingFor, \")\"),\n        handler: function handler() {\n          return handleEditText(\"waitingFor\", meta.waitingFor);\n        }\n      });\n      list.push({\n        key: \"meta-waiting-remove\",\n        label: tm.removeWaiting || \"Remove waiting-for\",\n        handler: function handler() {\n          var _controller$updateMet1;\n          return (_controller$updateMet1 = controller.updateMetadata) === null || _controller$updateMet1 === void 0 ? void 0 : _controller$updateMet1.call(controller, task.uid, {\n            waitingFor: null\n          });\n        },\n        danger: true\n      });\n    } else {\n      list.push({\n        key: \"meta-waiting-add\",\n        label: tm.setWaiting || \"Set waiting-for\",\n        handler: function handler() {\n          return handleEditText(\"waitingFor\", meta.waitingFor);\n        }\n      });\n    }\n    list.push({\n      key: \"meta-priority\",\n      label: \"\".concat(tm.priorityCycle || \"Priority (click to cycle)\").concat(meta.priority ? \": \".concat(valueLabel(\"priority\", meta.priority)) : \"\"),\n      handler: function handler() {\n        return cycleValue(\"priority\");\n      }\n    });\n    list.push({\n      key: \"meta-energy\",\n      label: \"\".concat(tm.energyCycle || \"Energy (click to cycle)\").concat(meta.energy ? \": \".concat(valueLabel(\"energy\", meta.energy)) : \"\"),\n      handler: function handler() {\n        return cycleValue(\"energy\");\n      }\n    });\n    return list;\n  }, [controller, task, handleEditText, strings]);\n  var safeActions = Array.isArray(actions) ? actions : [];\n  var menuRoot = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    if (typeof document === \"undefined\") return null;\n    var root = document.createElement(\"div\");\n    root.className = \"bt-task-menu-portal\";\n    root.setAttribute(\"data-bt-portal\", \"task-menu\");\n    root.style.position = \"relative\";\n    root.style.zIndex = \"1000\";\n    return root;\n  }, []);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!menuRoot || typeof document === \"undefined\") return undefined;\n    if (!safeActions.length) return undefined;\n    var host = document.querySelector(\".bt-dashboard-host\") || document.body;\n    host.appendChild(menuRoot);\n    return function () {\n      menuRoot.remove();\n    };\n  }, [menuRoot, safeActions.length]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(function () {\n    if (!open) return undefined;\n    var menuEl = menuRef.current;\n    if (menuEl) {\n      var rect = menuEl.getBoundingClientRect();\n      menuSizeRef.current = {\n        width: rect.width,\n        height: rect.height\n      };\n      updatePosition();\n    }\n  }, [open, updatePosition, safeActions.length]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(function () {\n    if (!open) return undefined;\n    updatePosition();\n    var handler = function handler() {\n      return updatePosition();\n    };\n    window.addEventListener(\"scroll\", handler, true);\n    window.addEventListener(\"resize\", handler);\n    return function () {\n      window.removeEventListener(\"scroll\", handler, true);\n      window.removeEventListener(\"resize\", handler);\n    };\n  }, [open, updatePosition]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!open) return undefined;\n    var handleClick = function handleClick(event) {\n      var _menuRef$current, _buttonRef$current;\n      if ((_menuRef$current = menuRef.current) !== null && _menuRef$current !== void 0 && _menuRef$current.contains(event.target) || (_buttonRef$current = buttonRef.current) !== null && _buttonRef$current !== void 0 && _buttonRef$current.contains(event.target)) {\n        return;\n      }\n      setOpenState(false);\n    };\n    var handleKey = function handleKey(event) {\n      if (event.key === \"Escape\") {\n        setOpenState(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClick);\n    document.addEventListener(\"keydown\", handleKey);\n    return function () {\n      document.removeEventListener(\"mousedown\", handleClick);\n      document.removeEventListener(\"keydown\", handleKey);\n    };\n  }, [open]);\n  if (!safeActions.length) return null;\n  var menu = open && menuRoot ? /*#__PURE__*/(0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-menu__popover\",\n    role: \"menu\",\n    ref: menuRef,\n    style: {\n      position: \"fixed\",\n      top: coords.top,\n      left: coords.left\n    }\n  }, safeActions.map(function (action) {\n    return action.separator ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      key: action.key,\n      className: \"bt-task-menu__separator\"\n    }, action.label) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: action.key,\n      type: \"button\",\n      className: \"bt-task-menu__item\".concat(action.danger ? \" bt-task-menu__item--danger\" : \"\"),\n      role: \"menuitem\",\n      onClick: /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n        return _regenerator().w(function (_context2) {\n          while (1) switch (_context2.n) {\n            case 0:\n              if (!(typeof action.handler === \"function\")) {\n                _context2.n = 1;\n                break;\n              }\n              _context2.n = 1;\n              return action.handler();\n            case 1:\n              setOpenState(false);\n            case 2:\n              return _context2.a(2);\n          }\n        }, _callee2);\n      }))\n    }, action.label);\n  })), menuRoot) : null;\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-menu\".concat(open ? \" bt-task-menu--open\" : \"\")\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-task-menu__trigger\",\n    onClick: function onClick() {\n      return setOpenState(function (value) {\n        return !value;\n      });\n    },\n    \"aria-haspopup\": \"menu\",\n    \"aria-expanded\": open,\n    title: (strings === null || strings === void 0 ? void 0 : strings.taskOptions) || \"Task options\",\n    ref: buttonRef\n  }, \"\\u22EF\"), menu);\n}\nfunction SimpleActionsMenu(_ref8) {\n  var actions = _ref8.actions,\n    title = _ref8.title,\n    _ref8$disabled = _ref8.disabled,\n    disabled = _ref8$disabled === void 0 ? false : _ref8$disabled;\n  var _useState7 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    open = _useState8[0],\n    setOpen = _useState8[1];\n  var menuRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var buttonRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var _useState9 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({\n      top: 0,\n      left: 0\n    }),\n    _useState0 = _slicedToArray(_useState9, 2),\n    coords = _useState0[0],\n    setCoords = _useState0[1];\n  var menuSizeRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)({\n    width: 240,\n    height: 200\n  });\n  var safeActions = Array.isArray(actions) ? actions : [];\n  var setOpenState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (next) {\n    setOpen(function (prev) {\n      return typeof next === \"function\" ? next(prev) : next;\n    });\n  }, []);\n  var updatePosition = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!buttonRef.current) return;\n    var rect = buttonRef.current.getBoundingClientRect();\n    var viewportHeight = window.innerHeight;\n    var viewportWidth = window.innerWidth;\n    var spacing = 8;\n    var _ref9 = menuSizeRef.current || {},\n      _ref9$width = _ref9.width,\n      width = _ref9$width === void 0 ? 240 : _ref9$width,\n      _ref9$height = _ref9.height,\n      height = _ref9$height === void 0 ? 200 : _ref9$height;\n    var openAbove = rect.top - spacing - height >= spacing;\n    if (!openAbove && rect.bottom + spacing + height <= viewportHeight - spacing) {\n      openAbove = false;\n    } else if (!openAbove) {\n      openAbove = rect.top > viewportHeight / 2;\n    }\n    var top = openAbove ? rect.top - height - spacing : rect.bottom + spacing;\n    if (top < spacing) top = spacing;\n    if (top + height + spacing > viewportHeight) {\n      top = Math.max(spacing, viewportHeight - height - spacing);\n    }\n    var left = rect.right - width;\n    if (left < spacing) left = spacing;\n    if (left + width + spacing > viewportWidth) {\n      left = Math.max(spacing, viewportWidth - width - spacing);\n    }\n    setCoords({\n      top: top,\n      left: left\n    });\n  }, []);\n  var menuRoot = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    if (typeof document === \"undefined\") return null;\n    var root = document.createElement(\"div\");\n    root.className = \"bt-task-menu-portal\";\n    root.setAttribute(\"data-bt-portal\", \"simple-menu\");\n    root.style.position = \"relative\";\n    root.style.zIndex = \"1000\";\n    return root;\n  }, []);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!menuRoot || typeof document === \"undefined\") return undefined;\n    if (!safeActions.length) return undefined;\n    var host = document.querySelector(\".bt-dashboard-host\") || document.body;\n    host.appendChild(menuRoot);\n    return function () {\n      menuRoot.remove();\n    };\n  }, [menuRoot, safeActions.length]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(function () {\n    if (!open) return undefined;\n    var menuEl = menuRef.current;\n    if (menuEl) {\n      var rect = menuEl.getBoundingClientRect();\n      menuSizeRef.current = {\n        width: rect.width,\n        height: rect.height\n      };\n      updatePosition();\n    }\n  }, [open, updatePosition, safeActions.length]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(function () {\n    if (!open) return undefined;\n    updatePosition();\n    var handler = function handler() {\n      return updatePosition();\n    };\n    window.addEventListener(\"scroll\", handler, true);\n    window.addEventListener(\"resize\", handler);\n    return function () {\n      window.removeEventListener(\"scroll\", handler, true);\n      window.removeEventListener(\"resize\", handler);\n    };\n  }, [open, updatePosition]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!open) return undefined;\n    var handleClick = function handleClick(event) {\n      var _menuRef$current2, _buttonRef$current2;\n      if ((_menuRef$current2 = menuRef.current) !== null && _menuRef$current2 !== void 0 && _menuRef$current2.contains(event.target) || (_buttonRef$current2 = buttonRef.current) !== null && _buttonRef$current2 !== void 0 && _buttonRef$current2.contains(event.target)) {\n        return;\n      }\n      setOpenState(false);\n    };\n    var handleKey = function handleKey(event) {\n      if (event.key === \"Escape\") setOpenState(false);\n    };\n    document.addEventListener(\"mousedown\", handleClick);\n    document.addEventListener(\"keydown\", handleKey);\n    return function () {\n      document.removeEventListener(\"mousedown\", handleClick);\n      document.removeEventListener(\"keydown\", handleKey);\n    };\n  }, [open, setOpenState]);\n  if (!safeActions.length) return null;\n  var menu = open && menuRoot ? /*#__PURE__*/(0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-menu__popover\",\n    role: \"menu\",\n    ref: menuRef,\n    style: {\n      position: \"fixed\",\n      top: coords.top,\n      left: coords.left\n    }\n  }, safeActions.map(function (action) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: action.key,\n      type: \"button\",\n      className: \"bt-task-menu__item\".concat(action.danger ? \" bt-task-menu__item--danger\" : \"\"),\n      role: \"menuitem\",\n      onClick: /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {\n        return _regenerator().w(function (_context3) {\n          while (1) switch (_context3.n) {\n            case 0:\n              if (!(typeof action.handler === \"function\")) {\n                _context3.n = 1;\n                break;\n              }\n              _context3.n = 1;\n              return action.handler();\n            case 1:\n              setOpenState(false);\n            case 2:\n              return _context3.a(2);\n          }\n        }, _callee3);\n      }))\n    }, action.label);\n  })), menuRoot) : null;\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-menu\".concat(open ? \" bt-task-menu--open\" : \"\")\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-task-menu__trigger\",\n    onClick: function onClick() {\n      if (disabled) return;\n      setOpenState(function (value) {\n        return !value;\n      });\n    },\n    \"aria-haspopup\": \"menu\",\n    \"aria-expanded\": open,\n    title: title || undefined,\n    ref: buttonRef,\n    disabled: disabled\n  }, \"\\u22EF\"), menu);\n}\nfunction TaskRow(_ref1) {\n  var _strings$bulk3, _strings$bulk4;\n  var task = _ref1.task,\n    controller = _ref1.controller,\n    strings = _ref1.strings,\n    selectionActive = _ref1.selectionActive,\n    isSelected = _ref1.isSelected,\n    onToggleSelect = _ref1.onToggleSelect;\n  var checkboxLabel = task.isCompleted ? (strings === null || strings === void 0 ? void 0 : strings.markOpen) || \"Mark as open\" : (strings === null || strings === void 0 ? void 0 : strings.markDone) || \"Mark as done\";\n  var completedLabel = (strings === null || strings === void 0 ? void 0 : strings.completedLabel) || \"Completed\";\n  var selectLabel = isSelected ? (strings === null || strings === void 0 || (_strings$bulk3 = strings.bulk) === null || _strings$bulk3 === void 0 ? void 0 : _strings$bulk3.deselectTask) || \"Deselect\" : (strings === null || strings === void 0 || (_strings$bulk4 = strings.bulk) === null || _strings$bulk4 === void 0 ? void 0 : _strings$bulk4.selectTask) || \"Select\";\n  var metaDescriptionId = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return \"bt-task-meta-\".concat(task.uid);\n  }, [task.uid]);\n  var _useState1 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState10 = _slicedToArray(_useState1, 2),\n    menuOpen = _useState10[0],\n    setMenuOpen = _useState10[1];\n  var handleMenuOpenChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (value) {\n    setMenuOpen(value);\n  }, []);\n  var metadata = task.metadata || {};\n  var contextBits = [];\n  if (task.pageTitle) {\n    contextBits.push({\n      key: \"page\",\n      type: \"page\",\n      text: task.pageTitle,\n      pageUid: task.pageUid\n    });\n  }\n  if (task.isCompleted) contextBits.push({\n    key: \"completed\",\n    type: \"text\",\n    text: completedLabel\n  });else if (task.availabilityLabel) contextBits.push({\n    key: \"availability\",\n    type: \"text\",\n    text: task.availabilityLabel\n  });\n  var showSnooze = !task.isCompleted;\n  var handlePillClick = function handlePillClick(event, pill, taskRow, ctrl) {\n    var type = pill.type;\n    if (type === \"repeat\") {\n      ctrl.editRepeat(taskRow.uid, event);\n    } else if (type === \"start\" || type === \"defer\" || type === \"due\") {\n      ctrl.editDate(taskRow.uid, type, {\n        event: event\n      });\n    } else if (type === \"priority\" || type === \"energy\") {\n      var _ctrl$updateMetadata;\n      (_ctrl$updateMetadata = ctrl.updateMetadata) === null || _ctrl$updateMetadata === void 0 || _ctrl$updateMetadata.call(ctrl, taskRow.uid, _defineProperty({}, type, pill.nextValue));\n    } else if (type === \"gtd\") {\n      var _ctrl$updateMetadata2;\n      (_ctrl$updateMetadata2 = ctrl.updateMetadata) === null || _ctrl$updateMetadata2 === void 0 || _ctrl$updateMetadata2.call(ctrl, taskRow.uid, {\n        gtd: pill.nextValue\n      });\n    } else if (type === \"project\") {\n      var _ctrl$handleMetadataC;\n      (_ctrl$handleMetadataC = ctrl.handleMetadataClick) === null || _ctrl$handleMetadataC === void 0 || _ctrl$handleMetadataC.call(ctrl, taskRow.uid, \"project\", {\n        value: pill.raw || pill.value\n      }, event, ctrl);\n    } else if (type === \"waitingFor\") {\n      var _ctrl$handleMetadataC2;\n      (_ctrl$handleMetadataC2 = ctrl.handleMetadataClick) === null || _ctrl$handleMetadataC2 === void 0 || _ctrl$handleMetadataC2.call(ctrl, taskRow.uid, \"waitingFor\", {\n        value: pill.raw || pill.value\n      }, event, ctrl);\n    } else if (type === \"context\") {\n      var _ctrl$handleMetadataC3, _pill$rawList;\n      (_ctrl$handleMetadataC3 = ctrl.handleMetadataClick) === null || _ctrl$handleMetadataC3 === void 0 || _ctrl$handleMetadataC3.call(ctrl, taskRow.uid, \"context\", {\n        value: ((_pill$rawList = pill.rawList) === null || _pill$rawList === void 0 ? void 0 : _pill$rawList[0]) || pill.raw || pill.value,\n        list: pill.rawList\n      }, event, ctrl);\n    }\n  };\n  // When in selection mode, clicking checkbox toggles selection instead of completion\n  var handleCheckboxClick = function handleCheckboxClick(event) {\n    if (selectionActive) {\n      event.stopPropagation();\n      onToggleSelect === null || onToggleSelect === void 0 || onToggleSelect(task.uid, event);\n    } else {\n      controller.toggleTask(task.uid, task.isCompleted ? \"undo\" : \"complete\");\n    }\n  };\n  var rowClasses = [\"bt-task-row\", menuOpen ? \"bt-task-row--menu-open\" : \"\", isSelected ? \"bt-task-row--selected\" : \"\"].filter(Boolean).join(\" \");\n  // In selection mode: show selection state; otherwise show completion state\n  var checkboxIcon = selectionActive ? isSelected ? \"â˜‘\" : \"â˜\" : task.isCompleted ? \"â˜‘\" : \"â˜\";\n  var checkboxAriaLabel = selectionActive ? selectLabel : checkboxLabel;\n  var checkboxAriaChecked = selectionActive ? isSelected : task.isCompleted;\n  var checkboxClasses = selectionActive ? \"bt-task-row__checkbox\".concat(isSelected ? \" bt-task-row__checkbox--selected\" : \"\") : \"bt-task-row__checkbox\".concat(task.isCompleted ? \" bt-task-row__checkbox--done\" : \"\");\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: rowClasses\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: checkboxClasses,\n    onClick: handleCheckboxClick,\n    title: checkboxAriaLabel,\n    \"aria-label\": checkboxAriaLabel,\n    role: \"checkbox\",\n    \"aria-checked\": checkboxAriaChecked\n  }, checkboxIcon), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__body\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__title\",\n    \"aria-describedby\": metaDescriptionId\n  }, task.title || (strings === null || strings === void 0 ? void 0 : strings.untitled) || \"(Untitled task)\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    id: metaDescriptionId,\n    className: \"bt-sr-only\"\n  }, contextBits.map(function (bit) {\n    return bit.text;\n  }).filter(Boolean).join(\", \")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__meta\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__meta-pills\"\n  }, (task.metaPills || []).map(function (pill) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      key: \"\".concat(task.uid, \"-\").concat(pill.type),\n      className: \"bt-pill-wrap\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(Pill, {\n      icon: pill.icon,\n      label: pill.label,\n      value: pill.value,\n      muted: !pill.value,\n      onClick: function onClick(e) {\n        return handlePillClick(e, pill, task, controller);\n      }\n    }));\n  })), !selectionActive && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(TaskActionsMenu, {\n    task: task,\n    controller: controller,\n    onOpenChange: handleMenuOpenChange,\n    strings: strings\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__context\"\n  }, contextBits.map(function (bit, idx) {\n    var prefix = idx > 0 ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      key: \"sep-\".concat(task.uid, \"-\").concat(idx),\n      className: \"bt-task-row__context-sep\"\n    }, \"\\xB7\") : null;\n    var key = \"\".concat(task.uid, \"-\").concat(bit.key || idx);\n    if (bit.type === \"page\" && bit.pageUid) {\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), {\n        key: key\n      }, prefix, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n        type: \"button\",\n        className: \"bt-task-row__context-link\",\n        onClick: function onClick(event) {\n          return controller.openPage(bit.pageUid, {\n            inSidebar: event.shiftKey\n          });\n        },\n        title: \"Open page (Shift+Click \\u2192 sidebar)\"\n      }, \"[[\", bit.text, \"]]\"));\n    }\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), {\n      key: key\n    }, prefix, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, bit.text));\n  }))), !selectionActive && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__actions\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      return controller.openBlock(task.uid, {\n        skipCompletionToast: task.isCompleted\n      });\n    }\n  }, (strings === null || strings === void 0 ? void 0 : strings.view) || \"View\"), showSnooze ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-task-row__snooze\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      return controller.snoozeTask(task.uid, 1);\n    }\n  }, (strings === null || strings === void 0 ? void 0 : strings.snoozePlus1) || \"+1d\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      return controller.snoozeTask(task.uid, 7);\n    }\n  }, (strings === null || strings === void 0 ? void 0 : strings.snoozePlus7) || \"+7d\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      return controller.snoozeTask(task.uid, \"pick\");\n    }\n  }, (strings === null || strings === void 0 ? void 0 : strings.snoozePick) || \"Pick\")) : null));\n}\nfunction BulkActionBar(_ref10) {\n  var selectedUids = _ref10.selectedUids,\n    tasks = _ref10.tasks,\n    controller = _ref10.controller,\n    strings = _ref10.strings,\n    onClearSelection = _ref10.onClearSelection,\n    onCancel = _ref10.onCancel,\n    isMobileLayout = _ref10.isMobileLayout;\n  var _useState11 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState12 = _slicedToArray(_useState11, 2),\n    metaMenuOpen = _useState12[0],\n    setMetaMenuOpen = _useState12[1];\n  var _useState13 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),\n    _useState14 = _slicedToArray(_useState13, 2),\n    activeSubmenu = _useState14[0],\n    setActiveSubmenu = _useState14[1]; // \"priority\" | \"energy\" | \"gtd\" | null\n  var metaMenuRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n\n  // Close menu when clicking outside - must be before any early returns\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!metaMenuOpen) return undefined;\n    var handleClick = function handleClick(e) {\n      if (metaMenuRef.current && !metaMenuRef.current.contains(e.target)) {\n        setMetaMenuOpen(false);\n        setActiveSubmenu(null);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClick);\n    return function () {\n      return document.removeEventListener(\"mousedown\", handleClick);\n    };\n  }, [metaMenuOpen]);\n  if (selectedUids.size === 0) return null;\n  var count = selectedUids.size;\n  var uids = Array.from(selectedUids);\n  var bulk = (strings === null || strings === void 0 ? void 0 : strings.bulk) || {};\n  var fieldLabels = bulk.fieldLabels || {};\n  var metaValues = bulk.metaValues || {};\n\n  // Determine completion state of selected tasks\n  var selectedTasks = tasks.filter(function (t) {\n    return selectedUids.has(t.uid);\n  });\n  var allCompleted = selectedTasks.length > 0 && selectedTasks.every(function (t) {\n    return t.isCompleted;\n  });\n  var allOpen = selectedTasks.length > 0 && selectedTasks.every(function (t) {\n    return !t.isCompleted;\n  });\n  var handleBulkComplete = function handleBulkComplete() {\n    var _controller$bulkToggl;\n    (_controller$bulkToggl = controller.bulkToggleTask) === null || _controller$bulkToggl === void 0 || _controller$bulkToggl.call(controller, uids, \"complete\");\n    onClearSelection();\n  };\n  var handleBulkReopen = function handleBulkReopen() {\n    var _controller$bulkToggl2;\n    (_controller$bulkToggl2 = controller.bulkToggleTask) === null || _controller$bulkToggl2 === void 0 || _controller$bulkToggl2.call(controller, uids, \"undo\");\n    onClearSelection();\n  };\n  var handleBulkSnooze = function handleBulkSnooze(days) {\n    var _controller$bulkSnooz;\n    (_controller$bulkSnooz = controller.bulkSnoozeTask) === null || _controller$bulkSnooz === void 0 || _controller$bulkSnooz.call(controller, uids, days);\n    onClearSelection();\n  };\n  var handleMetaAction = /*#__PURE__*/function () {\n    var _ref11 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(field) {\n      var value, _controller$promptPro, result, _controller$promptWai, _result, _controller$promptCon, _result2;\n      return _regenerator().w(function (_context4) {\n        while (1) switch (_context4.n) {\n          case 0:\n            setMetaMenuOpen(false);\n            setActiveSubmenu(null);\n            if (controller.bulkUpdateMetadata) {\n              _context4.n = 1;\n              break;\n            }\n            return _context4.a(2);\n          case 1:\n            value = null;\n            if (!(field === \"project\")) {\n              _context4.n = 4;\n              break;\n            }\n            _context4.n = 2;\n            return (_controller$promptPro = controller.promptProject) === null || _controller$promptPro === void 0 ? void 0 : _controller$promptPro.call(controller, {\n              initialValue: \"\"\n            });\n          case 2:\n            result = _context4.v;\n            if (!(result === undefined || result === null)) {\n              _context4.n = 3;\n              break;\n            }\n            return _context4.a(2);\n          case 3:\n            value = result;\n            _context4.n = 10;\n            break;\n          case 4:\n            if (!(field === \"waitingFor\")) {\n              _context4.n = 7;\n              break;\n            }\n            _context4.n = 5;\n            return (_controller$promptWai = controller.promptWaiting) === null || _controller$promptWai === void 0 ? void 0 : _controller$promptWai.call(controller, {\n              initialValue: \"\"\n            });\n          case 5:\n            _result = _context4.v;\n            if (!(_result === undefined || _result === null)) {\n              _context4.n = 6;\n              break;\n            }\n            return _context4.a(2);\n          case 6:\n            value = _result;\n            _context4.n = 10;\n            break;\n          case 7:\n            if (!(field === \"context\")) {\n              _context4.n = 10;\n              break;\n            }\n            _context4.n = 8;\n            return (_controller$promptCon = controller.promptContext) === null || _controller$promptCon === void 0 ? void 0 : _controller$promptCon.call(controller, {\n              initialValue: \"\"\n            });\n          case 8:\n            _result2 = _context4.v;\n            if (!(_result2 === undefined || _result2 === null)) {\n              _context4.n = 9;\n              break;\n            }\n            return _context4.a(2);\n          case 9:\n            value = Array.isArray(_result2) ? _result2 : _result2 ? [_result2] : [];\n          case 10:\n            controller.bulkUpdateMetadata(uids, _defineProperty({}, field, value));\n            onClearSelection();\n          case 11:\n            return _context4.a(2);\n        }\n      }, _callee4);\n    }));\n    return function handleMetaAction(_x3) {\n      return _ref11.apply(this, arguments);\n    };\n  }();\n  var handleMetaValueAction = function handleMetaValueAction(field, value) {\n    setMetaMenuOpen(false);\n    setActiveSubmenu(null);\n    if (!controller.bulkUpdateMetadata) return;\n    controller.bulkUpdateMetadata(uids, _defineProperty({}, field, value));\n    onClearSelection();\n  };\n  var toggleSubmenu = function toggleSubmenu(submenu) {\n    setActiveSubmenu(function (prev) {\n      return prev === submenu ? null : submenu;\n    });\n  };\n\n  // Submenu options\n  var priorityOptions = [{\n    value: \"high\",\n    label: metaValues.priorityHigh || \"High\"\n  }, {\n    value: \"medium\",\n    label: metaValues.priorityMedium || \"Medium\"\n  }, {\n    value: \"low\",\n    label: metaValues.priorityLow || \"Low\"\n  }, {\n    value: null,\n    label: metaValues.clear || \"Clear\"\n  }];\n  var energyOptions = [{\n    value: \"high\",\n    label: metaValues.energyHigh || \"High\"\n  }, {\n    value: \"medium\",\n    label: metaValues.energyMedium || \"Medium\"\n  }, {\n    value: \"low\",\n    label: metaValues.energyLow || \"Low\"\n  }, {\n    value: null,\n    label: metaValues.clear || \"Clear\"\n  }];\n  var gtdOptions = [{\n    value: \"next\",\n    label: metaValues.gtdNext || \"Next action\"\n  }, {\n    value: \"waiting\",\n    label: metaValues.gtdDelegated || \"Delegated\"\n  }, {\n    value: \"deferred\",\n    label: metaValues.gtdDeferred || \"Deferred\"\n  }, {\n    value: \"someday\",\n    label: metaValues.gtdSomeday || \"Someday\"\n  }, {\n    value: null,\n    label: metaValues.clear || \"Clear\"\n  }];\n  return /*#__PURE__*/(0,react_dom__WEBPACK_IMPORTED_MODULE_1__.createPortal)(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-action-bar\".concat(isMobileLayout ? \" bt-bulk-action-bar--mobile\" : \"\")\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-bulk-action-bar__count\"\n  }, typeof bulk.selected === \"function\" ? bulk.selected(count) : \"\".concat(count, \" selected\")), !allCompleted && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleBulkComplete\n  }, bulk.complete || \"Complete\"), !allOpen && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleBulkReopen\n  }, bulk.reopen || \"Reopen\"), !allCompleted && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      return handleBulkSnooze(1);\n    }\n  }, bulk.snooze1d || \"+1d\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      return handleBulkSnooze(7);\n    }\n  }, bulk.snooze7d || \"+7d\")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-action-bar__meta-wrapper\",\n    ref: metaMenuRef\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: function onClick() {\n      setMetaMenuOpen(function (prev) {\n        return !prev;\n      });\n      setActiveSubmenu(null);\n    },\n    \"aria-expanded\": metaMenuOpen,\n    \"aria-haspopup\": \"menu\"\n  }, bulk.setMetadata || \"Set...\"), metaMenuOpen && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-menu\",\n    role: \"menu\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    role: \"menuitem\",\n    onClick: function onClick() {\n      return handleMetaAction(\"project\");\n    }\n  }, fieldLabels.project || \"Project\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    role: \"menuitem\",\n    onClick: function onClick() {\n      return handleMetaAction(\"waitingFor\");\n    }\n  }, fieldLabels.waitingFor || \"Waiting for\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    role: \"menuitem\",\n    onClick: function onClick() {\n      return handleMetaAction(\"context\");\n    }\n  }, fieldLabels.context || \"Context\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-menu__item-with-submenu\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    role: \"menuitem\",\n    \"aria-expanded\": activeSubmenu === \"priority\",\n    \"aria-haspopup\": \"menu\",\n    onClick: function onClick() {\n      return toggleSubmenu(\"priority\");\n    }\n  }, fieldLabels.priority || \"Priority\", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-bulk-meta-menu__arrow\"\n  }, \"\\u203A\")), activeSubmenu === \"priority\" && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-submenu\",\n    role: \"menu\"\n  }, priorityOptions.map(function (opt) {\n    var _opt$value;\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: (_opt$value = opt.value) !== null && _opt$value !== void 0 ? _opt$value : \"clear\",\n      type: \"button\",\n      role: \"menuitem\",\n      onClick: function onClick() {\n        return handleMetaValueAction(\"priority\", opt.value);\n      }\n    }, opt.label);\n  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-menu__item-with-submenu\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    role: \"menuitem\",\n    \"aria-expanded\": activeSubmenu === \"energy\",\n    \"aria-haspopup\": \"menu\",\n    onClick: function onClick() {\n      return toggleSubmenu(\"energy\");\n    }\n  }, fieldLabels.energy || \"Energy\", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-bulk-meta-menu__arrow\"\n  }, \"\\u203A\")), activeSubmenu === \"energy\" && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-submenu\",\n    role: \"menu\"\n  }, energyOptions.map(function (opt) {\n    var _opt$value2;\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: (_opt$value2 = opt.value) !== null && _opt$value2 !== void 0 ? _opt$value2 : \"clear\",\n      type: \"button\",\n      role: \"menuitem\",\n      onClick: function onClick() {\n        return handleMetaValueAction(\"energy\", opt.value);\n      }\n    }, opt.label);\n  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-menu__item-with-submenu\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    role: \"menuitem\",\n    \"aria-expanded\": activeSubmenu === \"gtd\",\n    \"aria-haspopup\": \"menu\",\n    onClick: function onClick() {\n      return toggleSubmenu(\"gtd\");\n    }\n  }, fieldLabels.gtd || \"GTD\", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-bulk-meta-menu__arrow\"\n  }, \"\\u203A\")), activeSubmenu === \"gtd\" && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-bulk-meta-submenu\",\n    role: \"menu\"\n  }, gtdOptions.map(function (opt) {\n    var _opt$value3;\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: (_opt$value3 = opt.value) !== null && _opt$value3 !== void 0 ? _opt$value3 : \"clear\",\n      type: \"button\",\n      role: \"menuitem\",\n      onClick: function onClick() {\n        return handleMetaValueAction(\"gtd\", opt.value);\n      }\n    }, opt.label);\n  }))))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small bp3-minimal\",\n    onClick: onCancel,\n    \"aria-label\": bulk.cancel || \"Cancel\",\n    title: bulk.cancel || \"Cancel\"\n  }, \"\\u2715\")), document.body);\n}\nfunction EmptyState(_ref12) {\n  var status = _ref12.status,\n    onRefresh = _ref12.onRefresh,\n    strings = _ref12.strings;\n  var copy = strings || {};\n  if (status === \"loading\") {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-empty\"\n    }, copy.loading || \"Loading tasksâ€¦\");\n  }\n  if (status === \"error\") {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-empty\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, copy.error || \"Couldnâ€™t load tasks.\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      onClick: onRefresh\n    }, copy.retry || \"Try again\"));\n  }\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-empty\"\n  }, copy.noMatch || \"No tasks match the selected filters.\");\n}\nfunction DashboardApp(_ref13) {\n  var _window, _window2, _ui$bulk4, _ui$bulk5, _ui$bulk6;\n  var controller = _ref13.controller,\n    onRequestClose = _ref13.onRequestClose,\n    onHeaderReady = _ref13.onHeaderReady,\n    _ref13$language = _ref13.language,\n    language = _ref13$language === void 0 ? \"en\" : _ref13$language;\n  var snapshot = useControllerSnapshot(controller);\n  var _useReducer = (0,react__WEBPACK_IMPORTED_MODULE_0__.useReducer)(filtersReducer, DEFAULT_FILTERS, loadSavedFilters),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    filters = _useReducer2[0],\n    dispatchFilters = _useReducer2[1];\n  var _useState15 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\"time\"),\n    _useState16 = _slicedToArray(_useState15, 2),\n    grouping = _useState16[0],\n    setGrouping = _useState16[1];\n  var _useState17 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\"\"),\n    _useState18 = _slicedToArray(_useState17, 2),\n    query = _useState18[0],\n    setQuery = _useState18[1];\n  var _useState19 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({}),\n    _useState20 = _slicedToArray(_useState19, 2),\n    expandedGroups = _useState20[0],\n    setExpandedGroups = _useState20[1];\n  var _useState21 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      return {\n        schema: 1,\n        activeViewId: null,\n        views: []\n      };\n    }),\n    _useState22 = _slicedToArray(_useState21, 2),\n    viewsStore = _useState22[0],\n    setViewsStore = _useState22[1];\n  var _useState23 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState24 = _slicedToArray(_useState23, 2),\n    viewsLoaded = _useState24[0],\n    setViewsLoaded = _useState24[1];\n  var _useState25 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState26 = _slicedToArray(_useState25, 2),\n    reviewStartRequested = _useState26[0],\n    setReviewStartRequested = _useState26[1];\n  var _useState27 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      return {\n        active: false,\n        index: 0\n      };\n    }),\n    _useState28 = _slicedToArray(_useState27, 2),\n    reviewState = _useState28[0],\n    setReviewState = _useState28[1];\n  var preReviewActiveViewIdRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  // NOTE: We only store activeViewId here.\n  // If null, exiting review relies on existing Default â†’ lastDefaultState restore logic.\n  var _useState29 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      var _controller$getProjec;\n      return (controller === null || controller === void 0 || (_controller$getProjec = controller.getProjectOptions) === null || _controller$getProjec === void 0 ? void 0 : _controller$getProjec.call(controller)) || [];\n    }),\n    _useState30 = _slicedToArray(_useState29, 2),\n    projectOptions = _useState30[0],\n    setProjectOptions = _useState30[1];\n  var _useState31 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      var _controller$getWaitin;\n      return (controller === null || controller === void 0 || (_controller$getWaitin = controller.getWaitingOptions) === null || _controller$getWaitin === void 0 ? void 0 : _controller$getWaitin.call(controller)) || [];\n    }),\n    _useState32 = _slicedToArray(_useState31, 2),\n    waitingOptions = _useState32[0],\n    setWaitingOptions = _useState32[1];\n  var _useState33 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      var _controller$getContex;\n      return (controller === null || controller === void 0 || (_controller$getContex = controller.getContextOptions) === null || _controller$getContex === void 0 ? void 0 : _controller$getContex.call(controller)) || [];\n    }),\n    _useState34 = _slicedToArray(_useState33, 2),\n    contextOptions = _useState34[0],\n    setContextOptions = _useState34[1];\n  var initialViewAppliedRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);\n  var defaultStatePersistTimerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var lastDefaultStateSigRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var _useState35 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") return false;\n      return window.matchMedia(\"(max-width: 639px)\").matches;\n    }),\n    _useState36 = _slicedToArray(_useState35, 2),\n    isNarrowLayout = _useState36[0],\n    setIsNarrowLayout = _useState36[1];\n  var isTouchDevice = !!((_window = window) !== null && _window !== void 0 && (_window = _window.roamAlphaAPI) !== null && _window !== void 0 && (_window = _window.platform) !== null && _window !== void 0 && _window.isTouchDevice);\n  var isMobileApp = !!((_window2 = window) !== null && _window2 !== void 0 && (_window2 = _window2.roamAlphaAPI) !== null && _window2 !== void 0 && (_window2 = _window2.platform) !== null && _window2 !== void 0 && _window2.isMobileApp);\n  var isMobileLayout = isMobileApp || isNarrowLayout;\n  var _useState37 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState38 = _slicedToArray(_useState37, 2),\n    sidebarOpen = _useState38[0],\n    setSidebarOpen = _useState38[1];\n  var layoutChangeTimerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var sidebarSwipeRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  // Bulk selection state\n  var _useState39 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      return new Set();\n    }),\n    _useState40 = _slicedToArray(_useState39, 2),\n    selectedUids = _useState40[0],\n    setSelectedUids = _useState40[1];\n  var _useState41 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState42 = _slicedToArray(_useState41, 2),\n    selectionMode = _useState42[0],\n    setSelectionMode = _useState42[1];\n  var lastSelectedUidRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var sortedViews = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var views = Array.isArray(viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.views) ? viewsStore.views : [];\n    var presetOrder = new Map(_viewsStore__WEBPACK_IMPORTED_MODULE_6__.DASHBOARD_PRESET_IDS.map(function (id, idx) {\n      return [id, idx];\n    }));\n    return views.slice().sort(function (a, b) {\n      var aPreset = presetOrder.has(a === null || a === void 0 ? void 0 : a.id);\n      var bPreset = presetOrder.has(b === null || b === void 0 ? void 0 : b.id);\n      if (aPreset && bPreset) return presetOrder.get(a.id) - presetOrder.get(b.id);\n      if (aPreset) return -1;\n      if (bPreset) return 1;\n      return String((a === null || a === void 0 ? void 0 : a.name) || \"\").localeCompare(String((b === null || b === void 0 ? void 0 : b.name) || \"\"), undefined, {\n        sensitivity: \"base\"\n      }) || Number((b === null || b === void 0 ? void 0 : b.updatedAt) || 0) - Number((a === null || a === void 0 ? void 0 : a.updatedAt) || 0);\n    });\n  }, [viewsStore]);\n  var activeView = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var id = viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId;\n    if (!id) return null;\n    return ((viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.views) || []).find(function (v) {\n      return v.id === id;\n    }) || null;\n  }, [viewsStore]);\n  var _useState43 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      var _controller$getReview;\n      var settings = controller === null || controller === void 0 || (_controller$getReview = controller.getReviewStepSettings) === null || _controller$getReview === void 0 ? void 0 : _controller$getReview.call(controller);\n      return settings && _typeof(settings) === \"object\" ? settings : {};\n    }),\n    _useState44 = _slicedToArray(_useState43, 2),\n    reviewStepSettings = _useState44[0],\n    setReviewStepSettings = _useState44[1];\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!(controller !== null && controller !== void 0 && controller.subscribeReviewStepSettings)) return undefined;\n    var sync = function sync() {\n      var _controller$getReview2;\n      var next = controller === null || controller === void 0 || (_controller$getReview2 = controller.getReviewStepSettings) === null || _controller$getReview2 === void 0 ? void 0 : _controller$getReview2.call(controller);\n      setReviewStepSettings(next && _typeof(next) === \"object\" ? next : {});\n    };\n    var unsub = controller.subscribeReviewStepSettings(sync);\n    sync();\n    return unsub;\n  }, [controller]);\n  var effectiveReviewIds = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var ids = Array.isArray(_viewsStore__WEBPACK_IMPORTED_MODULE_6__.DASHBOARD_REVIEW_PRESET_IDS) ? _viewsStore__WEBPACK_IMPORTED_MODULE_6__.DASHBOARD_REVIEW_PRESET_IDS : [];\n    var existing = new Set(((viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.views) || []).map(function (v) {\n      return v.id;\n    }));\n    return ids.filter(function (id) {\n      return existing.has(id) && reviewStepSettings[id] !== false;\n    });\n  }, [viewsStore, reviewStepSettings]);\n  var activeReviewView = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    if (!reviewState.active) return null;\n    var id = effectiveReviewIds[reviewState.index] || null;\n    if (!id) return null;\n    return ((viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.views) || []).find(function (v) {\n      return v.id === id;\n    }) || null;\n  }, [reviewState.active, reviewState.index, effectiveReviewIds, viewsStore]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!reviewState.active) return;\n    if (!effectiveReviewIds.length) {\n      var message = (ui === null || ui === void 0 ? void 0 : ui.reviewNoPresetsToast) || \"No review presets found.\";\n      notifyToast(message);\n      exitReview();\n      return;\n    }\n    var nextIndex = Math.min(reviewState.index, effectiveReviewIds.length - 1);\n    var currentId = effectiveReviewIds[reviewState.index];\n    if (!currentId || reviewStepSettings[currentId] === false) {\n      var forwardIndex = effectiveReviewIds.findIndex(function (_, idx) {\n        return idx > reviewState.index;\n      });\n      if (forwardIndex !== -1) {\n        nextIndex = forwardIndex;\n      } else {\n        var backwardIndex = _toConsumableArray(effectiveReviewIds).reverse().findIndex(function (_, idx) {\n          return effectiveReviewIds.length - 1 - idx < reviewState.index;\n        });\n        nextIndex = backwardIndex !== -1 ? effectiveReviewIds.length - 1 - backwardIndex : nextIndex;\n      }\n    }\n    if (nextIndex !== reviewState.index) {\n      setReviewState(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          index: nextIndex\n        });\n      });\n    }\n    var nextId = effectiveReviewIds[nextIndex];\n    if (nextId && (viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId) !== nextId) {\n      applySavedViewById(nextId);\n    }\n  }, [reviewState.active, reviewState.index, effectiveReviewIds, viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId, applySavedViewById, exitReview, notifyToast, ui, reviewStepSettings]);\n  var lang = _i18n__WEBPACK_IMPORTED_MODULE_5__.i18n[language] ? language : \"en\";\n  var tt = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (path, fallback) {\n    var val = tPath(path, lang);\n    if (typeof val === \"string\") return val;\n    if (typeof val === \"function\") return val;\n    return fallback;\n  }, [lang]);\n  var fallbackCapitalize = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (value) {\n    return value ? String(value).charAt(0).toUpperCase() + String(value).slice(1) : \"\";\n  }, []);\n  var filterDefs = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var fv = function fv(key) {\n      return tt([\"dashboard\", \"filterValues\", key], fallbackCapitalize(key));\n    };\n    return {\n      Recurrence: [{\n        value: \"recurring\",\n        label: fv(\"recurring\")\n      }, {\n        value: \"one-off\",\n        label: fv(\"one-off\")\n      }],\n      Start: [{\n        value: \"not-started\",\n        label: fv(\"not-started\")\n      }, {\n        value: \"started\",\n        label: fv(\"started\")\n      }],\n      Defer: [{\n        value: \"deferred\",\n        label: fv(\"deferred\")\n      }, {\n        value: \"available\",\n        label: fv(\"available\")\n      }],\n      Due: [{\n        value: \"overdue\",\n        label: fv(\"overdue\")\n      }, {\n        value: \"today\",\n        label: fv(\"today\")\n      }, {\n        value: \"upcoming\",\n        label: fv(\"upcoming\")\n      }, {\n        value: \"none\",\n        label: fv(\"none\")\n      }],\n      Completion: [{\n        value: \"open\",\n        label: fv(\"open\")\n      }, {\n        value: \"completed\",\n        label: fv(\"completed\")\n      }],\n      Priority: [{\n        value: \"high\",\n        label: fv(\"high\")\n      }, {\n        value: \"medium\",\n        label: fv(\"medium\")\n      }, {\n        value: \"low\",\n        label: fv(\"low\")\n      }],\n      Energy: [{\n        value: \"high\",\n        label: fv(\"high\")\n      }, {\n        value: \"medium\",\n        label: fv(\"medium\")\n      }, {\n        value: \"low\",\n        label: fv(\"low\")\n      }],\n      GTD: [{\n        value: \"next action\",\n        label: fv(\"next action\")\n      }, {\n        value: \"delegated\",\n        label: fv(\"delegated\")\n      }, {\n        value: \"deferred\",\n        label: fv(\"deferred\")\n      }, {\n        value: \"someday\",\n        label: fv(\"someday\")\n      }]\n    };\n  }, [tt, fallbackCapitalize]);\n  var filterSectionLabels = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return {\n      Recurrence: tt([\"dashboard\", \"filterSections\", \"Recurrence\"], \"Recurrence\"),\n      Start: tt([\"dashboard\", \"filterSections\", \"Start\"], \"Start\"),\n      Defer: tt([\"dashboard\", \"filterSections\", \"Defer\"], \"Defer\"),\n      Due: tt([\"dashboard\", \"filterSections\", \"Due\"], \"Due\"),\n      Completion: tt([\"dashboard\", \"filterSections\", \"Completion\"], \"Completion\"),\n      Priority: tt([\"dashboard\", \"filterSections\", \"Priority\"], \"Priority\"),\n      Energy: tt([\"dashboard\", \"filterSections\", \"Energy\"], \"Energy\"),\n      GTD: tt([\"dashboard\", \"filterSections\", \"GTD\"], \"GTD\")\n    };\n  }, [tt]);\n  var groupingOptions = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return [{\n      value: \"time\",\n      label: tt([\"dashboard\", \"groupingLabels\", \"time\"], \"Time\")\n    }, {\n      value: \"recurrence\",\n      label: tt([\"dashboard\", \"groupingLabels\", \"recurrence\"], \"Recurrence\")\n    }, {\n      value: \"project\",\n      label: tt([\"dashboard\", \"groupingLabels\", \"project\"], \"Project\")\n    }];\n  }, [tt]);\n  var groupLabels = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return {\n      overdue: tt([\"dashboard\", \"groupLabels\", \"overdue\"], \"Overdue\"),\n      today: tt([\"dashboard\", \"groupLabels\", \"today\"], \"Today\"),\n      upcoming: tt([\"dashboard\", \"groupLabels\", \"upcoming\"], \"Upcoming\"),\n      none: tt([\"dashboard\", \"groupLabels\", \"none\"], \"No Due Date\"),\n      recurring: tt([\"dashboard\", \"groupLabels\", \"recurring\"], \"Recurring\"),\n      \"one-off\": tt([\"dashboard\", \"groupLabels\", \"one-off\"], \"One-off\"),\n      completed: tt([\"dashboard\", \"groupLabels\", \"completed\"], \"Completed\"),\n      noProject: tt([\"dashboard\", \"groupLabels\", \"noProject\"], \"No Project\")\n    };\n  }, [tt]);\n  var metaLabels = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return {\n      priority: tt([\"dashboard\", \"metaPills\", \"priority\"], \"Priority\"),\n      energy: tt([\"dashboard\", \"metaPills\", \"energy\"], \"Energy\"),\n      gtd: tt([\"dashboard\", \"metaPills\", \"gtd\"], \"GTD\"),\n      project: tt([\"dashboard\", \"metaPills\", \"project\"], \"Project\"),\n      waitingFor: tt([\"dashboard\", \"metaPills\", \"waitingFor\"], \"Waiting for\"),\n      context: tt([\"dashboard\", \"metaPills\", \"context\"], \"Context\")\n    };\n  }, [tt]);\n  var taskMenuStrings = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return tPath([\"taskMenu\"], lang) || {};\n  }, [lang]);\n  var ui = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var _ref14;\n    return _ref14 = {\n      taskMenu: taskMenuStrings,\n      filterDefs: filterDefs,\n      metaLabels: metaLabels,\n      headerTitle: tt([\"dashboard\", \"title\"], \"Better Tasks\"),\n      headerSubtitle: tt([\"dashboard\", \"subtitle\"], \"Manage start, defer, due, and recurring tasks without leaving Roam.\"),\n      refresh: tt([\"dashboard\", \"refresh\"], \"Refresh\"),\n      close: tt([\"dashboard\", \"close\"], \"Close\"),\n      fullPageEnter: tt([\"dashboard\", \"fullPage\", \"enter\"], \"Expand\"),\n      fullPageExit: tt([\"dashboard\", \"fullPage\", \"exit\"], \"Exit full page\"),\n      savedViewsLabel: tt([\"dashboard\", \"views\", \"label\"], \"Saved Views\"),\n      viewsDefault: tt([\"dashboard\", \"views\", \"default\"], \"Default\"),\n      viewsSaveAs: tt([\"dashboard\", \"views\", \"saveAs\"], \"Save asâ€¦\"),\n      viewsUpdate: tt([\"dashboard\", \"views\", \"update\"], \"Update\"),\n      viewsOptions: tt([\"dashboard\", \"views\", \"options\"], \"View options\"),\n      viewsRename: tt([\"dashboard\", \"views\", \"rename\"], \"Renameâ€¦\"),\n      viewsDelete: tt([\"dashboard\", \"views\", \"delete\"], \"Delete\"),\n      viewsSaveAsMessage: tt([\"dashboard\", \"views\", \"prompts\", \"saveAsMessage\"], \"Save current view as\"),\n      viewsRenameMessage: tt([\"dashboard\", \"views\", \"prompts\", \"renameMessage\"], \"Rename view\"),\n      viewsNamePlaceholder: tt([\"dashboard\", \"views\", \"prompts\", \"namePlaceholder\"], \"View name\"),\n      viewsConfirmOverwrite: tt([\"dashboard\", \"views\", \"confirms\", \"overwrite\"], function (name) {\n        return \"Overwrite view \\\"\".concat(name, \"\\\"?\");\n      }),\n      viewsConfirmDelete: tt([\"dashboard\", \"views\", \"confirms\", \"delete\"], function (name) {\n        return \"Delete view \\\"\".concat(name, \"\\\"?\");\n      }),\n      quickAddPlaceholder: tt([\"dashboard\", \"quickAddPlaceholder\"], \"Add a Better Task\"),\n      quickAddButton: tt([\"dashboard\", \"quickAddButton\"], \"OK\"),\n      searchPlaceholder: tt([\"dashboard\", \"searchPlaceholder\"], \"Search Better Tasks\"),\n      filtersLabel: tt([\"dashboard\", \"filtersLabel\"], \"Filters\"),\n      filtersShow: tt([\"dashboard\", \"filters\", \"show\"], \"Show filters\"),\n      filtersHide: tt([\"dashboard\", \"filters\", \"hide\"], \"Hide filters\"),\n      tagsLabel: tt([\"dashboard\", \"filters\", \"tagsLabel\"], \"Tags\"),\n      filtersGroups: {\n        status: tt([\"dashboard\", \"filters\", \"groups\", \"status\"], \"Status\"),\n        dates: tt([\"dashboard\", \"filters\", \"groups\", \"dates\"], \"Dates\"),\n        gtd: tt([\"dashboard\", \"filters\", \"groups\", \"gtd\"], \"GTD\"),\n        meta: tt([\"dashboard\", \"filters\", \"groups\", \"meta\"], \"Meta\")\n      },\n      groupByLabel: tt([\"dashboard\", \"groupByLabel\"], \"Group by\"),\n      projectFilterLabel: tt([\"dashboard\", \"projectFilterLabel\"], \"Project\"),\n      projectFilterPlaceholder: tt([\"dashboard\", \"projectFilterPlaceholder\"], \"Project name\"),\n      projectFilterAny: tt([\"dashboard\", \"projectFilterAny\"], \"All projects\"),\n      contextFilterLabel: tt([\"dashboard\", \"contextFilterLabel\"], \"Context\"),\n      contextFilterAny: tt([\"dashboard\", \"contextFilterAny\"], \"All contexts\"),\n      waitingFilterLabel: tt([\"dashboard\", \"waitingFilterLabel\"], \"Waiting for\"),\n      waitingFilterPlaceholder: tt([\"dashboard\", \"waitingFilterPlaceholder\"], \"Waiting for\"),\n      completedWithinLabel: tt([\"dashboard\", \"completedWithinLabel\"], \"Completed within\"),\n      completedWithinAny: tt([\"dashboard\", \"completedWithinOptions\", \"any\"], \"Any time\"),\n      completedWithin7d: tt([\"dashboard\", \"completedWithinOptions\", \"7d\"], \"Last 7 days\"),\n      completedWithin30d: tt([\"dashboard\", \"completedWithinOptions\", \"30d\"], \"Last 30 days\"),\n      completedWithin90d: tt([\"dashboard\", \"completedWithinOptions\", \"90d\"], \"Last 90 days\"),\n      upcomingWithinLabel: tt([\"dashboard\", \"upcomingWithinLabel\"], \"Upcoming within\"),\n      upcomingWithinAny: tt([\"dashboard\", \"upcomingWithinOptions\", \"any\"], \"Any time\"),\n      upcomingWithin7d: tt([\"dashboard\", \"upcomingWithinOptions\", \"7d\"], \"Next 7 days\"),\n      upcomingWithin30d: tt([\"dashboard\", \"upcomingWithinOptions\", \"30d\"], \"Next 30 days\"),\n      upcomingWithin90d: tt([\"dashboard\", \"upcomingWithinOptions\", \"90d\"], \"Next 90 days\"),\n      reviewButton: tt([\"dashboard\", \"review\", \"button\"], \"Weekly Review\"),\n      reviewLabel: tt([\"dashboard\", \"review\", \"label\"], \"Weekly Review\"),\n      reviewOf: tt([\"dashboard\", \"review\", \"of\"], \"of\"),\n      reviewBack: tt([\"dashboard\", \"review\", \"back\"], \"â† Back\"),\n      reviewNext: tt([\"dashboard\", \"review\", \"next\"], \"Next â†’\"),\n      reviewExit: tt([\"dashboard\", \"review\", \"exit\"], \"Exit\"),\n      reviewNoPresetsToast: tt([\"toasts\", \"dashReviewNoPresets\"], \"No review presets found.\"),\n      groupingOptions: groupingOptions,\n      groupLabels: groupLabels\n    }, _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_ref14, \"metaLabels\", metaLabels), \"taskOptions\", tt([\"dashboard\", \"taskOptions\"], \"Task options\")), \"markDone\", tt([\"dashboard\", \"markDone\"], \"Mark as done\")), \"markOpen\", tt([\"dashboard\", \"markOpen\"], \"Mark as open\")), \"view\", tt([\"dashboard\", \"view\"], \"View\")), \"snoozePick\", tt([\"dashboard\", \"snoozePick\"], \"Pick\")), \"snoozePlus1\", tt([\"dashboard\", \"snoozePlus1\"], \"+1d\")), \"snoozePlus7\", tt([\"dashboard\", \"snoozePlus7\"], \"+7d\")), \"untitled\", tt([\"dashboard\", \"untitled\"], \"(Untitled task)\")), \"completedLabel\", tt([\"dashboard\", \"filterValues\", \"completed\"], \"Completed\")), _defineProperty(_ref14, \"empty\", {\n      loading: tt([\"dashboard\", \"empty\", \"loading\"], \"Loading tasksâ€¦\"),\n      error: tt([\"dashboard\", \"empty\", \"error\"], \"Couldnâ€™t load tasks.\"),\n      retry: tt([\"dashboard\", \"empty\", \"retry\"], \"Try again\"),\n      noMatch: tt([\"dashboard\", \"empty\", \"noMatch\"], \"No tasks match the selected filters.\")\n    });\n  }, [tt, groupingOptions, groupLabels, metaLabels, taskMenuStrings]);\n  var _useState45 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false),\n    _useState46 = _slicedToArray(_useState45, 2),\n    filtersOpen = _useState46[0],\n    setFiltersOpen = _useState46[1];\n  var filteredTasks = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return applyFilters(snapshot.tasks, filters, query);\n  }, [snapshot.tasks, filters, query]);\n  var groups = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return groupTasks(filteredTasks, grouping, {\n      completion: filters.Completion || filters.completion,\n      groupLabels: groupLabels\n    });\n  }, [filteredTasks, grouping, filters.Completion, filters.completion, groupLabels]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    setExpandedGroups(function (prev) {\n      var next = _objectSpread({}, prev);\n      var changed = false;\n      var ids = new Set(groups.map(function (group) {\n        return group.id;\n      }));\n      groups.forEach(function (group) {\n        if (!(group.id in next)) {\n          next[group.id] = true;\n          changed = true;\n        }\n      });\n      Object.keys(next).forEach(function (id) {\n        if (!ids.has(id)) {\n          delete next[id];\n          changed = true;\n        }\n      });\n      return changed ? next : prev;\n    });\n  }, [groups]);\n  var rows = useVirtualRows(groups, expandedGroups);\n  var parentRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (typeof window === \"undefined\" || typeof window.matchMedia !== \"function\") return undefined;\n    var mq = window.matchMedia(\"(max-width: 639px)\");\n    var handleChange = function handleChange(event) {\n      if (layoutChangeTimerRef.current) {\n        clearTimeout(layoutChangeTimerRef.current);\n      }\n      layoutChangeTimerRef.current = setTimeout(function () {\n        layoutChangeTimerRef.current = null;\n        setIsNarrowLayout(!!event.matches);\n      }, 150);\n    };\n    setIsNarrowLayout(!!mq.matches);\n    if (typeof mq.addEventListener === \"function\") {\n      mq.addEventListener(\"change\", handleChange);\n      return function () {\n        return mq.removeEventListener(\"change\", handleChange);\n      };\n    }\n    mq.addListener(handleChange);\n    return function () {\n      return mq.removeListener(handleChange);\n    };\n  }, []);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!layoutChangeTimerRef.current) return undefined;\n    return function () {\n      if (layoutChangeTimerRef.current) {\n        clearTimeout(layoutChangeTimerRef.current);\n        layoutChangeTimerRef.current = null;\n      }\n    };\n  }, []);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!isMobileLayout) {\n      setSidebarOpen(false);\n      return;\n    }\n    if (!(snapshot !== null && snapshot !== void 0 && snapshot.isFullPage)) {\n      var _controller$setDashbo;\n      controller === null || controller === void 0 || (_controller$setDashbo = controller.setDashboardFullPage) === null || _controller$setDashbo === void 0 || _controller$setDashbo.call(controller, true);\n    }\n  }, [isMobileLayout, snapshot === null || snapshot === void 0 ? void 0 : snapshot.isFullPage, controller]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!isMobileLayout || !sidebarOpen) return undefined;\n    var handler = function handler(event) {\n      if (event.key === \"Escape\") {\n        event.stopPropagation();\n        setSidebarOpen(false);\n      }\n    };\n    document.addEventListener(\"keydown\", handler);\n    return function () {\n      return document.removeEventListener(\"keydown\", handler);\n    };\n  }, [isMobileLayout, sidebarOpen]);\n  var estimateRowSize = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (index) {\n    var _rows$index;\n    return ((_rows$index = rows[index]) === null || _rows$index === void 0 ? void 0 : _rows$index.type) === \"group\" ? 40 : 100;\n  }, [rows]);\n  var getRowKey = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (index) {\n    var _rows$index$key, _rows$index2;\n    return (_rows$index$key = (_rows$index2 = rows[index]) === null || _rows$index2 === void 0 ? void 0 : _rows$index2.key) !== null && _rows$index$key !== void 0 ? _rows$index$key : index;\n  }, [rows]);\n  var getScrollElement = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    return parentRef.current;\n  }, []);\n  var virtualizerOptions = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return {\n      count: rows.length,\n      estimateSize: estimateRowSize,\n      getItemKey: getRowKey,\n      getScrollElement: getScrollElement,\n      overscan: isMobileApp ? 4 : isTouchDevice ? 6 : 8,\n      measureElement: _tanstack_react_virtual__WEBPACK_IMPORTED_MODULE_4__.measureElement\n    };\n  }, [rows.length, estimateRowSize, getRowKey, getScrollElement, isMobileApp, isTouchDevice]);\n  var rowVirtualizer = (0,_tanstack_react_virtual__WEBPACK_IMPORTED_MODULE_3__.useVirtualizer)(virtualizerOptions);\n\n  // Bulk selection helpers\n  var selectionActive = selectionMode || selectedUids.size > 0;\n  var toggleSelection = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (uid) {\n    setSelectedUids(function (prev) {\n      var next = new Set(prev);\n      if (next.has(uid)) next[\"delete\"](uid);else next.add(uid);\n      return next;\n    });\n  }, []);\n  var handleToggleSelect = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (uid, event) {\n    if (event !== null && event !== void 0 && event.shiftKey && lastSelectedUidRef.current) {\n      var taskUids = rows.filter(function (r) {\n        return r.type === \"task\";\n      }).map(function (r) {\n        return r.task.uid;\n      });\n      var startIdx = taskUids.indexOf(lastSelectedUidRef.current);\n      var endIdx = taskUids.indexOf(uid);\n      if (startIdx !== -1 && endIdx !== -1) {\n        var _ref15 = startIdx < endIdx ? [startIdx, endIdx] : [endIdx, startIdx],\n          _ref16 = _slicedToArray(_ref15, 2),\n          from = _ref16[0],\n          to = _ref16[1];\n        var rangeUids = taskUids.slice(from, to + 1);\n        setSelectedUids(function (prev) {\n          var next = new Set(prev);\n          rangeUids.forEach(function (u) {\n            return next.add(u);\n          });\n          return next;\n        });\n      }\n    } else {\n      toggleSelection(uid);\n    }\n    lastSelectedUidRef.current = uid;\n  }, [rows, toggleSelection]);\n  var selectAllVisible = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    var visibleUids = rows.filter(function (r) {\n      return r.type === \"task\";\n    }).map(function (r) {\n      return r.task.uid;\n    });\n    setSelectedUids(new Set(visibleUids));\n  }, [rows]);\n  var selectNone = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    setSelectedUids(new Set());\n    // Keep selection mode active - user can continue selecting\n  }, []);\n  var cancelSelection = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    setSelectedUids(new Set());\n    setSelectionMode(false);\n  }, []);\n  var selectGroup = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (groupTasks) {\n    if (!Array.isArray(groupTasks) || !groupTasks.length) return;\n    setSelectedUids(function (prev) {\n      var next = new Set(prev);\n      var allSelected = groupTasks.every(function (task) {\n        return next.has(task.uid);\n      });\n      if (allSelected) {\n        groupTasks.forEach(function (task) {\n          return next[\"delete\"](task.uid);\n        });\n      } else {\n        groupTasks.forEach(function (task) {\n          return next.add(task.uid);\n        });\n      }\n      return next;\n    });\n  }, []);\n  // Clear selection when filters, grouping, query, or view changes\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    setSelectedUids(new Set());\n    lastSelectedUidRef.current = null;\n  }, [filters, grouping, query, viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId]);\n  var handleFilterToggle = function handleFilterToggle(section, value) {\n    var singleChoice = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    dispatchFilters({\n      type: singleChoice ? \"toggleSingle\" : \"toggle\",\n      section: section,\n      value: value\n    });\n  };\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    saveFilters(filters);\n  }, [filters]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!(controller !== null && controller !== void 0 && controller.loadViewsStore)) return;\n    var store = controller.loadViewsStore();\n    setViewsStore(store);\n    setViewsLoaded(true);\n  }, [controller]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!(controller !== null && controller !== void 0 && controller.subscribeDashViewsStore) || !(controller !== null && controller !== void 0 && controller.loadViewsStore)) return undefined;\n    var unsub = controller.subscribeDashViewsStore(function (nextStore) {\n      if (nextStore && _typeof(nextStore) === \"object\") {\n        setViewsStore(nextStore);\n        setViewsLoaded(true);\n        return;\n      }\n      var store = controller.loadViewsStore();\n      setViewsStore(store);\n      setViewsLoaded(true);\n    });\n    return unsub;\n  }, [controller]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!(controller !== null && controller !== void 0 && controller.subscribeDashViewRequests)) return undefined;\n    var unsub = controller.subscribeDashViewRequests(function (nextState) {\n      if (!nextState || _typeof(nextState) !== \"object\") return;\n      dispatchFilters({\n        type: \"hydrate\",\n        value: nextState.filters\n      });\n      setGrouping(typeof nextState.grouping === \"string\" ? nextState.grouping : \"time\");\n      setQuery(typeof nextState.query === \"string\" ? nextState.query : \"\");\n    });\n    return unsub;\n  }, [controller]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!(controller !== null && controller !== void 0 && controller.subscribeDashReviewRequests)) return undefined;\n    var unsub = controller.subscribeDashReviewRequests(function (req) {\n      if ((req === null || req === void 0 ? void 0 : req.type) === \"start\") setReviewStartRequested(true);\n    });\n    return unsub;\n  }, [controller]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!reviewStartRequested) return;\n    if (!viewsLoaded) return;\n    setReviewStartRequested(false);\n    startReview();\n  }, [reviewStartRequested, viewsLoaded, startReview]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    var _controller$reportDas;\n    controller === null || controller === void 0 || (_controller$reportDas = controller.reportDashViewState) === null || _controller$reportDas === void 0 || _controller$reportDas.call(controller, {\n      filters: filters,\n      grouping: grouping,\n      query: query\n    });\n  }, [controller, filters, grouping, query]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (viewsStore !== null && viewsStore !== void 0 && viewsStore.activeViewId) return undefined;\n    if (!(controller !== null && controller !== void 0 && controller.saveViewsStore)) return undefined;\n    var dashState = {\n      filters: filters,\n      grouping: grouping,\n      query: query\n    };\n    var sig = null;\n    try {\n      sig = JSON.stringify(normalizeDashViewStateForCompare(dashState));\n    } catch (_) {\n      sig = null;\n    }\n    if (sig && lastDefaultStateSigRef.current === sig) return undefined;\n    if (defaultStatePersistTimerRef.current && typeof window !== \"undefined\") {\n      clearTimeout(defaultStatePersistTimerRef.current);\n    }\n    if (typeof window !== \"undefined\") {\n      defaultStatePersistTimerRef.current = window.setTimeout(function () {\n        var _controller$notifyDas;\n        defaultStatePersistTimerRef.current = null;\n        var latest = controller !== null && controller !== void 0 && controller.loadViewsStore ? controller.loadViewsStore() : viewsStore;\n        var next = (0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.setLastDefaultState)(latest, dashState);\n        var saved = controller.saveViewsStore(next);\n        setViewsStore(saved);\n        controller === null || controller === void 0 || (_controller$notifyDas = controller.notifyDashViewsStoreChanged) === null || _controller$notifyDas === void 0 || _controller$notifyDas.call(controller, saved);\n        if (sig) lastDefaultStateSigRef.current = sig;\n      }, 500);\n    }\n    return function () {\n      if (defaultStatePersistTimerRef.current && typeof window !== \"undefined\") {\n        clearTimeout(defaultStatePersistTimerRef.current);\n        defaultStatePersistTimerRef.current = null;\n      }\n    };\n  }, [viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId, controller, filters, grouping, query, viewsStore]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    var _view$state, _view$state2, _view$state3;\n    if (initialViewAppliedRef.current) return;\n    var id = viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId;\n    if (!id) {\n      initialViewAppliedRef.current = true;\n      var fallbackDefault = viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.lastDefaultState;\n      if (fallbackDefault) {\n        dispatchFilters({\n          type: \"hydrate\",\n          value: fallbackDefault.filters\n        });\n        setGrouping(typeof fallbackDefault.grouping === \"string\" ? fallbackDefault.grouping : \"time\");\n        setQuery(typeof fallbackDefault.query === \"string\" ? fallbackDefault.query : \"\");\n      }\n      return;\n    }\n    var view = ((viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.views) || []).find(function (v) {\n      return v.id === id;\n    });\n    if (!view) {\n      initialViewAppliedRef.current = true;\n      return;\n    }\n    initialViewAppliedRef.current = true;\n    dispatchFilters({\n      type: \"hydrate\",\n      value: (_view$state = view.state) === null || _view$state === void 0 ? void 0 : _view$state.filters\n    });\n    setGrouping(typeof ((_view$state2 = view.state) === null || _view$state2 === void 0 ? void 0 : _view$state2.grouping) === \"string\" ? view.state.grouping : \"time\");\n    setQuery(typeof ((_view$state3 = view.state) === null || _view$state3 === void 0 ? void 0 : _view$state3.query) === \"string\" ? view.state.query : \"\");\n  }, [viewsStore]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    var _controller$refreshPr2, _controller$refreshWa2, _controller$refreshCo2, _controller$subscribe, _controller$subscribe2, _controller$subscribe3;\n    if (!controller) return undefined;\n    (_controller$refreshPr2 = controller.refreshProjectOptions) === null || _controller$refreshPr2 === void 0 || _controller$refreshPr2.call(controller, true);\n    (_controller$refreshWa2 = controller.refreshWaitingOptions) === null || _controller$refreshWa2 === void 0 || _controller$refreshWa2.call(controller, true);\n    (_controller$refreshCo2 = controller.refreshContextOptions) === null || _controller$refreshCo2 === void 0 || _controller$refreshCo2.call(controller, true);\n    var unsub = (_controller$subscribe = controller.subscribeProjectOptions) === null || _controller$subscribe === void 0 ? void 0 : _controller$subscribe.call(controller, function (opts) {\n      return setProjectOptions(Array.isArray(opts) ? opts : []);\n    });\n    var unsubWaiting = (_controller$subscribe2 = controller.subscribeWaitingOptions) === null || _controller$subscribe2 === void 0 ? void 0 : _controller$subscribe2.call(controller, function (opts) {\n      return setWaitingOptions(Array.isArray(opts) ? opts : []);\n    });\n    var unsubContext = (_controller$subscribe3 = controller.subscribeContextOptions) === null || _controller$subscribe3 === void 0 ? void 0 : _controller$subscribe3.call(controller, function (opts) {\n      return setContextOptions(Array.isArray(opts) ? opts : []);\n    });\n    return function () {\n      unsub === null || unsub === void 0 || unsub();\n      unsubWaiting === null || unsubWaiting === void 0 || unsubWaiting();\n      unsubContext === null || unsubContext === void 0 || unsubContext();\n    };\n  }, [controller]);\n  var _useState47 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\"\"),\n    _useState48 = _slicedToArray(_useState47, 2),\n    quickText = _useState48[0],\n    setQuickText = _useState48[1];\n  var handleQuickAddSubmit = /*#__PURE__*/function () {\n    var _ref17 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {\n      var value, _controller$quickAdd, _t5;\n      return _regenerator().w(function (_context5) {\n        while (1) switch (_context5.p = _context5.n) {\n          case 0:\n            value = quickText.trim();\n            if (value) {\n              _context5.n = 1;\n              break;\n            }\n            return _context5.a(2);\n          case 1:\n            _context5.p = 1;\n            _context5.n = 2;\n            return (_controller$quickAdd = controller.quickAdd) === null || _controller$quickAdd === void 0 ? void 0 : _controller$quickAdd.call(controller, value);\n          case 2:\n            setQuickText(\"\");\n            _context5.n = 4;\n            break;\n          case 3:\n            _context5.p = 3;\n            _t5 = _context5.v;\n            console.error(\"[BetterTasks] quick add failed\", _t5);\n          case 4:\n            return _context5.a(2);\n        }\n      }, _callee5, null, [[1, 3]]);\n    }));\n    return function handleQuickAddSubmit() {\n      return _ref17.apply(this, arguments);\n    };\n  }();\n  var handleQuickAddKeyDown = function handleQuickAddKeyDown(event) {\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      void handleQuickAddSubmit();\n    }\n  };\n  var handleProjectFilterChange = function handleProjectFilterChange(e) {\n    return dispatchFilters({\n      type: \"setText\",\n      section: \"projectText\",\n      value: e.target.value\n    });\n  };\n  var handleContextFilterChange = function handleContextFilterChange(e) {\n    return dispatchFilters({\n      type: \"setText\",\n      section: \"contextText\",\n      value: e.target.value\n    });\n  };\n  var handleWaitingFilterChange = function handleWaitingFilterChange(e) {\n    return dispatchFilters({\n      type: \"setText\",\n      section: \"waitingText\",\n      value: e.target.value\n    });\n  };\n  var completionOnlyIsCompleted = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var list = Array.isArray(filters === null || filters === void 0 ? void 0 : filters.Completion) ? filters.Completion : [];\n    return list.length === 1 && list[0] === \"completed\";\n  }, [filters]);\n  var dueIncludesUpcomingMemo = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var list = Array.isArray(filters === null || filters === void 0 ? void 0 : filters.Due) ? filters.Due : [];\n    return list.includes(\"upcoming\");\n  }, [filters]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (completionOnlyIsCompleted) return;\n    if (((filters === null || filters === void 0 ? void 0 : filters.completedRange) || \"any\") === \"any\") return;\n    dispatchFilters({\n      type: \"setText\",\n      section: \"completedRange\",\n      value: \"any\"\n    });\n  }, [completionOnlyIsCompleted, filters === null || filters === void 0 ? void 0 : filters.completedRange]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (dueIncludesUpcomingMemo) return;\n    if (((filters === null || filters === void 0 ? void 0 : filters.upcomingRange) || \"any\") === \"any\") return;\n    dispatchFilters({\n      type: \"setText\",\n      section: \"upcomingRange\",\n      value: \"any\"\n    });\n  }, [dueIncludesUpcomingMemo, filters === null || filters === void 0 ? void 0 : filters.upcomingRange]);\n  var handleRefresh = function handleRefresh() {\n    var _controller$refresh;\n    return (_controller$refresh = controller.refresh) === null || _controller$refresh === void 0 ? void 0 : _controller$refresh.call(controller, {\n      reason: \"manual\"\n    });\n  };\n  var isFullPage = !!(snapshot !== null && snapshot !== void 0 && snapshot.isFullPage) || isMobileLayout;\n  var handleToggleFullPage = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    var _controller$toggleDas;\n    if (isMobileLayout) return;\n    (_controller$toggleDas = controller.toggleDashboardFullPage) === null || _controller$toggleDas === void 0 || _controller$toggleDas.call(controller);\n  }, [controller, isMobileLayout]);\n  var rootClasses = [\"bt-dashboard\", isTouchDevice ? \"bt-touch\" : \"\", isMobileApp ? \"bt-mobile-app\" : \"\", isMobileLayout ? \"bt-mobile-layout\" : \"\"].filter(Boolean).join(\" \");\n  var fullPageUiKey = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var graphName = \"default\";\n    try {\n      var _window3, _window3$name;\n      graphName = ((_window3 = window) === null || _window3 === void 0 || (_window3 = _window3.roamAlphaAPI) === null || _window3 === void 0 || (_window3 = _window3.graph) === null || _window3 === void 0 || (_window3$name = _window3.name) === null || _window3$name === void 0 ? void 0 : _window3$name.call(_window3)) || \"default\";\n    } catch (_) {\n      // ignore\n    }\n    return \"betterTasks.dashboard.fullPage.uiState.\".concat(encodeURIComponent(String(graphName)));\n  }, []);\n  var readFullPageUiState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    var defaultSidebarWidth = 310;\n    var defaults = {\n      sidebarCollapsed: false,\n      groupsCollapsed: {\n        status: false,\n        dates: false,\n        gtd: false,\n        meta: false\n      },\n      sidebarWidth: defaultSidebarWidth\n    };\n    if (typeof window === \"undefined\") return defaults;\n    try {\n      var _window$localStorage, _groups$dates, _groups$gtd, _groups$meta;\n      var raw = (_window$localStorage = window.localStorage) === null || _window$localStorage === void 0 ? void 0 : _window$localStorage.getItem(fullPageUiKey);\n      if (!raw) return defaults;\n      var parsed = JSON.parse(raw);\n      if (!parsed || _typeof(parsed) !== \"object\") return defaults;\n      var _groups = parsed.groupsCollapsed && _typeof(parsed.groupsCollapsed) === \"object\" ? parsed.groupsCollapsed : {};\n      var sidebarWidthRaw = parsed.sidebarWidth;\n      var sidebarWidthNum = typeof sidebarWidthRaw === \"number\" ? sidebarWidthRaw : typeof sidebarWidthRaw === \"string\" ? parseFloat(sidebarWidthRaw) : NaN;\n      var _sidebarWidth = Number.isFinite(sidebarWidthNum) ? Math.min(480, Math.max(240, Math.round(sidebarWidthNum))) : defaultSidebarWidth;\n      return {\n        sidebarCollapsed: !!parsed.sidebarCollapsed,\n        groupsCollapsed: {\n          status: !!_groups.status,\n          dates: !!((_groups$dates = _groups.dates) !== null && _groups$dates !== void 0 ? _groups$dates : _groups.flow),\n          gtd: !!((_groups$gtd = _groups.gtd) !== null && _groups$gtd !== void 0 ? _groups$gtd : _groups.structure),\n          meta: !!((_groups$meta = _groups.meta) !== null && _groups$meta !== void 0 ? _groups$meta : _groups.effort)\n        },\n        sidebarWidth: _sidebarWidth\n      };\n    } catch (_) {\n      return defaults;\n    }\n  }, [fullPageUiKey]);\n  var _useState49 = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      return readFullPageUiState();\n    }),\n    _useState50 = _slicedToArray(_useState49, 2),\n    fullPageUiState = _useState50[0],\n    setFullPageUiState = _useState50[1];\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    if (!isFullPage) return;\n    setFullPageUiState(readFullPageUiState());\n  }, [isFullPage, readFullPageUiState]);\n  var persistFullPageUiState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (next) {\n    if (typeof window === \"undefined\") return;\n    try {\n      var _window$localStorage2;\n      (_window$localStorage2 = window.localStorage) === null || _window$localStorage2 === void 0 || _window$localStorage2.setItem(fullPageUiKey, JSON.stringify(next));\n    } catch (_) {\n      // ignore\n    }\n  }, [fullPageUiKey]);\n  var updateFullPageUiState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (updater) {\n    setFullPageUiState(function (prev) {\n      var next = typeof updater === \"function\" ? updater(prev) : prev;\n      persistFullPageUiState(next);\n      return next;\n    });\n  }, [persistFullPageUiState]);\n  var sidebarCollapsed = !!fullPageUiState.sidebarCollapsed;\n  var groupsCollapsed = fullPageUiState.groupsCollapsed || {};\n  var sidebarWidth = typeof fullPageUiState.sidebarWidth === \"number\" && Number.isFinite(fullPageUiState.sidebarWidth) ? fullPageUiState.sidebarWidth : 310;\n  var isResizingSidebarRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);\n  var sidebarResizeStartRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)({\n    x: 0,\n    width: sidebarWidth\n  });\n  var sidebarResizeRafRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);\n  var toggleSidebarCollapsed = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    updateFullPageUiState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sidebarCollapsed: !prev.sidebarCollapsed\n      });\n    });\n  }, [updateFullPageUiState]);\n  var toggleGroupCollapsed = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (key) {\n    updateFullPageUiState(function (prev) {\n      var _prev$groupsCollapsed;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        groupsCollapsed: _objectSpread(_objectSpread({}, prev.groupsCollapsed || {}), {}, _defineProperty({}, key, !((_prev$groupsCollapsed = prev.groupsCollapsed) !== null && _prev$groupsCollapsed !== void 0 && _prev$groupsCollapsed[key])))\n      });\n    });\n  }, [updateFullPageUiState]);\n  var setSidebarWidth = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (nextWidth) {\n    var width = typeof nextWidth === \"number\" && Number.isFinite(nextWidth) ? Math.min(480, Math.max(240, Math.round(nextWidth))) : sidebarWidth;\n    updateFullPageUiState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sidebarWidth: width\n      });\n    });\n  }, [sidebarWidth, updateFullPageUiState]);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(function () {\n    return function () {\n      if (sidebarResizeRafRef.current) {\n        cancelAnimationFrame(sidebarResizeRafRef.current);\n        sidebarResizeRafRef.current = null;\n      }\n      isResizingSidebarRef.current = false;\n    };\n  }, []);\n  var handleSidebarResizerPointerDown = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (event) {\n    if (!isFullPage) return;\n    if (sidebarCollapsed) return;\n    if (!event || typeof event.clientX !== \"number\") return;\n    isResizingSidebarRef.current = true;\n    sidebarResizeStartRef.current = {\n      x: event.clientX,\n      width: sidebarWidth\n    };\n    try {\n      var _event$currentTarget, _event$currentTarget$;\n      (_event$currentTarget = event.currentTarget) === null || _event$currentTarget === void 0 || (_event$currentTarget$ = _event$currentTarget.setPointerCapture) === null || _event$currentTarget$ === void 0 || _event$currentTarget$.call(_event$currentTarget, event.pointerId);\n    } catch (_) {\n      // ignore\n    }\n    event.preventDefault();\n    event.stopPropagation();\n  }, [isFullPage, sidebarCollapsed, sidebarWidth]);\n  var handleSidebarResizerPointerMove = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (event) {\n    if (!isResizingSidebarRef.current) return;\n    if (!event || typeof event.clientX !== \"number\") return;\n    var _ref18 = sidebarResizeStartRef.current || {\n        x: 0,\n        width: sidebarWidth\n      },\n      x = _ref18.x,\n      width = _ref18.width;\n    var delta = event.clientX - x;\n    var next = width + delta;\n    if (sidebarResizeRafRef.current) return;\n    sidebarResizeRafRef.current = requestAnimationFrame(function () {\n      sidebarResizeRafRef.current = null;\n      setSidebarWidth(next);\n    });\n    event.preventDefault();\n  }, [setSidebarWidth, sidebarWidth]);\n  var handleSidebarResizerPointerUp = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (event) {\n    if (!isResizingSidebarRef.current) return;\n    isResizingSidebarRef.current = false;\n    try {\n      var _event$currentTarget2, _event$currentTarget3;\n      (_event$currentTarget2 = event.currentTarget) === null || _event$currentTarget2 === void 0 || (_event$currentTarget3 = _event$currentTarget2.releasePointerCapture) === null || _event$currentTarget3 === void 0 || _event$currentTarget3.call(_event$currentTarget2, event.pointerId);\n    } catch (_) {\n      // ignore\n    }\n    event.preventDefault();\n    event.stopPropagation();\n  }, []);\n  var getDashViewState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    return {\n      filters: filters,\n      grouping: grouping,\n      query: query\n    };\n  }, [filters, grouping, query]);\n  var notifyToast = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (message) {\n    if (!message) return;\n    try {\n      izitoast__WEBPACK_IMPORTED_MODULE_2___default().show({\n        theme: \"light\",\n        color: \"black\",\n        \"class\": \"betterTasks bt-toast-strong-icon\",\n        position: \"center\",\n        message: String(message),\n        timeout: 2400,\n        close: true,\n        closeOnEscape: true,\n        onOpening: function onOpening(_instance, toastEl) {\n          applyToastA11y(toastEl);\n        }\n      });\n    } catch (_) {\n      // best effort\n    }\n  }, []);\n  var persistViewsStore = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (nextStore) {\n    var _controller$notifyDas2;\n    if (!(controller !== null && controller !== void 0 && controller.saveViewsStore)) {\n      setViewsStore(nextStore);\n      return nextStore;\n    }\n    var saved = controller.saveViewsStore(nextStore);\n    setViewsStore(saved);\n    controller === null || controller === void 0 || (_controller$notifyDas2 = controller.notifyDashViewsStoreChanged) === null || _controller$notifyDas2 === void 0 || _controller$notifyDas2.call(controller, saved);\n    return saved;\n  }, [controller]);\n  var persistDefaultState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (dashState) {\n    var _controller$notifyDas3;\n    if (!(controller !== null && controller !== void 0 && controller.saveViewsStore)) return;\n    var latest = controller !== null && controller !== void 0 && controller.loadViewsStore ? controller.loadViewsStore() : viewsStore;\n    var next = (0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.setLastDefaultState)(latest, dashState);\n    var saved = controller.saveViewsStore(next);\n    setViewsStore(saved);\n    controller === null || controller === void 0 || (_controller$notifyDas3 = controller.notifyDashViewsStoreChanged) === null || _controller$notifyDas3 === void 0 || _controller$notifyDas3.call(controller, saved);\n  }, [controller, viewsStore]);\n  var applyDashViewState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (state) {\n    if (!state || _typeof(state) !== \"object\") return;\n    dispatchFilters({\n      type: \"hydrate\",\n      value: state.filters\n    });\n    setGrouping(typeof state.grouping === \"string\" ? state.grouping : \"time\");\n    setQuery(typeof state.query === \"string\" ? state.query : \"\");\n  }, []);\n  var applyDefaultView = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    var storeNow = controller !== null && controller !== void 0 && controller.loadViewsStore ? controller.loadViewsStore() : viewsStore;\n    var savedStore = persistViewsStore((0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.setActiveView)(storeNow, null));\n    var defaultState = (savedStore === null || savedStore === void 0 ? void 0 : savedStore.lastDefaultState) || (storeNow === null || storeNow === void 0 ? void 0 : storeNow.lastDefaultState) || null;\n    if (defaultState) applyDashViewState(defaultState);\n  }, [controller, viewsStore, persistViewsStore, applyDashViewState]);\n  var applySavedViewById = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (id) {\n    var view = ((viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.views) || []).find(function (v) {\n      return v.id === id;\n    });\n    if (!view) return false;\n    if (!(viewsStore !== null && viewsStore !== void 0 && viewsStore.activeViewId)) {\n      persistDefaultState(getDashViewState());\n    }\n    applyDashViewState(view.state);\n    persistViewsStore((0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.setActiveView)(viewsStore, id));\n    return true;\n  }, [viewsStore, persistDefaultState, getDashViewState, applyDashViewState, persistViewsStore]);\n  var startReview = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!effectiveReviewIds.length) {\n      notifyToast(ui.reviewNoPresetsToast);\n      return;\n    }\n    preReviewActiveViewIdRef.current = (viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId) || null;\n    setReviewState({\n      active: true,\n      index: 0\n    });\n    applySavedViewById(effectiveReviewIds[0]);\n  }, [effectiveReviewIds, notifyToast, ui.reviewNoPresetsToast, viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId, applySavedViewById]);\n  var exitReview = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    var priorId = preReviewActiveViewIdRef.current;\n    preReviewActiveViewIdRef.current = null;\n    setReviewState({\n      active: false,\n      index: 0\n    });\n    if (priorId) {\n      applySavedViewById(priorId);\n      return;\n    }\n    applyDefaultView();\n  }, [applyDefaultView, applySavedViewById]);\n  var goReviewNext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!reviewState.active) return;\n    var max = effectiveReviewIds.length - 1;\n    if (reviewState.index >= max) return;\n    var nextIndex = reviewState.index + 1;\n    setReviewState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        index: nextIndex\n      });\n    });\n    var id = effectiveReviewIds[nextIndex];\n    if (id) applySavedViewById(id);\n  }, [reviewState.active, reviewState.index, effectiveReviewIds, applySavedViewById]);\n  var goReviewBack = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!reviewState.active) return;\n    if (reviewState.index <= 0) return;\n    var nextIndex = reviewState.index - 1;\n    setReviewState(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        index: nextIndex\n      });\n    });\n    var id = effectiveReviewIds[nextIndex];\n    if (id) applySavedViewById(id);\n  }, [reviewState.active, reviewState.index, effectiveReviewIds, applySavedViewById]);\n  var handleViewSelectChange = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (e) {\n    var _e$target;\n    if (reviewState.active) {\n      setReviewState({\n        active: false,\n        index: 0\n      });\n      preReviewActiveViewIdRef.current = null;\n    }\n    var id = (e === null || e === void 0 || (_e$target = e.target) === null || _e$target === void 0 ? void 0 : _e$target.value) || null;\n    if (!id) {\n      applyDefaultView();\n      return;\n    }\n    applySavedViewById(id);\n  }, [reviewState.active, applyDefaultView, applySavedViewById]);\n  var handleSaveViewAs = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {\n    var name;\n    return _regenerator().w(function (_context6) {\n      while (1) switch (_context6.n) {\n        case 0:\n          if (controller !== null && controller !== void 0 && controller.promptValue) {\n            _context6.n = 1;\n            break;\n          }\n          return _context6.a(2);\n        case 1:\n          _context6.n = 2;\n          return controller.promptValue({\n            title: \"Better Tasks\",\n            message: ui.viewsSaveAsMessage,\n            placeholder: ui.viewsNamePlaceholder,\n            initial: \"\"\n          });\n        case 2:\n          name = _context6.v;\n          if (name) {\n            _context6.n = 3;\n            break;\n          }\n          return _context6.a(2);\n        case 3:\n          persistViewsStore((0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.createView)(viewsStore, name, getDashViewState()));\n        case 4:\n          return _context6.a(2);\n      }\n    }, _callee6);\n  })), [controller, viewsStore, getDashViewState, persistViewsStore, ui.viewsSaveAsMessage, ui.viewsNamePlaceholder]);\n  var handleUpdateActiveView = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!(activeView !== null && activeView !== void 0 && activeView.id)) return;\n    var confirmText = typeof ui.viewsConfirmOverwrite === \"function\" ? ui.viewsConfirmOverwrite(activeView.name) : \"Overwrite view \\\"\".concat(activeView.name, \"\\\"?\");\n    var ok = typeof window !== \"undefined\" ? window.confirm(confirmText) : true;\n    if (!ok) return;\n    persistViewsStore((0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.updateView)(viewsStore, activeView.id, getDashViewState()));\n  }, [activeView, viewsStore, getDashViewState, persistViewsStore, ui.viewsConfirmOverwrite]);\n  var handleRenameActiveView = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7() {\n    var name;\n    return _regenerator().w(function (_context7) {\n      while (1) switch (_context7.n) {\n        case 0:\n          if (!(!(activeView !== null && activeView !== void 0 && activeView.id) || !(controller !== null && controller !== void 0 && controller.promptValue))) {\n            _context7.n = 1;\n            break;\n          }\n          return _context7.a(2);\n        case 1:\n          _context7.n = 2;\n          return controller.promptValue({\n            title: \"Better Tasks\",\n            message: ui.viewsRenameMessage,\n            placeholder: ui.viewsNamePlaceholder,\n            initial: activeView.name || \"\"\n          });\n        case 2:\n          name = _context7.v;\n          if (name) {\n            _context7.n = 3;\n            break;\n          }\n          return _context7.a(2);\n        case 3:\n          persistViewsStore((0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.renameView)(viewsStore, activeView.id, name));\n        case 4:\n          return _context7.a(2);\n      }\n    }, _callee7);\n  })), [controller, activeView, viewsStore, persistViewsStore, ui.viewsRenameMessage, ui.viewsNamePlaceholder]);\n  var handleDeleteActiveView = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function () {\n    if (!(activeView !== null && activeView !== void 0 && activeView.id)) return;\n    var confirmText = typeof ui.viewsConfirmDelete === \"function\" ? ui.viewsConfirmDelete(activeView.name) : \"Delete view \\\"\".concat(activeView.name, \"\\\"?\");\n    var ok = typeof window !== \"undefined\" ? window.confirm(confirmText) : true;\n    if (!ok) return;\n    persistViewsStore((0,_viewsStore__WEBPACK_IMPORTED_MODULE_6__.deleteView)(viewsStore, activeView.id));\n  }, [activeView, viewsStore, persistViewsStore, ui.viewsConfirmDelete]);\n  var isActiveViewDirty = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    if (!(activeView !== null && activeView !== void 0 && activeView.id)) return false;\n    try {\n      var current = normalizeDashViewStateForCompare({\n        filters: filters,\n        grouping: grouping,\n        query: query\n      });\n      var saved = normalizeDashViewStateForCompare(activeView.state || {});\n      return JSON.stringify(current) !== JSON.stringify(saved);\n    } catch (_) {\n      return true;\n    }\n  }, [activeView, filters, grouping, query]);\n  var viewMenuActions = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    if (!(activeView !== null && activeView !== void 0 && activeView.id)) return [];\n    return [{\n      key: \"rename\",\n      label: ui.viewsRename,\n      handler: function handler() {\n        return handleRenameActiveView();\n      }\n    }, {\n      key: \"delete\",\n      label: ui.viewsDelete,\n      danger: true,\n      handler: function handler() {\n        return handleDeleteActiveView();\n      }\n    }];\n  }, [activeView, handleRenameActiveView, handleDeleteActiveView, ui.viewsRename, ui.viewsDelete]);\n  var headerRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (node) {\n    if (typeof onHeaderReady === \"function\") {\n      onHeaderReady(node);\n    }\n  }, [onHeaderReady]);\n  function FullPageFilterGroup(_ref21) {\n    var groupKey = _ref21.groupKey,\n      title = _ref21.title,\n      children = _ref21.children;\n    var isCollapsed = !!(groupsCollapsed !== null && groupsCollapsed !== void 0 && groupsCollapsed[groupKey]);\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"section\", {\n      className: \"bt-filter-group\",\n      \"data-group\": groupKey\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bt-filter-group__header\",\n      onClick: function onClick() {\n        return toggleGroupCollapsed(groupKey);\n      },\n      \"aria-expanded\": !isCollapsed\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-filter-group__title\"\n    }, title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-filter-group__caret\",\n      \"aria-hidden\": \"true\"\n    }, isCollapsed ? \"â–¸\" : \"â–¾\")), !isCollapsed ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-filter-group__body\"\n    }, children) : null);\n  }\n  var showFullPageSidebar = isMobileLayout ? sidebarOpen : !sidebarCollapsed;\n  var sidebarStyle = isMobileLayout ? undefined : {\n    width: \"\".concat(sidebarWidth, \"px\")\n  };\n  var handleSidebarTouchStart = function handleSidebarTouchStart(event) {\n    var _event$touches;\n    if (!isMobileLayout) return;\n    var touch = (_event$touches = event.touches) === null || _event$touches === void 0 ? void 0 : _event$touches[0];\n    if (!touch) return;\n    sidebarSwipeRef.current = {\n      x: touch.clientX,\n      y: touch.clientY\n    };\n  };\n  var handleSidebarTouchEnd = function handleSidebarTouchEnd(event) {\n    var _event$changedTouches;\n    if (!isMobileLayout || !sidebarSwipeRef.current) return;\n    var touch = (_event$changedTouches = event.changedTouches) === null || _event$changedTouches === void 0 ? void 0 : _event$changedTouches[0];\n    var start = sidebarSwipeRef.current;\n    sidebarSwipeRef.current = null;\n    if (!touch || !start) return;\n    var deltaX = touch.clientX - start.x;\n    var deltaY = touch.clientY - start.y;\n    if (deltaX < -60 && Math.abs(deltaY) < 80) {\n      setSidebarOpen(false);\n    }\n  };\n  var fullPageFiltersSidebar = showFullPageSidebar ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"aside\", {\n    className: \"bt-dashboard__sidebar\".concat(sidebarOpen ? \" bt-dashboard__sidebar--open\" : \"\"),\n    \"aria-label\": ui.filtersLabel,\n    style: sidebarStyle,\n    onTouchStart: isMobileLayout ? handleSidebarTouchStart : undefined,\n    onTouchEnd: isMobileLayout ? handleSidebarTouchEnd : undefined\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-sidebar__header\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-sidebar__title\"\n  }, ui.filtersLabel), isMobileLayout ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-sidebar__close\",\n    onClick: function onClick() {\n      return setSidebarOpen(false);\n    },\n    \"aria-label\": ui.close\n  }, \"\\u2715\") : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FullPageFilterGroup, {\n    groupKey: \"status\",\n    title: ui.filtersGroups.status\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Completion\",\n    label: filterSectionLabels[\"Completion\"] || \"Completion\",\n    chips: filterDefs[\"Completion\"],\n    activeValues: filters[\"Completion\"],\n    onToggle: handleFilterToggle\n  }), completionOnlyIsCompleted ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.completedWithinLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.completedRange || \"any\",\n    onChange: function onChange(e) {\n      return dispatchFilters({\n        type: \"setText\",\n        section: \"completedRange\",\n        value: e.target.value\n      });\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"any\"\n  }, ui.completedWithinAny), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"7d\"\n  }, ui.completedWithin7d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"30d\"\n  }, ui.completedWithin30d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"90d\"\n  }, ui.completedWithin90d))) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Recurrence\",\n    label: filterSectionLabels[\"Recurrence\"] || \"Recurrence\",\n    chips: filterDefs[\"Recurrence\"],\n    activeValues: filters[\"Recurrence\"],\n    onToggle: handleFilterToggle\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FullPageFilterGroup, {\n    groupKey: \"dates\",\n    title: ui.filtersGroups.dates\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Start\",\n    label: filterSectionLabels[\"Start\"] || \"Start\",\n    chips: filterDefs[\"Start\"],\n    activeValues: filters[\"Start\"],\n    onToggle: handleFilterToggle\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Defer\",\n    label: filterSectionLabels[\"Defer\"] || \"Defer\",\n    chips: filterDefs[\"Defer\"],\n    activeValues: filters[\"Defer\"],\n    onToggle: handleFilterToggle\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Due\",\n    label: filterSectionLabels[\"Due\"] || \"Due\",\n    chips: filterDefs[\"Due\"],\n    activeValues: filters[\"Due\"],\n    onToggle: handleFilterToggle\n  }), dueIncludesUpcomingMemo ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.upcomingWithinLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.upcomingRange || \"any\",\n    onChange: function onChange(e) {\n      return dispatchFilters({\n        type: \"setText\",\n        section: \"upcomingRange\",\n        value: e.target.value\n      });\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"any\"\n  }, ui.upcomingWithinAny), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"7d\"\n  }, ui.upcomingWithin7d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"30d\"\n  }, ui.upcomingWithin30d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"90d\"\n  }, ui.upcomingWithin90d))) : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FullPageFilterGroup, {\n    groupKey: \"gtd\",\n    title: ui.filtersGroups.gtd\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"GTD\",\n    label: ui.tagsLabel,\n    chips: filterDefs[\"GTD\"],\n    activeValues: filters[\"GTD\"],\n    onToggle: handleFilterToggle\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.projectFilterLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.projectText || \"\",\n    onChange: handleProjectFilterChange\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.projectFilterAny || ui.projectFilterPlaceholder || \"All projects\"), projectOptions.map(function (opt) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: opt,\n      value: opt\n    }, opt);\n  }), filters.projectText && !projectOptions.includes(filters.projectText) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: filters.projectText\n  }, filters.projectText) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.waitingFilterLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.waitingText || \"\",\n    onChange: handleWaitingFilterChange\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.waitingFilterAny || ui.waitingFilterPlaceholder || \"All waiting\"), waitingOptions.map(function (opt) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: opt,\n      value: opt\n    }, opt);\n  }), filters.waitingText && !waitingOptions.includes(filters.waitingText) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: filters.waitingText\n  }, filters.waitingText) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.contextFilterLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.contextText || \"\",\n    onChange: handleContextFilterChange\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.contextFilterAny || \"All contexts\"), contextOptions.map(function (opt) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: opt,\n      value: opt\n    }, opt);\n  }), filters.contextText && !contextOptions.includes(filters.contextText) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: filters.contextText\n  }, filters.contextText) : null))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FullPageFilterGroup, {\n    groupKey: \"meta\",\n    title: ui.filtersGroups.meta\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Priority\",\n    label: filterSectionLabels[\"Priority\"] || \"Priority\",\n    chips: filterDefs[\"Priority\"],\n    activeValues: filters[\"Priority\"],\n    onToggle: handleFilterToggle\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    sectionKey: \"Energy\",\n    label: filterSectionLabels[\"Energy\"] || \"Energy\",\n    chips: filterDefs[\"Energy\"],\n    activeValues: filters[\"Energy\"],\n    onToggle: handleFilterToggle\n  }))) : null;\n  if (isFullPage) {\n    var _ui$bulk, _ui$bulk2, _ui$bulk3;\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: rootClasses\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"header\", {\n      className: \"bt-dashboard__header\",\n      ref: headerRef\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h2\", null, ui.headerTitle), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, ui.headerSubtitle)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__header-actions\"\n    }, !isMobileLayout ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: handleToggleFullPage\n    }, snapshot !== null && snapshot !== void 0 && snapshot.isFullPage ? ui.fullPageExit : ui.fullPageEnter) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: handleRefresh\n    }, ui.refresh), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: onRequestClose,\n      \"aria-label\": ui.close\n    }, \"\\u2715\"))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__quick-add\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-quick-add\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"input\", {\n      type: \"text\",\n      className: \"bt-quick-add__input\",\n      placeholder: ui.quickAddPlaceholder,\n      value: quickText,\n      onChange: function onChange(e) {\n        return setQuickText(e.target.value);\n      },\n      onKeyDown: handleQuickAddKeyDown\n    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: handleQuickAddSubmit\n    }, ui.quickAddButton))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__toolbar\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-toolbar__left\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-filter-row__label\"\n    }, ui.savedViewsLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bp3-select bp3-small bt-views-select\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n      value: (viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId) || \"\",\n      onChange: handleViewSelectChange,\n      \"aria-label\": ui.savedViewsLabel\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      value: \"\"\n    }, ui.viewsDefault), sortedViews.map(function (view) {\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n        key: view.id,\n        value: view.id\n      }, view.name);\n    }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: handleSaveViewAs\n    }, ui.viewsSaveAs), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: handleUpdateActiveView,\n      disabled: !activeView || !isActiveViewDirty\n    }, ui.viewsUpdate), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SimpleActionsMenu, {\n      actions: viewMenuActions,\n      title: ui.viewsOptions,\n      disabled: !activeView\n    })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-toolbar__right\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small bt-weekly-review-button\".concat(reviewState.active ? \" bt-weekly-review-button--inactive\" : \"\"),\n      onClick: startReview,\n      disabled: reviewState.active || !effectiveReviewIds.length\n    }, ui.reviewButton))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__main\"\n    }, isMobileLayout && sidebarOpen ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__sidebar-backdrop\",\n      onPointerDown: function onPointerDown(event) {\n        event.stopPropagation();\n      },\n      onClick: function onClick(event) {\n        event.stopPropagation();\n        setSidebarOpen(false);\n      },\n      \"aria-hidden\": \"true\"\n    }) : null, fullPageFiltersSidebar, !isMobileLayout && !sidebarCollapsed ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__sidebar-resizer\",\n      role: \"separator\",\n      \"aria-orientation\": \"vertical\",\n      onPointerDown: handleSidebarResizerPointerDown,\n      onPointerMove: handleSidebarResizerPointerMove,\n      onPointerUp: handleSidebarResizerPointerUp,\n      onPointerCancel: handleSidebarResizerPointerUp\n    }) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__mainpane\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__controls\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-search-row\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"input\", {\n      type: \"text\",\n      className: \"bt-search\",\n      placeholder: ui.searchPlaceholder,\n      value: query,\n      onChange: function onChange(e) {\n        return setQuery(e.target.value);\n      }\n    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-grouping\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-grouping__label\"\n    }, ui.groupByLabel), ui.groupingOptions.map(function (option) {\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n        key: option.value,\n        type: \"button\",\n        className: \"bt-chip\".concat(grouping === option.value ? \" bt-chip--active\" : \"\"),\n        onClick: function onClick() {\n          return setGrouping(option.value);\n        }\n      }, option.label);\n    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bt-chip bt-chip--filters-toggle\",\n      onClick: function onClick() {\n        if (isMobileLayout) {\n          setSidebarOpen(function (prev) {\n            return !prev;\n          });\n          return;\n        }\n        toggleSidebarCollapsed();\n      },\n      \"aria-label\": ui.filtersLabel,\n      \"aria-expanded\": isMobileLayout ? sidebarOpen : !sidebarCollapsed\n    }, isMobileLayout ? ui.filtersLabel : sidebarCollapsed ? ui.filtersShow : ui.filtersHide), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-toolbar-divider\",\n      \"aria-hidden\": \"true\"\n    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bt-chip\".concat(selectionMode ? \" bt-chip--active\" : \"\"),\n      onClick: function onClick() {\n        if (selectionMode) {\n          setSelectionMode(false);\n          setSelectedUids(new Set());\n        } else {\n          setSelectionMode(true);\n        }\n      },\n      \"aria-pressed\": selectionMode\n    }, ((_ui$bulk = ui.bulk) === null || _ui$bulk === void 0 ? void 0 : _ui$bulk.select) || \"Bulk\"), selectionActive ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bt-chip\",\n      onClick: selectAllVisible\n    }, ((_ui$bulk2 = ui.bulk) === null || _ui$bulk2 === void 0 ? void 0 : _ui$bulk2.selectAll) || \"All\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bt-chip\",\n      onClick: selectNone\n    }, ((_ui$bulk3 = ui.bulk) === null || _ui$bulk3 === void 0 ? void 0 : _ui$bulk3.selectNone) || \"Clear\")) : null))), reviewState.active ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__reviewbar\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-reviewbar__left\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-reviewbar__title\"\n    }, ui.reviewLabel, \" \\xB7 \", Math.min(reviewState.index + 1, effectiveReviewIds.length), \" \", ui.reviewOf, \" \", effectiveReviewIds.length), activeReviewView !== null && activeReviewView !== void 0 && activeReviewView.name ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n      className: \"bt-reviewbar__current\"\n    }, activeReviewView.name) : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-reviewbar__right\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: goReviewBack,\n      disabled: reviewState.index <= 0\n    }, ui.reviewBack), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: goReviewNext,\n      disabled: reviewState.index >= effectiveReviewIds.length - 1\n    }, ui.reviewNext), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      type: \"button\",\n      className: \"bp3-button bp3-small\",\n      onClick: exitReview\n    }, ui.reviewExit))) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-dashboard__content\",\n      ref: parentRef\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-virtualizer\",\n      style: {\n        height: \"\".concat(rowVirtualizer.getTotalSize(), \"px\")\n      }\n    }, rowVirtualizer.getVirtualItems().map(function (virtualRow) {\n      var row = rows[virtualRow.index];\n      var style = {\n        position: \"absolute\",\n        top: 0,\n        left: 0,\n        width: \"100%\",\n        transform: \"translateY(\".concat(virtualRow.start, \"px)\")\n      };\n      if (row.type === \"group\") {\n        var expanded = expandedGroups[row.group.id] !== false;\n        var _groupTasks = row.group.items || [];\n        var selectedCount = _groupTasks.reduce(function (acc, task) {\n          return selectedUids.has(task.uid) ? acc + 1 : acc;\n        }, 0);\n        var selectionState = selectedCount === 0 ? \"none\" : selectedCount === _groupTasks.length ? \"all\" : \"partial\";\n        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n          style: style,\n          key: row.key,\n          \"data-index\": virtualRow.index,\n          ref: rowVirtualizer.measureElement\n        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(GroupHeader, {\n          title: row.group.title,\n          count: row.group.items.length,\n          isExpanded: expanded,\n          onToggle: function onToggle() {\n            return setExpandedGroups(function (prev) {\n              return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, row.group.id, !expanded));\n            });\n          },\n          selectionActive: selectionActive,\n          selectionState: selectionState,\n          onToggleSelection: function onToggleSelection() {\n            return selectGroup(_groupTasks);\n          },\n          strings: ui\n        }));\n      }\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n        style: style,\n        key: row.key,\n        \"data-index\": virtualRow.index,\n        ref: rowVirtualizer.measureElement\n      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(TaskRow, {\n        task: row.task,\n        controller: controller,\n        strings: ui,\n        selectionActive: selectionActive,\n        isSelected: selectedUids.has(row.task.uid),\n        onToggleSelect: handleToggleSelect\n      }));\n    })), !rows.length ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      className: \"bt-content-empty\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(EmptyState, {\n      status: snapshot.status,\n      onRefresh: handleRefresh,\n      strings: ui.empty\n    })) : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"footer\", {\n      className: \"bt-dashboard__footer\"\n    }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(BulkActionBar, {\n      selectedUids: selectedUids,\n      tasks: snapshot.tasks,\n      controller: controller,\n      strings: ui,\n      onClearSelection: selectNone,\n      onCancel: cancelSelection,\n      isMobileLayout: isMobileLayout\n    }));\n  }\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: rootClasses\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"header\", {\n    className: \"bt-dashboard__header\",\n    ref: headerRef\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h2\", null, ui.headerTitle), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", null, ui.headerSubtitle)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__header-actions\"\n  }, !isMobileLayout ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleToggleFullPage\n  }, snapshot !== null && snapshot !== void 0 && snapshot.isFullPage ? ui.fullPageExit : ui.fullPageEnter) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleRefresh\n  }, ui.refresh), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: onRequestClose,\n    \"aria-label\": ui.close\n  }, \"\\u2715\"))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__toolbar\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-toolbar__left\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-filter-row__label\"\n  }, ui.savedViewsLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bp3-select bp3-small bt-views-select\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: (viewsStore === null || viewsStore === void 0 ? void 0 : viewsStore.activeViewId) || \"\",\n    onChange: handleViewSelectChange,\n    \"aria-label\": ui.savedViewsLabel\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.viewsDefault), sortedViews.map(function (view) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: view.id,\n      value: view.id\n    }, view.name);\n  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleSaveViewAs\n  }, ui.viewsSaveAs), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleUpdateActiveView,\n    disabled: !activeView || !isActiveViewDirty\n  }, ui.viewsUpdate), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(SimpleActionsMenu, {\n    actions: viewMenuActions,\n    title: ui.viewsOptions,\n    disabled: !activeView\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-toolbar__right\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small bt-weekly-review-button\".concat(reviewState.active ? \" bt-weekly-review-button--inactive\" : \"\"),\n    onClick: startReview,\n    disabled: reviewState.active || !effectiveReviewIds.length\n  }, ui.reviewButton))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__quick-add\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-quick-add\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"input\", {\n    type: \"text\",\n    className: \"bt-quick-add__input\",\n    placeholder: ui.quickAddPlaceholder,\n    value: quickText,\n    onChange: function onChange(e) {\n      return setQuickText(e.target.value);\n    },\n    onKeyDown: handleQuickAddKeyDown\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: handleQuickAddSubmit\n  }, ui.quickAddButton))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__controls\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-search-row\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"input\", {\n    type: \"text\",\n    className: \"bt-search\",\n    placeholder: ui.searchPlaceholder,\n    value: query,\n    onChange: function onChange(e) {\n      return setQuery(e.target.value);\n    }\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-grouping\"\n  }, !selectionActive && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-grouping__label\"\n  }, ui.groupByLabel), ui.groupingOptions.map(function (option) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n      key: option.value,\n      type: \"button\",\n      className: \"bt-chip\".concat(grouping === option.value ? \" bt-chip--active\" : \"\"),\n      onClick: function onClick() {\n        return setGrouping(option.value);\n      }\n    }, option.label);\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-chip\".concat(filtersOpen ? \" bt-chip--active\" : \"\"),\n    onClick: function onClick() {\n      return setFiltersOpen(function (v) {\n        return !v;\n      });\n    },\n    \"aria-expanded\": filtersOpen,\n    \"aria-label\": ui.filtersLabel\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bp3-icon bp3-icon-filter\",\n    \"aria-hidden\": \"true\"\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-toolbar-divider\",\n    \"aria-hidden\": \"true\"\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-chip\".concat(selectionMode ? \" bt-chip--active\" : \"\"),\n    onClick: function onClick() {\n      if (selectionMode) {\n        setSelectionMode(false);\n        setSelectedUids(new Set());\n      } else {\n        setSelectionMode(true);\n      }\n    },\n    \"aria-pressed\": selectionMode\n  }, ((_ui$bulk4 = ui.bulk) === null || _ui$bulk4 === void 0 ? void 0 : _ui$bulk4.select) || \"Bulk\"), selectionActive ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-chip\",\n    onClick: selectAllVisible\n  }, ((_ui$bulk5 = ui.bulk) === null || _ui$bulk5 === void 0 ? void 0 : _ui$bulk5.selectAll) || \"All\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bt-chip\",\n    onClick: selectNone\n  }, ((_ui$bulk6 = ui.bulk) === null || _ui$bulk6 === void 0 ? void 0 : _ui$bulk6.selectNone) || \"Clear\")) : null))), filtersOpen ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__filters\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filters-grid-cols\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filters-col\"\n  }, FILTER_SECTIONS_LEFT.map(function (sectionKey) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n      key: sectionKey,\n      sectionKey: sectionKey,\n      label: filterSectionLabels[sectionKey] || sectionKey,\n      chips: filterDefs[sectionKey],\n      activeValues: filters[sectionKey],\n      onToggle: handleFilterToggle\n    });\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filters-col\"\n  }, FILTER_SECTIONS_RIGHT.map(function (sectionKey) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n      key: sectionKey,\n      sectionKey: sectionKey,\n      label: filterSectionLabels[sectionKey] || sectionKey,\n      chips: filterDefs[sectionKey],\n      activeValues: filters[sectionKey],\n      onToggle: handleFilterToggle\n    });\n  })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filters-col bt-filters-col--full\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    key: \"Due\",\n    sectionKey: \"Due\",\n    label: filterSectionLabels[\"Due\"] || \"Due\",\n    chips: filterDefs[\"Due\"],\n    activeValues: filters[\"Due\"],\n    onToggle: handleFilterToggle\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(FilterChips, {\n    key: \"GTD\",\n    sectionKey: \"GTD\",\n    label: filterSectionLabels[\"GTD\"] || \"GTD\",\n    chips: filterDefs[\"GTD\"],\n    activeValues: filters[\"GTD\"],\n    onToggle: handleFilterToggle\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-filter-text-row\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.projectFilterLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.projectText || \"\",\n    onChange: handleProjectFilterChange\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.projectFilterAny || ui.projectFilterPlaceholder || \"All projects\"), projectOptions.map(function (opt) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: opt,\n      value: opt\n    }, opt);\n  }), filters.projectText && !projectOptions.includes(filters.projectText) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: filters.projectText\n  }, filters.projectText) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.waitingFilterLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.waitingText || \"\",\n    onChange: handleWaitingFilterChange\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.waitingFilterAny || ui.waitingFilterPlaceholder || \"All waiting\"), waitingOptions.map(function (opt) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: opt,\n      value: opt\n    }, opt);\n  }), filters.waitingText && !waitingOptions.includes(filters.waitingText) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: filters.waitingText\n  }, filters.waitingText) : null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.contextFilterLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.contextText || \"\",\n    onChange: handleContextFilterChange\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"\"\n  }, ui.contextFilterAny || \"All contexts\"), contextOptions.map(function (opt) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n      key: opt,\n      value: opt\n    }, opt);\n  }), filters.contextText && !contextOptions.includes(filters.contextText) ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: filters.contextText\n  }, filters.contextText) : null)), dueIncludesUpcomingMemo ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.upcomingWithinLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.upcomingRange || \"any\",\n    onChange: function onChange(e) {\n      return dispatchFilters({\n        type: \"setText\",\n        section: \"upcomingRange\",\n        value: e.target.value\n      });\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"any\"\n  }, ui.upcomingWithinAny), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"7d\"\n  }, ui.upcomingWithin7d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"30d\"\n  }, ui.upcomingWithin30d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"90d\"\n  }, ui.upcomingWithin90d))) : null, completionOnlyIsCompleted ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"label\", {\n    className: \"bt-filter-text\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", null, ui.completedWithinLabel), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"select\", {\n    value: filters.completedRange || \"any\",\n    onChange: function onChange(e) {\n      return dispatchFilters({\n        type: \"setText\",\n        section: \"completedRange\",\n        value: e.target.value\n      });\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"any\"\n  }, ui.completedWithinAny), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"7d\"\n  }, ui.completedWithin7d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"30d\"\n  }, ui.completedWithin30d), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"option\", {\n    value: \"90d\"\n  }, ui.completedWithin90d))) : null)))) : null, reviewState.active ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__reviewbar\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-reviewbar__left\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-reviewbar__title\"\n  }, ui.reviewLabel, \" \\xB7 \", Math.min(reviewState.index + 1, effectiveReviewIds.length), \" \", ui.reviewOf, \" \", effectiveReviewIds.length), activeReviewView !== null && activeReviewView !== void 0 && activeReviewView.name ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"span\", {\n    className: \"bt-reviewbar__current\"\n  }, activeReviewView.name) : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-reviewbar__right\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: goReviewBack,\n    disabled: reviewState.index <= 0\n  }, ui.reviewBack), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: goReviewNext,\n    disabled: reviewState.index >= effectiveReviewIds.length - 1\n  }, ui.reviewNext), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    type: \"button\",\n    className: \"bp3-button bp3-small\",\n    onClick: exitReview\n  }, ui.reviewExit))) : null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-dashboard__content\",\n    ref: parentRef\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-virtualizer\",\n    style: {\n      height: \"\".concat(rowVirtualizer.getTotalSize(), \"px\")\n    }\n  }, rowVirtualizer.getVirtualItems().map(function (virtualRow) {\n    var row = rows[virtualRow.index];\n    var style = {\n      position: \"absolute\",\n      top: 0,\n      left: 0,\n      width: \"100%\",\n      transform: \"translateY(\".concat(virtualRow.start, \"px)\")\n    };\n    if (row.type === \"group\") {\n      var expanded = expandedGroups[row.group.id] !== false;\n      var _groupTasks2 = row.group.items || [];\n      var selectedCount = _groupTasks2.reduce(function (acc, task) {\n        return selectedUids.has(task.uid) ? acc + 1 : acc;\n      }, 0);\n      var selectionState = selectedCount === 0 ? \"none\" : selectedCount === _groupTasks2.length ? \"all\" : \"partial\";\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n        style: style,\n        key: row.key,\n        \"data-index\": virtualRow.index,\n        ref: rowVirtualizer.measureElement\n      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(GroupHeader, {\n        title: row.group.title,\n        count: row.group.items.length,\n        isExpanded: expanded,\n        onToggle: function onToggle() {\n          return setExpandedGroups(function (prev) {\n            return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, row.group.id, !expanded));\n          });\n        },\n        selectionActive: selectionActive,\n        selectionState: selectionState,\n        onToggleSelection: function onToggleSelection() {\n          return selectGroup(_groupTasks2);\n        },\n        strings: ui\n      }));\n    }\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n      style: style,\n      key: row.key,\n      \"data-index\": virtualRow.index,\n      ref: rowVirtualizer.measureElement\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(TaskRow, {\n      task: row.task,\n      controller: controller,\n      strings: ui,\n      selectionActive: selectionActive,\n      isSelected: selectedUids.has(row.task.uid),\n      onToggleSelect: handleToggleSelect\n    }));\n  })), !rows.length ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bt-content-empty\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(EmptyState, {\n    status: snapshot.status,\n    onRefresh: handleRefresh,\n    strings: ui.empty\n  })) : null), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"footer\", {\n    className: \"bt-dashboard__footer\"\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(BulkActionBar, {\n    selectedUids: selectedUids,\n    tasks: snapshot.tasks,\n    controller: controller,\n    strings: ui,\n    onClearSelection: selectNone,\n    onCancel: cancelSelection,\n    isMobileLayout: isMobileLayout\n  }));\n}\n\n//# sourceURL=webpack://better-tasks/./src/dashboard/App.jsx?\n}");

/***/ },

/***/ "./src/dashboard/viewsStore.js"
/*!*************************************!*\
  !*** ./src/dashboard/viewsStore.js ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DASHBOARD_PRESET_IDS: () => (/* binding */ DASHBOARD_PRESET_IDS),\n/* harmony export */   DASHBOARD_REVIEW_PRESET_IDS: () => (/* binding */ DASHBOARD_REVIEW_PRESET_IDS),\n/* harmony export */   SETTINGS_KEY_SEEDS_INSTALLED: () => (/* binding */ SETTINGS_KEY_SEEDS_INSTALLED),\n/* harmony export */   SETTINGS_KEY_VIEWS: () => (/* binding */ SETTINGS_KEY_VIEWS),\n/* harmony export */   buildPresetViews: () => (/* binding */ buildPresetViews),\n/* harmony export */   createView: () => (/* binding */ createView),\n/* harmony export */   deleteView: () => (/* binding */ deleteView),\n/* harmony export */   installPresetDashboardViews: () => (/* binding */ installPresetDashboardViews),\n/* harmony export */   loadViewsStore: () => (/* binding */ loadViewsStore),\n/* harmony export */   renameView: () => (/* binding */ renameView),\n/* harmony export */   saveViewsStore: () => (/* binding */ saveViewsStore),\n/* harmony export */   setActiveView: () => (/* binding */ setActiveView),\n/* harmony export */   setLastDefaultState: () => (/* binding */ setLastDefaultState),\n/* harmony export */   updateView: () => (/* binding */ updateView)\n/* harmony export */ });\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nvar SETTINGS_KEY_VIEWS = \"bt_dashViews\";\nvar SETTINGS_KEY_SEEDS_INSTALLED = \"bt_seedsInstalled\";\nvar STORE_SCHEMA = 1;\nvar VIEW_SCHEMA = 1;\nvar DASHBOARD_PRESET_IDS = [\"bt_preset_next_actions\", \"bt_preset_waiting_for\", \"bt_preset_completed_7d\", \"bt_preset_upcoming_7d\", \"bt_preset_overdue\", \"bt_preset_someday\", \"bt_preset_all_open\"];\nvar DASHBOARD_REVIEW_PRESET_IDS = [\"bt_preset_next_actions\", \"bt_preset_waiting_for\", \"bt_preset_completed_7d\", \"bt_preset_upcoming_7d\", \"bt_preset_overdue\", \"bt_preset_someday\"];\nfunction nowMs() {\n  return Date.now();\n}\nfunction emptyStore() {\n  return {\n    schema: STORE_SCHEMA,\n    activeViewId: null,\n    views: [],\n    lastDefaultState: null,\n    lastDefaultUpdatedAt: null\n  };\n}\nfunction cloneJsonSafe(value) {\n  if (value == null) return value;\n  if (typeof structuredClone === \"function\") {\n    try {\n      return structuredClone(value);\n    } catch (_) {\n      // fall back\n    }\n  }\n  try {\n    return JSON.parse(JSON.stringify(value));\n  } catch (_) {\n    return value;\n  }\n}\nfunction safeParseStore(raw) {\n  if (!raw) return emptyStore();\n  if (_typeof(raw) === \"object\") return normalizeStore(raw);\n  if (typeof raw !== \"string\") return emptyStore();\n  try {\n    var parsed = JSON.parse(raw);\n    return normalizeStore(parsed);\n  } catch (_) {\n    return emptyStore();\n  }\n}\nfunction normalizeDashState(state) {\n  var filters = state && _typeof(state.filters) === \"object\" && state.filters ? cloneJsonSafe(state.filters) : {};\n  var grouping = typeof (state === null || state === void 0 ? void 0 : state.grouping) === \"string\" ? state.grouping : \"time\";\n  var query = typeof (state === null || state === void 0 ? void 0 : state.query) === \"string\" ? state.query : \"\";\n  return {\n    filters: filters,\n    grouping: grouping,\n    query: query\n  };\n}\nfunction normalizeView(view) {\n  if (!view || _typeof(view) !== \"object\") return null;\n  var id = typeof view.id === \"string\" ? view.id : null;\n  var name = typeof view.name === \"string\" ? view.name.trim() : \"\";\n  if (!id || !name) return null;\n  var createdAt = typeof view.createdAt === \"number\" ? view.createdAt : nowMs();\n  var updatedAt = typeof view.updatedAt === \"number\" ? view.updatedAt : createdAt;\n  var state = normalizeDashState(view.state || {});\n  return {\n    id: id,\n    name: name,\n    createdAt: createdAt,\n    updatedAt: updatedAt,\n    schema: VIEW_SCHEMA,\n    state: state\n  };\n}\nfunction normalizeStore(store) {\n  if (!store || _typeof(store) !== \"object\") return emptyStore();\n  var viewsRaw = Array.isArray(store.views) ? store.views : [];\n  var views = viewsRaw.map(normalizeView).filter(Boolean);\n  var activeViewId = typeof store.activeViewId === \"string\" && views.some(function (v) {\n    return v.id === store.activeViewId;\n  }) ? store.activeViewId : null;\n  var lastDefaultStateRaw = store.lastDefaultState;\n  var lastDefaultState = lastDefaultStateRaw && _typeof(lastDefaultStateRaw) === \"object\" ? normalizeDashState(lastDefaultStateRaw) : null;\n  var lastDefaultUpdatedAt = typeof store.lastDefaultUpdatedAt === \"number\" ? store.lastDefaultUpdatedAt : null;\n  return {\n    schema: STORE_SCHEMA,\n    activeViewId: activeViewId,\n    views: views,\n    lastDefaultState: lastDefaultState,\n    lastDefaultUpdatedAt: lastDefaultUpdatedAt\n  };\n}\nfunction generateId() {\n  if (typeof crypto !== \"undefined\" && typeof crypto.randomUUID === \"function\") {\n    return crypto.randomUUID();\n  }\n  if (typeof crypto !== \"undefined\" && typeof crypto.getRandomValues === \"function\") {\n    var buf = new Uint8Array(16);\n    crypto.getRandomValues(buf);\n    var hex = Array.from(buf).map(function (b) {\n      return b.toString(16).padStart(2, \"0\");\n    }).join(\"\");\n    return \"btv_\".concat(hex);\n  }\n  return \"btv_\".concat(Math.random().toString(16).slice(2), \"_\").concat(Date.now().toString(16));\n}\nfunction normalizeNameForCompare(name) {\n  return String(name || \"\").trim().toLowerCase();\n}\nfunction loadViewsStore(extensionAPI) {\n  try {\n    var _extensionAPI$setting, _extensionAPI$setting2;\n    var raw = extensionAPI === null || extensionAPI === void 0 || (_extensionAPI$setting = extensionAPI.settings) === null || _extensionAPI$setting === void 0 || (_extensionAPI$setting2 = _extensionAPI$setting.get) === null || _extensionAPI$setting2 === void 0 ? void 0 : _extensionAPI$setting2.call(_extensionAPI$setting, SETTINGS_KEY_VIEWS);\n    return safeParseStore(raw);\n  } catch (_) {\n    return emptyStore();\n  }\n}\nfunction saveViewsStore(extensionAPI, store) {\n  var normalized = normalizeStore(store);\n  try {\n    var _extensionAPI$setting3, _extensionAPI$setting4;\n    extensionAPI === null || extensionAPI === void 0 || (_extensionAPI$setting3 = extensionAPI.settings) === null || _extensionAPI$setting3 === void 0 || (_extensionAPI$setting4 = _extensionAPI$setting3.set) === null || _extensionAPI$setting4 === void 0 || _extensionAPI$setting4.call(_extensionAPI$setting3, SETTINGS_KEY_VIEWS, JSON.stringify(normalized));\n  } catch (_) {\n    // ignore settings failures\n  }\n  return normalized;\n}\nfunction setLastDefaultState(store, dashState) {\n  var next = normalizeStore(store);\n  next.lastDefaultState = normalizeDashState(dashState);\n  next.lastDefaultUpdatedAt = nowMs();\n  return next;\n}\nfunction buildPresetViews() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n    getName = _ref.getName;\n  var nameFor = function nameFor(key, fallback) {\n    try {\n      var v = typeof getName === \"function\" ? getName(key) : null;\n      if (typeof v === \"string\" && v.trim()) return v.trim();\n    } catch (_) {\n      // ignore\n    }\n    return fallback;\n  };\n  var t = nowMs();\n  return [{\n    id: \"bt_preset_next_actions\",\n    name: nameFor(\"nextActions\", \"Next Actions\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"open\"],\n        GTD: [\"next action\"],\n        completedRange: \"any\"\n      },\n      grouping: \"time\",\n      query: \"\"\n    }\n  }, {\n    id: \"bt_preset_waiting_for\",\n    name: nameFor(\"waitingFor\", \"Waiting For\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"open\"],\n        GTD: [\"delegated\"],\n        completedRange: \"any\"\n      },\n      grouping: \"time\",\n      query: \"\"\n    }\n  }, {\n    id: \"bt_preset_completed_7d\",\n    name: nameFor(\"completed7d\", \"Completed (Last 7 Days)\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"completed\"],\n        completedRange: \"7d\"\n      },\n      grouping: \"time\",\n      query: \"\"\n    }\n  }, {\n    id: \"bt_preset_upcoming_7d\",\n    name: nameFor(\"upcoming7d\", \"Upcoming (Next 7 Days)\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"open\"],\n        Due: [\"upcoming\"],\n        completedRange: \"any\",\n        upcomingRange: \"7d\"\n      },\n      grouping: \"time\",\n      query: \"\"\n    }\n  }, {\n    id: \"bt_preset_overdue\",\n    name: nameFor(\"overdue\", \"Overdue\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"open\"],\n        Due: [\"overdue\"],\n        completedRange: \"any\",\n        upcomingRange: \"any\"\n      },\n      grouping: \"time\",\n      query: \"\"\n    }\n  }, {\n    id: \"bt_preset_someday\",\n    name: nameFor(\"someday\", \"Someday / Maybe\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"open\"],\n        GTD: [\"someday\"],\n        completedRange: \"any\"\n      },\n      grouping: \"project\",\n      query: \"\"\n    }\n  }, {\n    id: \"bt_preset_all_open\",\n    name: nameFor(\"allOpen\", \"All Open Tasks\"),\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: {\n      filters: {\n        Completion: [\"open\"],\n        completedRange: \"any\"\n      },\n      grouping: \"time\",\n      query: \"\"\n    }\n  }];\n}\nfunction installPresetDashboardViews(extensionAPI) {\n  var _store$views;\n  var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    _ref2$force = _ref2.force,\n    force = _ref2$force === void 0 ? false : _ref2$force,\n    getName = _ref2.getName;\n  var store = loadViewsStore(extensionAPI);\n  var seedsInstalled = false;\n  try {\n    var _extensionAPI$setting5, _extensionAPI$setting6;\n    var raw = extensionAPI === null || extensionAPI === void 0 || (_extensionAPI$setting5 = extensionAPI.settings) === null || _extensionAPI$setting5 === void 0 || (_extensionAPI$setting6 = _extensionAPI$setting5.get) === null || _extensionAPI$setting6 === void 0 ? void 0 : _extensionAPI$setting6.call(_extensionAPI$setting5, SETTINGS_KEY_SEEDS_INSTALLED);\n    seedsInstalled = raw === true || raw === \"1\" || raw === \"true\";\n  } catch (_) {\n    seedsInstalled = false;\n  }\n  var presets = buildPresetViews({\n    getName: getName\n  }).map(normalizeView).filter(Boolean);\n  var existingById = new Set((store.views || []).map(function (v) {\n    return v.id;\n  }));\n  var existingNames = new Set((store.views || []).map(function (v) {\n    return normalizeNameForCompare(v.name);\n  }));\n  var missingPresetIds = presets.filter(function (preset) {\n    return !existingById.has(preset.id);\n  }).map(function (preset) {\n    return preset.id;\n  });\n  var shouldSeedInitial = !force && !seedsInstalled && (((_store$views = store.views) === null || _store$views === void 0 ? void 0 : _store$views.length) || 0) === 0;\n  var shouldAttempt = force || shouldSeedInitial || missingPresetIds.length > 0;\n  if (!shouldAttempt) {\n    return {\n      store: store,\n      installedIds: [],\n      skippedNameCollisions: [],\n      skippedExistingIds: [],\n      didSave: false\n    };\n  }\n  var toAdd = [];\n  var skippedNameCollisions = [];\n  var skippedExistingIds = [];\n  var _iterator = _createForOfIteratorHelper(presets),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var preset = _step.value;\n      if (existingById.has(preset.id)) {\n        skippedExistingIds.push(preset.id);\n        continue;\n      }\n      var normalizedName = normalizeNameForCompare(preset.name);\n      if (normalizedName && existingNames.has(normalizedName)) {\n        skippedNameCollisions.push(preset.name);\n        continue;\n      }\n      toAdd.push(preset);\n      existingById.add(preset.id);\n      if (normalizedName) existingNames.add(normalizedName);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  if (!toAdd.length) {\n    if (shouldSeedInitial && !seedsInstalled) {\n      try {\n        var _extensionAPI$setting7, _extensionAPI$setting8;\n        extensionAPI === null || extensionAPI === void 0 || (_extensionAPI$setting7 = extensionAPI.settings) === null || _extensionAPI$setting7 === void 0 || (_extensionAPI$setting8 = _extensionAPI$setting7.set) === null || _extensionAPI$setting8 === void 0 || _extensionAPI$setting8.call(_extensionAPI$setting7, SETTINGS_KEY_SEEDS_INSTALLED, \"1\");\n      } catch (_) {\n        // ignore\n      }\n    }\n    return {\n      store: store,\n      installedIds: [],\n      skippedNameCollisions: skippedNameCollisions,\n      skippedExistingIds: skippedExistingIds,\n      didSave: false\n    };\n  }\n  var next = normalizeStore({\n    schema: STORE_SCHEMA,\n    activeViewId: store.activeViewId || null,\n    lastDefaultState: store.lastDefaultState || null,\n    lastDefaultUpdatedAt: store.lastDefaultUpdatedAt || null,\n    views: [].concat(toAdd, _toConsumableArray(store.views || []))\n  });\n  var saved = saveViewsStore(extensionAPI, next);\n  if (shouldSeedInitial && !seedsInstalled) {\n    try {\n      var _extensionAPI$setting9, _extensionAPI$setting0;\n      extensionAPI === null || extensionAPI === void 0 || (_extensionAPI$setting9 = extensionAPI.settings) === null || _extensionAPI$setting9 === void 0 || (_extensionAPI$setting0 = _extensionAPI$setting9.set) === null || _extensionAPI$setting0 === void 0 || _extensionAPI$setting0.call(_extensionAPI$setting9, SETTINGS_KEY_SEEDS_INSTALLED, \"1\");\n    } catch (_) {\n      // ignore\n    }\n  }\n  return {\n    store: saved,\n    installedIds: toAdd.map(function (v) {\n      return v.id;\n    }),\n    skippedNameCollisions: skippedNameCollisions,\n    skippedExistingIds: skippedExistingIds,\n    didSave: true\n  };\n}\nfunction setActiveView(store, idOrNull) {\n  var next = normalizeStore(store);\n  var id = typeof idOrNull === \"string\" ? idOrNull : null;\n  next.activeViewId = id && next.views.some(function (v) {\n    return v.id === id;\n  }) ? id : null;\n  return next;\n}\nfunction createView(store, name, dashState) {\n  var next = normalizeStore(store);\n  var cleanName = typeof name === \"string\" ? name.trim() : \"\";\n  if (!cleanName) return next;\n  var id = generateId();\n  var t = nowMs();\n  var view = {\n    id: id,\n    name: cleanName,\n    createdAt: t,\n    updatedAt: t,\n    schema: VIEW_SCHEMA,\n    state: normalizeDashState(dashState)\n  };\n  next.views = [].concat(_toConsumableArray(next.views), [view]);\n  next.activeViewId = id;\n  return next;\n}\nfunction updateView(store, id, dashState) {\n  var next = normalizeStore(store);\n  var idx = next.views.findIndex(function (v) {\n    return v.id === id;\n  });\n  if (idx === -1) return next;\n  var existing = next.views[idx];\n  var updated = _objectSpread(_objectSpread({}, existing), {}, {\n    updatedAt: nowMs(),\n    schema: VIEW_SCHEMA,\n    state: normalizeDashState(dashState)\n  });\n  next.views = next.views.slice();\n  next.views[idx] = updated;\n  return next;\n}\nfunction renameView(store, id, name) {\n  var next = normalizeStore(store);\n  var idx = next.views.findIndex(function (v) {\n    return v.id === id;\n  });\n  if (idx === -1) return next;\n  var cleanName = typeof name === \"string\" ? name.trim() : \"\";\n  if (!cleanName) return next;\n  var existing = next.views[idx];\n  var updated = _objectSpread(_objectSpread({}, existing), {}, {\n    name: cleanName,\n    updatedAt: nowMs()\n  });\n  next.views = next.views.slice();\n  next.views[idx] = updated;\n  return next;\n}\nfunction deleteView(store, id) {\n  var next = normalizeStore(store);\n  next.views = next.views.filter(function (v) {\n    return v.id !== id;\n  });\n  if (next.activeViewId === id) next.activeViewId = null;\n  if (next.activeViewId && !next.views.some(function (v) {\n    return v.id === next.activeViewId;\n  })) {\n    next.activeViewId = null;\n  }\n  return next;\n}\n\n//# sourceURL=webpack://better-tasks/./src/dashboard/viewsStore.js?\n}");

/***/ },

/***/ "./src/i18n.js"
/*!*********************!*\
  !*** ./src/i18n.js ***!
  \*********************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   i18n: () => (/* binding */ i18n)\n/* harmony export */ });\nvar i18n = {\n  en: {\n    settings: {\n      tabTitle: \"Better Tasks\",\n      enableTodayWidget: \"Enable Today Widget\",\n      enableTodayWidgetDescription: \"Show the Better Tasks Today widget on your daily note page\",\n      todayWidgetLayout: \"Today widget layout\",\n      todayWidgetLayoutDescription: \"Choose how the Today widget appears on your DNP\",\n      todayWidgetLayoutOptions: [\"Panel\", \"Roam-style inline\"],\n      todayWidgetPlacement: \"Today widget placement\",\n      todayWidgetPlacementDescription: \"Place the widget at the top or bottom of the DNP, unless a matching block is found\",\n      todayWidgetIncludeOverdue: \"Include overdue tasks in Today widget\",\n      todayWidgetIncludeOverdueDescription: \"Show tasks with due dates before today\",\n      todayWidgetShowCompleted: \"Show completed tasks in Today widget\",\n      todayWidgetShowCompletedDescription: \"Include completed tasks (hidden by default)\",\n      todayWidgetHeadingLevel: \"Today widget heading level\",\n      todayWidgetHeadingLevelDescription: \"Apply heading styling to the Today widget anchor block\",\n      todayBadgeEnable: \"Enable Today badge\",\n      todayBadgeEnableDescription: \"Show a Today link and badge in the left sidebar\",\n      todayBadgeLabel: \"Today badge label\",\n      todayBadgeLabelDescription: \"Text for the Today badge/link (markdown ignored for matching)\",\n      todayBadgeIncludeOverdue: \"Include overdue in Today badge\",\n      todayBadgeIncludeOverdueDescription: \"Counts overdue tasks in the badge (completed are excluded)\",\n      todayBadgeBg: \"Today badge background\",\n      todayBadgeBgDescription: \"CSS color for the badge background\",\n      todayBadgeFg: \"Today badge text\",\n      todayBadgeFgDescription: \"CSS color for the badge text\",\n      picklistExcludesAdvanced: \"Advanced Project/Context/Waiting options\",\n      picklistExcludesAdvancedDescription: \"Show settings to exclude specific pages from Project/Context/Waiting picklists (roam/* pages are always excluded).\",\n      excludePicklistPages: \"Exclude pages from picklists\",\n      excludePicklistPagesDescription: \"Comma-separated page titles. Wrap titles containing commas (e.g. daily notes) in [[...]]. Values found on these pages will not populate Project/Context/Waiting picklists (useful for Templates/SmartBlocks).\",\n      excludePicklistPagesPlaceholder: \"Templates, SmartBlocks, [[December 18th, 2025]]\",\n      pillThreshold: \"Inline pill checkbox threshold\",\n      pillThresholdDescription: \"Max checkbox count before Better Tasks inline pills skip initial rendering (default 100). Higher values will render but the page may be slower.\",\n      advancedDashboard: \"Advanced Dashboard options\",\n      advancedDashboardDescription: \"Show settings for Weekly Review steps.\",\n      reviewStepDescription: \"Include this step in the Weekly Review flow (order is fixed).\",\n      reviewStepNextActions: \"Weekly Review: Next Actions\",\n      reviewStepWaitingFor: \"Weekly Review: Waiting For\",\n      reviewStepCompleted7d: \"Weekly Review: Completed (Last 7 Days)\",\n      reviewStepUpcoming7d: \"Weekly Review: Upcoming (Next 7 Days)\",\n      reviewStepOverdue: \"Weekly Review: Overdue\",\n      reviewStepSomeday: \"Weekly Review: Someday / Maybe\",\n      destNextTask: \"Destination for next task\",\n      destNextTaskDescription: \"Where to create the next occurrence\",\n      dnpHeading: \"DNP heading\",\n      dnpHeadingDescription: \"Create under this heading on DNP when destination is DNP under heading\",\n      destinationOptions: [\"DNP\", \"Same Page\", \"DNP under heading\"],\n      placementOptions: [\"Top\", \"Bottom\"],\n      headingLevelOptions: [\"None\", \"H1\", \"H2\", \"H3\"],\n      repeatAttr: \"Repeat attribute name\",\n      repeatAttrDescription: \"Label for the recurrence rule attribute\",\n      startAttr: \"Start attribute name\",\n      startAttrDescription: \"Label for start/available date attribute\",\n      deferAttr: \"Defer attribute name\",\n      deferAttrDescription: \"Label for defer/snooze date attribute\",\n      dueAttr: \"Due attribute name\",\n      dueAttrDescription: \"Label for due date attribute\",\n      completedAttr: \"Completed attribute name\",\n      completedAttrDescription: \"Label written when a recurring/scheduled task is completed\",\n      projectAttr: \"Project attribute name\",\n      projectAttrDescription: \"Label for project attribute\",\n      gtdAttr: \"GTD status attribute name\",\n      gtdAttrDescription: \"Label for GTD status attribute\",\n      waitingAttr: \"Waiting-for attribute name\",\n      waitingAttrDescription: \"Label for waiting-for attribute\",\n      contextAttr: \"Context attribute name\",\n      contextAttrDescription: \"Label for context attribute\",\n      priorityAttr: \"Priority attribute name\",\n      priorityAttrDescription: \"Label for priority attribute\",\n      energyAttr: \"Energy attribute name\",\n      energyAttrDescription: \"Label for energy attribute\",\n      confirmBeforeSpawn: \"Confirm before spawning next task\",\n      confirmBeforeSpawnDescription: \"Ask for confirmation before spawning when a repeating Better Task is completed\",\n      weekStart: \"First day of the week\",\n      weekStartDescription: \"Used to align weekly schedules with your graph preference\",\n      weekStartOptions: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n      aiMode: \"AI parsing mode\",\n      aiModeDescription: \"Optional: use your OpenAI API key for AI-assisted task parsing\",\n      aiModeOptions: [\"Off\", \"Use my OpenAI key\"],\n      aiKey: \"OpenAI API key\",\n      aiKeyDescription: \"Sensitive: stored in Roam settings; used client-side only for AI parsing\",\n      language: \"Language\",\n      languageDescription: \"Preferred language for Better Tasks\"\n    },\n    buttons: {\n      save: \"Save\",\n      cancel: \"Cancel\",\n      yes: \"Yes\",\n      no: \"No\",\n      spawnNext: \"Spawn next\",\n      skip: \"Skip\",\n      dueDate: \"Due date\",\n      completionDate: \"Completion date\",\n      close: \"Close\",\n      tryAgain: \"Try again\"\n    },\n    commands: {\n      reinstallPresetDashViews: \"Better Tasks: Reinstall preset dashboard views\",\n      startReview: \"Better Tasks: Weekly Review\",\n      toggleDashboardFullPage: \"Toggle Better Tasks Dashboard (Full page)\"\n    },\n    prompts: {\n      addProject: {\n        title: \"Add Project\",\n        message: \"Enter a project\",\n        placeholder: \"Project name\"\n      },\n      addContext: {\n        title: \"Add Context\",\n        message: \"Enter context\",\n        placeholder: \"Context\"\n      },\n      addWaiting: {\n        title: \"Add Waiting-for\",\n        message: \"Who or what are you waiting for?\",\n        placeholder: \"Waiting for\"\n      },\n      addDate: {\n        title: \"Pick a date\",\n        message: \"Select a date\"\n      },\n      editRepeat: {\n        title: \"Edit Repeat\",\n        message: \"Update repeat rule\",\n        placeholder: \"e.g. every Friday\"\n      },\n      spawnConfirm: {\n        title: \"Better Tasks\",\n        message: \"Spawn next occurrence?\"\n      },\n      schedulingMode: {\n        title: \"Choose scheduling mode\",\n        message: \"Select how to schedule future occurrences.\"\n      },\n      aiParsing: \"Parsing task with AIâ€¦\",\n      parseUnavailable: \"AI parsing unavailable, creating a normal Better Task instead.\",\n      cannotParseDue: \"Could not parse the task due date. Please ensure it uses Roam's standard date format (e.g. [[November 8th, 2025]]).\",\n      cannotParseRepeat: \"Unable to understand that repeat rule.\",\n      enterTaskText: \"Enter some task text.\",\n      addRepeatOrDate: \"Add a repeat rule or at least one start/defer/due date.\",\n      form: {\n        taskLabel: \"Task *\",\n        taskPlaceholder: \"Task text\",\n        repeatLabel: \"Repeat\",\n        repeatPlaceholder: \"Repeat rule (optional)\",\n        startLabel: \"Start\",\n        deferLabel: \"Defer\",\n        dueLabel: \"Due\",\n        projectLabel: \"Project\",\n        projectPlaceholder: \"Project\",\n        gtdLabel: \"GTD status\",\n        gtdOptions: {\n          \"next action\": \"Next Action\",\n          delegated: \"Delegated\",\n          deferred: \"Deferred\",\n          someday: \"Someday\"\n        },\n        waitingLabel: \"Waiting-for\",\n        waitingPlaceholder: \"Waiting-for\",\n        priorityLabel: \"Priority\",\n        priorityOptions: {\n          low: \"Low\",\n          medium: \"Medium\",\n          high: \"High\"\n        },\n        energyLabel: \"Energy\",\n        energyOptions: {\n          low: \"Low\",\n          medium: \"Medium\",\n          high: \"High\"\n        },\n        contextLabel: \"Context(s)\",\n        contextPlaceholder: \"@home, @work\",\n        messageWithTask: \"Enter the task text, optional repeat rule, dates, and metadata.\",\n        messageWithoutTask: \"Enter an optional repeat rule, dates, and metadata.\"\n      }\n    },\n    projectPicker: {\n      title: \"Select project\",\n      placeholder: \"Search or create a project\",\n      noProjects: \"No projects yet â€” type to create one\",\n      button: \"Browse\"\n    },\n    waitingPicker: {\n      title: \"Select waiting-for\",\n      placeholder: \"Search or create\",\n      noItems: \"No waiting-for entries yet â€” type to create one\"\n    },\n    contextPicker: {\n      title: \"Select context(s)\",\n      placeholder: \"Search or create\",\n      noItems: \"No contexts yet â€” type to create one\"\n    },\n    toasts: {\n      createdRecurring: \"Created your Better Task\",\n      createdScheduled: \"Created your Better Task\",\n      addedMetadata: \"Added metadata\",\n      repeatCopied: \"Repeat copied\",\n      repeatUpdated: \"Repeat \\u2192 {{value}}\",\n      nextOccurrenceTo: \"Next occurrence \\u2192 [[{{date}}]]\",\n      cannotParseDate: \"Couldn't parse that date.\",\n      enterText: \"Enter some task text.\",\n      removeAttrRepeat: \"Repeat rule removed\",\n      removeAttrStart: \"Start date removed\",\n      removeAttrDefer: \"Defer date removed\",\n      removeAttrDue: \"Due date removed\",\n      undoSuccess: \"Changes undone successfully\",\n      spawnConfirmTitle: \"Better Tasks\",\n      spawnConfirmMessage: \"Spawn next occurrence?\",\n      aiFallback: \"AI parsing unavailable, falling back to manual entry.\",\n      addRepeatOrDate: \"Add a repeat rule or at least one start/defer/due date.\",\n      addRepeatDateOrMetadata: \"Add a repeat rule, a date, or metadata.\",\n      completionCancelled: \"Better Task completion cancelled.\",\n      computeNextFailed: \"Could not compute the next occurrence.\",\n      couldNotParseRecurrence: \"Could not parse the task recurrence pattern. Please check your task and review the README for supported patterns.\",\n      snoozeFailed: \"Could not snooze task.\",\n      metadataUpdateFailed: \"Could not update metadata.\",\n      aiCreateFailed: \"Couldn't create task from AI result; try manual.\",\n      createInputFailed: \"Couldn't create task from input.\",\n      pageNotFound: \"Couldn't find a page to create that task.\",\n      cannotParseDefer: \"Couldn't parse that defer date.\",\n      cannotParseDue: \"Couldn't parse that due date.\",\n      cannotParseStart: \"Couldn't parse that start date.\",\n      createdWithAi: \"Created Better Task with AI parsing\",\n      noRepeatFound: \"No repeat rule found.\",\n      noRepeatToSkip: \"No repeat rule to skip.\",\n      noSeriesHistory: \"No series history available.\",\n      openSettings: \"Open the Roam Depot settings for Better Tasks to adjust options.\",\n      placeCursorCreate: \"Place the cursor in the block where you wish to create the Better Task.\",\n      placeCursorTodo: \"Place the cursor in the block where you wish to create the Better Task.\",\n      placeCursorConvert: \"Place the cursor in the block you wish to convert.\",\n      taskTextRequired: \"Task text is required.\",\n      unableReadBlock: \"Unable to read the current block.\",\n      unableRemoveAttr: \"Unable to remove that attribute.\",\n      unableUnderstandRepeat: \"Unable to understand that repeat rule.\",\n      unableUpdateTask: \"Unable to update task.\",\n      dashViewsOpenToSwitch: \"Open Better Tasks Dashboard to switch views.\",\n      dashViewsNoSaved: \"No saved views.\",\n      dashViewsSwitchFailed: \"Unable to switch view.\",\n      dashViewsOpenToSave: \"Open Better Tasks Dashboard to save views.\",\n      dashViewsReadStateFailed: \"Unable to read dashboard state. Try reopening the dashboard.\",\n      dashViewsSaveFailed: \"Unable to save view.\",\n      dashViewsPresetInstalled: \"Preset dashboard views installed.\",\n      dashViewsPresetNothingToInstall: \"All preset dashboard views are already present.\",\n      dashViewsPresetNameCollisions: \"Skipped presets due to name conflicts:\",\n      dashViewsPresetInstallFailed: \"Unable to reinstall preset dashboard views.\",\n      dashReviewNoPresets: \"No review presets found.\",\n      dashReviewStartFailed: \"Unable to start weekly review.\"\n    },\n    dashboard: {\n      topbarTitle: \"Better Tasks Dashboard\",\n      title: \"Better Tasks\",\n      subtitle: \"Comprehensive task management in Roam Research.\",\n      refresh: \"Refresh\",\n      close: \"Close\",\n      fullPage: {\n        enter: \"Expand\",\n        exit: \"Exit full page\"\n      },\n      groupByLabel: \"Group by\",\n      review: {\n        button: \"Weekly Review\",\n        label: \"Weekly Review\",\n        of: \"of\",\n        back: \"â† Back\",\n        next: \"Next â†’\",\n        exit: \"Exit\"\n      },\n      views: {\n        label: \"Saved Views\",\n        \"default\": \"Default\",\n        saveAs: \"Save asâ€¦\",\n        update: \"Update\",\n        options: \"View options\",\n        rename: \"Renameâ€¦\",\n        \"delete\": \"Delete\",\n        prompts: {\n          saveAsMessage: \"Save current view as\",\n          renameMessage: \"Rename view\",\n          namePlaceholder: \"View name\"\n        },\n        confirms: {\n          overwrite: function overwrite(name) {\n            return \"Overwrite view \\\"\".concat(name, \"\\\"?\");\n          },\n          \"delete\": function _delete(name) {\n            return \"Delete view \\\"\".concat(name, \"\\\"?\");\n          }\n        }\n      },\n      viewsPresets: {\n        nextActions: \"Next Actions\",\n        waitingFor: \"Waiting For\",\n        completed7d: \"Completed (Last 7 Days)\",\n        upcoming7d: \"Upcoming (Next 7 Days)\",\n        overdue: \"Overdue\",\n        someday: \"Someday / Maybe\",\n        allOpen: \"All Open Tasks\"\n      },\n      quickAddPlaceholder: \"Add a Better Task\",\n      quickAddButton: \"OK\",\n      searchPlaceholder: \"Search Better Tasks\",\n      groupingOptions: {\n        time: \"By Time\",\n        page: \"By Page\",\n        recurrence: \"By Recurrence\"\n      },\n      filtersLabel: \"Filters\",\n      filters: {\n        show: \"Show filters\",\n        hide: \"Hide filters\",\n        tagsLabel: \"Tags\",\n        groups: {\n          status: \"Status\",\n          dates: \"Dates\",\n          gtd: \"GTD\",\n          meta: \"Meta\"\n        }\n      },\n      empty: {\n        loading: \"Loading tasksâ€¦\",\n        error: \"Couldnâ€™t load tasks.\",\n        retry: \"Try again\",\n        noMatch: \"No tasks match the selected filters.\"\n      },\n      filterSections: {\n        Recurrence: \"Recurrence\",\n        Start: \"Start\",\n        Defer: \"Defer\",\n        Due: \"Due\",\n        Completion: \"Completion\",\n        Priority: \"Priority\",\n        Energy: \"Energy\",\n        GTD: \"GTD\"\n      },\n      filterValues: {\n        recurring: \"Recurring\",\n        \"one-off\": \"One-off\",\n        \"not-started\": \"Not Started\",\n        started: \"Started\",\n        deferred: \"Deferred\",\n        available: \"Available\",\n        overdue: \"Overdue\",\n        today: \"Today\",\n        upcoming: \"Upcoming\",\n        none: \"No Due\",\n        open: \"Open\",\n        completed: \"Completed\",\n        high: \"High\",\n        medium: \"Medium\",\n        low: \"Low\",\n        \"next action\": \"Next action\",\n        delegated: \"Delegated\",\n        someday: \"Someday\"\n      },\n      completedWithinLabel: \"Completed within\",\n      completedWithinOptions: {\n        any: \"Any time\",\n        \"7d\": \"Last 7 days\",\n        \"30d\": \"Last 30 days\",\n        \"90d\": \"Last 90 days\"\n      },\n      upcomingWithinLabel: \"Upcoming within\",\n      upcomingWithinOptions: {\n        any: \"Any time\",\n        \"7d\": \"Next 7 days\",\n        \"30d\": \"Next 30 days\",\n        \"90d\": \"Next 90 days\"\n      },\n      groupLabels: {\n        overdue: \"Overdue\",\n        today: \"Today\",\n        upcoming: \"Upcoming\",\n        none: \"No Due Date\",\n        recurring: \"Recurring\",\n        \"one-off\": \"One-off\",\n        completed: \"Completed\",\n        noProject: \"No Project\"\n      },\n      metaPills: {\n        priority: \"Priority\",\n        energy: \"Energy\",\n        gtd: \"GTD\",\n        project: \"Project\",\n        waitingFor: \"Waiting for\",\n        context: \"Context\"\n      },\n      projectFilterLabel: \"Project\",\n      projectFilterPlaceholder: \"Project name\",\n      projectFilterAny: \"All projects\",\n      waitingFilterLabel: \"Waiting for\",\n      waitingFilterPlaceholder: \"Waiting for\",\n      waitingFilterAny: \"All waiting-for\",\n      contextFilterLabel: \"Context\",\n      contextFilterAny: \"All contexts\",\n      groupingLabels: {\n        time: \"Time\",\n        recurrence: \"Recurrence\",\n        project: \"Project\"\n      },\n      taskOptions: \"Task options\",\n      markDone: \"Mark as done\",\n      markOpen: \"Mark as open\",\n      view: \"View\",\n      snoozePick: \"Pick\",\n      snoozePlus1: \"+1d\",\n      snoozePlus7: \"+7d\",\n      untitled: \"(Untitled task)\",\n      bulk: {\n        select: \"Bulk\",\n        selectTask: \"Select\",\n        deselectTask: \"Deselect\",\n        selectAll: \"Select All\",\n        selectNone: \"Clear\",\n        selected: function selected(n) {\n          return \"\".concat(n, \" selected\");\n        },\n        selectGroup: function selectGroup(title) {\n          return \"Select all in \".concat(title);\n        },\n        deselectGroup: function deselectGroup(title) {\n          return \"Deselect all in \".concat(title);\n        },\n        complete: \"Complete\",\n        reopen: \"Reopen\",\n        snooze1d: \"+1d\",\n        snooze7d: \"+7d\",\n        setMetadata: \"Set...\",\n        cancel: \"Cancel\",\n        completedCount: function completedCount(n) {\n          return \"Completed \".concat(n, \" task\").concat(n === 1 ? \"\" : \"s\");\n        },\n        reopenedCount: function reopenedCount(n) {\n          return \"Reopened \".concat(n, \" task\").concat(n === 1 ? \"\" : \"s\");\n        },\n        snoozedCount: function snoozedCount(n, days) {\n          return \"Snoozed \".concat(n, \" task\").concat(n === 1 ? \"\" : \"s\", \" by \").concat(days, \" day\").concat(days === 1 ? \"\" : \"s\");\n        },\n        updatedCount: function updatedCount(field, n) {\n          return \"Updated \".concat(field, \" on \").concat(n, \" task\").concat(n === 1 ? \"\" : \"s\");\n        },\n        fieldLabels: {\n          project: \"Project\",\n          waitingFor: \"Waiting for\",\n          context: \"Context\",\n          priority: \"Priority\",\n          energy: \"Energy\",\n          gtd: \"GTD\"\n        },\n        metaValues: {\n          priorityHigh: \"High\",\n          priorityMedium: \"Medium\",\n          priorityLow: \"Low\",\n          energyHigh: \"High\",\n          energyMedium: \"Medium\",\n          energyLow: \"Low\",\n          gtdNext: \"Next action\",\n          gtdDelegated: \"Delegated\",\n          gtdDeferred: \"Deferred\",\n          gtdSomeday: \"Someday\",\n          clear: \"Clear\"\n        },\n        undo: \"Undo\",\n        undoSuccess: \"Changes undone\",\n        undoFailed: \"Undo failed\"\n      }\n    },\n    today: {\n      title: \"Better Tasks - Today\",\n      starting: \"Starting Today\",\n      deferred: \"Deferred Until Today\",\n      due: \"Due Today\",\n      overdue: function overdue(n) {\n        return \"Overdue (\".concat(n, \")\");\n      },\n      empty: \"No tasks for today.\",\n      complete: \"Complete\",\n      snoozeShort: \"Snooze +1d\",\n      untitled: \"(Untitled)\"\n    },\n    pillMenu: {\n      moreActions: \"More task actions\",\n      snoozePlus1: \"Snooze +1 day\",\n      snoozePlus3: \"Snooze +3 days\",\n      snoozeNextMon: \"Snooze to next Monday\",\n      snoozePick: \"Snooze (pick date)\",\n      skipOccurrence: \"Skip this occurrence\",\n      generateNext: \"Generate next now\",\n      endRecurrence: \"End recurrence\",\n      addProject: \"Add project\",\n      removeProject: \"Remove project\",\n      addContext: \"Add context\",\n      removeContext: \"Remove context\",\n      addWaiting: \"Add waiting-for\",\n      removeWaiting: \"Remove waiting-for\",\n      cyclePriority: \"Cycle priority\",\n      cycleEnergy: \"Cycle energy\",\n      cycleGtd: \"Cycle GTD\",\n      metaHeading: \"Metadata\"\n    },\n    taskMenu: {\n      setProject: \"Set project\",\n      editProject: \"Edit project\",\n      removeProject: \"Remove project\",\n      setContext: \"Set context\",\n      editContext: \"Edit context\",\n      removeContext: \"Remove context\",\n      setWaiting: \"Set waiting-for\",\n      editWaiting: \"Edit waiting-for\",\n      removeWaiting: \"Remove waiting-for\",\n      priorityCycle: \"Priority (click to cycle)\",\n      energyCycle: \"Energy (click to cycle)\",\n      cycleGtd: \"Cycle GTD\",\n      metaHeading: \"Metadata\"\n    },\n    metadata: {\n      repeat: \"Repeat\",\n      project: \"Project\",\n      waitingFor: \"Waiting for\",\n      context: \"Context\",\n      gtd: \"GTD\",\n      priority: \"Priority\",\n      energy: \"Energy\",\n      start: \"Start\",\n      defer: \"Defer\",\n      due: \"Due\",\n      next: \"Next\",\n      repeatingTask: \"Repeating Better Task\",\n      scheduledTask: \"Scheduled Better Task\",\n      loadingTheme: \"Loading themeâ€¦\",\n      applyTheme: \"Applying themeâ€¦\",\n      themeChanged: \"Detected change to themes. Reloading page to apply changes.\",\n      repeatRule: \"Repeat rule\",\n      projectLabel: \"Project\",\n      waitingLabel: \"Waiting for\",\n      contextLabel: \"Context\",\n      priorityLabel: \"Priority\",\n      energyLabel: \"Energy\",\n      gtdLabel: \"GTD\"\n    }\n  },\n  // -----------------------------\n  // Simplified Chinese\n  // -----------------------------\n  zh: {\n    settings: {\n      tabTitle: \"Better Tasks\",\n      enableTodayWidget: \"å¯ç”¨ä»Šæ—¥å°ç»„ä»¶\",\n      enableTodayWidgetDescription: \"åœ¨æ¯æ—¥ç¬”è®°é¡µæ˜¾ç¤º Better Tasks ä»Šæ—¥å°ç»„ä»¶\",\n      todayWidgetLayout: \"ä»Šæ—¥å°ç»„ä»¶å¸ƒå±€\",\n      todayWidgetLayoutDescription: \"é€‰æ‹©ä»Šæ—¥å°ç»„ä»¶çš„æ˜¾ç¤ºæ–¹å¼\",\n      todayWidgetLayoutOptions: [\"é¢æ¿\", \"ç±» Roam å†…è”\"],\n      todayWidgetPlacement: \"ä»Šæ—¥å°ç»„ä»¶ä½ç½®\",\n      todayWidgetPlacementDescription: \"å°†å°ç»„ä»¶æ”¾åœ¨ DNP é¡¶éƒ¨æˆ–åº•éƒ¨ï¼Œé™¤éžæ‰¾åˆ°åŒ¹é…çš„å—\",\n      todayWidgetIncludeOverdue: \"åœ¨ä»Šæ—¥å°ç»„ä»¶ä¸­åŒ…å«é€¾æœŸä»»åŠ¡\",\n      todayWidgetIncludeOverdueDescription: \"æ˜¾ç¤ºåˆ°æœŸæ—¥åœ¨ä»Šå¤©ä¹‹å‰çš„ä»»åŠ¡\",\n      todayWidgetShowCompleted: \"åœ¨ä»Šæ—¥å°ç»„ä»¶ä¸­æ˜¾ç¤ºå·²å®Œæˆä»»åŠ¡\",\n      todayWidgetShowCompletedDescription: \"åŒ…å«å·²å®Œæˆä»»åŠ¡ï¼ˆé»˜è®¤éšè—ï¼‰\",\n      todayWidgetHeadingLevel: \"ä»Šæ—¥å°ç»„ä»¶æ ‡é¢˜çº§åˆ«\",\n      todayWidgetHeadingLevelDescription: \"ä¸ºä»Šæ—¥å°ç»„ä»¶é”šç‚¹åº”ç”¨æ ‡é¢˜æ ·å¼\",\n      todayBadgeEnable: \"å¯ç”¨ Today å¾½ç« \",\n      todayBadgeEnableDescription: \"åœ¨å·¦ä¾§è¾¹æ æ˜¾ç¤º Today é“¾æŽ¥å’Œå¾½ç« \",\n      todayBadgeLabel: \"Today å¾½ç« æ ‡ç­¾\",\n      todayBadgeLabelDescription: \"Today å¾½ç« /é“¾æŽ¥çš„æ–‡æœ¬ï¼ˆåŒ¹é…æ—¶å¿½ç•¥ Markdownï¼‰\",\n      todayBadgeIncludeOverdue: \"å¾½ç« è®¡æ•°åŒ…å«é€¾æœŸä»»åŠ¡\",\n      todayBadgeIncludeOverdueDescription: \"å¾½ç« è®¡æ•°åŒ…å«é€¾æœŸä»»åŠ¡ï¼ˆå·²å®Œæˆä¸è®¡å…¥ï¼‰\",\n      todayBadgeBg: \"Today å¾½ç« èƒŒæ™¯è‰²\",\n      todayBadgeBgDescription: \"å¾½ç« èƒŒæ™¯çš„ CSS é¢œè‰²\",\n      todayBadgeFg: \"Today å¾½ç« æ–‡å­—é¢œè‰²\",\n      todayBadgeFgDescription: \"å¾½ç« æ–‡å­—çš„ CSS é¢œè‰²\",\n      picklistExcludesAdvanced: \"é¡¹ç›®/æƒ…å¢ƒ/ç­‰å¾…åˆ—è¡¨é«˜çº§é€‰é¡¹\",\n      picklistExcludesAdvancedDescription: \"æ˜¾ç¤ºç”¨äºŽä»Žé¡¹ç›®/æƒ…å¢ƒ/ç­‰å¾…åˆ—è¡¨ä¸­æŽ’é™¤ç‰¹å®šé¡µé¢çš„è®¾ç½®ï¼ˆå§‹ç»ˆæŽ’é™¤ roam/* é¡µé¢ï¼‰ã€‚\",\n      excludePicklistPages: \"ä»Žåˆ—è¡¨ä¸­æŽ’é™¤é¡µé¢\",\n      excludePicklistPagesDescription: \"ä»¥é€—å·åˆ†éš”çš„é¡µé¢æ ‡é¢˜ã€‚è‹¥æ ‡é¢˜åŒ…å«é€—å·ï¼ˆä¾‹å¦‚æ¯æ—¥ç¬”è®°ï¼‰ï¼Œè¯·ç”¨ [[...]] åŒ…è£¹ã€‚è¿™äº›é¡µé¢ä¸­çš„å€¼ä¸ä¼šå‡ºçŽ°åœ¨é¡¹ç›®/æƒ…å¢ƒ/ç­‰å¾…åˆ—è¡¨ä¸­ï¼ˆé€‚ç”¨äºŽæ¨¡æ¿/SmartBlocksï¼‰ã€‚\",\n      excludePicklistPagesPlaceholder: \"Templates, SmartBlocks, [[December 18th, 2025]]\",\n      pillThreshold: \"å†…è”å¾½æ ‡å¤é€‰æ¡†é˜ˆå€¼\",\n      pillThresholdDescription: \"å½“å¤é€‰æ¡†æ•°é‡è¶…è¿‡æ­¤å€¼æ—¶ï¼Œå†…è”å¾½æ ‡å°†è·³è¿‡åˆå§‹æ¸²æŸ“ï¼ˆé»˜è®¤ 100ï¼‰ã€‚æ›´é«˜çš„å€¼ä¼šæ¸²æŸ“ä½†å¯èƒ½ä½¿é¡µé¢å˜æ…¢ã€‚\",\n      advancedDashboard: \"ä»ªè¡¨æ¿é«˜çº§é€‰é¡¹\",\n      advancedDashboardDescription: \"æ˜¾ç¤ºæ¯å‘¨å¤ç›˜æ­¥éª¤çš„è®¾ç½®ã€‚\",\n      reviewStepDescription: \"å°†æ­¤æ­¥éª¤åŒ…å«åœ¨æ¯å‘¨å¤ç›˜æµç¨‹ä¸­ï¼ˆé¡ºåºå›ºå®šï¼‰ã€‚\",\n      reviewStepNextActions: \"æ¯å‘¨å¤ç›˜ï¼šä¸‹ä¸€æ­¥è¡ŒåŠ¨\",\n      reviewStepWaitingFor: \"æ¯å‘¨å¤ç›˜ï¼šç­‰å¾…ä¸­\",\n      reviewStepCompleted7d: \"æ¯å‘¨å¤ç›˜ï¼šå·²å®Œæˆï¼ˆæœ€è¿‘ 7 å¤©ï¼‰\",\n      reviewStepUpcoming7d: \"æ¯å‘¨å¤ç›˜ï¼šå³å°†åˆ°æœŸï¼ˆæœªæ¥ 7 å¤©ï¼‰\",\n      reviewStepOverdue: \"æ¯å‘¨å¤ç›˜ï¼šé€¾æœŸ\",\n      reviewStepSomeday: \"æ¯å‘¨å¤ç›˜ï¼šä¹Ÿè®¸ / æŸå¤©\",\n      destNextTask: \"ä¸‹ä¸€ä¸ªä»»åŠ¡çš„ä½ç½®\",\n      destNextTaskDescription: \"åœ¨å“ªé‡Œåˆ›å»ºä¸‹ä¸€æ¬¡å‡ºçŽ°\",\n      dnpHeading: \"DNP æ ‡é¢˜\",\n      dnpHeadingDescription: \"å½“ä½ç½®ä¸º DNP ä¸‹çš„æ ‡é¢˜æ—¶ï¼Œåœ¨æ­¤æ ‡é¢˜ä¸‹åˆ›å»º\",\n      destinationOptions: [\"DNP\", \"åŒä¸€é¡µé¢\", \"DNP ä¸‹çš„æ ‡é¢˜\"],\n      placementOptions: [\"é¡¶éƒ¨\", \"åº•éƒ¨\"],\n      headingLevelOptions: [\"æ— \", \"H1\", \"H2\", \"H3\"],\n      repeatAttr: \"é‡å¤å±žæ€§åç§°\",\n      repeatAttrDescription: \"é‡å¤è§„åˆ™å±žæ€§çš„æ ‡ç­¾\",\n      startAttr: \"å¼€å§‹æ—¥æœŸå±žæ€§åç§°\",\n      startAttrDescription: \"å¼€å§‹/å¯ç”¨æ—¥æœŸå±žæ€§çš„æ ‡ç­¾\",\n      deferAttr: \"å»¶æœŸæ—¥æœŸå±žæ€§åç§°\",\n      deferAttrDescription: \"å»¶æœŸ/æç½®æ—¥æœŸå±žæ€§çš„æ ‡ç­¾\",\n      dueAttr: \"æˆªæ­¢æ—¥æœŸå±žæ€§åç§°\",\n      dueAttrDescription: \"æˆªæ­¢æ—¥æœŸå±žæ€§çš„æ ‡ç­¾\",\n      completedAttr: \"å®Œæˆå±žæ€§åç§°\",\n      completedAttrDescription: \"å®Œæˆé‡å¤/è®¡åˆ’ä»»åŠ¡æ—¶å†™å…¥çš„æ ‡ç­¾\",\n      projectAttr: \"é¡¹ç›®å±žæ€§åç§°\",\n      projectAttrDescription: \"é¡¹ç›®å±žæ€§çš„æ ‡ç­¾\",\n      gtdAttr: \"GTD çŠ¶æ€å±žæ€§åç§°\",\n      gtdAttrDescription: \"GTD çŠ¶æ€å±žæ€§çš„æ ‡ç­¾\",\n      waitingAttr: \"ç­‰å¾…å¯¹è±¡å±žæ€§åç§°\",\n      waitingAttrDescription: \"ç­‰å¾…å¯¹è±¡å±žæ€§çš„æ ‡ç­¾\",\n      contextAttr: \"æƒ…å¢ƒå±žæ€§åç§°\",\n      contextAttrDescription: \"æƒ…å¢ƒå±žæ€§çš„æ ‡ç­¾\",\n      priorityAttr: \"ä¼˜å…ˆçº§å±žæ€§åç§°\",\n      priorityAttrDescription: \"ä¼˜å…ˆçº§å±žæ€§çš„æ ‡ç­¾\",\n      energyAttr: \"ç²¾åŠ›å±žæ€§åç§°\",\n      energyAttrDescription: \"ç²¾åŠ›å±žæ€§çš„æ ‡ç­¾\",\n      confirmBeforeSpawn: \"ç”Ÿæˆä¸‹ä¸€ä¸ªä»»åŠ¡å‰éœ€è¦ç¡®è®¤\",\n      confirmBeforeSpawnDescription: \"åœ¨é‡å¤ä»»åŠ¡å®Œæˆæ—¶ç”Ÿæˆä¸‹ä¸€æ¬¡å‰æç¤ºç¡®è®¤\",\n      weekStart: \"æ¯å‘¨çš„ç¬¬ä¸€å¤©\",\n      weekStartDescription: \"ç”¨äºŽæ ¹æ®ä½ çš„ Roam å›¾åå¥½å¯¹é½æ¯å‘¨å®‰æŽ’\",\n      weekStartOptions: [\"æ˜ŸæœŸæ—¥\", \"æ˜ŸæœŸä¸€\", \"æ˜ŸæœŸäºŒ\", \"æ˜ŸæœŸä¸‰\", \"æ˜ŸæœŸå››\", \"æ˜ŸæœŸäº”\", \"æ˜ŸæœŸå…­\"],\n      aiMode: \"AI è§£æžæ¨¡å¼\",\n      aiModeDescription: \"å¯é€‰ï¼šä½¿ç”¨ä½ çš„ OpenAI API å¯†é’¥è¿›è¡Œ AI è¾…åŠ©è§£æž\",\n      aiModeOptions: [\"å…³é—­\", \"ä½¿ç”¨æˆ‘çš„ OpenAI å¯†é’¥\"],\n      aiKey: \"OpenAI API å¯†é’¥\",\n      aiKeyDescription: \"æ•æ„Ÿï¼šå­˜å‚¨äºŽ Roam è®¾ç½®ï¼Œä»…å®¢æˆ·ç«¯ç”¨äºŽ AI è§£æž\",\n      language: \"è¯­è¨€\",\n      languageDescription: \"Better Tasks çš„é¦–é€‰è¯­è¨€\"\n    },\n    buttons: {\n      save: \"ä¿å­˜\",\n      cancel: \"å–æ¶ˆ\",\n      yes: \"æ˜¯\",\n      no: \"å¦\",\n      spawnNext: \"ç”Ÿæˆä¸‹ä¸€ä¸ª\",\n      skip: \"è·³è¿‡\",\n      dueDate: \"æˆªæ­¢æ—¥æœŸ\",\n      completionDate: \"å®Œæˆæ—¥æœŸ\",\n      close: \"å…³é—­\",\n      tryAgain: \"é‡è¯•\"\n    },\n    commands: {\n      reinstallPresetDashViews: \"Better Tasksï¼šé‡æ–°å®‰è£…ä»ªè¡¨æ¿é¢„è®¾è§†å›¾\",\n      startReview: \"Better Tasksï¼šæ¯å‘¨å¤ç›˜\",\n      toggleDashboardFullPage: \"åˆ‡æ¢ Better Tasks ä»ªè¡¨æ¿ï¼ˆå…¨é¡µï¼‰\"\n    },\n    prompts: {\n      addProject: {\n        title: \"æ·»åŠ é¡¹ç›®\",\n        message: \"è¾“å…¥é¡¹ç›®åç§°\",\n        placeholder: \"é¡¹ç›®åç§°\"\n      },\n      addContext: {\n        title: \"æ·»åŠ æƒ…å¢ƒ\",\n        message: \"è¾“å…¥æƒ…å¢ƒ\",\n        placeholder: \"æƒ…å¢ƒ\"\n      },\n      addWaiting: {\n        title: \"æ·»åŠ ç­‰å¾…å¯¹è±¡\",\n        message: \"ä½ åœ¨ç­‰å¾…è°æˆ–ä»€ä¹ˆï¼Ÿ\",\n        placeholder: \"ç­‰å¾…å¯¹è±¡\"\n      },\n      addDate: {\n        title: \"é€‰æ‹©æ—¥æœŸ\",\n        message: \"è¯·é€‰æ‹©æ—¥æœŸ\"\n      },\n      editRepeat: {\n        title: \"ç¼–è¾‘é‡å¤è§„åˆ™\",\n        message: \"æ›´æ–°é‡å¤è§„åˆ™\",\n        placeholder: \"ä¾‹å¦‚ï¼šæ¯å‘¨äº”\"\n      },\n      spawnConfirm: {\n        title: \"Better Tasks\",\n        message: \"ç”Ÿæˆä¸‹ä¸€æ¬¡ä»»åŠ¡ï¼Ÿ\"\n      },\n      schedulingMode: {\n        title: \"é€‰æ‹©è°ƒåº¦æ¨¡å¼\",\n        message: \"è¯·é€‰æ‹©æœªæ¥ä»»åŠ¡çš„è°ƒåº¦æ–¹å¼ã€‚\"\n      },\n      aiParsing: \"æ­£åœ¨ä½¿ç”¨ AI è§£æžä»»åŠ¡â€¦\",\n      parseUnavailable: \"AI è§£æžä¸å¯ç”¨ï¼Œå°†åˆ›å»ºæ™®é€š Better Taskã€‚\",\n      cannotParseDue: \"æ— æ³•è§£æžæˆªæ­¢æ—¥æœŸã€‚è¯·ç¡®ä¿ä½¿ç”¨ Roam çš„æ ‡å‡†æ—¥æœŸæ ¼å¼ï¼ˆä¾‹å¦‚ [[2025å¹´11æœˆ8æ—¥]]ï¼‰ã€‚\",\n      cannotParseRepeat: \"æ— æ³•ç†è§£è¯¥é‡å¤è§„åˆ™ã€‚\",\n      enterTaskText: \"è¯·è¾“å…¥ä»»åŠ¡æ–‡æœ¬ã€‚\",\n      addRepeatOrDate: \"è¯·æ·»åŠ é‡å¤è§„åˆ™æˆ–è‡³å°‘ä¸€ä¸ªå¼€å§‹ï¼å»¶æœŸï¼æˆªæ­¢æ—¥æœŸã€‚\",\n      form: {\n        taskLabel: \"ä»»åŠ¡ *\",\n        taskPlaceholder: \"ä»»åŠ¡æ–‡æœ¬\",\n        repeatLabel: \"é‡å¤\",\n        repeatPlaceholder: \"é‡å¤è§„åˆ™ï¼ˆå¯é€‰ï¼‰\",\n        startLabel: \"å¼€å§‹\",\n        deferLabel: \"å»¶æœŸ\",\n        dueLabel: \"æˆªæ­¢\",\n        projectLabel: \"é¡¹ç›®\",\n        projectPlaceholder: \"é¡¹ç›®\",\n        gtdLabel: \"GTD çŠ¶æ€\",\n        gtdOptions: {\n          \"next action\": \"ä¸‹ä¸€æ­¥è¡ŒåŠ¨\",\n          delegated: \"å·²å§”æ´¾\",\n          deferred: \"å·²å»¶æœŸ\",\n          someday: \"æŸå¤©\"\n        },\n        waitingLabel: \"ç­‰å¾…å¯¹è±¡\",\n        waitingPlaceholder: \"ç­‰å¾…å¯¹è±¡\",\n        priorityLabel: \"ä¼˜å…ˆçº§\",\n        priorityOptions: {\n          low: \"ä½Ž\",\n          medium: \"ä¸­\",\n          high: \"é«˜\"\n        },\n        energyLabel: \"ç²¾åŠ›\",\n        energyOptions: {\n          low: \"ä½Ž\",\n          medium: \"ä¸­\",\n          high: \"é«˜\"\n        },\n        contextLabel: \"æƒ…å¢ƒï¼ˆå¯å¤šé€‰ï¼‰\",\n        contextPlaceholder: \"@home, @work\",\n        messageWithTask: \"è¯·è¾“å…¥ä»»åŠ¡æ–‡æœ¬ã€å¯é€‰é‡å¤è§„åˆ™ã€æ—¥æœŸå’Œå…ƒæ•°æ®ã€‚\",\n        messageWithoutTask: \"è¯·è¾“å…¥å¯é€‰çš„é‡å¤è§„åˆ™ã€æ—¥æœŸå’Œå…ƒæ•°æ®ã€‚\"\n      }\n    },\n    projectPicker: {\n      title: \"é€‰æ‹©é¡¹ç›®\",\n      placeholder: \"æœç´¢æˆ–åˆ›å»ºé¡¹ç›®\",\n      noProjects: \"å°šæ— é¡¹ç›®ï¼Œè¯·è¾“å…¥ä»¥åˆ›å»º\",\n      button: \"æµè§ˆ\"\n    },\n    waitingPicker: {\n      title: \"é€‰æ‹©ç­‰å¾…å¯¹è±¡\",\n      placeholder: \"æœç´¢æˆ–åˆ›å»º\",\n      noItems: \"æš‚æ— ç­‰å¾…å¯¹è±¡ï¼Œå¯è¾“å…¥åˆ›å»º\"\n    },\n    contextPicker: {\n      title: \"é€‰æ‹©æƒ…å¢ƒ\",\n      placeholder: \"æœç´¢æˆ–åˆ›å»º\",\n      noItems: \"æš‚æ— æƒ…å¢ƒï¼Œå¯è¾“å…¥åˆ›å»º\"\n    },\n    toasts: {\n      createdRecurring: \"å·²åˆ›å»º Better Task\",\n      createdScheduled: \"å·²åˆ›å»º Better Task\",\n      addedMetadata: \"å·²æ·»åŠ å…ƒæ•°æ®\",\n      repeatCopied: \"é‡å¤è§„åˆ™å·²å¤åˆ¶\",\n      repeatUpdated: \"\\u91CD\\u590D \\u2192 {{value}}\",\n      nextOccurrenceTo: \"\\u4E0B\\u4E00\\u6B21\\u51FA\\u73B0 \\u2192 [[{{date}}]]\",\n      cannotParseDate: \"æ— æ³•è§£æžè¯¥æ—¥æœŸã€‚\",\n      enterText: \"è¯·è¾“å…¥ä»»åŠ¡æ–‡æœ¬ã€‚\",\n      removeAttrRepeat: \"é‡å¤è§„åˆ™å·²ç§»é™¤\",\n      removeAttrStart: \"å¼€å§‹æ—¥æœŸå·²ç§»é™¤\",\n      removeAttrDefer: \"å»¶æœŸæ—¥æœŸå·²ç§»é™¤\",\n      removeAttrDue: \"æˆªæ­¢æ—¥æœŸå·²ç§»é™¤\",\n      undoSuccess: \"æ›´æ”¹å·²æˆåŠŸæ’¤é”€\",\n      spawnConfirmTitle: \"Better Tasks\",\n      spawnConfirmMessage: \"ç”Ÿæˆä¸‹ä¸€æ¬¡ä»»åŠ¡ï¼Ÿ\",\n      aiFallback: \"AI è§£æžä¸å¯ç”¨ï¼Œå·²æ”¹ç”¨æ‰‹åŠ¨è¾“å…¥ã€‚\",\n      addRepeatOrDate: \"è¯·æ·»åŠ é‡å¤è§„åˆ™æˆ–è‡³å°‘ä¸€ä¸ªå¼€å§‹/å»¶æœŸ/æˆªæ­¢æ—¥æœŸã€‚\",\n      addRepeatDateOrMetadata: \"è¯·æ·»åŠ é‡å¤è§„åˆ™ã€æ—¥æœŸæˆ–å…ƒæ•°æ®ã€‚\",\n      completionCancelled: \"å·²å–æ¶ˆå®Œæˆ Better Taskã€‚\",\n      computeNextFailed: \"æ— æ³•è®¡ç®—ä¸‹ä¸€æ¬¡å‡ºçŽ°æ—¶é—´ã€‚\",\n      couldNotParseRecurrence: \"æ— æ³•è§£æžä»»åŠ¡é‡å¤æ¨¡å¼ã€‚è¯·æ£€æŸ¥ä»»åŠ¡å¹¶æŸ¥çœ‹ README ä¸­çš„æ”¯æŒæ¨¡å¼ã€‚\",\n      snoozeFailed: \"æ— æ³•å»¶åŽä»»åŠ¡ã€‚\",\n      metadataUpdateFailed: \"æ— æ³•æ›´æ–°å…ƒæ•°æ®ã€‚\",\n      aiCreateFailed: \"æ— æ³•æ ¹æ® AI ç»“æžœåˆ›å»ºä»»åŠ¡ï¼›è¯·å°è¯•æ‰‹åŠ¨ã€‚\",\n      createInputFailed: \"æ— æ³•æ ¹æ®è¾“å…¥åˆ›å»ºä»»åŠ¡ã€‚\",\n      pageNotFound: \"æ‰¾ä¸åˆ°ç”¨äºŽåˆ›å»ºä»»åŠ¡çš„é¡µé¢ã€‚\",\n      cannotParseDefer: \"æ— æ³•è§£æžå»¶æœŸæ—¥æœŸã€‚\",\n      cannotParseDue: \"æ— æ³•è§£æžæˆªæ­¢æ—¥æœŸã€‚\",\n      cannotParseStart: \"æ— æ³•è§£æžå¼€å§‹æ—¥æœŸã€‚\",\n      createdWithAi: \"å·²ä½¿ç”¨ AI è§£æžåˆ›å»º Better Task\",\n      noRepeatFound: \"æœªæ‰¾åˆ°é‡å¤è§„åˆ™ã€‚\",\n      noRepeatToSkip: \"æ²¡æœ‰å¯è·³è¿‡çš„é‡å¤è§„åˆ™ã€‚\",\n      noSeriesHistory: \"æ²¡æœ‰ç³»åˆ—åŽ†å²è®°å½•ã€‚\",\n      openSettings: \"è¯·åœ¨ Roam Depot è®¾ç½®ä¸­è°ƒæ•´ Better Tasks é€‰é¡¹ã€‚\",\n      placeCursorCreate: \"è¯·å°†å…‰æ ‡æ”¾åœ¨ä½ æƒ³åˆ›å»º Better Task çš„å—ä¸­ã€‚\",\n      placeCursorTodo: \"è¯·å°†å…‰æ ‡æ”¾åœ¨ä½ æƒ³åˆ›å»º Better Task çš„å—ä¸­ã€‚\",\n      placeCursorConvert: \"è¯·å°†å…‰æ ‡æ”¾åœ¨ä½ æƒ³è½¬æ¢çš„å—ä¸­ã€‚\",\n      taskTextRequired: \"ä»»åŠ¡æ–‡æœ¬ä¸ºå¿…å¡«é¡¹ã€‚\",\n      unableReadBlock: \"æ— æ³•è¯»å–å½“å‰å—ã€‚\",\n      unableRemoveAttr: \"æ— æ³•ç§»é™¤è¯¥å±žæ€§ã€‚\",\n      unableUnderstandRepeat: \"æ— æ³•ç†è§£è¯¥é‡å¤è§„åˆ™ã€‚\",\n      unableUpdateTask: \"æ— æ³•æ›´æ–°ä»»åŠ¡ã€‚\",\n      dashViewsOpenToSwitch: \"è¯·æ‰“å¼€ Better Tasks ä»ªè¡¨æ¿ä»¥åˆ‡æ¢è§†å›¾ã€‚\",\n      dashViewsNoSaved: \"æ²¡æœ‰å·²ä¿å­˜çš„è§†å›¾ã€‚\",\n      dashViewsSwitchFailed: \"æ— æ³•åˆ‡æ¢è§†å›¾ã€‚\",\n      dashViewsOpenToSave: \"è¯·æ‰“å¼€ Better Tasks ä»ªè¡¨æ¿ä»¥ä¿å­˜è§†å›¾ã€‚\",\n      dashViewsReadStateFailed: \"æ— æ³•è¯»å–ä»ªè¡¨æ¿çŠ¶æ€ã€‚è¯·å°è¯•é‡æ–°æ‰“å¼€ä»ªè¡¨æ¿ã€‚\",\n      dashViewsSaveFailed: \"æ— æ³•ä¿å­˜è§†å›¾ã€‚\",\n      dashViewsPresetInstalled: \"å·²å®‰è£…ä»ªè¡¨æ¿é¢„è®¾è§†å›¾ã€‚\",\n      dashViewsPresetNothingToInstall: \"æ‰€æœ‰ä»ªè¡¨æ¿é¢„è®¾è§†å›¾å‡å·²å­˜åœ¨ã€‚\",\n      dashViewsPresetNameCollisions: \"ç”±äºŽåç§°å†²çªè€Œè·³è¿‡é¢„è®¾ï¼š\",\n      dashViewsPresetInstallFailed: \"æ— æ³•é‡æ–°å®‰è£…ä»ªè¡¨æ¿é¢„è®¾è§†å›¾ã€‚\",\n      dashReviewNoPresets: \"æœªæ‰¾åˆ°å¤ç›˜é¢„è®¾ã€‚\",\n      dashReviewStartFailed: \"æ— æ³•å¼€å§‹æ¯å‘¨å¤ç›˜ã€‚\"\n    },\n    dashboard: {\n      topbarTitle: \"Better Tasks Dashboard\",\n      title: \"Better Tasks\",\n      subtitle: \"åœ¨ Roam Research ä¸­è¿›è¡Œå…¨é¢çš„ä»»åŠ¡ç®¡ç†ã€‚\",\n      refresh: \"åˆ·æ–°\",\n      close: \"å…³é—­\",\n      fullPage: {\n        enter: \"å±•å¼€\",\n        exit: \"é€€å‡ºå…¨é¡µ\"\n      },\n      groupByLabel: \"åˆ†ç»„ä¾æ®\",\n      review: {\n        button: \"æ¯å‘¨å¤ç›˜\",\n        label: \"æ¯å‘¨å¤ç›˜\",\n        of: \"å…±\",\n        back: \"â† ä¸Šä¸€æ­¥\",\n        next: \"ä¸‹ä¸€æ­¥ â†’\",\n        exit: \"é€€å‡º\"\n      },\n      views: {\n        label: \"å·²ä¿å­˜è§†å›¾\",\n        \"default\": \"é»˜è®¤\",\n        saveAs: \"å¦å­˜ä¸ºâ€¦\",\n        update: \"æ›´æ–°\",\n        options: \"è§†å›¾é€‰é¡¹\",\n        rename: \"é‡å‘½åâ€¦\",\n        \"delete\": \"åˆ é™¤\",\n        prompts: {\n          saveAsMessage: \"å°†å½“å‰è§†å›¾å¦å­˜ä¸º\",\n          renameMessage: \"é‡å‘½åè§†å›¾\",\n          namePlaceholder: \"è§†å›¾åç§°\"\n        },\n        confirms: {\n          overwrite: function overwrite(name) {\n            return \"\\u8986\\u76D6\\u89C6\\u56FE\\u201C\".concat(name, \"\\u201D\\uFF1F\");\n          },\n          \"delete\": function _delete(name) {\n            return \"\\u5220\\u9664\\u89C6\\u56FE\\u201C\".concat(name, \"\\u201D\\uFF1F\");\n          }\n        }\n      },\n      viewsPresets: {\n        nextActions: \"ä¸‹ä¸€æ­¥è¡ŒåŠ¨\",\n        waitingFor: \"ç­‰å¾…ä¸­\",\n        completed7d: \"å·²å®Œæˆï¼ˆæœ€è¿‘ 7 å¤©ï¼‰\",\n        upcoming7d: \"å³å°†åˆ°æœŸï¼ˆæœªæ¥ 7 å¤©ï¼‰\",\n        overdue: \"é€¾æœŸ\",\n        someday: \"ä¹Ÿè®¸ / æŸå¤©\",\n        allOpen: \"å…¨éƒ¨æœªå®Œæˆä»»åŠ¡\"\n      },\n      quickAddPlaceholder: \"æ·»åŠ  Better Task\",\n      quickAddButton: \"ç¡®å®š\",\n      searchPlaceholder: \"æœç´¢ Better Tasks\",\n      groupingOptions: {\n        time: \"æŒ‰æ—¶é—´\",\n        page: \"æŒ‰é¡µé¢\",\n        recurrence: \"æŒ‰é‡å¤è§„åˆ™\"\n      },\n      filtersLabel: \"ç­›é€‰å™¨\",\n      filters: {\n        show: \"æ˜¾ç¤ºç­›é€‰å™¨\",\n        hide: \"éšè—ç­›é€‰å™¨\",\n        tagsLabel: \"æ ‡ç­¾\",\n        groups: {\n          status: \"çŠ¶æ€\",\n          dates: \"æ—¥æœŸ\",\n          gtd: \"GTD\",\n          meta: \"å…ƒä¿¡æ¯\"\n        }\n      },\n      empty: {\n        loading: \"æ­£åœ¨åŠ è½½ä»»åŠ¡â€¦\",\n        error: \"æ— æ³•åŠ è½½ä»»åŠ¡ã€‚\",\n        retry: \"é‡è¯•\",\n        noMatch: \"æ²¡æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„ä»»åŠ¡ã€‚\"\n      },\n      filterSections: {\n        Recurrence: \"é‡å¤\",\n        Start: \"å¼€å§‹\",\n        Defer: \"å»¶æœŸ\",\n        Due: \"åˆ°æœŸ\",\n        Completion: \"å®ŒæˆçŠ¶æ€\",\n        Priority: \"ä¼˜å…ˆçº§\",\n        Energy: \"ç²¾åŠ›\",\n        GTD: \"GTD\"\n      },\n      filterValues: {\n        recurring: \"é‡å¤\",\n        \"one-off\": \"ä¸€æ¬¡æ€§\",\n        \"not-started\": \"æœªå¼€å§‹\",\n        started: \"å·²å¼€å§‹\",\n        deferred: \"å·²å»¶æœŸ\",\n        available: \"å¯ç”¨\",\n        overdue: \"é€¾æœŸ\",\n        today: \"ä»Šå¤©\",\n        upcoming: \"å³å°†åˆ°æœŸ\",\n        none: \"æ— åˆ°æœŸ\",\n        open: \"æœªå®Œæˆ\",\n        completed: \"å·²å®Œæˆ\",\n        high: \"é«˜\",\n        medium: \"ä¸­\",\n        low: \"ä½Ž\",\n        \"next action\": \"ä¸‹ä¸€æ­¥è¡ŒåŠ¨\",\n        delegated: \"å·²å§”æ´¾\",\n        someday: \"æŸå¤©\"\n      },\n      completedWithinLabel: \"å®Œæˆæ—¶é—´èŒƒå›´\",\n      completedWithinOptions: {\n        any: \"ä¸é™æ—¶é—´\",\n        \"7d\": \"æœ€è¿‘ 7 å¤©\",\n        \"30d\": \"æœ€è¿‘ 30 å¤©\",\n        \"90d\": \"æœ€è¿‘ 90 å¤©\"\n      },\n      upcomingWithinLabel: \"å³å°†åˆ°æœŸèŒƒå›´\",\n      upcomingWithinOptions: {\n        any: \"ä¸é™æ—¶é—´\",\n        \"7d\": \"æœªæ¥ 7 å¤©\",\n        \"30d\": \"æœªæ¥ 30 å¤©\",\n        \"90d\": \"æœªæ¥ 90 å¤©\"\n      },\n      groupLabels: {\n        overdue: \"é€¾æœŸ\",\n        today: \"ä»Šå¤©\",\n        upcoming: \"å³å°†åˆ°æœŸ\",\n        none: \"æ— åˆ°æœŸæ—¥\",\n        recurring: \"é‡å¤\",\n        \"one-off\": \"ä¸€æ¬¡æ€§\",\n        completed: \"å·²å®Œæˆ\",\n        noProject: \"æ— é¡¹ç›®\"\n      },\n      metaPills: {\n        priority: \"ä¼˜å…ˆçº§\",\n        energy: \"ç²¾åŠ›\",\n        gtd: \"GTD\",\n        project: \"é¡¹ç›®\",\n        waitingFor: \"ç­‰å¾…å¯¹è±¡\",\n        context: \"æƒ…å¢ƒ\"\n      },\n      projectFilterLabel: \"é¡¹ç›®\",\n      projectFilterPlaceholder: \"é¡¹ç›®åç§°\",\n      projectFilterAny: \"å…¨éƒ¨é¡¹ç›®\",\n      waitingFilterLabel: \"ç­‰å¾…å¯¹è±¡\",\n      waitingFilterPlaceholder: \"ç­‰å¾…å¯¹è±¡\",\n      waitingFilterAny: \"å…¨éƒ¨ç­‰å¾…å¯¹è±¡\",\n      contextFilterLabel: \"æƒ…å¢ƒ\",\n      contextFilterAny: \"å…¨éƒ¨æƒ…å¢ƒ\",\n      groupingLabels: {\n        time: \"æ—¶é—´\",\n        recurrence: \"é‡å¤\",\n        project: \"é¡¹ç›®\"\n      },\n      taskOptions: \"ä»»åŠ¡é€‰é¡¹\",\n      markDone: \"æ ‡è®°ä¸ºå®Œæˆ\",\n      markOpen: \"æ ‡è®°ä¸ºæœªå®Œæˆ\",\n      view: \"æŸ¥çœ‹\",\n      snoozePick: \"é€‰æ‹©\",\n      snoozePlus1: \"+1å¤©\",\n      snoozePlus7: \"+7å¤©\",\n      untitled: \"ï¼ˆæœªå‘½åä»»åŠ¡ï¼‰\",\n      bulk: {\n        select: \"æ‰¹é‡\",\n        selectTask: \"é€‰æ‹©\",\n        deselectTask: \"å–æ¶ˆé€‰æ‹©\",\n        selectAll: \"å…¨é€‰\",\n        selectNone: \"æ¸…é™¤\",\n        selected: function selected(n) {\n          return \"\\u5DF2\\u9009 \".concat(n, \" \\u9879\");\n        },\n        selectGroup: function selectGroup(title) {\n          return \"\\u9009\\u62E9 \".concat(title, \" \\u4E2D\\u7684\\u5168\\u90E8\\u4EFB\\u52A1\");\n        },\n        deselectGroup: function deselectGroup(title) {\n          return \"\\u53D6\\u6D88\\u9009\\u62E9 \".concat(title, \" \\u4E2D\\u7684\\u5168\\u90E8\\u4EFB\\u52A1\");\n        },\n        complete: \"å®Œæˆ\",\n        reopen: \"é‡æ–°æ‰“å¼€\",\n        snooze1d: \"+1å¤©\",\n        snooze7d: \"+7å¤©\",\n        setMetadata: \"è®¾ç½®...\",\n        cancel: \"å–æ¶ˆ\",\n        completedCount: function completedCount(n) {\n          return \"\\u5DF2\\u5B8C\\u6210 \".concat(n, \" \\u4E2A\\u4EFB\\u52A1\");\n        },\n        reopenedCount: function reopenedCount(n) {\n          return \"\\u5DF2\\u91CD\\u65B0\\u6253\\u5F00 \".concat(n, \" \\u4E2A\\u4EFB\\u52A1\");\n        },\n        snoozedCount: function snoozedCount(n, days) {\n          return \"\\u5DF2\\u5EF6\\u540E \".concat(n, \" \\u4E2A\\u4EFB\\u52A1 \").concat(days, \" \\u5929\");\n        },\n        updatedCount: function updatedCount(field, n) {\n          return \"\\u5DF2\\u66F4\\u65B0 \".concat(n, \" \\u4E2A\\u4EFB\\u52A1\\u7684 \").concat(field);\n        },\n        fieldLabels: {\n          project: \"é¡¹ç›®\",\n          waitingFor: \"ç­‰å¾…å¯¹è±¡\",\n          context: \"æƒ…å¢ƒ\",\n          priority: \"ä¼˜å…ˆçº§\",\n          energy: \"ç²¾åŠ›\",\n          gtd: \"GTD\"\n        },\n        metaValues: {\n          priorityHigh: \"é«˜\",\n          priorityMedium: \"ä¸­\",\n          priorityLow: \"ä½Ž\",\n          energyHigh: \"é«˜\",\n          energyMedium: \"ä¸­\",\n          energyLow: \"ä½Ž\",\n          gtdNext: \"ä¸‹ä¸€æ­¥è¡ŒåŠ¨\",\n          gtdDelegated: \"å·²å§”æ´¾\",\n          gtdDeferred: \"å·²å»¶æœŸ\",\n          gtdSomeday: \"å°†æ¥/ä¹Ÿè®¸\",\n          clear: \"æ¸…é™¤\"\n        },\n        undo: \"æ’¤é”€\",\n        undoSuccess: \"å·²æ’¤é”€æ›´æ”¹\",\n        undoFailed: \"æ’¤é”€å¤±è´¥\"\n      }\n    },\n    today: {\n      title: \"Better Tasks - ä»Šæ—¥\",\n      starting: \"ä»Šæ—¥å¼€å§‹\",\n      deferred: \"å»¶æœŸè‡³ä»Šæ—¥\",\n      due: \"ä»Šæ—¥åˆ°æœŸ\",\n      overdue: function overdue(n) {\n        return \"\\u903E\\u671F\\uFF08\".concat(n, \"\\uFF09\");\n      },\n      empty: \"ä»Šæ—¥æ— ä»»åŠ¡ã€‚\",\n      complete: \"å®Œæˆ\",\n      snoozeShort: \"å»¶åŽ 1 å¤©\",\n      untitled: \"ï¼ˆæœªå‘½åï¼‰\"\n    },\n    pillMenu: {\n      moreActions: \"æ›´å¤šä»»åŠ¡æ“ä½œ\",\n      snoozePlus1: \"å»¶åŽ 1 å¤©\",\n      snoozePlus3: \"å»¶åŽ 3 å¤©\",\n      snoozeNextMon: \"å»¶åŽè‡³ä¸‹å‘¨ä¸€\",\n      snoozePick: \"å»¶åŽï¼ˆé€‰æ‹©æ—¥æœŸï¼‰\",\n      skipOccurrence: \"è·³è¿‡æ­¤é‡å¤\",\n      generateNext: \"ç«‹å³ç”Ÿæˆä¸‹ä¸€æ¬¡\",\n      endRecurrence: \"ç»“æŸé‡å¤\",\n      addProject: \"æ·»åŠ é¡¹ç›®\",\n      removeProject: \"ç§»é™¤é¡¹ç›®\",\n      addContext: \"æ·»åŠ æƒ…å¢ƒ\",\n      removeContext: \"ç§»é™¤æƒ…å¢ƒ\",\n      addWaiting: \"æ·»åŠ ç­‰å¾…å¯¹è±¡\",\n      removeWaiting: \"ç§»é™¤ç­‰å¾…å¯¹è±¡\",\n      cyclePriority: \"åˆ‡æ¢ä¼˜å…ˆçº§\",\n      cycleEnergy: \"åˆ‡æ¢ç²¾åŠ›\",\n      cycleGtd: \"åˆ‡æ¢ GTD\",\n      metaHeading: \"å…ƒæ•°æ®\"\n    },\n    taskMenu: {\n      setProject: \"è®¾ç½®é¡¹ç›®\",\n      editProject: \"ç¼–è¾‘é¡¹ç›®\",\n      removeProject: \"ç§»é™¤é¡¹ç›®\",\n      setContext: \"è®¾ç½®æƒ…å¢ƒ\",\n      editContext: \"ç¼–è¾‘æƒ…å¢ƒ\",\n      removeContext: \"ç§»é™¤æƒ…å¢ƒ\",\n      setWaiting: \"è®¾ç½®ç­‰å¾…å¯¹è±¡\",\n      editWaiting: \"ç¼–è¾‘ç­‰å¾…å¯¹è±¡\",\n      removeWaiting: \"ç§»é™¤ç­‰å¾…å¯¹è±¡\",\n      priorityCycle: \"ä¼˜å…ˆçº§ï¼ˆç‚¹å‡»å¾ªçŽ¯ï¼‰\",\n      energyCycle: \"ç²¾åŠ›ï¼ˆç‚¹å‡»å¾ªçŽ¯ï¼‰\",\n      cycleGtd: \"åˆ‡æ¢ GTD\",\n      metaHeading: \"å…ƒæ•°æ®\"\n    },\n    metadata: {\n      repeat: \"é‡å¤\",\n      project: \"é¡¹ç›®\",\n      waitingFor: \"ç­‰å¾…å¯¹è±¡\",\n      context: \"æƒ…å¢ƒ\",\n      gtd: \"GTD\",\n      priority: \"ä¼˜å…ˆçº§\",\n      energy: \"ç²¾åŠ›\",\n      start: \"å¼€å§‹\",\n      defer: \"å»¶æœŸ\",\n      due: \"æˆªæ­¢\",\n      next: \"ä¸‹ä¸€æ­¥\",\n      repeatingTask: \"é‡å¤ Better Task\",\n      scheduledTask: \"è®¡åˆ’ Better Task\",\n      loadingTheme: \"æ­£åœ¨åŠ è½½ä¸»é¢˜â€¦\",\n      applyTheme: \"æ­£åœ¨åº”ç”¨ä¸»é¢˜â€¦\",\n      themeChanged: \"æ£€æµ‹åˆ°ä¸»é¢˜æ›´æ”¹ï¼Œæ­£åœ¨é‡æ–°åŠ è½½ä»¥åº”ç”¨å˜åŒ–ã€‚\",\n      repeatRule: \"é‡å¤è§„åˆ™\",\n      projectLabel: \"é¡¹ç›®\",\n      waitingLabel: \"ç­‰å¾…å¯¹è±¡\",\n      contextLabel: \"æƒ…å¢ƒ\",\n      priorityLabel: \"ä¼˜å…ˆçº§\",\n      energyLabel: \"ç²¾åŠ›\",\n      gtdLabel: \"GTD\"\n    }\n  },\n  // -----------------------------\n  // Traditional Chinese\n  // -----------------------------\n  zhHant: {\n    settings: {\n      tabTitle: \"Better Tasks\",\n      enableTodayWidget: \"å•Ÿç”¨ä»Šæ—¥å°å·¥å…·\",\n      enableTodayWidgetDescription: \"åœ¨æ¯æ—¥ç­†è¨˜é é¡¯ç¤º Better Tasks ä»Šæ—¥å°å·¥å…·\",\n      todayWidgetLayout: \"ä»Šæ—¥å°å·¥å…·ä½ˆå±€\",\n      todayWidgetLayoutDescription: \"é¸æ“‡ä»Šæ—¥å°å·¥å…·çš„é¡¯ç¤ºæ–¹å¼\",\n      todayWidgetLayoutOptions: [\"é¢æ¿\", \"é¡ž Roam å…§åµŒ\"],\n      todayWidgetPlacement: \"ä»Šæ—¥å°å·¥å…·ä½ç½®\",\n      todayWidgetPlacementDescription: \"å°‡å°å·¥å…·æ”¾åœ¨ DNP é ‚éƒ¨æˆ–åº•éƒ¨ï¼Œé™¤éžæ‰¾åˆ°åŒ¹é…çš„å€å¡Š\",\n      todayWidgetIncludeOverdue: \"åœ¨ä»Šæ—¥å°å·¥å…·ä¸­åŒ…å«é€¾æœŸä»»å‹™\",\n      todayWidgetIncludeOverdueDescription: \"é¡¯ç¤ºåˆ°æœŸæ—¥åœ¨ä»Šå¤©ä¹‹å‰çš„ä»»å‹™\",\n      todayWidgetShowCompleted: \"åœ¨ä»Šæ—¥å°å·¥å…·ä¸­é¡¯ç¤ºå·²å®Œæˆä»»å‹™\",\n      todayWidgetShowCompletedDescription: \"åŒ…å«å·²å®Œæˆä»»å‹™ï¼ˆé è¨­éš±è—ï¼‰\",\n      todayWidgetHeadingLevel: \"ä»Šæ—¥å°å·¥å…·æ¨™é¡Œå±¤ç´š\",\n      todayWidgetHeadingLevelDescription: \"ç‚ºä»Šæ—¥å°å·¥å…·éŒ¨é»žå¥—ç”¨æ¨™é¡Œæ¨£å¼\",\n      todayBadgeEnable: \"å•Ÿç”¨ Today å¾½ç« \",\n      todayBadgeEnableDescription: \"åœ¨å·¦å´é‚Šæ¬„é¡¯ç¤º Today é€£çµèˆ‡å¾½ç« \",\n      todayBadgeLabel: \"Today å¾½ç« æ¨™ç±¤\",\n      todayBadgeLabelDescription: \"Today å¾½ç« /é€£çµçš„æ–‡å­—ï¼ˆæ¯”å°æ™‚æœƒå¿½ç•¥ Markdownï¼‰\",\n      todayBadgeIncludeOverdue: \"å¾½ç« è¨ˆæ•¸åŒ…å«é€¾æœŸä»»å‹™\",\n      todayBadgeIncludeOverdueDescription: \"å¾½ç« è¨ˆæ•¸åŒ…å«é€¾æœŸä»»å‹™ï¼ˆå·²å®Œæˆä¸è¨ˆå…¥ï¼‰\",\n      todayBadgeBg: \"Today å¾½ç« èƒŒæ™¯è‰²\",\n      todayBadgeBgDescription: \"å¾½ç« èƒŒæ™¯çš„ CSS é¡è‰²\",\n      todayBadgeFg: \"Today å¾½ç« æ–‡å­—é¡è‰²\",\n      todayBadgeFgDescription: \"å¾½ç« æ–‡å­—çš„ CSS é¡è‰²\",\n      picklistExcludesAdvanced: \"å°ˆæ¡ˆ/æƒ…å¢ƒ/ç­‰å¾…æ¸…å–®é€²éšŽé¸é …\",\n      picklistExcludesAdvancedDescription: \"é¡¯ç¤ºç”¨æ–¼å¾žå°ˆæ¡ˆ/æƒ…å¢ƒ/ç­‰å¾…æ¸…å–®ä¸­æŽ’é™¤ç‰¹å®šé é¢çš„è¨­å®šï¼ˆæ°¸é æŽ’é™¤ roam/* é é¢ï¼‰ã€‚\",\n      excludePicklistPages: \"å¾žæ¸…å–®ä¸­æŽ’é™¤é é¢\",\n      excludePicklistPagesDescription: \"ä»¥é€—è™Ÿåˆ†éš”çš„é é¢æ¨™é¡Œã€‚è‹¥æ¨™é¡ŒåŒ…å«é€—è™Ÿï¼ˆä¾‹å¦‚æ¯æ—¥ç­†è¨˜ï¼‰ï¼Œè«‹ç”¨ [[...]] åŒ…è£¹ã€‚é€™äº›é é¢ä¸­çš„å€¼ä¸æœƒå‡ºç¾åœ¨å°ˆæ¡ˆ/æƒ…å¢ƒ/ç­‰å¾…æ¸…å–®ä¸­ï¼ˆé©ç”¨æ–¼ Templates/SmartBlocksï¼‰ã€‚\",\n      excludePicklistPagesPlaceholder: \"Templates, SmartBlocks, [[December 18th, 2025]]\",\n      pillThreshold: \"å…§åµŒæ¨™ç±¤å‹¾é¸æ¡†é–€æª»\",\n      pillThresholdDescription: \"ç•¶å‹¾é¸æ¡†æ•¸é‡è¶…éŽæ­¤å€¼æ™‚ï¼Œå…§åµŒæ¨™ç±¤æœƒè·³éŽåˆå§‹æ¸²æŸ“ï¼ˆé è¨­ 100ï¼‰ã€‚è¼ƒé«˜æ•¸å€¼æœƒæ¸²æŸ“ä½†å¯èƒ½è®“é é¢è®Šæ…¢ã€‚\",\n      advancedDashboard: \"å„€è¡¨æ¿é€²éšŽé¸é …\",\n      advancedDashboardDescription: \"é¡¯ç¤ºæ¯é€±è¤‡ç›¤æ­¥é©Ÿçš„è¨­å®šã€‚\",\n      reviewStepDescription: \"å°‡æ­¤æ­¥é©ŸåŒ…å«åœ¨æ¯é€±è¤‡ç›¤æµç¨‹ä¸­ï¼ˆé †åºå›ºå®šï¼‰ã€‚\",\n      reviewStepNextActions: \"æ¯é€±è¤‡ç›¤ï¼šä¸‹ä¸€æ­¥è¡Œå‹•\",\n      reviewStepWaitingFor: \"æ¯é€±è¤‡ç›¤ï¼šç­‰å¾…ä¸­\",\n      reviewStepCompleted7d: \"æ¯é€±è¤‡ç›¤ï¼šå·²å®Œæˆï¼ˆæœ€è¿‘ 7 å¤©ï¼‰\",\n      reviewStepUpcoming7d: \"æ¯é€±è¤‡ç›¤ï¼šå³å°‡åˆ°æœŸï¼ˆæœªä¾† 7 å¤©ï¼‰\",\n      reviewStepOverdue: \"æ¯é€±è¤‡ç›¤ï¼šé€¾æœŸ\",\n      reviewStepSomeday: \"æ¯é€±è¤‡ç›¤ï¼šä¹Ÿè¨± / æŸå¤©\",\n      destNextTask: \"ä¸‹ä¸€å€‹ä»»å‹™çš„ä½ç½®\",\n      destNextTaskDescription: \"åœ¨å“ªè£¡å»ºç«‹ä¸‹ä¸€æ¬¡å‡ºç¾\",\n      dnpHeading: \"DNP æ¨™é¡Œ\",\n      dnpHeadingDescription: \"ç•¶ä½ç½®ç‚º DNP åº•ä¸‹æ¨™é¡Œæ™‚ï¼Œåœ¨æ­¤æ¨™é¡Œä¸‹å»ºç«‹\",\n      destinationOptions: [\"DNP\", \"åŒä¸€é é¢\", \"DNP åº•ä¸‹æ¨™é¡Œ\"],\n      placementOptions: [\"é ‚éƒ¨\", \"åº•éƒ¨\"],\n      headingLevelOptions: [\"ç„¡\", \"H1\", \"H2\", \"H3\"],\n      repeatAttr: \"é‡è¤‡å±¬æ€§åç¨±\",\n      repeatAttrDescription: \"é‡è¤‡è¦å‰‡å±¬æ€§çš„æ¨™ç±¤\",\n      startAttr: \"é–‹å§‹æ—¥æœŸå±¬æ€§åç¨±\",\n      startAttrDescription: \"é–‹å§‹/å¯ç”¨æ—¥æœŸå±¬æ€§çš„æ¨™ç±¤\",\n      deferAttr: \"å»¶å¾Œæ—¥æœŸå±¬æ€§åç¨±\",\n      deferAttrDescription: \"å»¶å¾Œ/æ“±ç½®æ—¥æœŸå±¬æ€§çš„æ¨™ç±¤\",\n      dueAttr: \"åˆ°æœŸæ—¥æœŸå±¬æ€§åç¨±\",\n      dueAttrDescription: \"åˆ°æœŸæ—¥æœŸå±¬æ€§çš„æ¨™ç±¤\",\n      completedAttr: \"å®Œæˆå±¬æ€§åç¨±\",\n      completedAttrDescription: \"å®Œæˆé‡è¤‡/æŽ’ç¨‹ä»»å‹™æ™‚å¯«å…¥çš„æ¨™ç±¤\",\n      projectAttr: \"å°ˆæ¡ˆå±¬æ€§åç¨±\",\n      projectAttrDescription: \"å°ˆæ¡ˆå±¬æ€§çš„æ¨™ç±¤\",\n      gtdAttr: \"GTD ç‹€æ…‹å±¬æ€§åç¨±\",\n      gtdAttrDescription: \"GTD ç‹€æ…‹å±¬æ€§çš„æ¨™ç±¤\",\n      waitingAttr: \"ç­‰å¾…å°è±¡å±¬æ€§åç¨±\",\n      waitingAttrDescription: \"ç­‰å¾…å°è±¡å±¬æ€§çš„æ¨™ç±¤\",\n      contextAttr: \"æƒ…å¢ƒå±¬æ€§åç¨±\",\n      contextAttrDescription: \"æƒ…å¢ƒå±¬æ€§çš„æ¨™ç±¤\",\n      priorityAttr: \"å„ªå…ˆç´šå±¬æ€§åç¨±\",\n      priorityAttrDescription: \"å„ªå…ˆç´šå±¬æ€§çš„æ¨™ç±¤\",\n      energyAttr: \"ç²¾åŠ›å±¬æ€§åç¨±\",\n      energyAttrDescription: \"ç²¾åŠ›å±¬æ€§çš„æ¨™ç±¤\",\n      confirmBeforeSpawn: \"ç”Ÿæˆä¸‹ä¸€å€‹ä»»å‹™å‰éœ€ç¢ºèª\",\n      confirmBeforeSpawnDescription: \"åœ¨é‡è¤‡ä»»å‹™å®Œæˆæ™‚ç”Ÿæˆä¸‹ä¸€æ¬¡å‰æç¤ºç¢ºèª\",\n      weekStart: \"æ¯é€±çš„ç¬¬ä¸€å¤©\",\n      weekStartDescription: \"ç”¨æ–¼ä¾æ“šä½ çš„ Roam åœ–åå¥½å°é½Šæ¯é€±è¡Œç¨‹\",\n      weekStartOptions: [\"æ˜ŸæœŸæ—¥\", \"æ˜ŸæœŸä¸€\", \"æ˜ŸæœŸäºŒ\", \"æ˜ŸæœŸä¸‰\", \"æ˜ŸæœŸå››\", \"æ˜ŸæœŸäº”\", \"æ˜ŸæœŸå…­\"],\n      aiMode: \"AI è§£æžæ¨¡å¼\",\n      aiModeDescription: \"å¯é¸ï¼šä½¿ç”¨ä½ çš„ OpenAI API é‡‘é‘°é€²è¡Œ AI å”åŠ©è§£æž\",\n      aiModeOptions: [\"é—œé–‰\", \"ä½¿ç”¨æˆ‘çš„ OpenAI é‡‘é‘°\"],\n      aiKey: \"OpenAI API é‡‘é‘°\",\n      aiKeyDescription: \"æ•æ„Ÿï¼šå­˜æ”¾æ–¼ Roam è¨­å®šï¼Œåƒ…åœ¨å®¢æˆ¶ç«¯ç”¨æ–¼ AI è§£æž\",\n      language: \"èªžè¨€\",\n      languageDescription: \"Better Tasks çš„åå¥½èªžè¨€\"\n    },\n    buttons: {\n      save: \"å„²å­˜\",\n      cancel: \"å–æ¶ˆ\",\n      yes: \"æ˜¯\",\n      no: \"å¦\",\n      spawnNext: \"ç”Ÿæˆä¸‹ä¸€å€‹\",\n      skip: \"ç•¥éŽ\",\n      dueDate: \"åˆ°æœŸæ—¥æœŸ\",\n      completionDate: \"å®Œæˆæ—¥æœŸ\",\n      close: \"é—œé–‰\",\n      tryAgain: \"å†è©¦ä¸€æ¬¡\"\n    },\n    commands: {\n      reinstallPresetDashViews: \"Better Tasksï¼šé‡æ–°å®‰è£å„€è¡¨æ¿é è¨­æª¢è¦–\",\n      startReview: \"Better Tasksï¼šæ¯é€±è¤‡ç›¤\",\n      toggleDashboardFullPage: \"åˆ‡æ› Better Tasks å„€è¡¨æ¿ï¼ˆå…¨é ï¼‰\"\n    },\n    prompts: {\n      addProject: {\n        title: \"æ–°å¢žå°ˆæ¡ˆ\",\n        message: \"è¼¸å…¥å°ˆæ¡ˆåç¨±\",\n        placeholder: \"å°ˆæ¡ˆåç¨±\"\n      },\n      addContext: {\n        title: \"æ–°å¢žæƒ…å¢ƒ\",\n        message: \"è¼¸å…¥æƒ…å¢ƒ\",\n        placeholder: \"æƒ…å¢ƒ\"\n      },\n      addWaiting: {\n        title: \"æ–°å¢žç­‰å¾…å°è±¡\",\n        message: \"ä½ æ­£åœ¨ç­‰å¾…èª°æˆ–ä»€éº¼ï¼Ÿ\",\n        placeholder: \"ç­‰å¾…å°è±¡\"\n      },\n      addDate: {\n        title: \"é¸æ“‡æ—¥æœŸ\",\n        message: \"è«‹é¸æ“‡æ—¥æœŸ\"\n      },\n      editRepeat: {\n        title: \"ç·¨è¼¯é‡è¤‡è¦å‰‡\",\n        message: \"æ›´æ–°é‡è¤‡è¦å‰‡\",\n        placeholder: \"ä¾‹å¦‚ï¼šæ¯é€±äº”\"\n      },\n      spawnConfirm: {\n        title: \"Better Tasks\",\n        message: \"è¦ç”Ÿæˆä¸‹ä¸€æ¬¡ä»»å‹™å—Žï¼Ÿ\"\n      },\n      schedulingMode: {\n        title: \"é¸æ“‡æŽ’ç¨‹æ¨¡å¼\",\n        message: \"è«‹é¸æ“‡æœªä¾†ä»»å‹™çš„æŽ’ç¨‹æ–¹å¼ã€‚\"\n      },\n      aiParsing: \"æ­£åœ¨ä½¿ç”¨ AI è§£æžä»»å‹™â€¦\",\n      parseUnavailable: \"AI è§£æžä¸å¯ç”¨ï¼Œå°‡å»ºç«‹ä¸€èˆ¬çš„ Better Taskã€‚\",\n      cannotParseDue: \"ç„¡æ³•è§£æžåˆ°æœŸæ—¥ã€‚è«‹ä½¿ç”¨ Roam çš„æ¨™æº–æ—¥æœŸæ ¼å¼ï¼ˆä¾‹å¦‚ [[2025å¹´11æœˆ8æ—¥]]ï¼‰ã€‚\",\n      cannotParseRepeat: \"ç„¡æ³•ç†è§£è©²é‡è¤‡è¦å‰‡ã€‚\",\n      enterTaskText: \"è«‹è¼¸å…¥ä»»å‹™å…§å®¹ã€‚\",\n      addRepeatOrDate: \"è«‹æ–°å¢žé‡è¤‡è¦å‰‡æˆ–è‡³å°‘ä¸€å€‹é–‹å§‹ï¼å»¶å¾Œï¼åˆ°æœŸæ—¥æœŸã€‚\",\n      form: {\n        taskLabel: \"ä»»å‹™ *\",\n        taskPlaceholder: \"ä»»å‹™å…§å®¹\",\n        repeatLabel: \"é‡è¤‡\",\n        repeatPlaceholder: \"é‡è¤‡è¦å‰‡ï¼ˆå¯é¸ï¼‰\",\n        startLabel: \"é–‹å§‹\",\n        deferLabel: \"å»¶å¾Œ\",\n        dueLabel: \"åˆ°æœŸ\",\n        projectLabel: \"å°ˆæ¡ˆ\",\n        projectPlaceholder: \"å°ˆæ¡ˆ\",\n        gtdLabel: \"GTD ç‹€æ…‹\",\n        gtdOptions: {\n          \"next action\": \"ä¸‹ä¸€æ­¥è¡Œå‹•\",\n          delegated: \"å·²å§”æ´¾\",\n          deferred: \"å·²å»¶å¾Œ\",\n          someday: \"æŸå¤©\"\n        },\n        waitingLabel: \"ç­‰å¾…å°è±¡\",\n        waitingPlaceholder: \"ç­‰å¾…å°è±¡\",\n        priorityLabel: \"å„ªå…ˆç´š\",\n        priorityOptions: {\n          low: \"ä½Ž\",\n          medium: \"ä¸­\",\n          high: \"é«˜\"\n        },\n        energyLabel: \"ç²¾åŠ›\",\n        energyOptions: {\n          low: \"ä½Ž\",\n          medium: \"ä¸­\",\n          high: \"é«˜\"\n        },\n        contextLabel: \"æƒ…å¢ƒï¼ˆå¯å¤šå€‹ï¼‰\",\n        contextPlaceholder: \"@home, @work\",\n        messageWithTask: \"è«‹è¼¸å…¥ä»»å‹™å…§å®¹ã€å¯é¸é‡è¤‡è¦å‰‡ã€æ—¥æœŸèˆ‡ä¸­ç¹¼è³‡æ–™ã€‚\",\n        messageWithoutTask: \"è«‹è¼¸å…¥å¯é¸çš„é‡è¤‡è¦å‰‡ã€æ—¥æœŸèˆ‡ä¸­ç¹¼è³‡æ–™ã€‚\"\n      }\n    },\n    projectPicker: {\n      title: \"é¸æ“‡å°ˆæ¡ˆ\",\n      placeholder: \"æœå°‹æˆ–å»ºç«‹å°ˆæ¡ˆ\",\n      noProjects: \"å°šç„¡å°ˆæ¡ˆï¼Œè¼¸å…¥å³å¯å»ºç«‹\",\n      button: \"ç€è¦½\"\n    },\n    waitingPicker: {\n      title: \"é¸æ“‡ç­‰å¾…å°è±¡\",\n      placeholder: \"æœå°‹æˆ–å»ºç«‹\",\n      noItems: \"å°šç„¡ç­‰å¾…å°è±¡ï¼Œè¼¸å…¥å³å¯å»ºç«‹\"\n    },\n    contextPicker: {\n      title: \"é¸æ“‡æƒ…å¢ƒ\",\n      placeholder: \"æœå°‹æˆ–å»ºç«‹\",\n      noItems: \"å°šç„¡æƒ…å¢ƒï¼Œè¼¸å…¥å³å¯å»ºç«‹\"\n    },\n    toasts: {\n      createdRecurring: \"å·²å»ºç«‹ Better Task\",\n      createdScheduled: \"å·²å»ºç«‹ Better Task\",\n      addedMetadata: \"å·²æ–°å¢žä¸­ç¹¼è³‡æ–™\",\n      repeatCopied: \"é‡è¤‡è¦å‰‡å·²è¤‡è£½\",\n      repeatUpdated: \"\\u91CD\\u8907 \\u2192 {{value}}\",\n      nextOccurrenceTo: \"\\u4E0B\\u4E00\\u6B21\\u51FA\\u73FE \\u2192 [[{{date}}]]\",\n      cannotParseDate: \"ç„¡æ³•è§£æžè©²æ—¥æœŸã€‚\",\n      enterText: \"è«‹è¼¸å…¥ä»»å‹™å…§å®¹ã€‚\",\n      removeAttrRepeat: \"é‡è¤‡è¦å‰‡å·²ç§»é™¤\",\n      removeAttrStart: \"é–‹å§‹æ—¥æœŸå·²ç§»é™¤\",\n      removeAttrDefer: \"å»¶å¾Œæ—¥æœŸå·²ç§»é™¤\",\n      removeAttrDue: \"åˆ°æœŸæ—¥æœŸå·²ç§»é™¤\",\n      undoSuccess: \"è®Šæ›´å·²æˆåŠŸå¾©åŽŸ\",\n      spawnConfirmTitle: \"Better Tasks\",\n      spawnConfirmMessage: \"è¦ç”Ÿæˆä¸‹ä¸€æ¬¡ä»»å‹™å—Žï¼Ÿ\",\n      aiFallback: \"AI è§£æžä¸å¯ç”¨ï¼Œå·²æ”¹ç”¨æ‰‹å‹•è¼¸å…¥ã€‚\",\n      addRepeatOrDate: \"è«‹æ–°å¢žé‡è¤‡è¦å‰‡æˆ–è‡³å°‘ä¸€å€‹é–‹å§‹/å»¶å¾Œ/åˆ°æœŸæ—¥æœŸã€‚\",\n      addRepeatDateOrMetadata: \"è«‹æ–°å¢žé‡è¤‡è¦å‰‡ã€æ—¥æœŸæˆ–ä¸­ç¹¼è³‡æ–™ã€‚\",\n      completionCancelled: \"å·²å–æ¶ˆå®Œæˆ Better Taskã€‚\",\n      computeNextFailed: \"ç„¡æ³•è¨ˆç®—ä¸‹ä¸€æ¬¡å‡ºç¾æ™‚é–“ã€‚\",\n      couldNotParseRecurrence: \"ç„¡æ³•è§£æžä»»å‹™é‡è¤‡æ¨¡å¼ã€‚è«‹æª¢æŸ¥ä»»å‹™ä¸¦æŸ¥çœ‹ README ä¸­çš„æ”¯æ´æ¨¡å¼ã€‚\",\n      snoozeFailed: \"ç„¡æ³•å»¶å¾Œä»»å‹™ã€‚\",\n      metadataUpdateFailed: \"ç„¡æ³•æ›´æ–°ä¸­ç¹¼è³‡æ–™ã€‚\",\n      aiCreateFailed: \"ç„¡æ³•ä¾æ“š AI çµæžœå»ºç«‹ä»»å‹™ï¼›è«‹å˜—è©¦æ‰‹å‹•ã€‚\",\n      createInputFailed: \"ç„¡æ³•ä¾æ“šè¼¸å…¥å»ºç«‹ä»»å‹™ã€‚\",\n      pageNotFound: \"æ‰¾ä¸åˆ°ç”¨æ–¼å»ºç«‹ä»»å‹™çš„é é¢ã€‚\",\n      cannotParseDefer: \"ç„¡æ³•è§£æžå»¶å¾Œæ—¥æœŸã€‚\",\n      cannotParseDue: \"ç„¡æ³•è§£æžåˆ°æœŸæ—¥æœŸã€‚\",\n      cannotParseStart: \"ç„¡æ³•è§£æžé–‹å§‹æ—¥æœŸã€‚\",\n      createdWithAi: \"å·²ä½¿ç”¨ AI è§£æžå»ºç«‹ Better Task\",\n      noRepeatFound: \"æœªæ‰¾åˆ°é‡è¤‡è¦å‰‡ã€‚\",\n      noRepeatToSkip: \"æ²’æœ‰å¯ç•¥éŽçš„é‡è¤‡è¦å‰‡ã€‚\",\n      noSeriesHistory: \"æ²’æœ‰ç³»åˆ—æ­·å²è¨˜éŒ„ã€‚\",\n      openSettings: \"è«‹åˆ° Roam Depot è¨­å®šèª¿æ•´ Better Tasks é¸é …ã€‚\",\n      placeCursorCreate: \"è«‹å°‡æ¸¸æ¨™æ”¾åœ¨ä½ æƒ³å»ºç«‹ Better Task çš„å€å¡Šä¸­ã€‚\",\n      placeCursorTodo: \"è«‹å°‡æ¸¸æ¨™æ”¾åœ¨ä½ æƒ³å»ºç«‹ Better Task çš„å€å¡Šä¸­ã€‚\",\n      placeCursorConvert: \"è«‹å°‡æ¸¸æ¨™æ”¾åœ¨ä½ æƒ³è½‰æ›çš„å€å¡Šä¸­ã€‚\",\n      taskTextRequired: \"ä»»å‹™å…§å®¹ç‚ºå¿…å¡«ã€‚\",\n      unableReadBlock: \"ç„¡æ³•è®€å–ç›®å‰çš„å€å¡Šã€‚\",\n      unableRemoveAttr: \"ç„¡æ³•ç§»é™¤è©²å±¬æ€§ã€‚\",\n      unableUnderstandRepeat: \"ç„¡æ³•ç†è§£è©²é‡è¤‡è¦å‰‡ã€‚\",\n      unableUpdateTask: \"ç„¡æ³•æ›´æ–°ä»»å‹™ã€‚\",\n      dashViewsOpenToSwitch: \"è«‹å…ˆé–‹å•Ÿ Better Tasks å„€è¡¨æ¿ä»¥åˆ‡æ›æª¢è¦–ã€‚\",\n      dashViewsNoSaved: \"æ²’æœ‰å·²å„²å­˜çš„æª¢è¦–ã€‚\",\n      dashViewsSwitchFailed: \"ç„¡æ³•åˆ‡æ›æª¢è¦–ã€‚\",\n      dashViewsOpenToSave: \"è«‹å…ˆé–‹å•Ÿ Better Tasks å„€è¡¨æ¿ä»¥å„²å­˜æª¢è¦–ã€‚\",\n      dashViewsReadStateFailed: \"ç„¡æ³•è®€å–å„€è¡¨æ¿ç‹€æ…‹ã€‚è«‹å˜—è©¦é‡æ–°é–‹å•Ÿå„€è¡¨æ¿ã€‚\",\n      dashViewsSaveFailed: \"ç„¡æ³•å„²å­˜æª¢è¦–ã€‚\",\n      dashViewsPresetInstalled: \"å·²å®‰è£å„€è¡¨æ¿é è¨­æª¢è¦–ã€‚\",\n      dashViewsPresetNothingToInstall: \"æ‰€æœ‰å„€è¡¨æ¿é è¨­æª¢è¦–å‡å·²å­˜åœ¨ã€‚\",\n      dashViewsPresetNameCollisions: \"å› åç¨±è¡çªè€Œç•¥éŽé è¨­ï¼š\",\n      dashViewsPresetInstallFailed: \"ç„¡æ³•é‡æ–°å®‰è£å„€è¡¨æ¿é è¨­æª¢è¦–ã€‚\",\n      dashReviewNoPresets: \"æœªæ‰¾åˆ°è¤‡ç›¤é è¨­ã€‚\",\n      dashReviewStartFailed: \"ç„¡æ³•é–‹å§‹æ¯é€±è¤‡ç›¤ã€‚\"\n    },\n    dashboard: {\n      topbarTitle: \"Better Tasks Dashboard\",\n      title: \"Better Tasks\",\n      subtitle: \"åœ¨ Roam Research ä¸­é€²è¡Œå…¨é¢çš„ä»»å‹™ç®¡ç†ã€‚\",\n      refresh: \"é‡æ–°æ•´ç†\",\n      close: \"é—œé–‰\",\n      fullPage: {\n        enter: \"å±•é–‹\",\n        exit: \"é€€å‡ºå…¨é \"\n      },\n      groupByLabel: \"åˆ†çµ„ä¾æ“š\",\n      review: {\n        button: \"æ¯é€±è¤‡ç›¤\",\n        label: \"æ¯é€±è¤‡ç›¤\",\n        of: \"å…±\",\n        back: \"â† ä¸Šä¸€æ­¥\",\n        next: \"ä¸‹ä¸€æ­¥ â†’\",\n        exit: \"é€€å‡º\"\n      },\n      views: {\n        label: \"å·²å„²å­˜æª¢è¦–\",\n        \"default\": \"é è¨­\",\n        saveAs: \"å¦å­˜ç‚ºâ€¦\",\n        update: \"æ›´æ–°\",\n        options: \"æª¢è¦–é¸é …\",\n        rename: \"é‡æ–°å‘½åâ€¦\",\n        \"delete\": \"åˆªé™¤\",\n        prompts: {\n          saveAsMessage: \"å°‡ç›®å‰æª¢è¦–å¦å­˜ç‚º\",\n          renameMessage: \"é‡æ–°å‘½åæª¢è¦–\",\n          namePlaceholder: \"æª¢è¦–åç¨±\"\n        },\n        confirms: {\n          overwrite: function overwrite(name) {\n            return \"\\u8986\\u5BEB\\u6AA2\\u8996\\u300C\".concat(name, \"\\u300D\\uFF1F\");\n          },\n          \"delete\": function _delete(name) {\n            return \"\\u522A\\u9664\\u6AA2\\u8996\\u300C\".concat(name, \"\\u300D\\uFF1F\");\n          }\n        }\n      },\n      viewsPresets: {\n        nextActions: \"ä¸‹ä¸€æ­¥è¡Œå‹•\",\n        waitingFor: \"ç­‰å¾…ä¸­\",\n        completed7d: \"å·²å®Œæˆï¼ˆæœ€è¿‘ 7 å¤©ï¼‰\",\n        upcoming7d: \"å³å°‡åˆ°æœŸï¼ˆæœªä¾† 7 å¤©ï¼‰\",\n        overdue: \"é€¾æœŸ\",\n        someday: \"ä¹Ÿè¨± / æŸå¤©\",\n        allOpen: \"å…¨éƒ¨æœªå®Œæˆä»»å‹™\"\n      },\n      quickAddPlaceholder: \"æ–°å¢ž Better Task\",\n      quickAddButton: \"ç¢ºå®š\",\n      searchPlaceholder: \"æœå°‹ Better Tasks\",\n      groupingOptions: {\n        time: \"ä¾æ™‚é–“\",\n        page: \"ä¾é é¢\",\n        recurrence: \"ä¾é‡è¤‡è¦å‰‡\"\n      },\n      filtersLabel: \"ç¯©é¸å™¨\",\n      filters: {\n        show: \"é¡¯ç¤ºç¯©é¸å™¨\",\n        hide: \"éš±è—ç¯©é¸å™¨\",\n        tagsLabel: \"æ¨™ç±¤\",\n        groups: {\n          status: \"ç‹€æ…‹\",\n          dates: \"æ—¥æœŸ\",\n          gtd: \"GTD\",\n          meta: \"å…ƒè³‡è¨Š\"\n        }\n      },\n      empty: {\n        loading: \"æ­£åœ¨è¼‰å…¥ä»»å‹™â€¦\",\n        error: \"ç„¡æ³•è¼‰å…¥ä»»å‹™ã€‚\",\n        retry: \"å†è©¦ä¸€æ¬¡\",\n        noMatch: \"æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„ä»»å‹™ã€‚\"\n      },\n      filterSections: {\n        Recurrence: \"é‡è¤‡\",\n        Start: \"é–‹å§‹\",\n        Defer: \"å»¶å¾Œ\",\n        Due: \"åˆ°æœŸ\",\n        Completion: \"å®Œæˆç‹€æ…‹\",\n        Priority: \"å„ªå…ˆç´š\",\n        Energy: \"ç²¾åŠ›\",\n        GTD: \"GTD\"\n      },\n      filterValues: {\n        recurring: \"é‡è¤‡\",\n        \"one-off\": \"ä¸€æ¬¡æ€§\",\n        \"not-started\": \"æœªé–‹å§‹\",\n        started: \"å·²é–‹å§‹\",\n        deferred: \"å·²å»¶å¾Œ\",\n        available: \"å¯ç”¨\",\n        overdue: \"é€¾æœŸ\",\n        today: \"ä»Šå¤©\",\n        upcoming: \"å³å°‡åˆ°æœŸ\",\n        none: \"ç„¡åˆ°æœŸ\",\n        open: \"æœªå®Œæˆ\",\n        completed: \"å·²å®Œæˆ\",\n        high: \"é«˜\",\n        medium: \"ä¸­\",\n        low: \"ä½Ž\",\n        \"next action\": \"ä¸‹ä¸€æ­¥è¡Œå‹•\",\n        delegated: \"å·²å§”æ´¾\",\n        someday: \"æŸå¤©\"\n      },\n      completedWithinLabel: \"å®Œæˆæ™‚é–“ç¯„åœ\",\n      completedWithinOptions: {\n        any: \"ä¸é™æ™‚é–“\",\n        \"7d\": \"æœ€è¿‘ 7 å¤©\",\n        \"30d\": \"æœ€è¿‘ 30 å¤©\",\n        \"90d\": \"æœ€è¿‘ 90 å¤©\"\n      },\n      upcomingWithinLabel: \"å³å°‡åˆ°æœŸç¯„åœ\",\n      upcomingWithinOptions: {\n        any: \"ä¸é™æ™‚é–“\",\n        \"7d\": \"æœªä¾† 7 å¤©\",\n        \"30d\": \"æœªä¾† 30 å¤©\",\n        \"90d\": \"æœªä¾† 90 å¤©\"\n      },\n      groupLabels: {\n        overdue: \"é€¾æœŸ\",\n        today: \"ä»Šå¤©\",\n        upcoming: \"å³å°‡åˆ°æœŸ\",\n        none: \"ç„¡åˆ°æœŸæ—¥\",\n        recurring: \"é‡è¤‡\",\n        \"one-off\": \"ä¸€æ¬¡æ€§\",\n        completed: \"å·²å®Œæˆ\",\n        noProject: \"ç„¡å°ˆæ¡ˆ\"\n      },\n      metaPills: {\n        priority: \"å„ªå…ˆç´š\",\n        energy: \"ç²¾åŠ›\",\n        gtd: \"GTD\",\n        project: \"å°ˆæ¡ˆ\",\n        waitingFor: \"ç­‰å¾…å°è±¡\",\n        context: \"æƒ…å¢ƒ\"\n      },\n      projectFilterLabel: \"å°ˆæ¡ˆ\",\n      projectFilterPlaceholder: \"å°ˆæ¡ˆåç¨±\",\n      projectFilterAny: \"å…¨éƒ¨å°ˆæ¡ˆ\",\n      waitingFilterLabel: \"ç­‰å¾…å°è±¡\",\n      waitingFilterPlaceholder: \"ç­‰å¾…å°è±¡\",\n      waitingFilterAny: \"å…¨éƒ¨ç­‰å¾…å°è±¡\",\n      contextFilterLabel: \"æƒ…å¢ƒ\",\n      contextFilterAny: \"å…¨éƒ¨æƒ…å¢ƒ\",\n      groupingLabels: {\n        time: \"æ™‚é–“\",\n        recurrence: \"é‡è¤‡\",\n        project: \"å°ˆæ¡ˆ\"\n      },\n      taskOptions: \"ä»»å‹™é¸é …\",\n      markDone: \"æ¨™è¨˜ç‚ºå®Œæˆ\",\n      markOpen: \"æ¨™è¨˜ç‚ºæœªå®Œæˆ\",\n      view: \"æŸ¥çœ‹\",\n      snoozePick: \"é¸æ“‡\",\n      snoozePlus1: \"+1å¤©\",\n      snoozePlus7: \"+7å¤©\",\n      untitled: \"ï¼ˆæœªå‘½åä»»å‹™ï¼‰\",\n      bulk: {\n        select: \"æ‰¹é‡\",\n        selectTask: \"é¸æ“‡\",\n        deselectTask: \"å–æ¶ˆé¸æ“‡\",\n        selectAll: \"å…¨é¸\",\n        selectNone: \"æ¸…é™¤\",\n        selected: function selected(n) {\n          return \"\\u5DF2\\u9078 \".concat(n, \" \\u9805\");\n        },\n        selectGroup: function selectGroup(title) {\n          return \"\\u9078\\u64C7 \".concat(title, \" \\u4E2D\\u7684\\u5168\\u90E8\\u4EFB\\u52D9\");\n        },\n        deselectGroup: function deselectGroup(title) {\n          return \"\\u53D6\\u6D88\\u9078\\u64C7 \".concat(title, \" \\u4E2D\\u7684\\u5168\\u90E8\\u4EFB\\u52D9\");\n        },\n        complete: \"å®Œæˆ\",\n        reopen: \"é‡æ–°é–‹å•Ÿ\",\n        snooze1d: \"+1å¤©\",\n        snooze7d: \"+7å¤©\",\n        setMetadata: \"è¨­å®š...\",\n        cancel: \"å–æ¶ˆ\",\n        completedCount: function completedCount(n) {\n          return \"\\u5DF2\\u5B8C\\u6210 \".concat(n, \" \\u500B\\u4EFB\\u52D9\");\n        },\n        reopenedCount: function reopenedCount(n) {\n          return \"\\u5DF2\\u91CD\\u65B0\\u958B\\u555F \".concat(n, \" \\u500B\\u4EFB\\u52D9\");\n        },\n        snoozedCount: function snoozedCount(n, days) {\n          return \"\\u5DF2\\u5EF6\\u5F8C \".concat(n, \" \\u500B\\u4EFB\\u52D9 \").concat(days, \" \\u5929\");\n        },\n        updatedCount: function updatedCount(field, n) {\n          return \"\\u5DF2\\u66F4\\u65B0 \".concat(n, \" \\u500B\\u4EFB\\u52D9\\u7684 \").concat(field);\n        },\n        fieldLabels: {\n          project: \"å°ˆæ¡ˆ\",\n          waitingFor: \"ç­‰å¾…å°è±¡\",\n          context: \"æƒ…å¢ƒ\",\n          priority: \"å„ªå…ˆç´š\",\n          energy: \"ç²¾åŠ›\",\n          gtd: \"GTD\"\n        },\n        metaValues: {\n          priorityHigh: \"é«˜\",\n          priorityMedium: \"ä¸­\",\n          priorityLow: \"ä½Ž\",\n          energyHigh: \"é«˜\",\n          energyMedium: \"ä¸­\",\n          energyLow: \"ä½Ž\",\n          gtdNext: \"ä¸‹ä¸€æ­¥è¡Œå‹•\",\n          gtdDelegated: \"å·²å§”æ´¾\",\n          gtdDeferred: \"å·²å»¶æœŸ\",\n          gtdSomeday: \"å°‡ä¾†/ä¹Ÿè¨±\",\n          clear: \"æ¸…é™¤\"\n        },\n        undo: \"å¾©åŽŸ\",\n        undoSuccess: \"å·²å¾©åŽŸè®Šæ›´\",\n        undoFailed: \"å¾©åŽŸå¤±æ•—\"\n      }\n    },\n    today: {\n      title: \"Better Tasks - ä»Šæ—¥\",\n      starting: \"ä»Šæ—¥é–‹å§‹\",\n      deferred: \"å»¶å¾Œè‡³ä»Šæ—¥\",\n      due: \"ä»Šæ—¥åˆ°æœŸ\",\n      overdue: function overdue(n) {\n        return \"\\u903E\\u671F\\uFF08\".concat(n, \"\\uFF09\");\n      },\n      empty: \"ä»Šæ—¥æ²’æœ‰ä»»å‹™ã€‚\",\n      complete: \"å®Œæˆ\",\n      snoozeShort: \"å»¶å¾Œ 1 å¤©\",\n      untitled: \"ï¼ˆæœªå‘½åï¼‰\"\n    },\n    pillMenu: {\n      moreActions: \"æ›´å¤šä»»å‹™æ“ä½œ\",\n      snoozePlus1: \"å»¶å¾Œ 1 å¤©\",\n      snoozePlus3: \"å»¶å¾Œ 3 å¤©\",\n      snoozeNextMon: \"å»¶å¾Œè‡³ä¸‹é€±ä¸€\",\n      snoozePick: \"å»¶å¾Œï¼ˆé¸æ“‡æ—¥æœŸï¼‰\",\n      skipOccurrence: \"ç•¥éŽæ­¤é‡è¤‡\",\n      generateNext: \"ç«‹åˆ»ç”Ÿæˆä¸‹ä¸€æ¬¡\",\n      endRecurrence: \"çµæŸé‡è¤‡\",\n      addProject: \"æ–°å¢žå°ˆæ¡ˆ\",\n      removeProject: \"ç§»é™¤å°ˆæ¡ˆ\",\n      addContext: \"æ–°å¢žæƒ…å¢ƒ\",\n      removeContext: \"ç§»é™¤æƒ…å¢ƒ\",\n      addWaiting: \"æ–°å¢žç­‰å¾…å°è±¡\",\n      removeWaiting: \"ç§»é™¤ç­‰å¾…å°è±¡\",\n      cyclePriority: \"åˆ‡æ›å„ªå…ˆç´š\",\n      cycleEnergy: \"åˆ‡æ›ç²¾åŠ›\",\n      cycleGtd: \"åˆ‡æ› GTD\",\n      metaHeading: \"ä¸­ç¹¼è³‡æ–™\"\n    },\n    taskMenu: {\n      setProject: \"è¨­å®šå°ˆæ¡ˆ\",\n      editProject: \"ç·¨è¼¯å°ˆæ¡ˆ\",\n      removeProject: \"ç§»é™¤å°ˆæ¡ˆ\",\n      setContext: \"è¨­å®šæƒ…å¢ƒ\",\n      editContext: \"ç·¨è¼¯æƒ…å¢ƒ\",\n      removeContext: \"ç§»é™¤æƒ…å¢ƒ\",\n      setWaiting: \"è¨­å®šç­‰å¾…å°è±¡\",\n      editWaiting: \"ç·¨è¼¯ç­‰å¾…å°è±¡\",\n      removeWaiting: \"ç§»é™¤ç­‰å¾…å°è±¡\",\n      priorityCycle: \"å„ªå…ˆç´šï¼ˆé»žæ“Šåˆ‡æ›ï¼‰\",\n      energyCycle: \"ç²¾åŠ›ï¼ˆé»žæ“Šåˆ‡æ›ï¼‰\",\n      cycleGtd: \"åˆ‡æ› GTD\",\n      metaHeading: \"ä¸­ç¹¼è³‡æ–™\"\n    },\n    metadata: {\n      repeat: \"é‡è¤‡\",\n      project: \"å°ˆæ¡ˆ\",\n      waitingFor: \"ç­‰å¾…å°è±¡\",\n      context: \"æƒ…å¢ƒ\",\n      gtd: \"GTD\",\n      priority: \"å„ªå…ˆç´š\",\n      energy: \"ç²¾åŠ›\",\n      start: \"é–‹å§‹\",\n      defer: \"å»¶å¾Œ\",\n      due: \"åˆ°æœŸ\",\n      next: \"ä¸‹ä¸€æ­¥\",\n      repeatingTask: \"é‡è¤‡ Better Task\",\n      scheduledTask: \"æŽ’ç¨‹ Better Task\",\n      loadingTheme: \"æ­£åœ¨è¼‰å…¥ä¸»é¡Œâ€¦\",\n      applyTheme: \"æ­£åœ¨å¥—ç”¨ä¸»é¡Œâ€¦\",\n      themeChanged: \"åµæ¸¬åˆ°ä¸»é¡Œè®Šæ›´ï¼Œæ­£åœ¨é‡æ–°è¼‰å…¥ä»¥å¥—ç”¨è®Šæ›´ã€‚\",\n      repeatRule: \"é‡è¤‡è¦å‰‡\",\n      projectLabel: \"å°ˆæ¡ˆ\",\n      waitingLabel: \"ç­‰å¾…å°è±¡\",\n      contextLabel: \"æƒ…å¢ƒ\",\n      priorityLabel: \"å„ªå…ˆç´š\",\n      energyLabel: \"ç²¾åŠ›\",\n      gtdLabel: \"GTD\"\n    }\n  }\n};\n\n//# sourceURL=webpack://better-tasks/./src/i18n.js?\n}");

/***/ },

/***/ "./src/index.js"
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var izitoast__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! izitoast */ \"./node_modules/izitoast/dist/js/iziToast.js\");\n/* harmony import */ var izitoast__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(izitoast__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _dashboard_App__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./dashboard/App */ \"./src/dashboard/App.jsx\");\n/* harmony import */ var _i18n__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./i18n */ \"./src/i18n.js\");\n/* harmony import */ var _project_store__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./project-store */ \"./src/project-store.js\");\n/* harmony import */ var _waiting_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./waiting-store */ \"./src/waiting-store.js\");\n/* harmony import */ var _context_store__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./context-store */ \"./src/context-store.js\");\n/* harmony import */ var _dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./dashboard/viewsStore */ \"./src/dashboard/viewsStore.js\");\nfunction _regeneratorValues(e){if(null!=e){var t=e[\"function\"==typeof Symbol&&Symbol.iterator||\"@@iterator\"],r=0;if(t)return t.call(e);if(\"function\"==typeof e.next)return e;if(!isNaN(e.length))return{next:function next(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e};}};}throw new TypeError(_typeof(e)+\" is not iterable\");}function _toArray(r){return _arrayWithHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableRest();}function _createForOfIteratorHelper(r,e){var t=\"undefined\"!=typeof Symbol&&r[Symbol.iterator]||r[\"@@iterator\"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&\"number\"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]};},e:function e(r){throw r;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var o,a=!0,u=!1;return{s:function s(){t=t.call(r);},n:function n(){var r=t.next();return a=r.done,r;},e:function e(r){u=!0,o=r;},f:function f(){try{a||null==t[\"return\"]||t[\"return\"]();}finally{if(u)throw o;}}};}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e;}function _regenerator(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,r=\"function\"==typeof Symbol?Symbol:{},n=r.iterator||\"@@iterator\",o=r.toStringTag||\"@@toStringTag\";function i(r,n,o,i){var c=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(c.prototype);return _regeneratorDefine2(u,\"_invoke\",function(r,n,o){var i,c,u,f=0,p=o||[],y=!1,G={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,r){return i=t,c=0,u=e,G.n=r,a;}};function d(r,n){for(c=r,u=n,t=0;!y&&f&&!o&&t<p.length;t++){var o,i=p[t],d=G.p,l=i[2];r>3?(o=l===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=r<2&&d<i[1])?(c=0,G.v=n,G.n=i[1]):d<l&&(o=r<3||i[0]>n||n>l)&&(i[4]=r,i[5]=n,G.n=l,c=0));}if(o||r>1)return a;throw y=!0,n;}return function(o,p,l){if(f>1)throw TypeError(\"Generator is already running\");for(y&&1===p&&d(p,l),c=p,u=l;(t=c<2?e:u)||!y;){i||(c?c<3?(c>1&&(G.n=-1),d(c,u)):G.n=u:G.v=u);try{if(f=2,i){if(c||(o=\"next\"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError(\"iterator result is not an object\");if(!t.done)return t;u=t.value,c<2&&(c=0);}else 1===c&&(t=i[\"return\"])&&t.call(i),c<2&&(u=TypeError(\"The iterator does not provide a '\"+o+\"' method\"),c=1);i=e;}else if((t=(y=G.n<0)?u:r.call(n,G))!==a)break;}catch(t){i=e,c=1,u=t;}finally{f=1;}}return{value:t,done:y};};}(r,o,i),!0),u;}var a={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var c=[][n]?t(t([][n]())):(_regeneratorDefine2(t={},n,function(){return this;}),t),u=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,o,\"GeneratorFunction\")),e.prototype=Object.create(u),e;}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(u,\"constructor\",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,\"constructor\",GeneratorFunction),GeneratorFunction.displayName=\"GeneratorFunction\",_regeneratorDefine2(GeneratorFunctionPrototype,o,\"GeneratorFunction\"),_regeneratorDefine2(u),_regeneratorDefine2(u,o,\"Generator\"),_regeneratorDefine2(u,n,function(){return this;}),_regeneratorDefine2(u,\"toString\",function(){return\"[object Generator]\";}),(_regenerator=function _regenerator(){return{w:i,m:f};})();}function _regeneratorDefine2(e,r,n,t){var i=Object.defineProperty;try{i({},\"\",{});}catch(e){i=0;}_regeneratorDefine2=function _regeneratorDefine(e,r,n,t){function o(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e);});}r?i?i(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(o(\"next\",0),o(\"throw\",1),o(\"return\",2));},_regeneratorDefine2(e,r,n,t);}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value;}catch(n){return void e(n);}i.done?t(u):Promise.resolve(u).then(r,o);}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,\"next\",n);}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,\"throw\",n);}_next(void 0);});};}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError(\"Cannot call a class as a function\");}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o);}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,\"prototype\",{writable:!1}),e;}function _toPropertyKey(t){var i=_toPrimitive(t,\"string\");return\"symbol\"==_typeof(i)?i:i+\"\";}function _toPrimitive(t,r){if(\"object\"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||\"default\");if(\"object\"!=_typeof(i))return i;throw new TypeError(\"@@toPrimitive must return a primitive value.\");}return(\"string\"===r?String:Number)(t);}function _callSuper(t,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e));}function _possibleConstructorReturn(t,e){if(e&&(\"object\"==_typeof(e)||\"function\"==typeof e))return e;if(void 0!==e)throw new TypeError(\"Derived constructors may only return object or undefined\");return _assertThisInitialized(t);}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e;}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t;})();}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t);},_getPrototypeOf(t);}function _inherits(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,\"prototype\",{writable:!1}),e&&_setPrototypeOf(t,e);}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t;},_setPrototypeOf(t,e);}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}function _iterableToArray(r){if(\"undefined\"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r[\"@@iterator\"])return Array.from(r);}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r);}function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}function _unsupportedIterableToArray(r,a){if(r){if(\"string\"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return\"Object\"===t&&r.constructor&&(t=r.constructor.name),\"Map\"===t||\"Set\"===t?Array.from(r):\"Arguments\"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0;}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n;}function _iterableToArrayLimit(r,l){var t=null==r?null:\"undefined\"!=typeof Symbol&&r[Symbol.iterator]||r[\"@@iterator\"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1;}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r;}finally{try{if(!f&&null!=t[\"return\"]&&(u=t[\"return\"](),Object(u)!==u))return;}finally{if(o)throw n;}}return a;}}function _arrayWithHoles(r){if(Array.isArray(r))return r;}function _typeof(o){\"@babel/helpers - typeof\";return _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&\"function\"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?\"symbol\":typeof o;},_typeof(o);}var ADV_ATTR_NAMES_SETTING=\"bt-advanced-attr-names\";var DEFAULT_REPEAT_ATTR=\"BT_attrRepeat\";var DEFAULT_START_ATTR=\"BT_attrStart\";var DEFAULT_DEFER_ATTR=\"BT_attrDefer\";var DEFAULT_DUE_ATTR=\"BT_attrDue\";var DEFAULT_COMPLETED_ATTR=\"BT_attrCompleted\";var DEFAULT_PROJECT_ATTR=\"BT_attrProject\";var DEFAULT_WAITING_FOR_ATTR=\"BT_attrWaitingFor\";var DEFAULT_CONTEXT_ATTR=\"BT_attrContext\";var DEFAULT_PRIORITY_ATTR=\"BT_attrPriority\";var DEFAULT_ENERGY_ATTR=\"BT_attrEnergy\";var DEFAULT_GTD_ATTR=\"BT_attrGTD\";var ADVANCE_ATTR=\"BT_attrAdvance\";var INSTALL_TOAST_KEY=\"rt-intro-toast\";var AI_MODE_SETTING=\"bt-ai-mode\";var AI_KEY_SETTING=\"bt-ai-openai-key\";var AI_MODE_OPTIONS=[\"Off\",\"Use my OpenAI key\"];var AI_MODEL=\"gpt-4o-mini\";var AI_SYSTEM_PROMPT=[\"You are a strict JSON generator for task parsing. Return ONLY JSON with no prose.\",'Required: { \"title\": string }','Optional: \"repeatRule\", \"dueDateText\", \"startDateText\", \"deferDateText\", \"project\", \"context\", \"priority\", \"energy\".','priority/energy must be one of: \"low\", \"medium\", \"high\", or null.',\"Dates: prefer Roam page links like [[November 18th, 2025]]; if unsure, use short phrases like \\\"next Monday\\\" (not bare weekday names).\",\"If you see time (e.g., 3pm), include it only in dueDateText/startDateText (e.g., \\\"next Wednesday at 3pm\\\").\",\"For wording that implies when work can start (beginning/starting/available/from/after), use startDateText; for deadlines (by/before/due), use dueDateText; for postponement, use deferDateText.\",\"For vague spans like \\\"this week/this weekend/this month/this quarter\\\", prefer concrete dates (start of span for startDateText, end of span for dueDateText when only one date is given).\",\"Please consider words like every, each, daily, weekly, monthly, yearly, annually, weekdays, weekends, biweekly, fortnightly, quarterly, semiannual(ly), semi-annual(ly), twice a year, every N days/weeks/months/years as indicators of repeat rules.\",\"Keep scheduling details (repeat/dates) OUT of the title; place them only in repeatRule/dueDateText/startDateText/deferDateText. The title should just be the task text.\",\"Do not invent details not implied.\",'If input lacks a clear task title, set \"title\" to the original input.'].join(\" \");var START_ICON=\"â±\";var DEFER_ICON=\"â³\";var DUE_ICON=\"ðŸ“…\";var WEEK_START_OPTIONS=[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"];var GTD_STATUS_ORDER=[\"next action\",\"delegated\",\"deferred\",\"someday\"];var PARENT_WRITE_DELAY_MS=120;var TOAST_HIDE_DELAY_MS=120;var DASHBOARD_TOPBAR_BUTTON_ID=\"bt-dashboard-button\";var DASHBOARD_TOPBAR_SPACER_ID=\"bt-dashboard-button-spacer\";var TODAY_WIDGET_LAYOUT_SETTING=\"bt-today-widget-layout\";var TODAY_WIDGET_OVERDUE_SETTING=\"bt-today-widget-include-overdue\";var TODAY_WIDGET_COMPLETED_SETTING=\"bt-today-widget-show-completed\";var TODAY_WIDGET_PLACEMENT_SETTING=\"bt-today-widget-placement\";var TODAY_WIDGET_HEADING_SETTING=\"bt-today-widget-heading\";var TODAY_WIDGET_TITLE_SETTING=\"bt-today-widget-title\";var TODAY_WIDGET_ENABLE_SETTING=\"bt-today-widget-enabled\";var TODAY_BADGE_ENABLE_SETTING=\"bt-today-badge-enabled\";var TODAY_BADGE_LABEL_SETTING=\"bt-today-badge-label\";var TODAY_BADGE_OVERDUE_SETTING=\"bt-today-badge-include-overdue\";var TODAY_BADGE_BG_SETTING=\"bt-today-badge-bg\";var TODAY_BADGE_FG_SETTING=\"bt-today-badge-fg\";var LANGUAGE_SETTING=\"bt-language\";var ADV_DASH_OPTIONS_SETTING=\"bt-advanced-dashboard-options\";var REVIEW_STEP_NEXT_ACTIONS_SETTING=\"bt-review-step-next-actions\";var REVIEW_STEP_WAITING_FOR_SETTING=\"bt-review-step-waiting-for\";var REVIEW_STEP_COMPLETED_7D_SETTING=\"bt-review-step-completed-7d\";var REVIEW_STEP_UPCOMING_7D_SETTING=\"bt-review-step-upcoming-7d\";var REVIEW_STEP_OVERDUE_SETTING=\"bt-review-step-overdue\";var REVIEW_STEP_SOMEDAY_SETTING=\"bt-review-step-someday\";var TODAY_WIDGET_ANCHOR_TEXT_DEFAULT=\"Better Tasks - Today\";var TODAY_WIDGET_ANCHOR_TEXT_LEGACY=[\"BetterTasks Today Widget\",\"Better Tasks - Today\"];var TODAY_WIDGET_PANEL_CHILD_TEXT=\"\";var TODAY_WIDGET_PANEL_CHILD_TEXT_LEGACY=[\"Today Widget Panel\"];var PILL_THRESHOLD_SETTING=\"bt-pill-checkbox-threshold\";var DEFAULT_PILL_THRESHOLD=100;// skip pill rendering when too many checkboxes are present\nvar SUPPORTED_LANGUAGES=Object.keys(_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n||{en:{}});var EN_STRING_PATH_MAP=new Map();var currentLanguage=\"en\";var todayBadgeNode=null;var todayBadgeLabelNode=null;var todayBadgeCountNode=null;var todayBadgeRefreshTimer=null;var lastTodayBadgeSignature=null;var todayBadgeOverrides={bg:null,fg:null,label:null};var todayWidgetCbWindowStart=0;var todayWidgetCbCount=0;var todayWidgetCbTrippedUntil=0;var TODAY_WIDGET_CB_WINDOW_MS=2000;var TODAY_WIDGET_CB_MAX=10;var TODAY_WIDGET_CB_COOLDOWN_MS=15000;function buildEnStringLookup(obj){var prefix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!obj||_typeof(obj)!==\"object\")return;Object.entries(obj).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];if(typeof value===\"string\"){var path=[].concat(_toConsumableArray(prefix),[key]);if(!EN_STRING_PATH_MAP.has(value)){EN_STRING_PATH_MAP.set(value,path);}}else if(value&&_typeof(value)===\"object\"&&!Array.isArray(value)){buildEnStringLookup(value,[].concat(_toConsumableArray(prefix),[key]));}});}buildEnStringLookup((_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===null||_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===void 0?void 0:_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n.en)||{});var todayWidgetRenderTimer=null;var todayTitleChangeDebounceTimer=null;var todayWidgetPanelRoot=null;var todayWidgetPanelContainer=null;var lastTodayWidgetSignature=null;var lastTodayInlineSignature=null;var todayInlineRenderInFlight=false;var lastTodayAnchorIsHeading=false;var todayEnabledOverride=null;var todayHeadingRecheckPending=false;var todayHeadingRetryCount=0;var MAX_TODAY_HEADING_RETRIES=3;var todayNavListenerAttached=false;var teardownTodayPanelGlobal=null;var lastTodayAnchorUid=null;var todayInlineChildUids=new Set();var todayAnchorTextHistory=new Set();var MAX_TODAY_ANCHOR_TEXT_HISTORY=200;var MAX_INVALID_PARSE_TOASTED=1000;var pillRefreshTimer=null;var todayWidgetForceNext=false;var lastTodayRenderAt=0;var lastPillDecorateRun=0;var dashboardRefreshTimer=null;var dashboardRefreshLogAt=0;var DASHBOARD_REFRESH_LOG_INTERVAL_MS=5*60*1000;var dashboardWatchClearTimer=null;var pillScrollHandlerAttached=false;var pillScrollHandler=null;var pillScrollDebounceMs=420;var todayNavListener=null;var detachTodayNavigationListenerGlobal=null;var MAX_BLOCKS_FOR_PILLS=1500;var pillSkipDecorate=new Set();var INLINE_META_CACHE_TTL_MS=10*60*1000;var INLINE_META_CACHE_MAX=5000;var TODAY_WIDGET_ENABLED=true;// temporary kill switch\nvar DEBUG_BT=false;var DEBUG_BT_PERF=false;var bulkOperationInProgress=false;// Suppress individual toasts during bulk operations\nvar bulkOperationCooldownTimer=null;// Keep toast suppression active briefly after bulk op ends\nvar BULK_OPERATION_COOLDOWN_MS=1500;// Time to keep suppressing toasts after bulk op\nvar DASHBOARD_NOTIFY_BATCH_SIZE=25;var DASHBOARD_NOTIFY_DEBOUNCE_MS=250;var dashboardNotifyQueue=new Set();var dashboardNotifyTimer=null;var TODAY_WIDGET_PAGE_GUARD_TTL_MS=1500;var todayWidgetPageGuard={at:0,value:true,inFlight:null};var todayWidgetRefreshTimer=null;var todayWidgetRefreshForcePending=false;var PILL_DOM_COUNT_TTL_MS=6000;var pillDomCountsCache={at:0,blockCount:null,checkboxCount:null};var lastAttrNames=null;var activeDashboardController=null;var dashboardWatchers=new Map();var topbarButtonObserver=null;var themeObserver=null;var themeSyncTimer=null;var lastThemeSample=null;var roamStudioToggleObserver=null;var btPendingRoamStudioTheme=false;var ReactDOMGlobal=typeof window!==\"undefined\"?window.ReactDOM||null:null;var ReactGlobal=typeof window!==\"undefined\"?window.React||null:null;var DashboardErrorBoundary=/*#__PURE__*/function(_ref3){function DashboardErrorBoundary(props){var _this;_classCallCheck(this,DashboardErrorBoundary);_this=_callSuper(this,DashboardErrorBoundary,[props]);_this.state={error:null,info:null};return _this;}_inherits(DashboardErrorBoundary,_ref3);return _createClass(DashboardErrorBoundary,[{key:\"componentDidCatch\",value:function componentDidCatch(error,info){try{// info.componentStack is the most useful thing to identify which component is looping/crashing.\nconsole.error(\"[BetterTasks] Dashboard render crashed\",error);if(info!==null&&info!==void 0&&info.componentStack)console.error(\"[BetterTasks] Dashboard component stack:\",info.componentStack);}finally{this.setState({error:error,info:info});}}},{key:\"render\",value:function render(){var _this$state,_this$props2;if((_this$state=this.state)!==null&&_this$state!==void 0&&_this$state.error){var _this$props;return/*#__PURE__*/React.createElement(\"div\",{className:\"bt-dashboard bt-dashboard--error\"},/*#__PURE__*/React.createElement(\"header\",{className:\"bt-dashboard__header\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h2\",null,\"Better Tasks\"),/*#__PURE__*/React.createElement(\"p\",null,\"Dashboard failed to render. Check console for details.\")),/*#__PURE__*/React.createElement(\"div\",{className:\"bt-dashboard__header-actions\"},/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"bp3-button bp3-small\",\"aria-label\":\"Close\",onClick:(_this$props=this.props)===null||_this$props===void 0?void 0:_this$props.onRequestClose},\"\\u2715\"))));}return((_this$props2=this.props)===null||_this$props2===void 0?void 0:_this$props2.children)||null;}}]);}((ReactGlobal===null||ReactGlobal===void 0?void 0:ReactGlobal.Component)||/*#__PURE__*/_createClass(function _class(){_classCallCheck(this,_class);}));function enqueueDashboardNotifyBlockChange(uid){if(!uid)return;try{var _activeDashboardContr,_activeDashboardContr2;if(!((_activeDashboardContr=activeDashboardController)!==null&&_activeDashboardContr!==void 0&&(_activeDashboardContr2=_activeDashboardContr.isOpen)!==null&&_activeDashboardContr2!==void 0&&_activeDashboardContr2.call(_activeDashboardContr)))return;}catch(err){debugLog(\"dashboard notify isOpen check failed\",err);return;}dashboardNotifyQueue.add(uid);if(dashboardNotifyTimer)return;dashboardNotifyTimer=setTimeout(function(){dashboardNotifyTimer=null;void flushDashboardNotifyQueue();},DASHBOARD_NOTIFY_DEBOUNCE_MS);}function flushDashboardNotifyQueue(){return _flushDashboardNotifyQueue.apply(this,arguments);}function _flushDashboardNotifyQueue(){_flushDashboardNotifyQueue=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee153(){var isOpen,_activeDashboardContr118,_activeDashboardContr119,uids,batch,remainder,_iterator46,_step46,_id,_activeDashboardContr120,_activeDashboardContr121,_iterator47,_step47,id,_t139,_t140;return _regenerator().w(function(_context154){while(1)switch(_context154.p=_context154.n){case 0:if(dashboardNotifyQueue.size){_context154.n=1;break;}return _context154.a(2);case 1:isOpen=false;try{isOpen=!!((_activeDashboardContr118=activeDashboardController)!==null&&_activeDashboardContr118!==void 0&&(_activeDashboardContr119=_activeDashboardContr118.isOpen)!==null&&_activeDashboardContr119!==void 0&&_activeDashboardContr119.call(_activeDashboardContr118));}catch(err){debugLog(\"dashboard notify isOpen check failed\",err);isOpen=false;}if(isOpen){_context154.n=2;break;}dashboardNotifyQueue.clear();return _context154.a(2);case 2:uids=Array.from(dashboardNotifyQueue);dashboardNotifyQueue.clear();batch=uids.slice(0,DASHBOARD_NOTIFY_BATCH_SIZE);remainder=uids.slice(DASHBOARD_NOTIFY_BATCH_SIZE);_iterator46=_createForOfIteratorHelper(batch);_context154.p=3;_iterator46.s();case 4:if((_step46=_iterator46.n()).done){_context154.n=9;break;}_id=_step46.value;_context154.p=5;_context154.n=6;return(_activeDashboardContr120=activeDashboardController)===null||_activeDashboardContr120===void 0||(_activeDashboardContr121=_activeDashboardContr120.notifyBlockChange)===null||_activeDashboardContr121===void 0?void 0:_activeDashboardContr121.call(_activeDashboardContr120,_id);case 6:_context154.n=8;break;case 7:_context154.p=7;_t139=_context154.v;debugLog(\"dashboard notifyBlockChange failed\",_t139);case 8:_context154.n=4;break;case 9:_context154.n=11;break;case 10:_context154.p=10;_t140=_context154.v;_iterator46.e(_t140);case 11:_context154.p=11;_iterator46.f();return _context154.f(11);case 12:if(remainder.length){_iterator47=_createForOfIteratorHelper(remainder);try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){id=_step47.value;dashboardNotifyQueue.add(id);}}catch(err){_iterator47.e(err);}finally{_iterator47.f();}if(!dashboardNotifyTimer){dashboardNotifyTimer=setTimeout(function(){dashboardNotifyTimer=null;void flushDashboardNotifyQueue();},DASHBOARD_NOTIFY_DEBOUNCE_MS);}}case 13:return _context154.a(2);}},_callee153,null,[[5,7],[3,10,11,12]]);}));return _flushDashboardNotifyQueue.apply(this,arguments);}function DashboardRoot(_ref4){var controller=_ref4.controller,onRequestClose=_ref4.onRequestClose,onHeaderReady=_ref4.onHeaderReady,language=_ref4.language;return/*#__PURE__*/React.createElement(DashboardErrorBoundary,{onRequestClose:onRequestClose},/*#__PURE__*/React.createElement(_dashboard_App__WEBPACK_IMPORTED_MODULE_1__[\"default\"],{controller:controller,onRequestClose:onRequestClose,onHeaderReady:onHeaderReady,language:language}));}var DOW_MAP={sunday:\"SU\",monday:\"MO\",tuesday:\"TU\",wednesday:\"WE\",thursday:\"TH\",friday:\"FR\",saturday:\"SA\"};var DOW_IDX=[\"SU\",\"MO\",\"TU\",\"WE\",\"TH\",\"FR\",\"SA\"];var ORD_MAP={\"1st\":1,\"first\":1,\"2nd\":2,\"second\":2,\"3rd\":3,\"third\":3,\"4th\":4,\"fourth\":4,\"last\":-1};var DOW_ALIASES={su:\"sunday\",sun:\"sunday\",sunday:\"sunday\",mo:\"monday\",mon:\"monday\",monday:\"monday\",tu:\"tuesday\",tue:\"tuesday\",tues:\"tuesday\",tuesday:\"tuesday\",we:\"wednesday\",wed:\"wednesday\",wednesday:\"wednesday\",th:\"thursday\",thu:\"thursday\",thur:\"thursday\",thurs:\"thursday\",thursday:\"thursday\",fr:\"friday\",fri:\"friday\",friday:\"friday\",sa:\"saturday\",sat:\"saturday\",saturday:\"saturday\"};var DOW_ORDER=[\"MO\",\"TU\",\"WE\",\"TH\",\"FR\",\"SA\",\"SU\"];var DEFAULT_WEEK_START_CODE=\"MO\";var MONTH_MAP={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12};var MONTH_KEYWORD_INTERVAL_LOOKUP={quarterly:3,\"every quarter\":3,semiannual:6,\"semi annual\":6,semiannually:6,\"semi annually\":6,\"semi-annual\":6,\"semi-annually\":6,\"twice a year\":6,\"twice-a-year\":6,\"twice per year\":6,\"twice-per-year\":6};/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({onload:function onload(_ref5){var _window$roamAlphaAPI,_window$roamAlphaAPI2;var extensionAPI=_ref5.extensionAPI;(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.initProjectStore)(extensionAPI);(0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.initWaitingStore)(extensionAPI);(0,_context_store__WEBPACK_IMPORTED_MODULE_5__.initContextStore)(extensionAPI);var PICKLIST_EXCLUDE_ENABLED_SETTING=\"bt_excludePicklistPagesEnabled\";var PICKLIST_EXCLUDE_PAGES_SETTING=\"bt_excludePicklistPages\";var normalizeBooleanSetting=function normalizeBooleanSetting(raw){if(raw===true||raw===1)return true;if(raw===false||raw===0)return false;if(raw===undefined||raw===null)return false;var norm=typeof raw===\"string\"?raw.trim().toLowerCase():String(raw).trim().toLowerCase();if([\"true\",\"1\",\"yes\",\"on\"].includes(norm))return true;if([\"false\",\"0\",\"no\",\"off\"].includes(norm))return false;return!!raw;};var buildSettingsConfig=function buildSettingsConfig(){var _extensionAPI$setting,_extensionAPI$setting2,_extensionAPI$setting3,_extensionAPI$setting4,_extensionAPI$setting5,_extensionAPI$setting6,_extensionAPI$setting7,_extensionAPI$setting8,_extensionAPI$setting9,_extensionAPI$setting0;var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},todayEnabled=_ref6.todayEnabled,badgeEnabled=_ref6.badgeEnabled,picklistExcludeEnabled=_ref6.picklistExcludeEnabled,lang=_ref6.lang,uiOverrides=_ref6.uiOverrides;var langSetting=getLanguageSetting(lang);var tr=function tr(k,fallback){return t(k,langSetting)||fallback;};var overrides=uiOverrides&&_typeof(uiOverrides)===\"object\"?uiOverrides:{};var todayEnabledValue=todayEnabled!==null&&todayEnabled!==void 0?todayEnabled:getTodayWidgetEnabled();var badgeEnabledValue=badgeEnabled!==null&&badgeEnabled!==void 0?badgeEnabled:getTodayBadgeEnabled();var picklistExcludeEnabledValue=picklistExcludeEnabled!==null&&picklistExcludeEnabled!==undefined?normalizeBooleanSetting(picklistExcludeEnabled):normalizeBooleanSetting(extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting=extensionAPI.settings)===null||_extensionAPI$setting===void 0||(_extensionAPI$setting2=_extensionAPI$setting.get)===null||_extensionAPI$setting2===void 0?void 0:_extensionAPI$setting2.call(_extensionAPI$setting,PICKLIST_EXCLUDE_ENABLED_SETTING));var advancedAttrNamesEnabled=overrides.advancedAttrNamesEnabled!==undefined?normalizeBooleanSetting(overrides.advancedAttrNamesEnabled):normalizeBooleanSetting(extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting3=extensionAPI.settings)===null||_extensionAPI$setting3===void 0||(_extensionAPI$setting4=_extensionAPI$setting3.get)===null||_extensionAPI$setting4===void 0?void 0:_extensionAPI$setting4.call(_extensionAPI$setting3,ADV_ATTR_NAMES_SETTING));var advancedDashboardEnabled=overrides.advancedDashboardEnabled!==undefined?normalizeBooleanSetting(overrides.advancedDashboardEnabled):normalizeBooleanSetting(extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting5=extensionAPI.settings)===null||_extensionAPI$setting5===void 0||(_extensionAPI$setting6=_extensionAPI$setting5.get)===null||_extensionAPI$setting6===void 0?void 0:_extensionAPI$setting6.call(_extensionAPI$setting5,ADV_DASH_OPTIONS_SETTING));var destination=overrides.destination!==undefined?overrides.destination:extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting7=extensionAPI.settings)===null||_extensionAPI$setting7===void 0||(_extensionAPI$setting8=_extensionAPI$setting7.get)===null||_extensionAPI$setting8===void 0?void 0:_extensionAPI$setting8.call(_extensionAPI$setting7,\"rt-destination\");var isDnpUnderHeading=destination===\"DNP under heading\";var AI_MODE_USE_KEY=AI_MODE_OPTIONS[1];var aiMode=overrides.aiMode!==undefined?overrides.aiMode:extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting9=extensionAPI.settings)===null||_extensionAPI$setting9===void 0||(_extensionAPI$setting0=_extensionAPI$setting9.get)===null||_extensionAPI$setting0===void 0?void 0:_extensionAPI$setting0.call(_extensionAPI$setting9,AI_MODE_SETTING);var shouldShowAiKey=aiMode===AI_MODE_USE_KEY;// Helper to set + rebuild (keeps handlers consistent)\nvar setAndRebuild=function setAndRebuild(id,value){var nextUiOverrides=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};try{var _extensionAPI$setting1,_extensionAPI$setting10;extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting1=extensionAPI.settings)===null||_extensionAPI$setting1===void 0||(_extensionAPI$setting10=_extensionAPI$setting1.set)===null||_extensionAPI$setting10===void 0||_extensionAPI$setting10.call(_extensionAPI$setting1,id,value);}catch(_){// ignore\n}// Rebuild so conditional blocks appear/disappear immediately.\n// Delay slightly so the settings panel handler updates are visible.\nsetTimeout(function(){var _activeDashboardContr3;rebuildSettingsPanel(null,null,null,null,nextUiOverrides);if(options.notifyReviewSteps&&(_activeDashboardContr3=activeDashboardController)!==null&&_activeDashboardContr3!==void 0&&_activeDashboardContr3.notifyReviewStepSettingsChanged){activeDashboardController.notifyReviewStepSettingsChanged();}},30);};var coreSettings=[{id:LANGUAGE_SETTING,name:tr(\"settings.language\",\"Language\"),description:tr(\"settings.languageDescription\",\"Preferred language for Better Tasks\"),action:{type:\"select\",items:SUPPORTED_LANGUAGES,onChange:function onChange(v){return handleLanguageChange(v);}}},{id:\"rt-destination\",name:tr(\"settings.destNextTask\",\"Destination for next task\"),description:tr(\"settings.destNextTaskDescription\",\"Where to create the next occurrence\"),action:{type:\"select\",items:tr(\"settings.destinationOptions\",[\"DNP\",\"Same Page\",\"DNP under heading\"])||[\"DNP\",\"Same Page\",\"DNP under heading\"],onChange:function onChange(v){var _ref7,_v$value,_v$target;// Save destination then rebuild so rt-dnp-heading can show/hide\nvar next=(_ref7=(_v$value=v===null||v===void 0?void 0:v.value)!==null&&_v$value!==void 0?_v$value:v===null||v===void 0||(_v$target=v.target)===null||_v$target===void 0?void 0:_v$target.value)!==null&&_ref7!==void 0?_ref7:v;setAndRebuild(\"rt-destination\",next,{destination:next});}}}].concat(_toConsumableArray(isDnpUnderHeading?[{id:\"rt-dnp-heading\",name:tr(\"settings.dnpHeading\",\"DNP heading\"),description:tr(\"settings.dnpHeadingDescription\",\"Create under this heading on DNP when destination is DNP under heading\"),action:{type:\"input\",placeholder:\"Tasks\"}}]:[]),[{id:\"rt-confirm\",name:tr(\"settings.confirmBeforeSpawn\",\"Confirm before spawning next task\"),description:tr(\"settings.confirmBeforeSpawnDescription\",\"Ask for confirmation before spawning when a repeating Better Task is completed\"),action:{type:\"switch\"}},{id:\"rt-week-start\",name:tr(\"settings.weekStart\",\"First day of the week\"),description:tr(\"settings.weekStartDescription\",\"Used to align weekly schedules with your graph preference\"),action:{type:\"select\",items:tr(\"settings.weekStartOptions\",WEEK_START_OPTIONS)||WEEK_START_OPTIONS}},{id:PILL_THRESHOLD_SETTING,name:tr(\"settings.pillThreshold\",\"Inline pill checkbox threshold\"),description:tr(\"settings.pillThresholdDescription\",\"Max checkbox count before Better Tasks inline pills skip initial rendering (default 100). Higher values will render but the page may be slower.\"),action:{type:\"input\",placeholder:DEFAULT_PILL_THRESHOLD.toString()}}]);var reviewStepDescription=tr(\"settings.reviewStepDescription\",\"Include this step in the Weekly Review flow (order is fixed).\");var weeklyReviewSettings=[{id:REVIEW_STEP_NEXT_ACTIONS_SETTING,name:tr(\"settings.reviewStepNextActions\",\"Weekly Review: Next Actions\"),description:reviewStepDescription,action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(REVIEW_STEP_NEXT_ACTIONS_SETTING,normalized,null,{notifyReviewSteps:true});}}},{id:REVIEW_STEP_WAITING_FOR_SETTING,name:tr(\"settings.reviewStepWaitingFor\",\"Weekly Review: Waiting For\"),description:reviewStepDescription,action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(REVIEW_STEP_WAITING_FOR_SETTING,normalized,null,{notifyReviewSteps:true});}}},{id:REVIEW_STEP_COMPLETED_7D_SETTING,name:tr(\"settings.reviewStepCompleted7d\",\"Weekly Review: Completed (Last 7 Days)\"),description:reviewStepDescription,action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(REVIEW_STEP_COMPLETED_7D_SETTING,normalized,null,{notifyReviewSteps:true});}}},{id:REVIEW_STEP_UPCOMING_7D_SETTING,name:tr(\"settings.reviewStepUpcoming7d\",\"Weekly Review: Upcoming (Next 7 Days)\"),description:reviewStepDescription,action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(REVIEW_STEP_UPCOMING_7D_SETTING,normalized,null,{notifyReviewSteps:true});}}},{id:REVIEW_STEP_OVERDUE_SETTING,name:tr(\"settings.reviewStepOverdue\",\"Weekly Review: Overdue\"),description:reviewStepDescription,action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(REVIEW_STEP_OVERDUE_SETTING,normalized,null,{notifyReviewSteps:true});}}},{id:REVIEW_STEP_SOMEDAY_SETTING,name:tr(\"settings.reviewStepSomeday\",\"Weekly Review: Someday / Maybe\"),description:reviewStepDescription,action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(REVIEW_STEP_SOMEDAY_SETTING,normalized,null,{notifyReviewSteps:true});}}}];var attributeSettingsToggle=[{id:ADV_ATTR_NAMES_SETTING,name:tr(\"settings.advancedAttrNames\",\"Customise attribute names (advanced)\"),description:tr(\"settings.advancedAttrNamesDescription\",\"Show settings to customise the attribute/page names Better Tasks uses. Defaults work for most users.\"),action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(ADV_ATTR_NAMES_SETTING,normalized,{advancedAttrNamesEnabled:normalized});}}}];var attributeSettings=[{id:\"rt-repeat-attr\",name:tr(\"settings.repeatAttr\",\"Repeat attribute name\"),description:tr(\"settings.repeatAttrDescription\",\"Label for the recurrence rule attribute\"),action:{type:\"input\",placeholder:DEFAULT_REPEAT_ATTR,onChange:handleAttributeNameChange}},{id:\"rt-start-attr\",name:tr(\"settings.startAttr\",\"Start attribute name\"),description:tr(\"settings.startAttrDescription\",\"Label for start/available date attribute\"),action:{type:\"input\",placeholder:DEFAULT_START_ATTR,onChange:handleAttributeNameChange}},{id:\"rt-defer-attr\",name:tr(\"settings.deferAttr\",\"Defer attribute name\"),description:tr(\"settings.deferAttrDescription\",\"Label for defer/snooze date attribute\"),action:{type:\"input\",placeholder:DEFAULT_DEFER_ATTR,onChange:handleAttributeNameChange}},{id:\"rt-due-attr\",name:tr(\"settings.dueAttr\",\"Due attribute name\"),description:tr(\"settings.dueAttrDescription\",\"Label for due date attribute\"),action:{type:\"input\",placeholder:DEFAULT_DUE_ATTR,onChange:handleAttributeNameChange}},{id:\"rt-completed-attr\",name:tr(\"settings.completedAttr\",\"Completed attribute name\"),description:tr(\"settings.completedAttrDescription\",\"Label written when a recurring/scheduled task is completed\"),action:{type:\"input\",placeholder:DEFAULT_COMPLETED_ATTR,onChange:handleAttributeNameChange}},{id:\"bt-attr-project\",name:tr(\"settings.projectAttr\",\"Project attribute name\"),description:tr(\"settings.projectAttrDescription\",\"Label for project attribute (child block)\"),action:{type:\"input\",placeholder:\"BT_attrProject\",onChange:handleAttributeNameChange}},{id:\"bt-attr-gtd\",name:tr(\"settings.gtdAttr\",\"GTD status attribute name\"),description:tr(\"settings.gtdAttrDescription\",\"Label for GTD status attribute (child block)\"),action:{type:\"input\",placeholder:DEFAULT_GTD_ATTR,onChange:handleAttributeNameChange}},{id:\"bt-attr-waitingFor\",name:tr(\"settings.waitingAttr\",\"Waiting-for attribute name\"),description:tr(\"settings.waitingAttrDescription\",\"Label for waiting-for attribute (child block)\"),action:{type:\"input\",placeholder:\"BT_attrWaitingFor\",onChange:handleAttributeNameChange}},{id:\"bt-attr-context\",name:tr(\"settings.contextAttr\",\"Context attribute name\"),description:tr(\"settings.contextAttrDescription\",\"Label for context/tags attribute (child block)\"),action:{type:\"input\",placeholder:\"BT_attrContext\",onChange:handleAttributeNameChange}},{id:\"bt-attr-priority\",name:tr(\"settings.priorityAttr\",\"Priority attribute name\"),description:tr(\"settings.priorityAttrDescription\",\"Label for priority attribute (child block)\"),action:{type:\"input\",placeholder:\"BT_attrPriority\",onChange:handleAttributeNameChange}},{id:\"bt-attr-energy\",name:tr(\"settings.energyAttr\",\"Energy attribute name\"),description:tr(\"settings.energyAttrDescription\",\"Label for energy attribute (child block)\"),action:{type:\"input\",placeholder:\"BT_attrEnergy\",onChange:handleAttributeNameChange}}];var dashboardAdvancedToggle=[{id:ADV_DASH_OPTIONS_SETTING,name:tr(\"settings.advancedDashboard\",\"Advanced Dashboard options\"),description:tr(\"settings.advancedDashboardDescription\",\"Show settings for Weekly Review steps.\"),action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeBooleanSetting(normalizeTodaySettingValue(v));setAndRebuild(ADV_DASH_OPTIONS_SETTING,normalized,{advancedDashboardEnabled:normalized},{notifyReviewSteps:true});}}}];var picklistAdvanced=[{id:PICKLIST_EXCLUDE_ENABLED_SETTING,name:tr(\"settings.picklistExcludesAdvanced\",\"Advanced Project/Context/Waiting options\"),description:tr(\"settings.picklistExcludesAdvancedDescription\",\"Show settings to exclude specific pages from Project/Context/Waiting picklists (roam/* pages are always excluded).\"),action:{type:\"switch\",onChange:function onChange(v){var normalized=normalizeTodaySettingValue(v);var nextEnabled=normalizeBooleanSetting(normalized);try{var _extensionAPI$setting11,_extensionAPI$setting12;extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting11=extensionAPI.settings)===null||_extensionAPI$setting11===void 0||(_extensionAPI$setting12=_extensionAPI$setting11.set)===null||_extensionAPI$setting12===void 0||_extensionAPI$setting12.call(_extensionAPI$setting11,PICKLIST_EXCLUDE_ENABLED_SETTING,nextEnabled);}catch(_){}try{void (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)(true);void (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)(true);void (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)(true);}catch(_){}rebuildSettingsPanel(null,null,null,nextEnabled);}}}].concat(_toConsumableArray(picklistExcludeEnabledValue?[{id:PICKLIST_EXCLUDE_PAGES_SETTING,name:tr(\"settings.excludePicklistPages\",\"Exclude pages from picklists\"),description:tr(\"settings.excludePicklistPagesDescription\",\"Comma-separated page titles. Wrap titles containing commas (e.g. daily notes) in [[...]]. Values found on these pages will not populate Project/Context/Waiting picklists (useful for Templates/SmartBlocks).\"),action:{type:\"input\",placeholder:tr(\"settings.excludePicklistPagesPlaceholder\",\"Templates, SmartBlocks, [[December 18th, 2025]]\"),onChange:function onChange(v){var normalized=normalizeTodaySettingValue(v);try{var _extensionAPI$setting13,_extensionAPI$setting14;extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting13=extensionAPI.settings)===null||_extensionAPI$setting13===void 0||(_extensionAPI$setting14=_extensionAPI$setting13.set)===null||_extensionAPI$setting14===void 0||_extensionAPI$setting14.call(_extensionAPI$setting13,PICKLIST_EXCLUDE_PAGES_SETTING,String(normalized||\"\"));}catch(_){}try{void (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)(true);void (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)(true);void (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)(true);}catch(_){}}}}]:[]));var aiSettings=[{id:AI_MODE_SETTING,name:tr(\"settings.aiMode\",\"AI parsing mode\"),description:tr(\"settings.aiModeDescription\",\"Optional: use your OpenAI API key for AI-assisted task parsing\"),action:{type:\"select\",items:t(\"settings.aiModeOptions\",langSetting)||AI_MODE_OPTIONS,onChange:function onChange(v){var _ref8,_v$value2,_v$target2;var next=(_ref8=(_v$value2=v===null||v===void 0?void 0:v.value)!==null&&_v$value2!==void 0?_v$value2:v===null||v===void 0||(_v$target2=v.target)===null||_v$target2===void 0?void 0:_v$target2.value)!==null&&_ref8!==void 0?_ref8:v;try{var _extensionAPI$setting15,_extensionAPI$setting16;extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting15=extensionAPI.settings)===null||_extensionAPI$setting15===void 0||(_extensionAPI$setting16=_extensionAPI$setting15.set)===null||_extensionAPI$setting16===void 0||_extensionAPI$setting16.call(_extensionAPI$setting15,AI_MODE_SETTING,next);}catch(_){}rebuildSettingsPanel(null,null,null,null,{aiMode:next});}}}].concat(_toConsumableArray(shouldShowAiKey?[{id:AI_KEY_SETTING,name:tr(\"settings.aiKey\",\"OpenAI API key\"),description:tr(\"settings.aiKeyDescription\",\"Sensitive: stored in Roam settings; used client-side only for AI parsing\"),action:{type:\"input\",placeholder:\"sk-...\",onChange:function onChange(v){var normalized=normalizeTodaySettingValue(v);try{var _extensionAPI$setting17,_extensionAPI$setting18;extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting17=extensionAPI.settings)===null||_extensionAPI$setting17===void 0||(_extensionAPI$setting18=_extensionAPI$setting17.set)===null||_extensionAPI$setting18===void 0||_extensionAPI$setting18.call(_extensionAPI$setting17,AI_KEY_SETTING,String(normalized||\"\"));}catch(_){}}}}]:[]));var todayBadgeSettings=[{id:TODAY_BADGE_ENABLE_SETTING,name:tr(\"settings.todayBadgeEnable\",\"Enable Today badge\"),description:tr(\"settings.todayBadgeEnableDescription\",\"Show a Today link and badge in the left sidebar (default off)\"),action:{type:\"switch\",onChange:function onChange(v){return handleTodayBadgeSettingChange(TODAY_BADGE_ENABLE_SETTING,v);}}}].concat(_toConsumableArray(badgeEnabledValue?[{id:TODAY_BADGE_LABEL_SETTING,name:tr(\"settings.todayBadgeLabel\",\"Today badge label\"),description:tr(\"settings.todayBadgeLabelDescription\",\"Text for the Today badge/link (markdown ignored for matching)\"),action:{type:\"input\",placeholder:\"Today\",onChange:function onChange(v){return handleTodayBadgeSettingChange(TODAY_BADGE_LABEL_SETTING,v);}}},{id:TODAY_BADGE_OVERDUE_SETTING,name:tr(\"settings.todayBadgeIncludeOverdue\",\"Include overdue in Today badge\"),description:tr(\"settings.todayBadgeIncludeOverdueDescription\",\"Counts overdue tasks in the badge (completed tasks are never counted)\"),action:{type:\"switch\",onChange:function onChange(v){return handleTodayBadgeSettingChange(TODAY_BADGE_OVERDUE_SETTING,v);}}},{id:TODAY_BADGE_BG_SETTING,name:tr(\"settings.todayBadgeBg\",\"Today badge background\"),description:tr(\"settings.todayBadgeBgDescription\",\"CSS color for the badge background\"),action:{type:\"input\",placeholder:\"#1F6FEB\",onChange:function onChange(v){return handleTodayBadgeSettingChange(TODAY_BADGE_BG_SETTING,v);}}},{id:TODAY_BADGE_FG_SETTING,name:tr(\"settings.todayBadgeFg\",\"Today badge text\"),description:tr(\"settings.todayBadgeFgDescription\",\"CSS color for the badge text\"),action:{type:\"input\",placeholder:\"#FFFFFF\",onChange:function onChange(v){return handleTodayBadgeSettingChange(TODAY_BADGE_FG_SETTING,v);}}}]:[]));var todayWidgetSettings=[{id:TODAY_WIDGET_ENABLE_SETTING,name:tr(\"settings.enableTodayWidget\",\"Enable Today widget\"),description:tr(\"settings.enableTodayWidgetDescription\",\"Show the Better Tasks Today widget on your daily note page\"),action:{type:\"switch\",onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_ENABLE_SETTING,v);}}}];var todayWidgetDetails=todayEnabledValue?[{id:TODAY_WIDGET_TITLE_SETTING,name:tr(\"settings.todayWidgetTitle\",\"Today widget title\"),description:tr(\"settings.todayWidgetTitleDescription\",\"Title used for the Today anchor; if a matching block exists on the DNP (any level), the widget renders under it, otherwise it creates one at the configured placement.\"),action:{type:\"input\",placeholder:TODAY_WIDGET_ANCHOR_TEXT_DEFAULT,onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_TITLE_SETTING,v);}}},{id:TODAY_WIDGET_PLACEMENT_SETTING,name:tr(\"settings.todayWidgetPlacement\",\"Today widget placement\"),description:tr(\"settings.todayWidgetPlacementDescription\",\"Place the widget at the top or bottom of the DNP\"),action:{type:\"select\",items:tr(\"settings.placementOptions\",[\"Top\",\"Bottom\"])||[\"Top\",\"Bottom\"],onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_PLACEMENT_SETTING,v);}}},{id:TODAY_WIDGET_HEADING_SETTING,name:tr(\"settings.todayWidgetHeadingLevel\",\"Today widget heading level\"),description:tr(\"settings.todayWidgetHeadingLevelDescription\",\"Apply heading styling to the Today widget anchor block\"),action:{type:\"select\",items:tr(\"settings.headingLevelOptions\",[\"None\",\"H1\",\"H2\",\"H3\"])||[\"None\",\"H1\",\"H2\",\"H3\"],onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_HEADING_SETTING,v);}}},{id:TODAY_WIDGET_LAYOUT_SETTING,name:tr(\"settings.todayWidgetLayout\",\"Today widget layout\"),description:tr(\"settings.todayWidgetLayoutDescription\",\"Choose how the Today widget appears on your DNP\"),action:{type:\"select\",items:tr(\"settings.todayWidgetLayoutOptions\",[\"Panel\",\"Roam-style inline\"])||[\"Panel\",\"Roam-style inline\"],onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_LAYOUT_SETTING,v);}}},{id:TODAY_WIDGET_OVERDUE_SETTING,name:tr(\"settings.todayWidgetIncludeOverdue\",\"Include overdue tasks in Today widget\"),description:tr(\"settings.todayWidgetIncludeOverdueDescription\",\"Show tasks with due dates before today\"),action:{type:\"switch\",onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_OVERDUE_SETTING,v);}}},{id:TODAY_WIDGET_COMPLETED_SETTING,name:tr(\"settings.todayWidgetShowCompleted\",\"Show completed tasks in Today widget\"),description:tr(\"settings.todayWidgetShowCompletedDescription\",\"Include completed tasks (hidden by default)\"),action:{type:\"switch\",onChange:function onChange(v){return handleTodaySettingChange(TODAY_WIDGET_COMPLETED_SETTING,v);}}}]:[];// Final ordering:\n// 1) Core\n// 2) Today Badge\n// 3) Today Widget\n// 4) AI\n// 5) Advanced Dashboard toggle\n// 6) Weekly Review steps (advanced)\n// 7) Picklist advanced\n// 8) Attribute names (advanced) toggle + fields\nvar settings=[].concat(_toConsumableArray(coreSettings),_toConsumableArray(todayBadgeSettings),todayWidgetSettings,_toConsumableArray(todayEnabledValue?todayWidgetDetails:[]),_toConsumableArray(aiSettings),dashboardAdvancedToggle,_toConsumableArray(advancedDashboardEnabled?weeklyReviewSettings:[]),_toConsumableArray(picklistAdvanced),attributeSettingsToggle,_toConsumableArray(advancedAttrNamesEnabled?attributeSettings:[]));return{tabTitle:tr(\"settings.tabTitle\",\"Better Tasks\"),settings:settings};};var rebuildSettingsPanel=function rebuildSettingsPanel(){var todayEnabledOverride=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var langOverride=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var badgeEnabledOverride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var picklistExcludeEnabledOverride=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var uiOverrides=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;try{var effectiveTodayEnabled=todayEnabledOverride!==null&&todayEnabledOverride!==undefined?todayEnabledOverride:getTodayWidgetEnabled();var effectiveBadgeEnabled=badgeEnabledOverride!==null&&badgeEnabledOverride!==undefined?badgeEnabledOverride:getTodayBadgeEnabled();var _config=buildSettingsConfig({todayEnabled:effectiveTodayEnabled,badgeEnabled:effectiveBadgeEnabled,picklistExcludeEnabled:picklistExcludeEnabledOverride,uiOverrides:uiOverrides,lang:langOverride});extensionAPI.settings.panel.create(_config);}catch(err){console.warn(\"[BetterTasks] failed to rebuild settings panel\",err);}};var config=buildSettingsConfig();extensionAPI.settings.panel.create(config);if(extensionAPI.settings.get(TODAY_WIDGET_ENABLE_SETTING)==null){extensionAPI.settings.set(TODAY_WIDGET_ENABLE_SETTING,true);}if(extensionAPI.settings.get(TODAY_WIDGET_LAYOUT_SETTING)==null){extensionAPI.settings.set(TODAY_WIDGET_LAYOUT_SETTING,\"Panel\");}if(extensionAPI.settings.get(TODAY_WIDGET_OVERDUE_SETTING)==null){extensionAPI.settings.set(TODAY_WIDGET_OVERDUE_SETTING,false);}if(extensionAPI.settings.get(TODAY_WIDGET_COMPLETED_SETTING)==null){extensionAPI.settings.set(TODAY_WIDGET_COMPLETED_SETTING,false);}if(extensionAPI.settings.get(TODAY_WIDGET_PLACEMENT_SETTING)==null){extensionAPI.settings.set(TODAY_WIDGET_PLACEMENT_SETTING,\"Top\");}if(extensionAPI.settings.get(TODAY_WIDGET_HEADING_SETTING)==null){extensionAPI.settings.set(TODAY_WIDGET_HEADING_SETTING,\"None\");}if(extensionAPI.settings.get(TODAY_BADGE_ENABLE_SETTING)==null){extensionAPI.settings.set(TODAY_BADGE_ENABLE_SETTING,false);}if(extensionAPI.settings.get(TODAY_BADGE_OVERDUE_SETTING)==null){extensionAPI.settings.set(TODAY_BADGE_OVERDUE_SETTING,false);}if(extensionAPI.settings.get(PICKLIST_EXCLUDE_ENABLED_SETTING)==null){extensionAPI.settings.set(PICKLIST_EXCLUDE_ENABLED_SETTING,false);}if(extensionAPI.settings.get(PICKLIST_EXCLUDE_PAGES_SETTING)==null){extensionAPI.settings.set(PICKLIST_EXCLUDE_PAGES_SETTING,\"\");}if(extensionAPI.settings.get(ADV_DASH_OPTIONS_SETTING)==null){extensionAPI.settings.set(ADV_DASH_OPTIONS_SETTING,false);}if(extensionAPI.settings.get(REVIEW_STEP_NEXT_ACTIONS_SETTING)==null){extensionAPI.settings.set(REVIEW_STEP_NEXT_ACTIONS_SETTING,true);}if(extensionAPI.settings.get(REVIEW_STEP_WAITING_FOR_SETTING)==null){extensionAPI.settings.set(REVIEW_STEP_WAITING_FOR_SETTING,true);}if(extensionAPI.settings.get(REVIEW_STEP_COMPLETED_7D_SETTING)==null){extensionAPI.settings.set(REVIEW_STEP_COMPLETED_7D_SETTING,true);}if(extensionAPI.settings.get(REVIEW_STEP_UPCOMING_7D_SETTING)==null){extensionAPI.settings.set(REVIEW_STEP_UPCOMING_7D_SETTING,true);}if(extensionAPI.settings.get(REVIEW_STEP_OVERDUE_SETTING)==null){extensionAPI.settings.set(REVIEW_STEP_OVERDUE_SETTING,true);}if(extensionAPI.settings.get(REVIEW_STEP_SOMEDAY_SETTING)==null){extensionAPI.settings.set(REVIEW_STEP_SOMEDAY_SETTING,true);}lastAttrNames=resolveAttributeNames();var introSeen=extensionAPI.settings.get(INSTALL_TOAST_KEY);if(!introSeen){toast(translateString(\"This extension automatically recognises {{[[TODO]]}} tasks in your graph and uses attributes to determine a recurrence pattern and other attributes. By default, it uses attributes like 'BT_attrRepeat' and 'BT_attrDue'. These can be changed in the extension settings.<BR><BR>If you already happen to use attributes like 'BT_attrRepeat' or 'BT_attrDue' for other functions in your graph, please change the defaults in the Roam Depot Settings for this extension BEFORE testing its functionality to avoid any unexpected behaviour.\",getLanguageSetting()),10000,\"betterTasks3 bt3-toast-info\");extensionAPI.settings.set(INSTALL_TOAST_KEY,\"1\");}currentLanguage=getLanguageSetting();var cmdConvert=translateString(\"Convert TODO to Better Task\",getLanguageSetting());extensionAPI.ui.commandPalette.addCommand({label:cmdConvert,callback:function callback(){return convertTODO(null);}});window.roamAlphaAPI.ui.blockContextMenu.addCommand({label:cmdConvert,callback:function callback(e){return convertTODO(e);}});var cmdCreate=translateString(\"Create a Better Task\",getLanguageSetting());extensionAPI.ui.commandPalette.addCommand({label:cmdCreate,callback:function callback(){return createBetterTaskEntryPoint();}});window.roamAlphaAPI.ui.blockContextMenu.addCommand({label:cmdCreate,callback:function callback(e){return createBetterTaskEntryPoint(e);}});var slashCommandAPI=(_window$roamAlphaAPI=window.roamAlphaAPI)===null||_window$roamAlphaAPI===void 0||(_window$roamAlphaAPI=_window$roamAlphaAPI.ui)===null||_window$roamAlphaAPI===void 0?void 0:_window$roamAlphaAPI.slashCommand;if(slashCommandAPI){var slashCreate=translateString(\"Create a Better Task\",getLanguageSetting());var slashConvert=translateString(\"Convert TODO to Better Task\",getLanguageSetting());slashCommandAPI.addCommand({label:slashCreate,callback:function callback(args){var blockUid=args[\"block-uid\"];createBetterTaskEntryPoint({\"block-uid\":blockUid});return\"\";}});slashCommandAPI.addCommand({label:slashConvert,callback:function callback(args){var blockUid=args[\"block-uid\"];convertTODO({\"block-uid\":blockUid});return\"\";}});}activeDashboardController=createDashboardController(extensionAPI);try{(0,_dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__.installPresetDashboardViews)(extensionAPI,{force:false,getName:function getName(key){var lang=getLanguageSetting();var val=t([\"dashboard\",\"viewsPresets\",key],lang);return typeof val===\"string\"?val:null;}});}catch(err){console.warn(\"[BetterTasks] preset dashboard views seed failed\",err);}extensionAPI.ui.commandPalette.addCommand({label:translateString(\"Toggle Better Tasks Dashboard\",getLanguageSetting()),callback:function callback(){return activeDashboardController.toggle();}});extensionAPI.ui.commandPalette.addCommand({label:t([\"commands\",\"toggleDashboardFullPage\"],getLanguageSetting())||\"Toggle Better Tasks Dashboard (Full page)\",callback:function callback(){var _activeDashboardContr4,_activeDashboardContr5,_activeDashboardContr0,_activeDashboardContr1;if(!activeDashboardController)return;if(!((_activeDashboardContr4=(_activeDashboardContr5=activeDashboardController).isOpen)!==null&&_activeDashboardContr4!==void 0&&_activeDashboardContr4.call(_activeDashboardContr5))){var _activeDashboardContr6,_activeDashboardContr7;(_activeDashboardContr6=(_activeDashboardContr7=activeDashboardController).open)===null||_activeDashboardContr6===void 0||_activeDashboardContr6.call(_activeDashboardContr7);requestAnimationFrame(function(){var _activeDashboardContr8,_activeDashboardContr9;(_activeDashboardContr8=(_activeDashboardContr9=activeDashboardController).setDashboardFullPage)===null||_activeDashboardContr8===void 0||_activeDashboardContr8.call(_activeDashboardContr9,true);});return;}(_activeDashboardContr0=(_activeDashboardContr1=activeDashboardController).toggleDashboardFullPage)===null||_activeDashboardContr0===void 0||_activeDashboardContr0.call(_activeDashboardContr1);}});extensionAPI.ui.commandPalette.addCommand({label:translateString(\"Better Tasks: Switch viewâ€¦\",getLanguageSetting()),callback:function(){var _callback=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(){var _activeDashboardContr10,_activeDashboardContr11,_activeDashboardContr12,_activeDashboardContr13,_activeDashboardContr14,_activeDashboardContr15,_activeDashboardContr16,_activeDashboardContr17,_activeDashboardContr18,_activeDashboardContr19,store,views,pickedId,view,nextStore,saved,_t;return _regenerator().w(function(_context){while(1)switch(_context.p=_context.n){case 0:_context.p=0;if((_activeDashboardContr10=activeDashboardController)!==null&&_activeDashboardContr10!==void 0&&(_activeDashboardContr11=_activeDashboardContr10.isOpen)!==null&&_activeDashboardContr11!==void 0&&_activeDashboardContr11.call(_activeDashboardContr10)){_context.n=1;break;}toast(t(\"toasts.dashViewsOpenToSwitch\",getLanguageSetting())||\"Open Better Tasks Dashboard to switch views.\");return _context.a(2);case 1:store=(_activeDashboardContr12=(_activeDashboardContr13=activeDashboardController).loadViewsStore)===null||_activeDashboardContr12===void 0?void 0:_activeDashboardContr12.call(_activeDashboardContr13);views=(store===null||store===void 0?void 0:store.views)||[];if(views.length){_context.n=2;break;}toast(t(\"toasts.dashViewsNoSaved\",getLanguageSetting())||\"No saved views.\");return _context.a(2);case 2:_context.n=3;return promptForDashView({title:\"Better Tasks\",placeholder:\"Filter views\",views:views,initialId:(store===null||store===void 0?void 0:store.activeViewId)||null});case 3:pickedId=_context.v;if(pickedId){_context.n=4;break;}return _context.a(2);case 4:view=views.find(function(v){return v.id===pickedId;});if(view){_context.n=5;break;}return _context.a(2);case 5:nextStore=(0,_dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__.setActiveView)(store,pickedId);saved=((_activeDashboardContr14=(_activeDashboardContr15=activeDashboardController).saveViewsStore)===null||_activeDashboardContr14===void 0?void 0:_activeDashboardContr14.call(_activeDashboardContr15,nextStore))||nextStore;(_activeDashboardContr16=(_activeDashboardContr17=activeDashboardController).notifyDashViewsStoreChanged)===null||_activeDashboardContr16===void 0||_activeDashboardContr16.call(_activeDashboardContr17,saved);(_activeDashboardContr18=(_activeDashboardContr19=activeDashboardController).requestApplyDashViewState)===null||_activeDashboardContr18===void 0||_activeDashboardContr18.call(_activeDashboardContr19,view.state);_context.n=7;break;case 6:_context.p=6;_t=_context.v;console.warn(\"[BetterTasks] switch view command failed\",_t);toast(t(\"toasts.dashViewsSwitchFailed\",getLanguageSetting())||\"Unable to switch view.\");case 7:return _context.a(2);}},_callee,null,[[0,6]]);}));function callback(){return _callback.apply(this,arguments);}return callback;}()});extensionAPI.ui.commandPalette.addCommand({label:translateString(\"Better Tasks: Save current view asâ€¦\",getLanguageSetting()),callback:function(){var _callback2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(){var _activeDashboardContr20,_activeDashboardContr21,_activeDashboardContr22,_activeDashboardContr23,_activeDashboardContr24,_activeDashboardContr25,_activeDashboardContr26,_activeDashboardContr27,_activeDashboardContr28,_activeDashboardContr29,dashState,name,store,nextStore,saved,_t2,_t3;return _regenerator().w(function(_context2){while(1)switch(_context2.p=_context2.n){case 0:_context2.p=0;if((_activeDashboardContr20=activeDashboardController)!==null&&_activeDashboardContr20!==void 0&&(_activeDashboardContr21=_activeDashboardContr20.isOpen)!==null&&_activeDashboardContr21!==void 0&&_activeDashboardContr21.call(_activeDashboardContr20)){_context2.n=1;break;}toast(t(\"toasts.dashViewsOpenToSave\",getLanguageSetting())||\"Open Better Tasks Dashboard to save views.\");return _context2.a(2);case 1:dashState=(_activeDashboardContr22=(_activeDashboardContr23=activeDashboardController).getDashViewState)===null||_activeDashboardContr22===void 0?void 0:_activeDashboardContr22.call(_activeDashboardContr23);if(dashState){_context2.n=2;break;}toast(t(\"toasts.dashViewsReadStateFailed\",getLanguageSetting())||\"Unable to read dashboard state. Try reopening the dashboard.\");return _context2.a(2);case 2:if(!activeDashboardController.promptValue){_context2.n=4;break;}_context2.n=3;return activeDashboardController.promptValue({title:\"Better Tasks\",message:\"Save current view as\",placeholder:\"View name\",initial:\"\"});case 3:_t2=_context2.v;_context2.n=5;break;case 4:_t2=null;case 5:name=_t2;if(name){_context2.n=6;break;}return _context2.a(2);case 6:store=(_activeDashboardContr24=(_activeDashboardContr25=activeDashboardController).loadViewsStore)===null||_activeDashboardContr24===void 0?void 0:_activeDashboardContr24.call(_activeDashboardContr25);nextStore=(0,_dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__.createView)(store,name,dashState);saved=((_activeDashboardContr26=(_activeDashboardContr27=activeDashboardController).saveViewsStore)===null||_activeDashboardContr26===void 0?void 0:_activeDashboardContr26.call(_activeDashboardContr27,nextStore))||nextStore;(_activeDashboardContr28=(_activeDashboardContr29=activeDashboardController).notifyDashViewsStoreChanged)===null||_activeDashboardContr28===void 0||_activeDashboardContr28.call(_activeDashboardContr29,saved);_context2.n=8;break;case 7:_context2.p=7;_t3=_context2.v;console.warn(\"[BetterTasks] save view command failed\",_t3);toast(t(\"toasts.dashViewsSaveFailed\",getLanguageSetting())||\"Unable to save view.\");case 8:return _context2.a(2);}},_callee2,null,[[0,7]]);}));function callback(){return _callback2.apply(this,arguments);}return callback;}()});extensionAPI.ui.commandPalette.addCommand({label:t([\"commands\",\"startReview\"],getLanguageSetting())||\"Better Tasks: Weekly Review\",callback:function(){var _callback3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(){var _activeDashboardContr30,_activeDashboardContr31,_activeDashboardContr34,_activeDashboardContr35,_activeDashboardContr32,_activeDashboardContr33;return _regenerator().w(function(_context3){while(1)switch(_context3.n){case 0:try{if(!((_activeDashboardContr30=activeDashboardController)!==null&&_activeDashboardContr30!==void 0&&(_activeDashboardContr31=_activeDashboardContr30.isOpen)!==null&&_activeDashboardContr31!==void 0&&_activeDashboardContr31.call(_activeDashboardContr30))){(_activeDashboardContr32=activeDashboardController)===null||_activeDashboardContr32===void 0||(_activeDashboardContr33=_activeDashboardContr32.open)===null||_activeDashboardContr33===void 0||_activeDashboardContr33.call(_activeDashboardContr32);}(_activeDashboardContr34=activeDashboardController)===null||_activeDashboardContr34===void 0||(_activeDashboardContr35=_activeDashboardContr34.requestStartDashReview)===null||_activeDashboardContr35===void 0||_activeDashboardContr35.call(_activeDashboardContr34);}catch(err){console.warn(\"[BetterTasks] start review command failed\",err);toast(t([\"toasts\",\"dashReviewStartFailed\"],getLanguageSetting())||\"Unable to start review.\");}case 1:return _context3.a(2);}},_callee3);}));function callback(){return _callback3.apply(this,arguments);}return callback;}()});extensionAPI.ui.commandPalette.addCommand({label:t([\"commands\",\"reinstallPresetDashViews\"],getLanguageSetting())||\"Better Tasks: Reinstall preset dashboard views\",callback:function(){var _callback4=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(){var result,_activeDashboardContr36,_activeDashboardContr37,collisions,base,installed,_t4;return _regenerator().w(function(_context4){while(1)switch(_context4.p=_context4.n){case 0:_context4.p=0;result=(0,_dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__.installPresetDashboardViews)(extensionAPI,{force:true,getName:function getName(key){var lang=getLanguageSetting();var val=t([\"dashboard\",\"viewsPresets\",key],lang);return typeof val===\"string\"?val:null;}});if(result!==null&&result!==void 0&&result.didSave){(_activeDashboardContr36=activeDashboardController)===null||_activeDashboardContr36===void 0||(_activeDashboardContr37=_activeDashboardContr36.notifyDashViewsStoreChanged)===null||_activeDashboardContr37===void 0||_activeDashboardContr37.call(_activeDashboardContr36,result.store);}collisions=Array.isArray(result===null||result===void 0?void 0:result.skippedNameCollisions)?result.skippedNameCollisions:[];if(!collisions.length){_context4.n=1;break;}base=t(\"toasts.dashViewsPresetNameCollisions\",getLanguageSetting())||\"Skipped presets due to name conflicts:\";toast(\"\".concat(base,\" \").concat(collisions.join(\", \")));return _context4.a(2);case 1:installed=Array.isArray(result===null||result===void 0?void 0:result.installedIds)?result.installedIds.length:0;if(!(installed>0)){_context4.n=2;break;}toast(t(\"toasts.dashViewsPresetInstalled\",getLanguageSetting())||\"Preset dashboard views installed.\");return _context4.a(2);case 2:toast(t(\"toasts.dashViewsPresetNothingToInstall\",getLanguageSetting())||\"All preset dashboard views are already present.\");_context4.n=4;break;case 3:_context4.p=3;_t4=_context4.v;console.warn(\"[BetterTasks] reinstall preset views failed\",_t4);toast(t(\"toasts.dashViewsPresetInstallFailed\",getLanguageSetting())||\"Unable to reinstall preset dashboard views.\");case 4:return _context4.a(2);}},_callee4,null,[[0,3]]);}));function callback(){return _callback4.apply(this,arguments);}return callback;}()});if(getTodayWidgetEnabled()){scheduleTodayWidgetRender();attachTodayNavigationListener();}if(getTodayBadgeEnabled()){scheduleTodayBadgeRefresh(100,true);attachTodayNavigationListener();}if(!dashboardRefreshTimer&&typeof window!==\"undefined\"){dashboardRefreshTimer=window.setInterval(function(){try{var _activeDashboardContr38,_activeDashboardContr39;if(!((_activeDashboardContr38=activeDashboardController)!==null&&_activeDashboardContr38!==void 0&&(_activeDashboardContr39=_activeDashboardContr38.isOpen)!==null&&_activeDashboardContr39!==void 0&&_activeDashboardContr39.call(_activeDashboardContr38))){var _activeDashboardContr40,_activeDashboardContr41;if(window.__btDebugRefreshTimer){var now=Date.now();if(now-dashboardRefreshLogAt>=DASHBOARD_REFRESH_LOG_INTERVAL_MS){dashboardRefreshLogAt=now;console.debug(\"[BetterTasks] dashboard refresh tick\");}}(_activeDashboardContr40=activeDashboardController)===null||_activeDashboardContr40===void 0||(_activeDashboardContr41=_activeDashboardContr40.refresh)===null||_activeDashboardContr41===void 0||_activeDashboardContr41.call(_activeDashboardContr40,{reason:\"background\"});}}catch(err){debugLog(\"dashboard refresh tick failed\",err);}},90000);}ensureDashboardTopbarButton();observeTopbarButton();observeThemeChanges();// Placeholder for future feature - deconvert Better Tasks TODOs\n/* \n    extensionAPI.ui.commandPalette.addCommand({\n      label: \"Convert Better Task to plain TODO\",\n      callback: () => disableRecTODO(null),\n    });\n    window.roamAlphaAPI.ui.blockContextMenu.addCommand({\n      label: \"Convert Better Task to plain TODO\",\n      callback: (e) => disableRecTODO(e),\n    });\n    */function convertTODO(_x){return _convertTODO.apply(this,arguments);}function _convertTODO(){_convertTODO=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee31(e){var perfConvert,fuid,focused,block,fstring,props,inlineAttrs,childAttrs,attrNames,existingMeta,childRepeatEntry,childDueEntry,childStartEntry,childDeferEntry,inlineRepeatVal,inlineDueVal,inlineStartVal,inlineDeferVal,removalKeys,baseWithoutAttrs,initialTaskText,promptResult,set,normalizedRepeat,dueDate,dueStr,promptDueSource,startSourceFromPrompt,startFallbackSource,startSource,startDate,startStr,deferSourceFromPrompt,deferFallbackSource,deferSource,deferDate,deferStr,taskSource,cleanedTaskText,todoString,hasRepeat,hasTimingInput,hasMetadataInput,rtProps,attrNamesForWrite,createdMsg;return _regenerator().w(function(_context31){while(1)switch(_context31.n){case 0:perfConvert=perfMark(\"convertTODO\");fuid=null;if(!(e&&e[\"block-uid\"])){_context31.n=1;break;}fuid=e[\"block-uid\"];_context31.n=3;break;case 1:_context31.n=2;return window.roamAlphaAPI.ui.getFocusedBlock();case 2:focused=_context31.v;fuid=focused&&focused[\"block-uid\"];if(fuid){_context31.n=3;break;}toast(t([\"toasts\",\"placeCursorConvert\"],getLanguageSetting())||\"Place the cursor in the block you wish to convert.\");return _context31.a(2);case 3:_context31.n=4;return getBlock(fuid);case 4:block=_context31.v;if(block){_context31.n=5;break;}toast(t([\"toasts\",\"unableReadBlock\"],getLanguageSetting())||\"Unable to read the current block.\");return _context31.a(2);case 5:fstring=block.string||\"\";props=parseProps(block.props);inlineAttrs=parseAttrsFromBlockText(fstring);childAttrs=parseAttrsFromChildBlocks(block.children||[]);attrNames=resolveAttributeNames();existingMeta=parseRichMetadata(childAttrs,attrNames);childRepeatEntry=pickChildAttr(childAttrs,attrNames.repeatAliases);childDueEntry=pickChildAttr(childAttrs,attrNames.dueAliases);childStartEntry=pickChildAttr(childAttrs,attrNames.startAliases);childDeferEntry=pickChildAttr(childAttrs,attrNames.deferAliases);inlineRepeatVal=pickInlineAttr(inlineAttrs,attrNames.repeatAliases);inlineDueVal=pickInlineAttr(inlineAttrs,attrNames.dueAliases);inlineStartVal=pickInlineAttr(inlineAttrs,attrNames.startAliases);inlineDeferVal=pickInlineAttr(inlineAttrs,attrNames.deferAliases);removalKeys=_toConsumableArray(new Set([].concat(_toConsumableArray(attrNames.repeatRemovalKeys),_toConsumableArray(attrNames.dueRemovalKeys),_toConsumableArray(attrNames.startRemovalKeys),_toConsumableArray(attrNames.deferRemovalKeys))));baseWithoutAttrs=removeInlineAttributes(fstring,removalKeys);initialTaskText=baseWithoutAttrs.trim();_context31.n=6;return promptForRepeatAndDue({includeTaskText:true,forceTaskInput:true,taskText:initialTaskText,repeat:props.repeat||(childRepeatEntry===null||childRepeatEntry===void 0?void 0:childRepeatEntry.value)||inlineRepeatVal||\"\",due:props.due||(childDueEntry===null||childDueEntry===void 0?void 0:childDueEntry.value)||inlineDueVal||\"\",start:props.start||(childStartEntry===null||childStartEntry===void 0?void 0:childStartEntry.value)||inlineStartVal||\"\",defer:props.defer||(childDeferEntry===null||childDeferEntry===void 0?void 0:childDeferEntry.value)||inlineDeferVal||\"\",project:existingMeta.project||\"\",waitingFor:existingMeta.waitingFor||\"\",context:existingMeta.context||\"\",priority:existingMeta.priority||\"\",energy:existingMeta.energy||\"\",gtd:existingMeta.gtd||\"\"});case 6:promptResult=_context31.v;if(promptResult){_context31.n=7;break;}return _context31.a(2);case 7:set=S(attrNames);normalizedRepeat=promptResult.repeat?normalizeRepeatRuleText(promptResult.repeat)||promptResult.repeat:\"\";if(!(normalizedRepeat&&!parseRuleText(normalizedRepeat,set))){_context31.n=8;break;}toast(t([\"toasts\",\"unableUnderstandRepeat\"],getLanguageSetting())||\"Unable to understand that repeat rule.\");return _context31.a(2);case 8:dueDate=null;dueStr=null;promptDueSource=promptResult.due||\"\";if(!promptDueSource){_context31.n=10;break;}dueDate=promptResult.dueDate instanceof Date&&!Number.isNaN(promptResult.dueDate.getTime())?new Date(promptResult.dueDate.getTime()):parseRoamDate(promptDueSource);if(!(!(dueDate instanceof Date)||Number.isNaN(dueDate.getTime()))){_context31.n=9;break;}toast(t([\"toasts\",\"cannotParseDue\"],getLanguageSetting())||\"Couldn't parse that due date.\");return _context31.a(2);case 9:dueStr=formatDate(dueDate,set);case 10:startSourceFromPrompt=promptResult.start||\"\";startFallbackSource=props.start||(childStartEntry===null||childStartEntry===void 0?void 0:childStartEntry.value)||inlineStartVal||\"\";startSource=startSourceFromPrompt||startFallbackSource;startDate=null;startStr=null;if(!startSource){_context31.n=12;break;}startDate=promptResult.startDate instanceof Date&&startSourceFromPrompt?new Date(promptResult.startDate.getTime()):parseRoamDate(startSource);if(!(!(startDate instanceof Date)||Number.isNaN(startDate.getTime()))){_context31.n=11;break;}toast(t([\"toasts\",\"cannotParseStart\"],getLanguageSetting())||\"Couldn't parse that start date.\");return _context31.a(2);case 11:startStr=formatDate(startDate,set);case 12:deferSourceFromPrompt=promptResult.defer||\"\";deferFallbackSource=props.defer||(childDeferEntry===null||childDeferEntry===void 0?void 0:childDeferEntry.value)||inlineDeferVal||\"\";deferSource=deferSourceFromPrompt||deferFallbackSource;deferDate=null;deferStr=null;if(!deferSource){_context31.n=14;break;}deferDate=promptResult.deferDate instanceof Date&&deferSourceFromPrompt?new Date(promptResult.deferDate.getTime()):parseRoamDate(deferSource);if(!(!(deferDate instanceof Date)||Number.isNaN(deferDate.getTime()))){_context31.n=13;break;}toast(t([\"toasts\",\"cannotParseDefer\"],getLanguageSetting())||\"Couldn't parse that defer date.\");return _context31.a(2);case 13:deferStr=formatDate(deferDate,set);case 14:taskSource=typeof promptResult.taskText===\"string\"&&promptResult.taskText?promptResult.taskText:typeof promptResult.taskTextRaw===\"string\"&&promptResult.taskTextRaw?promptResult.taskTextRaw:initialTaskText;cleanedTaskText=removeInlineAttributes(taskSource||\"\",removalKeys).trim();todoString=normalizeToTodoMacro(cleanedTaskText);if(!(todoString!==fstring)){_context31.n=15;break;}_context31.n=15;return updateBlockString(fuid,todoString);case 15:hasRepeat=!!normalizedRepeat;hasTimingInput=!!(dueStr||startStr||deferStr);hasMetadataInput=!!((promptResult.project||\"\").trim()||(promptResult.waitingFor||\"\").trim()||(promptResult.context||\"\").trim()||(promptResult.priority||\"\").trim()||(promptResult.energy||\"\").trim()||(promptResult.gtd||\"\").trim());if(!(!hasRepeat&&!hasTimingInput&&!hasMetadataInput)){_context31.n=16;break;}toast(t([\"toasts\",\"addRepeatDateOrMetadata\"],getLanguageSetting())||\"Add a repeat rule, a date, or metadata.\");return _context31.a(2);case 16:rtProps=_objectSpread({},props.rt||{});if(!rtProps.id)rtProps.id=shortId();if(!rtProps.tz)rtProps.tz=set.timezone;_context31.n=17;return updateBlockProps(fuid,{rt:rtProps});case 17:attrNamesForWrite=set.attrNames;if(!hasRepeat){_context31.n=19;break;}_context31.n=18;return ensureChildAttrForType(fuid,\"repeat\",normalizedRepeat,attrNamesForWrite);case 18:_context31.n=20;break;case 19:_context31.n=20;return removeChildAttrsForType(fuid,\"repeat\",attrNamesForWrite);case 20:if(!dueStr){_context31.n=22;break;}_context31.n=21;return ensureChildAttrForType(fuid,\"due\",dueStr,attrNamesForWrite);case 21:_context31.n=23;break;case 22:_context31.n=23;return removeChildAttrsForType(fuid,\"due\",attrNamesForWrite);case 23:if(!startStr){_context31.n=25;break;}_context31.n=24;return ensureChildAttrForType(fuid,\"start\",startStr,attrNamesForWrite);case 24:_context31.n=26;break;case 25:_context31.n=26;return removeChildAttrsForType(fuid,\"start\",attrNamesForWrite);case 26:if(!deferStr){_context31.n=28;break;}_context31.n=27;return ensureChildAttrForType(fuid,\"defer\",deferStr,attrNamesForWrite);case 27:_context31.n=29;break;case 28:_context31.n=29;return removeChildAttrsForType(fuid,\"defer\",attrNamesForWrite);case 29:_context31.n=30;return applyMetadataFromPrompt(fuid,promptResult,attrNamesForWrite,{initial:existingMeta});case 30:repeatOverrides[\"delete\"](fuid);createdMsg=t([\"toasts\",\"createdRecurring\"],getLanguageSetting())||\"Created your Better Task\";toast(hasRepeat||hasTimingInput?createdMsg:\"Added metadata\");scheduleSurfaceSync(set.attributeSurface);perfLog(perfConvert);case 31:return _context31.a(2);}},_callee31);}));return _convertTODO.apply(this,arguments);}function createBetterTaskEntryPoint(_x2){return _createBetterTaskEntryPoint.apply(this,arguments);}function _createBetterTaskEntryPoint(){_createBetterTaskEntryPoint=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee32(e){var _aiResult5;var targetUid,focused,block,rawText,aiSettings,aiEnabled,input,attrNames,removalKeys,cleanedInput,aiInput,aiAbort,suppressAiAbort,pending,aiResult,applied,_t35;return _regenerator().w(function(_context32){while(1)switch(_context32.p=_context32.n){case 0:targetUid=null;if(!(e&&e[\"block-uid\"])){_context32.n=1;break;}targetUid=e[\"block-uid\"];_context32.n=3;break;case 1:_context32.n=2;return window.roamAlphaAPI.ui.getFocusedBlock();case 2:focused=_context32.v;targetUid=focused&&focused[\"block-uid\"];if(targetUid){_context32.n=3;break;}toast(t([\"toasts\",\"placeCursorCreate\"],getLanguageSetting())||\"Place the cursor in the block where you wish to create the Better Task.\");return _context32.a(2);case 3:_context32.n=4;return getBlock(targetUid);case 4:block=_context32.v;if(block){_context32.n=5;break;}toast(t([\"toasts\",\"unableReadBlock\"],getLanguageSetting())||\"Unable to read the current block.\");return _context32.a(2);case 5:rawText=(block.string||\"\").trim();aiSettings=getAiSettings();aiEnabled=isAiEnabled(aiSettings);if(!(!rawText&&!aiEnabled)){_context32.n=7;break;}_context32.n=6;return createRecurringTODO(targetUid);case 6:return _context32.a(2);case 7:if(!(!rawText&&aiEnabled)){_context32.n=11;break;}_context32.n=8;return promptForValue({title:\"Create a Better Task\",message:\"Enter task text\",placeholder:\"Task text\",initial:\"\"});case 8:input=_context32.v;if(input){_context32.n=9;break;}return _context32.a(2);case 9:rawText=input.trim();if(rawText){_context32.n=10;break;}toast(t([\"toasts\",\"enterText\"],getLanguageSetting())||\"Enter some task text.\");return _context32.a(2);case 10:_context32.n=11;return updateBlockString(targetUid,input);case 11:attrNames=resolveAttributeNames();removalKeys=_toConsumableArray(new Set([].concat(_toConsumableArray(attrNames.repeatRemovalKeys),_toConsumableArray(attrNames.dueRemovalKeys),_toConsumableArray(attrNames.startRemovalKeys),_toConsumableArray(attrNames.deferRemovalKeys),[\"completed\"])));cleanedInput=removeInlineAttributes(rawText,removalKeys).replace(/^\\{\\{\\[\\[(?:TODO|DONE)\\]\\]\\}\\}\\s*/i,\"\").trim();aiInput=cleanedInput||rawText;if(aiEnabled){_context32.n=13;break;}_context32.n=12;return createRecurringTODO(targetUid);case 12:return _context32.a(2);case 13:aiAbort=typeof AbortController!==\"undefined\"?new AbortController():null;suppressAiAbort=false;pending=showPersistentToast(\"Parsing task with AIâ€¦\",{onClosed:function onClosed(){if(suppressAiAbort)return;aiAbort===null||aiAbort===void 0||aiAbort.abort();}});aiResult=null;_context32.p=14;_context32.n=15;return parseTaskWithOpenAI(aiInput,aiSettings,{signal:aiAbort===null||aiAbort===void 0?void 0:aiAbort.signal});case 15:aiResult=_context32.v;_context32.n=17;break;case 16:_context32.p=16;_t35=_context32.v;console.warn(\"[BetterTasks] AI parsing threw unexpectedly\",_t35);aiResult={ok:false,error:_t35};case 17:_context32.p=17;suppressAiAbort=true;hideToastInstance(pending);return _context32.f(17);case 18:if(!(((_aiResult5=aiResult)===null||_aiResult5===void 0?void 0:_aiResult5.reason)===\"aborted\")){_context32.n=19;break;}return _context32.a(2);case 19:if(!aiResult.ok){_context32.n=22;break;}_context32.n=20;return createTaskFromParsedJson(targetUid,aiResult.task,aiInput);case 20:applied=_context32.v;if(!applied){_context32.n=21;break;}toast(t([\"toasts\",\"createdWithAi\"],getLanguageSetting())||\"Created Better Task with AI parsing\");return _context32.a(2);case 21:_context32.n=23;break;case 22:console.warn(\"[BetterTasks] AI parsing unavailable\",aiResult.error||aiResult.reason);if(aiResult.status===429||aiResult.code===\"insufficient_quota\"){toast(\"AI parsing unavailable (429 from OpenAI). Check your billing/credit: https://platform.openai.com/settings/organization/billing/overview\");}else{toast(t([\"toasts\",\"aiFallback\"],getLanguageSetting())||\"AI parsing unavailable, creating a normal Better Task instead.\");}case 23:_context32.n=24;return createRecurringTODO(targetUid);case 24:return _context32.a(2);}},_callee32,null,[[14,16,17,18]]);}));return _createBetterTaskEntryPoint.apply(this,arguments);}function createRecurringTODO(_x3){return _createRecurringTODO.apply(this,arguments);}function _createRecurringTODO(){_createRecurringTODO=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee33(fuid){var focused,block,props,inlineAttrs,childAttrs,attrNames,childRepeatEntry,childDueEntry,childStartEntry,childDeferEntry,inlineRepeatVal,inlineDueVal,inlineStartVal,inlineDeferVal,removalKeys,baseWithoutAttrs,initialTaskText,promptResult,set,normalizedRepeat,dueDate,dueStr,promptDueSource,startSourceFromPrompt,startFallbackSource,startSource,startDate,startStr,deferSourceFromPrompt,deferFallbackSource,deferSource,deferDate,deferStr,hasRepeat,hasTimingInput,hasMetadataInput,taskTextInput,cleanedTaskText,todoString,rtProps,createdMsg;return _regenerator().w(function(_context33){while(1)switch(_context33.n){case 0:if(fuid){_context33.n=2;break;}_context33.n=1;return window.roamAlphaAPI.ui.getFocusedBlock();case 1:focused=_context33.v;fuid=focused&&focused[\"block-uid\"];if(!(fuid==null||fuid==undefined)){_context33.n=2;break;}toast(t([\"toasts\",\"placeCursorTodo\"],getLanguageSetting())||\"Place the cursor in the block where you wish to create the Better Task.\");return _context33.a(2);case 2:_context33.n=3;return getBlock(fuid);case 3:block=_context33.v;if(block){_context33.n=4;break;}toast(t([\"toasts\",\"unableReadBlock\"],getLanguageSetting())||\"Unable to read the current block.\");return _context33.a(2);case 4:props=parseProps(block.props);inlineAttrs=parseAttrsFromBlockText(block.string||\"\");childAttrs=parseAttrsFromChildBlocks(block.children||[]);attrNames=resolveAttributeNames();childRepeatEntry=pickChildAttr(childAttrs,attrNames.repeatAliases);childDueEntry=pickChildAttr(childAttrs,attrNames.dueAliases);childStartEntry=pickChildAttr(childAttrs,attrNames.startAliases);childDeferEntry=pickChildAttr(childAttrs,attrNames.deferAliases);inlineRepeatVal=pickInlineAttr(inlineAttrs,attrNames.repeatAliases);inlineDueVal=pickInlineAttr(inlineAttrs,attrNames.dueAliases);inlineStartVal=pickInlineAttr(inlineAttrs,attrNames.startAliases);inlineDeferVal=pickInlineAttr(inlineAttrs,attrNames.deferAliases);removalKeys=_toConsumableArray(new Set([].concat(_toConsumableArray(attrNames.repeatRemovalKeys),_toConsumableArray(attrNames.dueRemovalKeys),_toConsumableArray(attrNames.startRemovalKeys),_toConsumableArray(attrNames.deferRemovalKeys))));baseWithoutAttrs=removeInlineAttributes(block.string||\"\",removalKeys);initialTaskText=baseWithoutAttrs.replace(/^\\{\\{\\[\\[(?:TODO|DONE)\\]\\]\\}\\}\\s*/i,\"\").trim();_context33.n=5;return promptForRepeatAndDue({includeTaskText:true,forceTaskInput:true,taskText:initialTaskText,repeat:props.repeat||(childRepeatEntry===null||childRepeatEntry===void 0?void 0:childRepeatEntry.value)||inlineRepeatVal||\"\",due:props.due||(childDueEntry===null||childDueEntry===void 0?void 0:childDueEntry.value)||inlineDueVal||\"\",start:props.start||(childStartEntry===null||childStartEntry===void 0?void 0:childStartEntry.value)||inlineStartVal||\"\",defer:props.defer||(childDeferEntry===null||childDeferEntry===void 0?void 0:childDeferEntry.value)||inlineDeferVal||\"\"});case 5:promptResult=_context33.v;if(promptResult){_context33.n=6;break;}return _context33.a(2);case 6:set=S(attrNames);normalizedRepeat=promptResult.repeat?normalizeRepeatRuleText(promptResult.repeat)||promptResult.repeat:\"\";if(!(normalizedRepeat&&!parseRuleText(normalizedRepeat,set))){_context33.n=7;break;}toast(t([\"toasts\",\"unableUnderstandRepeat\"],getLanguageSetting())||\"Unable to understand that repeat rule.\");return _context33.a(2);case 7:dueDate=null;dueStr=null;promptDueSource=promptResult.due||\"\";if(!promptDueSource){_context33.n=9;break;}dueDate=promptResult.dueDate instanceof Date&&!Number.isNaN(promptResult.dueDate.getTime())?new Date(promptResult.dueDate.getTime()):parseRoamDate(promptDueSource);if(!(!(dueDate instanceof Date)||Number.isNaN(dueDate.getTime()))){_context33.n=8;break;}toast(t([\"toasts\",\"cannotParseDue\"],getLanguageSetting())||\"Couldn't parse that due date.\");return _context33.a(2);case 8:dueStr=formatDate(dueDate,set);case 9:startSourceFromPrompt=promptResult.start||\"\";startFallbackSource=props.start||(childStartEntry===null||childStartEntry===void 0?void 0:childStartEntry.value)||inlineStartVal||\"\";startSource=startSourceFromPrompt||startFallbackSource;startDate=null;startStr=null;if(!startSource){_context33.n=11;break;}startDate=promptResult.startDate instanceof Date&&startSourceFromPrompt?new Date(promptResult.startDate.getTime()):parseRoamDate(startSource);if(!(!(startDate instanceof Date)||Number.isNaN(startDate.getTime()))){_context33.n=10;break;}toast(t([\"toasts\",\"cannotParseStart\"],getLanguageSetting())||\"Couldn't parse that start date.\");return _context33.a(2);case 10:startStr=formatDate(startDate,set);case 11:deferSourceFromPrompt=promptResult.defer||\"\";deferFallbackSource=props.defer||(childDeferEntry===null||childDeferEntry===void 0?void 0:childDeferEntry.value)||inlineDeferVal||\"\";deferSource=deferSourceFromPrompt||deferFallbackSource;deferDate=null;deferStr=null;if(!deferSource){_context33.n=13;break;}deferDate=promptResult.deferDate instanceof Date&&deferSourceFromPrompt?new Date(promptResult.deferDate.getTime()):parseRoamDate(deferSource);if(!(!(deferDate instanceof Date)||Number.isNaN(deferDate.getTime()))){_context33.n=12;break;}toast(t([\"toasts\",\"cannotParseDefer\"],getLanguageSetting())||\"Couldn't parse that defer date.\");return _context33.a(2);case 12:deferStr=formatDate(deferDate,set);case 13:hasRepeat=!!normalizedRepeat;hasTimingInput=!!(dueStr||startStr||deferStr);hasMetadataInput=!!((promptResult.project||\"\").trim()||(promptResult.waitingFor||\"\").trim()||(promptResult.context||\"\").trim()||(promptResult.priority||\"\").trim()||(promptResult.energy||\"\").trim()||(promptResult.gtd||\"\").trim());if(!(!hasRepeat&&!hasTimingInput&&!hasMetadataInput)){_context33.n=14;break;}toast(t([\"toasts\",\"addRepeatDateOrMetadata\"],getLanguageSetting())||\"Add a repeat rule, a date, or metadata.\");return _context33.a(2);case 14:taskTextInput=typeof promptResult.taskText===\"string\"&&promptResult.taskText?promptResult.taskText:typeof promptResult.taskTextRaw===\"string\"&&promptResult.taskTextRaw?promptResult.taskTextRaw:initialTaskText;cleanedTaskText=removeInlineAttributes(taskTextInput||\"\",removalKeys).trim();todoString=normalizeToTodoMacro(cleanedTaskText);if(!(todoString!==(block.string||\"\"))){_context33.n=15;break;}_context33.n=15;return updateBlockString(fuid,todoString);case 15:rtProps=_objectSpread({},props.rt||{});if(!rtProps.id)rtProps.id=shortId();if(!rtProps.tz)rtProps.tz=set.timezone;_context33.n=16;return updateBlockProps(fuid,{rt:rtProps});case 16:if(!hasRepeat){_context33.n=18;break;}_context33.n=17;return ensureChildAttrForType(fuid,\"repeat\",normalizedRepeat,set.attrNames);case 17:_context33.n=19;break;case 18:_context33.n=19;return removeChildAttrsForType(fuid,\"repeat\",set.attrNames);case 19:if(!dueStr){_context33.n=21;break;}_context33.n=20;return ensureChildAttrForType(fuid,\"due\",dueStr,set.attrNames);case 20:_context33.n=22;break;case 21:_context33.n=22;return removeChildAttrsForType(fuid,\"due\",set.attrNames);case 22:if(!startStr){_context33.n=24;break;}_context33.n=23;return ensureChildAttrForType(fuid,\"start\",startStr,set.attrNames);case 23:_context33.n=25;break;case 24:_context33.n=25;return removeChildAttrsForType(fuid,\"start\",set.attrNames);case 25:if(!deferStr){_context33.n=27;break;}_context33.n=26;return ensureChildAttrForType(fuid,\"defer\",deferStr,set.attrNames);case 26:_context33.n=28;break;case 27:_context33.n=28;return removeChildAttrsForType(fuid,\"defer\",set.attrNames);case 28:if(!hasMetadataInput){_context33.n=29;break;}_context33.n=29;return applyMetadataFromPrompt(fuid,promptResult,set.attrNames);case 29:repeatOverrides[\"delete\"](fuid);createdMsg=t([\"toasts\",\"createdRecurring\"],getLanguageSetting())||\"Created your Better Task\";toast(createdMsg);scheduleSurfaceSync(set.attributeSurface);case 30:return _context33.a(2);}},_callee33);}));return _createRecurringTODO.apply(this,arguments);}function createTaskFromParsedJson(_x4,_x5){return _createTaskFromParsedJson.apply(this,arguments);}function _createTaskFromParsedJson(){_createTaskFromParsedJson=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee34(blockUid,parsed){var rawInput,block,baseTitle,cleanedTitle,attrNames,set,todoString,repeatVal,normalizedRepeat,parseAndFormatDate,weekendSpan,weekSpan,dueStr,startStr,deferStr,props,rtProps,hasAiMeta,_args34=arguments;return _regenerator().w(function(_context34){while(1)switch(_context34.n){case 0:rawInput=_args34.length>2&&_args34[2]!==undefined?_args34[2]:\"\";if(!(!blockUid||!parsed)){_context34.n=1;break;}return _context34.a(2,false);case 1:_context34.n=2;return getBlock(blockUid);case 2:block=_context34.v;if(block){_context34.n=3;break;}return _context34.a(2,false);case 3:baseTitle=typeof parsed.title===\"string\"?parsed.title.trim():\"\";if(baseTitle){_context34.n=4;break;}return _context34.a(2,false);case 4:cleanedTitle=stripSchedulingFromTitle(baseTitle,parsed);attrNames=resolveAttributeNames();set=S(attrNames);todoString=normalizeToTodoMacro(cleanedTitle);if(!(todoString!==(block.string||\"\"))){_context34.n=5;break;}_context34.n=5;return updateBlockString(blockUid,todoString);case 5:repeatVal=\"\";if(typeof parsed.repeatRule===\"string\"&&parsed.repeatRule.trim()){normalizedRepeat=normalizeRepeatRuleText(parsed.repeatRule)||parsed.repeatRule.trim();if(parseRuleText(normalizedRepeat,set)){repeatVal=normalizedRepeat;}else{console.warn(\"[BetterTasks] AI repeat rule invalid, ignoring\",normalizedRepeat);}}parseAndFormatDate=function parseAndFormatDate(value){if(typeof value!==\"string\"||!value.trim())return null;var original=value.trim();var cleaned=stripTimeFromDateText(original);var dt=parseRoamDate(cleaned)||parseRelativeDateText(cleaned,set.weekStartCode);if(!dt&&hasTimeOnlyHint(original)){dt=pickAnchorDateFromTimeHint(original,set);}if(!(dt instanceof Date)||Number.isNaN(dt.getTime()))return null;return formatDate(dt,set);};weekendSpan=parseWeekendSpan(parsed.dueDateText||parsed.startDateText||\"\",set);weekSpan=parseWeekSpan(parsed.dueDateText||parsed.startDateText||\"\",set);dueStr=(weekendSpan!==null&&weekendSpan!==void 0&&weekendSpan.due?formatDate(weekendSpan.due,set):null)||(weekSpan!==null&&weekSpan!==void 0&&weekSpan.due?formatDate(weekSpan.due,set):null)||parseAndFormatDate(parsed.dueDateText);startStr=(weekendSpan!==null&&weekendSpan!==void 0&&weekendSpan.start?formatDate(weekendSpan.start,set):null)||(weekSpan!==null&&weekSpan!==void 0&&weekSpan.start?formatDate(weekSpan.start,set):null)||parseAndFormatDate(parsed.startDateText);deferStr=parseAndFormatDate(parsed.deferDateText);props=parseProps(block.props);rtProps=_objectSpread({},props.rt||{});if(!rtProps.id)rtProps.id=shortId();if(!rtProps.tz)rtProps.tz=set.timezone;_context34.n=6;return updateBlockProps(blockUid,{rt:rtProps});case 6:if(!repeatVal){_context34.n=8;break;}_context34.n=7;return ensureChildAttrForType(blockUid,\"repeat\",repeatVal,set.attrNames);case 7:_context34.n=9;break;case 8:_context34.n=9;return removeChildAttrsForType(blockUid,\"repeat\",set.attrNames);case 9:if(!dueStr){_context34.n=11;break;}_context34.n=10;return ensureChildAttrForType(blockUid,\"due\",dueStr,set.attrNames);case 10:_context34.n=12;break;case 11:_context34.n=12;return removeChildAttrsForType(blockUid,\"due\",set.attrNames);case 12:if(!startStr){_context34.n=14;break;}_context34.n=13;return ensureChildAttrForType(blockUid,\"start\",startStr,set.attrNames);case 13:_context34.n=15;break;case 14:_context34.n=15;return removeChildAttrsForType(blockUid,\"start\",set.attrNames);case 15:if(!deferStr){_context34.n=17;break;}_context34.n=16;return ensureChildAttrForType(blockUid,\"defer\",deferStr,set.attrNames);case 16:_context34.n=18;break;case 17:_context34.n=18;return removeChildAttrsForType(blockUid,\"defer\",set.attrNames);case 18:hasAiMeta=!!((parsed.project||\"\").trim()||(parsed.context||\"\").trim()||(parsed.priority||\"\").trim()||(parsed.energy||\"\").trim());if(!hasAiMeta){_context34.n=19;break;}_context34.n=19;return applyMetadataFromPrompt(blockUid,{project:parsed.project||\"\",context:parsed.context||\"\",priority:parsed.priority||\"\",energy:parsed.energy||\"\"},set.attrNames);case 19:repeatOverrides[\"delete\"](blockUid);scheduleSurfaceSync(set.attributeSurface);return _context34.a(2,true);}},_callee34);}));return _createTaskFromParsedJson.apply(this,arguments);}function getWeekStartSetting(){var raw=extensionAPI.settings.get(\"rt-week-start\");if(typeof raw===\"string\"&&WEEK_START_OPTIONS.includes(raw))return raw;return\"Monday\";}function enforceChildAttrSurface(){var api=arguments.length>0&&arguments[0]!==undefined?arguments[0]:extensionAPI;try{var _api$settings;var stored=api===null||api===void 0||(_api$settings=api.settings)===null||_api$settings===void 0?void 0:_api$settings.get(\"rt-attribute-surface\");if(stored!==\"Child\"){var _api$settings2;api===null||api===void 0||(_api$settings2=api.settings)===null||_api$settings2===void 0||_api$settings2.set(\"rt-attribute-surface\",\"Child\");}}catch(err){console.warn(\"[RecurringTasks] failed to enforce Child attribute surface\",err);}return\"Child\";}function S(){var attrNamesOverride=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var attrSurface=enforceChildAttrSurface(extensionAPI);if(attrSurface!==lastAttrSurface){lastAttrSurface=attrSurface;scheduleSurfaceSync(attrSurface);}var attrNames=attrNamesOverride||resolveAttributeNames();lastAttrNames=attrNames;var tz=\"UTC\";var langSetting=getLanguageSetting();var locale=langSetting===\"en\"?\"en-US\":langSetting;try{tz=Intl.DateTimeFormat().resolvedOptions().timeZone||\"UTC\";}catch(_){tz=\"UTC\";}try{locale=langSetting||typeof navigator!==\"undefined\"&&navigator.language||Intl.DateTimeFormat().resolvedOptions().locale||\"en-US\";}catch(_){locale=\"en-US\";}var weekStartLabel=getWeekStartSetting();var weekStartCode=dowFromAlias(weekStartLabel)||\"MO\";return{destination:extensionAPI.settings.get(\"rt-destination\")||\"DNP\",dnpHeading:extensionAPI.settings.get(\"rt-dnp-heading\")||\"Tasks\",dateFormat:\"ROAM\",advanceFrom:\"due\",attributeSurface:attrSurface,confirmBeforeSpawn:!!extensionAPI.settings.get(\"rt-confirm\"),timezone:tz,locale:locale,attrNames:attrNames,weekStart:weekStartLabel,weekStartCode:weekStartCode};}function getAiSettings(){var modeRaw=extensionAPI.settings.get(AI_MODE_SETTING);var mode=AI_MODE_OPTIONS.includes(modeRaw)?modeRaw:\"Off\";var keyRaw=extensionAPI.settings.get(AI_KEY_SETTING);var apiKey=typeof keyRaw===\"string\"?keyRaw.trim():\"\";return{mode:mode,apiKey:apiKey};}function isAiEnabled(aiSettings){return(aiSettings===null||aiSettings===void 0?void 0:aiSettings.mode)===\"Use my OpenAI key\"&&!!aiSettings.apiKey;}function parseTaskWithOpenAI(_x6,_x7){return _parseTaskWithOpenAI.apply(this,arguments);}function _parseTaskWithOpenAI(){_parseTaskWithOpenAI=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee35(input,aiSettings){var _data$choices;var options,AI_RETRY_STATUSES,AI_RETRY_MAX,AI_RETRY_BASE_MS,signal,payload,response,lastError,attempt,retryDelayMs,_response$headers,_response$headers$get,retryAfter,retryAfterSec,jitterFactor,responseBodyText,parsedBody,parsedContent,_parsedBody,contentRaw,_errorJson,_response,_errorJson2,_errorJson3,_response2,errorText,errorJson,message,code,data,content,parsed,validated,_args35=arguments,_t36,_t37,_t38,_t39,_t40,_t41;return _regenerator().w(function(_context35){while(1)switch(_context35.p=_context35.n){case 0:options=_args35.length>2&&_args35[2]!==undefined?_args35[2]:{};if(isAiEnabled(aiSettings)){_context35.n=1;break;}return _context35.a(2,{ok:false,reason:\"disabled\"});case 1:AI_RETRY_STATUSES=new Set([429,500,502,503,504]);AI_RETRY_MAX=2;AI_RETRY_BASE_MS=400;signal=(options===null||options===void 0?void 0:options.signal)||null;payload={model:AI_MODEL,messages:[{role:\"system\",content:AI_SYSTEM_PROMPT},{role:\"user\",content:input}],response_format:{type:\"json_object\"},max_tokens:300};// console.info(\"[BetterTasks] OpenAI request\", {\n//   model: payload.model,\n//   messages: payload.messages?.map((m) => ({\n//     role: m.role,\n//     contentLength: m.content?.length,\n//     content: m.content,\n//   })),\n//   messageCount: payload.messages?.length,\n//   userLength: input?.length,\n//   response_format: payload.response_format,\n//   max_tokens: payload.max_tokens,\n// });\nresponse=null;lastError=null;_context35.p=2;attempt=0;case 3:if(!(attempt<=AI_RETRY_MAX)){_context35.n=21;break;}_context35.p=4;if(!(signal!==null&&signal!==void 0&&signal.aborted)){_context35.n=5;break;}return _context35.a(2,{ok:false,reason:\"aborted\"});case 5:_context35.n=6;return fetch(\"https://api.openai.com/v1/chat/completions\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(aiSettings.apiKey)},body:JSON.stringify(payload),signal:signal||undefined});case 6:response=_context35.v;_context35.n=14;break;case 7:_context35.p=7;_t36=_context35.v;if(!((_t36===null||_t36===void 0?void 0:_t36.name)===\"AbortError\")){_context35.n=8;break;}return _context35.a(2,{ok:false,reason:\"aborted\"});case 8:lastError=_t36;if(!(attempt<AI_RETRY_MAX)){_context35.n=13;break;}_context35.p=9;_context35.n=10;return delayWithSignal(AI_RETRY_BASE_MS*Math.pow(2,attempt),signal);case 10:_context35.n=12;break;case 11:_context35.p=11;_t37=_context35.v;if(!((_t37===null||_t37===void 0?void 0:_t37.name)===\"AbortError\")){_context35.n=12;break;}return _context35.a(2,{ok:false,reason:\"aborted\"});case 12:return _context35.a(3,20);case 13:throw _t36;case 14:if(!(!response||response.ok)){_context35.n=15;break;}return _context35.a(3,21);case 15:if(!(!AI_RETRY_STATUSES.has(response.status)||attempt>=AI_RETRY_MAX)){_context35.n=16;break;}return _context35.a(3,21);case 16:retryDelayMs=AI_RETRY_BASE_MS*Math.pow(2,attempt);if(response.status===429){retryAfter=(_response$headers=response.headers)===null||_response$headers===void 0||(_response$headers$get=_response$headers.get)===null||_response$headers$get===void 0?void 0:_response$headers$get.call(_response$headers,\"retry-after\");retryAfterSec=retryAfter?parseFloat(retryAfter):NaN;if(Number.isFinite(retryAfterSec)&&retryAfterSec>0){retryDelayMs=Math.max(retryDelayMs,retryAfterSec*1000);}}jitterFactor=0.8+Math.random()*0.4;_context35.p=17;_context35.n=18;return delayWithSignal(Math.round(retryDelayMs*jitterFactor),signal);case 18:_context35.n=20;break;case 19:_context35.p=19;_t38=_context35.v;if(!((_t38===null||_t38===void 0?void 0:_t38.name)===\"AbortError\")){_context35.n=20;break;}return _context35.a(2,{ok:false,reason:\"aborted\"});case 20:attempt+=1;_context35.n=3;break;case 21:_context35.n=23;break;case 22:_context35.p=22;_t39=_context35.v;console.warn(\"[BetterTasks] OpenAI request failed\",_t39);return _context35.a(2,{ok:false,error:_t39});case 23:if(response){_context35.n=24;break;}return _context35.a(2,{ok:false,error:lastError||new Error(\"OpenAI request failed\")});case 24:responseBodyText=null;_context35.p=25;_context35.n=26;return response.text();case 26:responseBodyText=_context35.v;_context35.n=28;break;case 27:_context35.p=27;_t40=_context35.v;if(!((_t40===null||_t40===void 0?void 0:_t40.name)===\"AbortError\")){_context35.n=28;break;}return _context35.a(2,{ok:false,reason:\"aborted\"});case 28:parsedBody=null;try{parsedBody=responseBodyText?JSON.parse(responseBodyText):null;}catch(_){// leave parsedBody null\n}parsedContent=null;try{contentRaw=(_parsedBody=parsedBody)===null||_parsedBody===void 0||(_parsedBody=_parsedBody.choices)===null||_parsedBody===void 0||(_parsedBody=_parsedBody[0])===null||_parsedBody===void 0||(_parsedBody=_parsedBody.message)===null||_parsedBody===void 0?void 0:_parsedBody.content;parsedContent=contentRaw?JSON.parse(contentRaw):null;}catch(_){parsedContent=null;}// console.info(\"[BetterTasks] OpenAI response\", {\n//   status: response?.status,\n//   ok: response?.ok,\n//   body: parsedBody ?? responseBodyText,\n//   contentJson: parsedContent,\n// });\nif(!(!response||!response.ok)){_context35.n=29;break;}errorText=null;errorJson=null;try{errorText=responseBodyText;errorJson=parsedBody||JSON.parse(errorText||\"{}\");}catch(_){// ignore parse issues\n}message=((_errorJson=errorJson)===null||_errorJson===void 0||(_errorJson=_errorJson.error)===null||_errorJson===void 0?void 0:_errorJson.message)||errorText||\"OpenAI response \".concat(((_response=response)===null||_response===void 0?void 0:_response.status)||\"unknown\");code=((_errorJson2=errorJson)===null||_errorJson2===void 0||(_errorJson2=_errorJson2.error)===null||_errorJson2===void 0?void 0:_errorJson2.code)||((_errorJson3=errorJson)===null||_errorJson3===void 0||(_errorJson3=_errorJson3.error)===null||_errorJson3===void 0?void 0:_errorJson3.type)||null;return _context35.a(2,{ok:false,error:new Error(message),status:(_response2=response)===null||_response2===void 0?void 0:_response2.status,code:code});case 29:data=parsedBody;if(data){_context35.n=30;break;}return _context35.a(2,{ok:false,error:new Error(\"Empty response body\")});case 30:content=data===null||data===void 0||(_data$choices=data.choices)===null||_data$choices===void 0||(_data$choices=_data$choices[0])===null||_data$choices===void 0||(_data$choices=_data$choices.message)===null||_data$choices===void 0?void 0:_data$choices.content;if(!(!content||typeof content!==\"string\")){_context35.n=31;break;}return _context35.a(2,{ok:false,error:new Error(\"Empty response\")});case 31:parsed=null;_context35.p=32;parsed=JSON.parse(content);_context35.n=34;break;case 33:_context35.p=33;_t41=_context35.v;return _context35.a(2,{ok:false,error:_t41});case 34:validated=validateParsedTask(parsed);if(validated.ok){_context35.n=35;break;}return _context35.a(2,validated);case 35:return _context35.a(2,validated);}},_callee35,null,[[32,33],[25,27],[17,19],[9,11],[4,7],[2,22]]);}));return _parseTaskWithOpenAI.apply(this,arguments);}function validateParsedTask(raw){if(!raw||_typeof(raw)!==\"object\")return{ok:false,error:new Error(\"Invalid JSON shape\")};var title=typeof raw.title===\"string\"?raw.title.trim():\"\";if(!title)return{ok:false,error:new Error(\"Missing title\")};var task={title:title};if(typeof raw.repeatRule===\"string\"&&raw.repeatRule.trim())task.repeatRule=raw.repeatRule.trim();if(typeof raw.dueDateText===\"string\"&&raw.dueDateText.trim())task.dueDateText=raw.dueDateText.trim();if(typeof raw.startDateText===\"string\"&&raw.startDateText.trim())task.startDateText=raw.startDateText.trim();if(typeof raw.deferDateText===\"string\"&&raw.deferDateText.trim())task.deferDateText=raw.deferDateText.trim();if(typeof raw.project===\"string\"&&raw.project.trim())task.project=raw.project.trim();if(typeof raw.context===\"string\"&&raw.context.trim())task.context=raw.context.trim();var allowedRatings=new Set([\"low\",\"medium\",\"high\"]);if(typeof raw.priority===\"string\"&&allowedRatings.has(raw.priority))task.priority=raw.priority;if(raw.priority===null)task.priority=null;if(typeof raw.energy===\"string\"&&allowedRatings.has(raw.energy))task.energy=raw.energy;if(raw.energy===null)task.energy=null;return{ok:true,task:task};}function stripSchedulingFromTitle(title,parsed){var hasRepeat=typeof(parsed===null||parsed===void 0?void 0:parsed.repeatRule)===\"string\"&&parsed.repeatRule.trim();var hasDate=typeof(parsed===null||parsed===void 0?void 0:parsed.dueDateText)===\"string\"&&parsed.dueDateText.trim()||typeof(parsed===null||parsed===void 0?void 0:parsed.startDateText)===\"string\"&&parsed.startDateText.trim()||typeof(parsed===null||parsed===void 0?void 0:parsed.deferDateText)===\"string\"&&parsed.deferDateText.trim();var t=(title||\"\").trim();if(!t)return t;if(hasRepeat){t=t.replace(/,\\s*every\\b.+$/i,\"\").trim();t=t.replace(/\\bevery\\s+.+$/i,\"\").trim();// Only drop bare cadence words when they are effectively trailing schedule hints (optionally with at/on ...)\nt=t.replace(/\\b(daily|weekly|monthly|yearly|annually|weekdays|weekends)\\b\\s*(?:(?:at|on)\\b.*)?$/i,\"\").trim();}if(hasDate){t=t.replace(/\\s*(on|by|due|for)\\s+(tomorrow|today|next\\s+[a-z]+|this\\s+[a-z]+)$/i,\"\").trim();t=t.replace(/\\s*(on\\s+)?\\[\\[[^\\]]+\\]\\]\\s*$/i,\"\").trim();t=t.replace(/\\s*(tomorrow|today|next\\s+[a-z]+)$/i,\"\").trim();}return t||(title||\"\").trim();}var DEBUG_COMPLETION_LOGS=function(){try{var _window$localStorage,_window$localStorage$;return((_window$localStorage=window.localStorage)===null||_window$localStorage===void 0||(_window$localStorage$=_window$localStorage.getItem)===null||_window$localStorage$===void 0?void 0:_window$localStorage$.call(_window$localStorage,\"bt-debug-completions\"))===\"1\";}catch(_){return false;}}()||false;var processedMap=new Map();var completionPairs=new Map();var completionQueue=new Map();var completionQueueTimer=null;var completionQueueFlushInFlight=false;var COMPLETION_PAIR_WINDOW_MS=1200;var USER_COMPLETION_BYPASS_MS=2200;var COMPLETION_STALE_WINDOW_MS=60000;var NAV_COMPLETION_BLOCK_MS=5000;var repeatOverrides=new Map();var invalidRepeatToasted=new Set();var invalidDueToasted=new Set();var deletingChildAttrs=new Set();var childAttrLocks=new Map();var pageLoadQuietUntil=0;var lastNavigationAt=Date.now();var lastUserCheckboxInteraction=0;var PAGE_COMPLETION_GRACE_MS=1800;function normalizeOverrideEntry(entry){if(!entry)return null;if(typeof entry===\"string\"){var normalized=normalizeRepeatRuleText(entry)||entry;return normalized?{repeat:normalized}:null;}if(_typeof(entry)===\"object\"){var out={};if(typeof entry.repeat===\"string\"&&entry.repeat){out.repeat=normalizeRepeatRuleText(entry.repeat)||entry.repeat;}if(entry.due instanceof Date&&!Number.isNaN(entry.due.getTime())){out.due=entry.due;}return Object.keys(out).length?out:null;}return null;}function mergeRepeatOverride(uid,patch){if(!uid||!patch)return;var current=normalizeOverrideEntry(repeatOverrides.get(uid))||{};var next=_objectSpread({},current);if(typeof patch.repeat===\"string\"&&patch.repeat){next.repeat=normalizeRepeatRuleText(patch.repeat)||patch.repeat;}if(patch.due instanceof Date&&!Number.isNaN(patch.due.getTime())){next.due=patch.due;}if(patch.due===null){delete next.due;}if(!next.repeat&&!next.due){repeatOverrides[\"delete\"](uid);return;}repeatOverrides.set(uid,next);}function captureBlockLocation(block){var _parents$,_block$page;var parents=Array.isArray(block===null||block===void 0?void 0:block.parents)?block.parents:[];var parentUid=parents.length?(_parents$=parents[0])===null||_parents$===void 0?void 0:_parents$.uid:(block===null||block===void 0||(_block$page=block.page)===null||_block$page===void 0?void 0:_block$page.uid)||null;var order=typeof(block===null||block===void 0?void 0:block.order)===\"number\"?block.order:0;return{parentUid:parentUid,order:order};}function prepareDueChangeContext(block,meta,set){var props=parseProps(block===null||block===void 0?void 0:block.props);var inlineAttrs=parseAttrsFromBlockText((block===null||block===void 0?void 0:block.string)||\"\");var location=captureBlockLocation(block);var childMap=(meta===null||meta===void 0?void 0:meta.childAttrMap)||{};var attrNames=(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames();var attrSurface=(set===null||set===void 0?void 0:set.attributeSurface)||\"Child\";var dueInfo=pickChildAttr(childMap,attrNames.dueAliases,{allowFallback:false})||null;var repeatInfo=pickChildAttr(childMap,attrNames.repeatAliases,{allowFallback:false})||null;var inlineDueValue=pickInlineAttr(inlineAttrs,attrNames.dueAliases);var inlineRepeatValue=pickInlineAttr(inlineAttrs,attrNames.repeatAliases);var snapshot=captureBlockSnapshot(block);var previousDueDate=(meta===null||meta===void 0?void 0:meta.due)instanceof Date&&!Number.isNaN(meta.due.getTime())?new Date(meta.due.getTime()):null;var previousDueStr=typeof(props===null||props===void 0?void 0:props.due)===\"string\"?props.due:previousDueDate?formatDate(previousDueDate,set):null;return{previousDueDate:previousDueDate,previousDueStr:previousDueStr,previousInlineDue:inlineDueValue||null,hadInlineDue:inlineDueValue!=null,previousChildDue:(dueInfo===null||dueInfo===void 0?void 0:dueInfo.value)||null,hadChildDue:!!dueInfo,previousChildDueUid:(dueInfo===null||dueInfo===void 0?void 0:dueInfo.uid)||null,previousChildRepeat:(repeatInfo===null||repeatInfo===void 0?void 0:repeatInfo.value)||null,previousChildRepeatUid:(repeatInfo===null||repeatInfo===void 0?void 0:repeatInfo.uid)||null,previousParentUid:location.parentUid,previousOrder:location.order,previousProps:props&&_typeof(props)===\"object\"?clonePlain(props):{},previousInlineRepeat:inlineRepeatValue||null,hadInlineRepeat:inlineRepeatValue!=null,snapshot:snapshot};}var dueUndoRegistry=new Map();function registerDueUndoAction(payload){if(!(payload!==null&&payload!==void 0&&payload.blockUid))return;dueUndoRegistry.set(payload.blockUid,payload);izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",\"class\":\"betterTasks bt-toast-strong-icon\",position:\"center\",timeout:5000,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#1f7a34\",close:true,closeOnEscape:true,closeOnClick:false,message:translateString(payload.message||\"Due updated\",getLanguageSetting()),buttons:[[\"<button>\".concat(escapeHtml(t([\"buttons\",\"undo\"],getLanguageSetting())||\"Undo\"),\"</button>\"),function(instance,toastEl){instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");performDueUndo(payload)[\"catch\"](function(err){return console.error(\"[RecurringTasks] due undo failed\",err);});},true]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},onClosed:function onClosed(){dueUndoRegistry[\"delete\"](payload.blockUid);}});}function performDueUndo(_x8){return _performDueUndo.apply(this,arguments);}function _performDueUndo(){_performDueUndo=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee36(payload){var uid,set,snapshot,_snapshot$props,_snapshot$childAttrs2,order,block,_block,_childAttrs$repeat,_childAttrs$due,_childAttrs$rtProces,childAttrs,_snapshot$childAttrs,propsUpdate,previousDueDate,snapshotRepeat,normalizedRepeat,restoreDueStr,restoreDueDate,overridePatch,_t42,_t43;return _regenerator().w(function(_context36){while(1)switch(_context36.p=_context36.n){case 0:if(payload!==null&&payload!==void 0&&payload.blockUid){_context36.n=1;break;}return _context36.a(2);case 1:dueUndoRegistry[\"delete\"](payload.blockUid);uid=payload.blockUid;repeatOverrides[\"delete\"](uid);set=payload.setSnapshot||S();snapshot=payload.snapshot||null;_context36.p=2;if(!(payload.wasMoved&&payload.previousParentUid&&payload.previousParentUid!==payload.newParentUid)){_context36.n=6;break;}_context36.p=3;order=payload.previousOrder!=null?payload.previousOrder:0;_context36.n=4;return window.roamAlphaAPI.moveBlock({location:{\"parent-uid\":payload.previousParentUid,order:order},block:{uid:uid}});case 4:_context36.n=6;break;case 5:_context36.p=5;_t42=_context36.v;console.warn(\"[RecurringTasks] undo move failed\",_t42);case 6:_context36.n=7;return getBlock(uid);case 7:block=_context36.v;if(!snapshot){_context36.n=19;break;}if(!(typeof snapshot.string===\"string\"&&((_block=block)===null||_block===void 0?void 0:_block.string)!==snapshot.string)){_context36.n=10;break;}_context36.n=8;return updateBlockString(uid,snapshot.string);case 8:_context36.n=9;return getBlock(uid);case 9:block=_context36.v;case 10:_context36.n=11;return setBlockProps(uid,snapshot.props||{});case 11:_context36.n=12;return getBlock(uid);case 12:block=_context36.v;_context36.n=13;return removeChildAttrsForType(uid,\"repeat\",set.attrNames);case 13:_context36.n=14;return removeChildAttrsForType(uid,\"due\",set.attrNames);case 14:_context36.n=15;return removeChildAttr(uid,\"rt-processed\");case 15:childAttrs=snapshot.childAttrs||{};if(!(((_childAttrs$repeat=childAttrs.repeat)===null||_childAttrs$repeat===void 0?void 0:_childAttrs$repeat.value)!=null&&childAttrs.repeat.value!==\"\")){_context36.n=16;break;}_context36.n=16;return ensureChildAttrForType(uid,\"repeat\",childAttrs.repeat.value,set.attrNames);case 16:if(!(((_childAttrs$due=childAttrs.due)===null||_childAttrs$due===void 0?void 0:_childAttrs$due.value)!=null&&childAttrs.due.value!==\"\")){_context36.n=17;break;}_context36.n=17;return ensureChildAttrForType(uid,\"due\",childAttrs.due.value,set.attrNames);case 17:if(!(((_childAttrs$rtProces=childAttrs[\"rt-processed\"])===null||_childAttrs$rtProces===void 0?void 0:_childAttrs$rtProces.value)!=null&&childAttrs[\"rt-processed\"].value!==\"\")){_context36.n=18;break;}_context36.n=18;return ensureChildAttr(uid,\"rt-processed\",childAttrs[\"rt-processed\"].value);case 18:_context36.n=30;break;case 19:propsUpdate={};if(payload.previousDueStr)propsUpdate.due=payload.previousDueStr;else propsUpdate.due=undefined;if(payload.previousInlineRepeat||payload.previousChildRepeat){propsUpdate.repeat=payload.previousInlineRepeat||payload.previousChildRepeat;}else{propsUpdate.repeat=undefined;}_context36.n=20;return updateBlockProps(uid,propsUpdate);case 20:_context36.n=21;return getBlock(uid);case 21:block=_context36.v;if(!(payload.previousChildRepeat!=null)){_context36.n=23;break;}_context36.n=22;return ensureChildAttrForType(uid,\"repeat\",payload.previousChildRepeat,set.attrNames);case 22:_context36.n=24;break;case 23:_context36.n=24;return removeChildAttrsForType(uid,\"repeat\",set.attrNames);case 24:if(!(payload.hadChildDue&&payload.previousChildDue!=null)){_context36.n=26;break;}_context36.n=25;return ensureChildAttrForType(uid,\"due\",payload.previousChildDue,set.attrNames);case 25:_context36.n=27;break;case 26:_context36.n=27;return removeChildAttrsForType(uid,\"due\",set.attrNames);case 27:if(!((snapshot===null||snapshot===void 0||(_snapshot$childAttrs=snapshot.childAttrs)===null||_snapshot$childAttrs===void 0||(_snapshot$childAttrs=_snapshot$childAttrs[\"rt-processed\"])===null||_snapshot$childAttrs===void 0?void 0:_snapshot$childAttrs.value)!=null&&snapshot.childAttrs[\"rt-processed\"].value!==\"\")){_context36.n=29;break;}_context36.n=28;return ensureChildAttr(uid,\"rt-processed\",snapshot.childAttrs[\"rt-processed\"].value);case 28:_context36.n=30;break;case 29:_context36.n=30;return removeChildAttr(uid,\"rt-processed\");case 30:previousDueDate=payload.previousDueDate instanceof Date&&!Number.isNaN(payload.previousDueDate.getTime())?new Date(payload.previousDueDate.getTime()):null;snapshotRepeat=(snapshot===null||snapshot===void 0||(_snapshot$props=snapshot.props)===null||_snapshot$props===void 0?void 0:_snapshot$props.repeat)||(snapshot===null||snapshot===void 0||(_snapshot$childAttrs2=snapshot.childAttrs)===null||_snapshot$childAttrs2===void 0||(_snapshot$childAttrs2=_snapshot$childAttrs2.repeat)===null||_snapshot$childAttrs2===void 0?void 0:_snapshot$childAttrs2.value)||payload.previousInlineRepeat||payload.previousChildRepeat||null;normalizedRepeat=snapshotRepeat!=null?normalizeRepeatRuleText(snapshotRepeat)||snapshotRepeat:payload.previousInlineRepeat!=null?normalizeRepeatRuleText(payload.previousInlineRepeat)||payload.previousInlineRepeat:payload.previousChildRepeat!=null?normalizeRepeatRuleText(payload.previousChildRepeat)||payload.previousChildRepeat:undefined;restoreDueStr=payload.previousDueStr!=null?payload.previousDueStr:previousDueDate?formatDate(previousDueDate,set):undefined;restoreDueDate=restoreDueStr?parseRoamDate(restoreDueStr)||previousDueDate:previousDueDate;overridePatch={};if(normalizedRepeat)overridePatch.repeat=normalizedRepeat;if(restoreDueStr!==undefined){if(restoreDueDate instanceof Date&&!Number.isNaN(restoreDueDate.getTime())){overridePatch.due=restoreDueDate;}else{overridePatch.due=null;}}if(Object.keys(overridePatch).length){mergeRepeatOverride(uid,overridePatch);}else{repeatOverrides[\"delete\"](uid);}toast(t([\"toasts\",\"undoSuccess\"],getLanguageSetting())||\"Changes un-done successfully\");_context36.n=32;break;case 31:_context36.p=31;_t43=_context36.v;console.warn(\"[RecurringTasks] due undo error\",_t43);case 32:void syncPillsForSurface(lastAttrSurface);case 33:return _context36.a(2);}},_callee36,null,[[3,5],[2,31]]);}));return _performDueUndo.apply(this,arguments);}function isValidDateValue(value){return value instanceof Date&&!Number.isNaN(value.getTime());}function pickPlacementDate(){var candidates=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!candidates||_typeof(candidates)!==\"object\")return null;var start=candidates.start,due=candidates.due,defer=candidates.defer;if(isValidDateValue(start))return start;if(isValidDateValue(due))return due;if(isValidDateValue(defer))return defer;return null;}function ensureTargetReady(_x9,_x0,_x1){return _ensureTargetReady.apply(this,arguments);}function _ensureTargetReady(){_ensureTargetReady=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee37(anchorDate,prevBlock,set){var uid,i,exists,dnpTitle,dnpUid,_dnpTitle,_t44,_t45;return _regenerator().w(function(_context37){while(1)switch(_context37.p=_context37.n){case 0:uid=null;_context37.p=1;_context37.n=2;return chooseTargetPageUid(anchorDate,prevBlock,set);case 2:uid=_context37.v;_context37.n=4;break;case 3:_context37.p=3;_t44=_context37.v;console.warn(\"[RecurringTasks] choose target failed (initial)\",_t44);case 4:if(uid){_context37.n=5;break;}return _context37.a(2,null);case 5:i=0;case 6:if(!(i<5)){_context37.n=10;break;}_context37.n=7;return getBlock(uid);case 7:exists=_context37.v;if(!exists){_context37.n=8;break;}return _context37.a(2,uid);case 8:_context37.n=9;return delay(60*(i+1));case 9:i++;_context37.n=6;break;case 10:_context37.p=10;if(!(set.destination===\"DNP under heading\"&&set.dnpHeading)){_context37.n=13;break;}dnpTitle=toDnpTitle(anchorDate);_context37.n=11;return getOrCreatePageUid(dnpTitle);case 11:dnpUid=_context37.v;_context37.n=12;return getOrCreateChildUnderHeading(dnpUid,set.dnpHeading);case 12:uid=_context37.v;_context37.n=15;break;case 13:if(!(set.destination!==\"Same Page\")){_context37.n=15;break;}_dnpTitle=toDnpTitle(anchorDate);_context37.n=14;return getOrCreatePageUid(_dnpTitle);case 14:uid=_context37.v;case 15:_context37.n=17;break;case 16:_context37.p=16;_t45=_context37.v;console.warn(\"[RecurringTasks] ensureTargetReady fallback failed\",_t45);case 17:return _context37.a(2,uid);}},_callee37,null,[[10,16],[1,3]]);}));return _ensureTargetReady.apply(this,arguments);}function relocateBlockForPlacement(_x10,_x11,_x12){return _relocateBlockForPlacement.apply(this,arguments);}function _relocateBlockForPlacement(){_relocateBlockForPlacement=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee38(block,candidates,set){var locationBefore,result,anchorDate,targetUid,_t46;return _regenerator().w(function(_context38){while(1)switch(_context38.p=_context38.n){case 0:locationBefore=captureBlockLocation(block);result={moved:false,targetUid:locationBefore.parentUid,previousParentUid:locationBefore.parentUid,previousOrder:locationBefore.order};if(!(!block||!set)){_context38.n=1;break;}return _context38.a(2,result);case 1:anchorDate=pickPlacementDate(candidates);if(anchorDate){_context38.n=2;break;}return _context38.a(2,result);case 2:targetUid=locationBefore.parentUid;if(!(set.destination!==\"Same Page\")){_context38.n=4;break;}_context38.n=3;return ensureTargetReady(anchorDate,block,set);case 3:targetUid=_context38.v;case 4:if(targetUid)result.targetUid=targetUid;if(!(targetUid&&targetUid!==locationBefore.parentUid)){_context38.n=8;break;}_context38.p=5;_context38.n=6;return window.roamAlphaAPI.moveBlock({location:{\"parent-uid\":targetUid,order:0},block:{uid:block.uid}});case 6:result.moved=true;_context38.n=8;break;case 7:_context38.p=7;_t46=_context38.v;console.warn(\"[RecurringTasks] relocateBlockForPlacement failed\",_t46);case 8:return _context38.a(2,result);}},_callee38,null,[[5,7]]);}));return _relocateBlockForPlacement.apply(this,arguments);}var pendingPillTimers=new Map();function clearPendingPillTimer(uid){if(!uid)return;var timer=pendingPillTimers.get(uid);if(timer){clearTimeout(timer);pendingPillTimers[\"delete\"](uid);}}function schedulePillRefresh(mainEl){var uid=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var delay=arguments.length>2&&arguments[2]!==undefined?arguments[2]:60;if(!mainEl)return;var targetUid=uid||findBlockUidFromElement(mainEl);if(!targetUid)return;clearPendingPillTimer(targetUid);var timer=setTimeout(function(){pendingPillTimers[\"delete\"](targetUid);void decorateBlockPills(mainEl);},delay);pendingPillTimers.set(targetUid,timer);}function findMainForChildrenContainer(childrenEl){var _prev$classList,_childrenEl$closest,_container$querySelec,_container$querySelec2;if(!childrenEl)return null;var prev=childrenEl.previousElementSibling;if(prev!==null&&prev!==void 0&&(_prev$classList=prev.classList)!==null&&_prev$classList!==void 0&&_prev$classList.contains(\"rm-block-main\")){return prev;}var container=(_childrenEl$closest=childrenEl.closest)===null||_childrenEl$closest===void 0?void 0:_childrenEl$closest.call(childrenEl,\".roam-block-container, .roam-block\");if(!container)return null;return((_container$querySelec=container.querySelector)===null||_container$querySelec===void 0?void 0:_container$querySelec.call(container,\":scope > .rm-block-main\"))||((_container$querySelec2=container.querySelector)===null||_container$querySelec2===void 0?void 0:_container$querySelec2.call(container,\".rm-block-main\"))||null;}var childEditDebounce=new Map();var observer=null;var observerReinitTimer=null;var lastSweep=0;var lastAttrSurface=null;var pendingSurfaceSync=null;lastAttrSurface=enforceChildAttrSurface(extensionAPI);void syncPillsForSurface(lastAttrSurface);initiateObserver();window.addEventListener(\"hashchange\",handleHashChange);(_window$roamAlphaAPI2=window.roamAlphaAPI)===null||_window$roamAlphaAPI2===void 0||delete _window$roamAlphaAPI2.__rtWrapped;// === Child -> Props sync listeners (only used when attribute surface is \"Child\")\nvar _handleAnyEdit=handleAnyEdit.bind(null);document.addEventListener(\"input\",_handleAnyEdit,true);document.addEventListener(\"blur\",_handleAnyEdit,true);var checkboxInteractionSelectors=\".check-container input, .rm-checkbox input\";var _onCheckboxPointer=function _onCheckboxPointer(event){var _event$target$matches,_event$target;if(!((event===null||event===void 0?void 0:event.target)instanceof HTMLElement))return;if(!((_event$target$matches=(_event$target=event.target).matches)!==null&&_event$target$matches!==void 0&&_event$target$matches.call(_event$target,checkboxInteractionSelectors)))return;markUserCheckboxInteraction();};var _onCheckboxChange=function _onCheckboxChange(event){var _event$target$matches2,_event$target2,_host$querySelector;if(!((event===null||event===void 0?void 0:event.target)instanceof HTMLElement))return;if(!((_event$target$matches2=(_event$target2=event.target).matches)!==null&&_event$target$matches2!==void 0&&_event$target$matches2.call(_event$target2,checkboxInteractionSelectors)))return;markUserCheckboxInteraction();var host=event.target.closest(\".rm-checkbox\");if(!host)return;var uid=deriveUidFromMutationNode(host,null);if(!uid)return;var checkbox=((_host$querySelector=host.querySelector)===null||_host$querySelector===void 0?void 0:_host$querySelector.call(host,\"input[type='checkbox']\"))||null;// Defer to ensure class updates (rm-todo -> rm-done) have been applied\nsetTimeout(function(){var _host$classList;if(!((_host$classList=host.classList)!==null&&_host$classList!==void 0&&_host$classList.contains(\"rm-done\")))return;noteTodoRemoval(uid);enqueueCompletion(uid,{checkbox:checkbox,userInitiated:true,detectedAt:Date.now()});},0);};var _onCmdEnterKey=function _onCmdEnterKey(event){var _event$target$closest,_event$target3,_event$target$closest2,_event$target4,_host$querySelector2,_host$querySelector3,_initialCheckbox$quer,_initialCheckbox$clas;var isCmdEnter=(event.metaKey||event.ctrlKey)&&event.key===\"Enter\";if(!isCmdEnter)return;if(!((event===null||event===void 0?void 0:event.target)instanceof HTMLElement))return;var host=((_event$target$closest=(_event$target3=event.target).closest)===null||_event$target$closest===void 0?void 0:_event$target$closest.call(_event$target3,\".rm-block-main\"))||((_event$target$closest2=(_event$target4=event.target).closest)===null||_event$target$closest2===void 0?void 0:_event$target$closest2.call(_event$target4,\".roam-block-container, .roam-block\"))||null;var initialCheckbox=(host===null||host===void 0||(_host$querySelector2=host.querySelector)===null||_host$querySelector2===void 0?void 0:_host$querySelector2.call(host,\":scope .rm-checkbox\"))||(host===null||host===void 0||(_host$querySelector3=host.querySelector)===null||_host$querySelector3===void 0?void 0:_host$querySelector3.call(host,\".rm-checkbox\"))||null;var initialChecked=!!(initialCheckbox!==null&&initialCheckbox!==void 0&&(_initialCheckbox$quer=initialCheckbox.querySelector)!==null&&_initialCheckbox$quer!==void 0&&(_initialCheckbox$quer=_initialCheckbox$quer.call(initialCheckbox,\"input[type='checkbox']\"))!==null&&_initialCheckbox$quer!==void 0&&_initialCheckbox$quer.checked);var initialDoneClass=!!(initialCheckbox!==null&&initialCheckbox!==void 0&&(_initialCheckbox$clas=initialCheckbox.classList)!==null&&_initialCheckbox$clas!==void 0&&_initialCheckbox$clas.contains(\"rm-done\"));var uid=deriveUidFromMutationNode(initialCheckbox||host,host)||findBlockUidFromElement(host);if(!uid)return;var initialMacroDone=/\\{\\{\\s*\\[\\[done\\]\\]\\s*\\}\\}/i.test(event.target.value||(host===null||host===void 0?void 0:host.textContent)||\"\");var initialIsDone=initialChecked||initialDoneClass||initialMacroDone;markUserCheckboxInteraction();var findCheckbox=function findCheckbox(){var _document$querySelect,_document,_document$querySelect2,_document2,_container$querySelec3,_container$querySelec4,_input$closest;var container=host&&host.isConnected&&host||((_document$querySelect=(_document=document).querySelector)===null||_document$querySelect===void 0?void 0:_document$querySelect.call(_document,\".rm-block-main[data-uid='\".concat(uid,\"']\")))||((_document$querySelect2=(_document2=document).querySelector)===null||_document$querySelect2===void 0?void 0:_document$querySelect2.call(_document2,\".roam-block[data-uid='\".concat(uid,\"']\")))||null;var input=(container===null||container===void 0||(_container$querySelec3=container.querySelector)===null||_container$querySelec3===void 0?void 0:_container$querySelec3.call(container,\":scope .rm-checkbox input[type='checkbox']\"))||(container===null||container===void 0||(_container$querySelec4=container.querySelector)===null||_container$querySelec4===void 0?void 0:_container$querySelec4.call(container,\".rm-checkbox input[type='checkbox']\"))||null;if(!input)return null;var checkboxHost=((_input$closest=input.closest)===null||_input$closest===void 0?void 0:_input$closest.call(input,\".rm-checkbox\"))||null;return{input:input,checkboxHost:checkboxHost};};var _attemptEnqueue=function attemptEnqueue(){var _checkboxHost$classLi;var tries=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var found=findCheckbox();var checkboxHost=(found===null||found===void 0?void 0:found.checkboxHost)||null;var input=(found===null||found===void 0?void 0:found.input)||null;var isChecked=(input===null||input===void 0?void 0:input.checked)===true;var isDoneClass=checkboxHost===null||checkboxHost===void 0||(_checkboxHost$classLi=checkboxHost.classList)===null||_checkboxHost$classLi===void 0?void 0:_checkboxHost$classLi.contains(\"rm-done\");if((isChecked||isDoneClass)&&!initialIsDone){noteTodoRemoval(uid);enqueueCompletion(uid,{checkbox:input,userInitiated:true,detectedAt:Date.now()});return;}if(tries<20){setTimeout(function(){return _attemptEnqueue(tries+1);},50);}};// Roam flips classes/checked state after the key event; poll briefly for DONE/checked.\nsetTimeout(function(){return _attemptEnqueue(0);},20);// Fallback: poll the block text for DONE macro in case no checkbox renders (edit mode).\nvar _pollForDoneMacro=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(){var tries,block,text,toggledToDone,_args5=arguments,_t5;return _regenerator().w(function(_context5){while(1)switch(_context5.p=_context5.n){case 0:tries=_args5.length>0&&_args5[0]!==undefined?_args5[0]:0;_context5.p=1;_context5.n=2;return getBlock(uid);case 2:block=_context5.v;text=(block===null||block===void 0?void 0:block.string)||\"\";toggledToDone=/\\{\\{\\s*\\[\\[done\\]\\]\\s*\\}\\}/i.test(text);if(!(toggledToDone&&!initialIsDone)){_context5.n=3;break;}noteTodoRemoval(uid);enqueueCompletion(uid,{checkbox:null,userInitiated:true,detectedAt:Date.now()});return _context5.a(2);case 3:_context5.n=5;break;case 4:_context5.p=4;_t5=_context5.v;case 5:if(tries<10){setTimeout(function(){return _pollForDoneMacro(tries+1);},80);}case 6:return _context5.a(2);}},_callee5,null,[[1,4]]);}));return function pollForDoneMacro(){return _ref9.apply(this,arguments);};}();setTimeout(function(){return _pollForDoneMacro(0);},60);};document.addEventListener(\"pointerdown\",_onCheckboxPointer,true);document.addEventListener(\"change\",_onCheckboxChange,true);document.addEventListener(\"keydown\",_onCmdEnterKey,true);function normalizeUid(raw){if(!raw)return null;var trimmed=String(raw).trim();if(!trimmed)return null;if(/^[A-Za-z0-9_-]{9}$/.test(trimmed))return trimmed;if(trimmed.includes(\"/\")){var segment=trimmed.split(\"/\").filter(Boolean).pop();var attempt=normalizeUid(segment);if(attempt)return attempt;}var tailMatch=trimmed.match(/[A-Za-z0-9_-]{9}$/);if(tailMatch)return tailMatch[0];return trimmed;}function findBlockUidFromCheckbox(input){var _input$closest2,_input$closest3,_input$closest4,_input$closest5,_input$closest6,_input$closest7,_roamBlock$getAttribu,_window$roamAlphaAPI3;if(!input)return null;var candidates=[(_input$closest2=input.closest)===null||_input$closest2===void 0?void 0:_input$closest2.call(input,\"[data-uid]\"),(_input$closest3=input.closest)===null||_input$closest3===void 0?void 0:_input$closest3.call(input,\".roam-block\"),(_input$closest4=input.closest)===null||_input$closest4===void 0?void 0:_input$closest4.call(input,\".rm-block-main\"),(_input$closest5=input.closest)===null||_input$closest5===void 0?void 0:_input$closest5.call(input,\".roam-block-container\"),(_input$closest6=input.closest)===null||_input$closest6===void 0?void 0:_input$closest6.call(input,\".roam-block-container > .roam-block\")];for(var _i=0,_candidates=candidates;_i<_candidates.length;_i++){var _el$getAttribute,_el$dataset;var el=_candidates[_i];if(!el)continue;var dataUid=normalizeUid(((_el$getAttribute=el.getAttribute)===null||_el$getAttribute===void 0?void 0:_el$getAttribute.call(el,\"data-uid\"))||((_el$dataset=el.dataset)===null||_el$dataset===void 0?void 0:_el$dataset.uid));if(dataUid)return dataUid;var id=el.id||\"\";if(id.startsWith(\"block-input-\"))return normalizeUid(id.slice(\"block-input-\".length));if(id.startsWith(\"block-\"))return normalizeUid(id.slice(\"block-\".length));}var roamBlock=(_input$closest7=input.closest)===null||_input$closest7===void 0?void 0:_input$closest7.call(input,\".roam-block\");var path=normalizeUid(roamBlock===null||roamBlock===void 0||(_roamBlock$getAttribu=roamBlock.getAttribute)===null||_roamBlock$getAttribu===void 0?void 0:_roamBlock$getAttribu.call(roamBlock,\"data-path\"));if(path){return path;}var domUtil=(_window$roamAlphaAPI3=window.roamAlphaAPI)===null||_window$roamAlphaAPI3===void 0||(_window$roamAlphaAPI3=_window$roamAlphaAPI3.util)===null||_window$roamAlphaAPI3===void 0?void 0:_window$roamAlphaAPI3.dom;if(domUtil){try{if(typeof domUtil.elToUid===\"function\"){var uid=normalizeUid(domUtil.elToUid(input));if(uid)return uid;}if(typeof domUtil.blockUidFromTarget===\"function\"){var _uid=normalizeUid(domUtil.blockUidFromTarget(input));if(_uid)return _uid;}}catch(err){console.warn(\"[RecurringTasks] Failed to derive UID via dom util\",err);}}return null;}function findBlockUidFromElement(el){var _el$getAttribute2,_el$dataset2,_el$closest,_el$querySelector,_el$closest2,_el$closest3,_el$querySelector2,_window$roamAlphaAPI4;if(!el)return null;var direct=normalizeUid(((_el$getAttribute2=el.getAttribute)===null||_el$getAttribute2===void 0?void 0:_el$getAttribute2.call(el,\"data-uid\"))||((_el$dataset2=el.dataset)===null||_el$dataset2===void 0?void 0:_el$dataset2.uid));if(direct)return direct;var withData=(_el$closest=el.closest)===null||_el$closest===void 0?void 0:_el$closest.call(el,\"[data-uid]\");if(withData){var _withData$getAttribut,_withData$dataset;var cand=normalizeUid(((_withData$getAttribut=withData.getAttribute)===null||_withData$getAttribut===void 0?void 0:_withData$getAttribut.call(withData,\"data-uid\"))||((_withData$dataset=withData.dataset)===null||_withData$dataset===void 0?void 0:_withData$dataset.uid));if(cand)return cand;}var id=el.id||\"\";if(id.startsWith(\"block-input-\"))return normalizeUid(id.slice(\"block-input-\".length));if(id.startsWith(\"block-\"))return normalizeUid(id.slice(\"block-\".length));var blockInput=((_el$querySelector=el.querySelector)===null||_el$querySelector===void 0?void 0:_el$querySelector.call(el,\"[id^='block-input-']\"))||((_el$closest2=el.closest)===null||_el$closest2===void 0?void 0:_el$closest2.call(el,\"[id^='block-input-']\"));if(blockInput){var extracted=normalizeUid(blockInput.id.replace(/^block-input-/,\"\"));if(extracted)return extracted;}var roamBlock=((_el$closest3=el.closest)===null||_el$closest3===void 0?void 0:_el$closest3.call(el,\".roam-block\"))||((_el$querySelector2=el.querySelector)===null||_el$querySelector2===void 0?void 0:_el$querySelector2.call(el,\".roam-block\"));if(roamBlock){var _roamBlock$getAttribu2,_roamBlock$dataset;var _cand=normalizeUid(((_roamBlock$getAttribu2=roamBlock.getAttribute)===null||_roamBlock$getAttribu2===void 0?void 0:_roamBlock$getAttribu2.call(roamBlock,\"data-uid\"))||((_roamBlock$dataset=roamBlock.dataset)===null||_roamBlock$dataset===void 0?void 0:_roamBlock$dataset.uid));if(_cand)return _cand;}var domUtil=(_window$roamAlphaAPI4=window.roamAlphaAPI)===null||_window$roamAlphaAPI4===void 0||(_window$roamAlphaAPI4=_window$roamAlphaAPI4.util)===null||_window$roamAlphaAPI4===void 0?void 0:_window$roamAlphaAPI4.dom;if(domUtil){try{if(typeof domUtil.elToUid===\"function\"){var _cand2=normalizeUid(domUtil.elToUid(el));if(_cand2)return _cand2;}if(typeof domUtil.blockUidFromTarget===\"function\"){var _cand3=normalizeUid(domUtil.blockUidFromTarget(el));if(_cand3)return _cand3;}}catch(err){console.warn(\"[RecurringTasks] Failed to derive UID from element\",err);}}return null;}function findCheckboxInNode(node,selector){var _node$matches,_node$querySelector;if(!(node instanceof HTMLElement))return null;if((_node$matches=node.matches)!==null&&_node$matches!==void 0&&_node$matches.call(node,selector))return node;return((_node$querySelector=node.querySelector)===null||_node$querySelector===void 0?void 0:_node$querySelector.call(node,selector))||null;}function logCompletionDebug(event){var payload=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!DEBUG_COMPLETION_LOGS)return;try{console.log(\"[BT Completion] \".concat(event),payload);}catch(_){// ignore logging failures\n}}function markUserCheckboxInteraction(){lastUserCheckboxInteraction=Date.now();logCompletionDebug(\"user-checkbox-interaction\",{at:lastUserCheckboxInteraction});}function deriveUidFromMutationNode(node,fallbackTarget){var _node$matches2,_node$querySelector2;var checkboxInput=node instanceof HTMLElement?(_node$matches2=node.matches)!==null&&_node$matches2!==void 0&&_node$matches2.call(node,\"input[type='checkbox']\")&&node?node:(_node$querySelector2=node.querySelector)===null||_node$querySelector2===void 0?void 0:_node$querySelector2.call(node,\"input[type='checkbox']\"):null;if(checkboxInput){var uidFromCheckbox=findBlockUidFromCheckbox(checkboxInput);if(uidFromCheckbox)return uidFromCheckbox;}if(node instanceof HTMLElement){var uidFromNode=findBlockUidFromElement(node);if(uidFromNode)return uidFromNode;}if(fallbackTarget instanceof HTMLElement){var uidFromTarget=findBlockUidFromElement(fallbackTarget);if(uidFromTarget)return uidFromTarget;}return null;}function noteTodoRemoval(uid){if(!uid)return;var now=Date.now();var recentClick=now-lastUserCheckboxInteraction<=USER_COMPLETION_BYPASS_MS;if(now<pageLoadQuietUntil&&!recentClick){logCompletionDebug(\"skip-todo-removal-quiet\",{uid:uid,now:now,quietUntil:pageLoadQuietUntil,recentClick:recentClick,lastUserCheckboxInteraction:lastUserCheckboxInteraction});return;}var entry=completionPairs.get(uid)||{};completionPairs.set(uid,_objectSpread(_objectSpread({},entry),{},{removedAt:now}));logCompletionDebug(\"todo-removed\",{uid:uid,removedAt:now});}function noteDoneAddition(uid,checkbox){if(!uid)return;var now=Date.now();var recentClick=now-lastUserCheckboxInteraction<=USER_COMPLETION_BYPASS_MS;var entry=completionPairs.get(uid)||{};var pairedRemoval=entry.removedAt&&now-entry.removedAt<=COMPLETION_PAIR_WINDOW_MS;var userInitiated=recentClick;if(now<pageLoadQuietUntil&&!userInitiated){logCompletionDebug(\"skip-done-add-quiet\",{uid:uid,now:now,quietUntil:pageLoadQuietUntil,recentClick:recentClick,lastUserCheckboxInteraction:lastUserCheckboxInteraction});return;}if(entry.removedAt&&now-entry.removedAt<=COMPLETION_PAIR_WINDOW_MS){completionPairs[\"delete\"](uid);logCompletionDebug(\"done-added-paired\",{uid:uid,removedAt:entry.removedAt,addedAt:now});enqueueCompletion(uid,{checkbox:checkbox,userInitiated:userInitiated,detectedAt:now});return;}completionPairs.set(uid,_objectSpread(_objectSpread({},entry),{},{addedAt:now,userInitiated:userInitiated}));logCompletionDebug(\"done-added-no-pair\",{uid:uid,addedAt:now,userInitiated:userInitiated});}function enqueueCompletion(uid){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!uid)return;completionQueue.set(uid,options);if(!completionQueueTimer&&!completionQueueFlushInFlight){completionQueueTimer=setTimeout(flushCompletionQueue,0);}logCompletionDebug(\"enqueue-completion\",{uid:uid,queueSize:completionQueue.size});}function flushCompletionQueue(){return _flushCompletionQueue.apply(this,arguments);}function _flushCompletionQueue(){_flushCompletionQueue=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee39(){var entries,_i9,_entries,_entries$_i,uid,opts,_t47;return _regenerator().w(function(_context39){while(1)switch(_context39.p=_context39.n){case 0:completionQueueTimer=null;if(!completionQueueFlushInFlight){_context39.n=1;break;}return _context39.a(2);case 1:completionQueueFlushInFlight=true;_context39.p=2;logCompletionDebug(\"flush-queue-start\",{size:completionQueue.size});case 3:if(!(completionQueue.size>0)){_context39.n=10;break;}entries=Array.from(completionQueue.entries());completionQueue.clear();_i9=0,_entries=entries;case 4:if(!(_i9<_entries.length)){_context39.n=9;break;}_entries$_i=_slicedToArray(_entries[_i9],2),uid=_entries$_i[0],opts=_entries$_i[1];_context39.p=5;_context39.n=6;return processTaskCompletion(uid,opts);case 6:_context39.n=8;break;case 7:_context39.p=7;_t47=_context39.v;console.error(\"[RecurringTasks] completion handling failed\",_t47);logCompletionDebug(\"flush-queue-error\",{uid:uid,error:_t47===null||_t47===void 0?void 0:_t47.message});case 8:_i9++;_context39.n=4;break;case 9:_context39.n=3;break;case 10:_context39.p=10;completionQueueFlushInFlight=false;if(completionQueue.size>0&&!completionQueueTimer){completionQueueTimer=setTimeout(flushCompletionQueue,0);}logCompletionDebug(\"flush-queue-finish\");return _context39.f(10);case 11:return _context39.a(2);}},_callee39,null,[[5,7],[2,,10,11]]);}));return _flushCompletionQueue.apply(this,arguments);}function sweepCompletionPairs(){var now=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Date.now();var _iterator=_createForOfIteratorHelper(completionPairs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),uid=_step$value[0],entry=_step$value[1];var _ref0=entry||{},removedAt=_ref0.removedAt,addedAt=_ref0.addedAt;if(removedAt&&now-removedAt>COMPLETION_PAIR_WINDOW_MS||addedAt&&now-addedAt>COMPLETION_PAIR_WINDOW_MS){completionPairs[\"delete\"](uid);logCompletionDebug(\"pair-expired\",{uid:uid,removedAt:removedAt,addedAt:addedAt,now:now});}}}catch(err){_iterator.e(err);}finally{_iterator.f();}}function disconnectObserver(){if(!observer)return;try{observer.disconnect();}catch(_){// Ignore disconnect errors\n}observer=null;}function scheduleObserverRestart(){var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:200;if(observerReinitTimer)clearTimeout(observerReinitTimer);observerReinitTimer=setTimeout(function(){initiateObserver();},delay);}function handleHashChange(){disconnectObserver();lastNavigationAt=Date.now();pageLoadQuietUntil=lastNavigationAt+PAGE_COMPLETION_GRACE_MS;logCompletionDebug(\"hashchange\",{quietUntil:pageLoadQuietUntil,graceMs:PAGE_COMPLETION_GRACE_MS,navigationAt:lastNavigationAt});scheduleObserverRestart();}if(typeof window!==\"undefined\"){try{var _window$__RecurringTa,_window;(_window$__RecurringTa=(_window=window).__RecurringTasksCleanup)===null||_window$__RecurringTa===void 0||_window$__RecurringTa.call(_window);}catch(_){// ignore cleanup errors from previous runs\n}window.__RecurringTasksCleanup=function(){window.removeEventListener(\"hashchange\",handleHashChange);if(observerReinitTimer){clearTimeout(observerReinitTimer);observerReinitTimer=null;}if(pendingSurfaceSync){clearTimeout(pendingSurfaceSync);pendingSurfaceSync=null;}var _iterator2=_createForOfIteratorHelper(pendingPillTimers.values()),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var timer=_step2.value;clearTimeout(timer);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}pendingPillTimers.clear();// remove child->props listeners\ndocument.removeEventListener(\"input\",_handleAnyEdit,true);document.removeEventListener(\"blur\",_handleAnyEdit,true);document.removeEventListener(\"pointerdown\",_onCheckboxPointer,true);document.removeEventListener(\"change\",_onCheckboxChange,true);document.removeEventListener(\"keydown\",_onCmdEnterKey,true);detachPillEventDelegation();clearAllPills();disconnectObserver();};}function initiateObserver(){var _document3,_document4;disconnectObserver();// Targets: main + right sidebar\nif(typeof document===\"undefined\")return;var targetNode1=(_document3=document)!==null&&_document3!==void 0&&_document3.getElementsByClassName?document.getElementsByClassName(\"roam-main\")[0]:null;var targetNode2=(_document4=document)!==null&&_document4!==void 0&&_document4.getElementById?document.getElementById(\"right-sidebar\"):null;if(!targetNode1&&!targetNode2)return;lastNavigationAt=Date.now();pageLoadQuietUntil=lastNavigationAt+PAGE_COMPLETION_GRACE_MS;logCompletionDebug(\"observer-init\",{quietUntil:pageLoadQuietUntil,graceMs:PAGE_COMPLETION_GRACE_MS,navigationAt:lastNavigationAt});var obsConfig={attributes:true,attributeFilter:[\"class\",\"open\",\"aria-expanded\"],attributeOldValue:true,childList:true,subtree:true};var handleMutations=function handleMutations(mutationsList){var isBtPillMutationNode=function isBtPillMutationNode(node){var _node$classList,_node$closest;if(!(node instanceof HTMLElement))return false;if((_node$classList=node.classList)!==null&&_node$classList!==void 0&&_node$classList.contains(\"rt-pill-wrap\"))return true;return!!((_node$closest=node.closest)!==null&&_node$closest!==void 0&&_node$closest.call(node,\".rt-pill-wrap\"));};var shouldBatchRefreshPills=false;var _iterator3=_createForOfIteratorHelper(mutationsList),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var mutation=_step3.value;if(mutation.type===\"attributes\"){var _target$classList,_target$classList2,_target$classList3,_target$classList4;var _target=mutation.target;if(!(_target instanceof HTMLElement)){continue;}// Ignore attribute churn caused by Better Tasks pill DOM itself.\nif(isBtPillMutationNode(_target))continue;var attrName=mutation.attributeName;if(attrName===\"class\"&&(_target$classList=_target.classList)!==null&&_target$classList!==void 0&&_target$classList.contains(\"rm-checkbox\")){var wasTodo=(mutation.oldValue||\"\").includes(\"rm-todo\");var isDone=_target.classList.contains(\"rm-done\");if(wasTodo&&isDone){var uid=deriveUidFromMutationNode(_target,null);if(uid){var _target$querySelector;var checkbox=((_target$querySelector=_target.querySelector)===null||_target$querySelector===void 0?void 0:_target$querySelector.call(_target,\"input[type='checkbox']\"))||null;noteTodoRemoval(uid);enqueueCompletion(uid,{checkbox:checkbox,userInitiated:true,detectedAt:Date.now()});shouldBatchRefreshPills=true;continue;}}}// Avoid hover-driven churn: only refresh pills on expand/collapse-like attribute changes.\nif(attrName!==\"open\"&&attrName!==\"aria-expanded\"){continue;}var main=null;if((_target$classList2=_target.classList)!==null&&_target$classList2!==void 0&&_target$classList2.contains(\"rm-block-main\")){main=_target;}else if((_target$classList3=_target.classList)!==null&&_target$classList3!==void 0&&_target$classList3.contains(\"roam-block-container\")||(_target$classList4=_target.classList)!==null&&_target$classList4!==void 0&&_target$classList4.contains(\"roam-block\")){var _target$querySelector2;main=((_target$querySelector2=_target.querySelector)===null||_target$querySelector2===void 0?void 0:_target$querySelector2.call(_target,\":scope > .rm-block-main\"))||null;}else{var _target$closest;main=((_target$closest=_target.closest)===null||_target$closest===void 0?void 0:_target$closest.call(_target,\".rm-block-main\"))||null;}if(main){// Debounce UI-driven changes (expand/collapse) so rapid interactions don't thrash.\nschedulePillRefresh(main,null,240);}continue;}var target=mutation.target instanceof HTMLElement?mutation.target:null;// Ignore childList churn caused by Better Tasks pill DOM itself.\nif(target&&isBtPillMutationNode(target))continue;if(mutation.removedNodes&&mutation.removedNodes.length>0){var _iterator4=_createForOfIteratorHelper(mutation.removedNodes),_step4;try{var _loop=function _loop(){var _node$matches3,_node$querySelectorAl,_node$matches4,_node$querySelector3;var node=_step4.value;if(!(node instanceof HTMLElement))return 0;// continue\nif(isBtPillMutationNode(node))return 0;// continue\nvar todoHosts=[];if((_node$matches3=node.matches)!==null&&_node$matches3!==void 0&&_node$matches3.call(node,\".rm-checkbox.rm-todo\"))todoHosts.push(node);(_node$querySelectorAl=node.querySelectorAll)===null||_node$querySelectorAl===void 0||(_node$querySelectorAl=_node$querySelectorAl.call(node,\".rm-checkbox.rm-todo\"))===null||_node$querySelectorAl===void 0||_node$querySelectorAl.forEach(function(el){return todoHosts.push(el);});for(var _i2=0,_todoHosts=todoHosts;_i2<_todoHosts.length;_i2++){var host=_todoHosts[_i2];var _uid2=deriveUidFromMutationNode(host,target);if(_uid2){noteTodoRemoval(_uid2);shouldBatchRefreshPills=true;}}// New blocks/checkboxes disappearing can invalidate pills.\nif((_node$matches4=node.matches)!==null&&_node$matches4!==void 0&&_node$matches4.call(node,\".rm-block-main, .roam-block-container, .roam-block, .rm-checkbox\")||(_node$querySelector3=node.querySelector)!==null&&_node$querySelector3!==void 0&&_node$querySelector3.call(node,\".rm-block-main, .roam-block-container, .roam-block, .rm-checkbox\")){shouldBatchRefreshPills=true;}},_ret;for(_iterator4.s();!(_step4=_iterator4.n()).done;){_ret=_loop();if(_ret===0)continue;}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}if(!mutation.addedNodes||mutation.addedNodes.length===0)continue;var _iterator5=_createForOfIteratorHelper(mutation.addedNodes),_step5;try{var _loop2=function _loop2(){var _node$matches5,_node$querySelectorAl2,_node$matches6,_node$querySelector4;var node=_step5.value;if(!(node instanceof HTMLElement))return 0;// continue\nif(isBtPillMutationNode(node))return 0;// continue\nvar doneHosts=[];if((_node$matches5=node.matches)!==null&&_node$matches5!==void 0&&_node$matches5.call(node,\".rm-checkbox.rm-done\"))doneHosts.push(node);(_node$querySelectorAl2=node.querySelectorAll)===null||_node$querySelectorAl2===void 0||(_node$querySelectorAl2=_node$querySelectorAl2.call(node,\".rm-checkbox.rm-done\"))===null||_node$querySelectorAl2===void 0||_node$querySelectorAl2.forEach(function(el){return doneHosts.push(el);});for(var _i3=0,_doneHosts=doneHosts;_i3<_doneHosts.length;_i3++){var _host$querySelector4;var host=_doneHosts[_i3];var _checkbox=((_host$querySelector4=host.querySelector)===null||_host$querySelector4===void 0?void 0:_host$querySelector4.call(host,\"input[type='checkbox']\"))||null;var _uid3=deriveUidFromMutationNode(host,target);if(_uid3){noteDoneAddition(_uid3,_checkbox);shouldBatchRefreshPills=true;}}// New blocks/checkboxes appearing are the main case for pill decoration (scroll/render).\nif((_node$matches6=node.matches)!==null&&_node$matches6!==void 0&&_node$matches6.call(node,\".rm-block-main, .roam-block-container, .roam-block, .rm-checkbox\")||(_node$querySelector4=node.querySelector)!==null&&_node$querySelector4!==void 0&&_node$querySelector4.call(node,\".rm-block-main, .roam-block-container, .roam-block, .rm-checkbox\")){shouldBatchRefreshPills=true;}},_ret2;for(_iterator5.s();!(_step5=_iterator5.n()).done;){_ret2=_loop2();if(_ret2===0)continue;}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}}// Batch refresh pills once per mutation batch instead of per node to reduce churn.\n}catch(err){_iterator3.e(err);}finally{_iterator3.f();}if(shouldBatchRefreshPills)schedulePillRefreshAll(120);sweepCompletionPairs();sweepProcessed();};var mutationQueue=[];var mutationScheduled=false;var flushMutationQueue=function flushMutationQueue(){if(!mutationQueue.length){mutationScheduled=false;return;}var batch=mutationQueue;mutationQueue=[];mutationScheduled=false;handleMutations(batch);};observer=new MutationObserver(function(mutationsList){var _mutationQueue;if(!mutationsList||!mutationsList.length)return;(_mutationQueue=mutationQueue).push.apply(_mutationQueue,_toConsumableArray(mutationsList));if(mutationScheduled)return;mutationScheduled=true;setTimeout(flushMutationQueue,0);});if(targetNode1)observer.observe(targetNode1,obsConfig);if(targetNode2)observer.observe(targetNode2,obsConfig);var surface=lastAttrSurface||enforceChildAttrSurface(extensionAPI);lastAttrSurface=surface;void syncPillsForSurface(surface);}function processTaskCompletion(_x13){return _processTaskCompletion.apply(this,arguments);}function _processTaskCompletion(){_processTaskCompletion=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee40(uid){var options,now,checkbox,userClickRecent,userInitiated,detectedAt,_activeDashboardContr59,_activeDashboardContr60,_nextDue$toISOString,_set,block,refreshed,meta,hasTimingOnly,detectionTs,recentNavigation,staleProcessed,completedEntry,isOneOff,_snapshot,_activeDashboardContr57,_activeDashboardContr58,_completion,anchor,confirmed,snapshot,overrideEntry,overrideRepeat,overrideDue,advanceMode,setWithAdvance,completion,_yield$resolveMetaAft,resolvedMeta,resolvedBlock,overrideRule,nextDueCandidate,nextDue,startOffsetMs,deferOffsetMs,nextStartDate,nextDeferDate,parentForSpawn,newUid,_activeDashboardContr61,_activeDashboardContr62,_args40=arguments,_t48,_t49,_t50,_t51;return _regenerator().w(function(_context40){while(1)switch(_context40.p=_context40.n){case 0:options=_args40.length>1&&_args40[1]!==undefined?_args40[1]:{};if(uid){_context40.n=1;break;}return _context40.a(2,null);case 1:if(!processedMap.has(uid)){_context40.n=2;break;}logCompletionDebug(\"skip-completion-duplicate\",{uid:uid});return _context40.a(2,null);case 2:logCompletionDebug(\"process-completion-start\",{uid:uid,fromQueue:!!(options!==null&&options!==void 0&&options.checkbox)||false,now:Date.now()});now=Date.now();processedMap.set(uid,now);checkbox=options.checkbox||null;userClickRecent=now-lastUserCheckboxInteraction<=USER_COMPLETION_BYPASS_MS;userInitiated=!!options.userInitiated&&userClickRecent;detectedAt=typeof options.detectedAt===\"number\"?options.detectedAt:null;_context40.p=3;_set=S();_context40.n=4;return flushChildAttrSync(uid);case 4:_context40.n=5;return delay(60);case 5:_context40.n=6;return getBlock(uid);case 6:block=_context40.v;_context40.n=7;return delay(60);case 7:_context40.n=8;return getBlock(uid);case 8:refreshed=_context40.v;if(refreshed)block=refreshed;if(block){_context40.n=9;break;}processedMap[\"delete\"](uid);return _context40.a(2,null);case 9:if(isBlockCompleted(block)){_context40.n=10;break;}processedMap[\"delete\"](uid);return _context40.a(2,null);case 10:_context40.n=11;return readRecurringMeta(block,_set);case 11:meta=_context40.v;hasTimingOnly=!!(meta!==null&&meta!==void 0&&meta.hasTimingAttrs);if(!(!meta.repeat&&!hasTimingOnly)){_context40.n=12;break;}processedMap[\"delete\"](uid);return _context40.a(2,null);case 12:detectionTs=detectedAt||now;recentNavigation=!!lastNavigationAt&&detectionTs-lastNavigationAt<=NAV_COMPLETION_BLOCK_MS;if(!(!userInitiated&&recentNavigation)){_context40.n=13;break;}processedMap[\"delete\"](uid);logCompletionDebug(\"skip-completion-nav\",{uid:uid,detectedAt:detectionTs,lastNavigationAt:lastNavigationAt,windowMs:NAV_COMPLETION_BLOCK_MS});return _context40.a(2,null);case 13:if(!(!userInitiated&&meta.processedTs)){_context40.n=14;break;}processedMap[\"delete\"](uid);logCompletionDebug(\"skip-completion-meta-processed\",{uid:uid,metaProcessed:meta.processedTs,now:now});return _context40.a(2,null);case 14:if(!(meta.processedTs&&now-meta.processedTs<4000)){_context40.n=15;break;}processedMap[\"delete\"](uid);logCompletionDebug(\"skip-completion-recent-meta\",{uid:uid,metaProcessed:meta.processedTs,now:now});return _context40.a(2,null);case 15:if(userInitiated){_context40.n=16;break;}staleProcessed=meta.processedTs&&now-meta.processedTs>COMPLETION_STALE_WINDOW_MS;// Allow keyboard completions (cmd/ctrl+Enter) which won't mark userInitiated,\n// but still block re-processing when a completed child attr already exists.\ncompletedEntry=pickChildAttr(meta.childAttrMap,_set.attrNames.completedAliases,{allowFallback:true});if(!(completedEntry||staleProcessed)){_context40.n=16;break;}processedMap[\"delete\"](uid);logCompletionDebug(\"skip-completion-stale\",{uid:uid,processedTs:meta.processedTs||null,completedValue:(completedEntry===null||completedEntry===void 0?void 0:completedEntry.value)||null,staleProcessed:staleProcessed,detectedAt:detectedAt,now:now});return _context40.a(2,null);case 16:isOneOff=!meta.repeat&&hasTimingOnly;if(!isOneOff){_context40.n=21;break;}_snapshot=captureBlockSnapshot(block);_context40.p=17;_context40.n=18;return markCompleted(block,meta,_set);case 18:_completion=_context40.v;processedMap.set(uid,_completion.processedAt);anchor=pickPlacementDate({start:meta.start,defer:meta.defer,due:meta.due})||meta.due||null;registerUndoAction({blockUid:uid,snapshot:_snapshot,completion:_completion,newBlockUid:null,nextDue:meta.due||null,nextAnchor:anchor,set:_set,overrideEntry:null,toastMessage:\"Task completion recorded\"});repeatOverrides[\"delete\"](uid);void syncPillsForSurface(lastAttrSurface);(_activeDashboardContr57=activeDashboardController)===null||_activeDashboardContr57===void 0||(_activeDashboardContr58=_activeDashboardContr57.notifyBlockChange)===null||_activeDashboardContr58===void 0||_activeDashboardContr58.call(_activeDashboardContr57,uid);logCompletionDebug(\"completion-one-off\",{uid:uid,processedAt:_completion.processedAt});return _context40.a(2,{type:\"one-off\"});case 19:_context40.p=19;_t48=_context40.v;console.error(\"[RecurringTasks] one-off completion failed\",_t48);_context40.n=20;return revertBlockCompletion(block);case 20:processedMap[\"delete\"](uid);logCompletionDebug(\"completion-one-off-error\",{uid:uid,error:_t48===null||_t48===void 0?void 0:_t48.message});return _context40.a(2,null);case 21:if(!(_set.confirmBeforeSpawn&&!options.skipConfirmation)){_context40.n=23;break;}_context40.n=22;return requestSpawnConfirmation(meta,_set);case 22:confirmed=_context40.v;if(confirmed){_context40.n=23;break;}processedMap[\"delete\"](uid);logCompletionDebug(\"skip-completion-user-cancel\",{uid:uid});return _context40.a(2,null);case 23:snapshot=captureBlockSnapshot(block);overrideEntry=normalizeOverrideEntry(repeatOverrides.get(uid));overrideRepeat=(overrideEntry===null||overrideEntry===void 0?void 0:overrideEntry.repeat)||null;overrideDue=(overrideEntry===null||overrideEntry===void 0?void 0:overrideEntry.due)||null;if(overrideRepeat){meta.repeat=overrideRepeat;meta.props=_objectSpread(_objectSpread({},meta.props||{}),{},{repeat:overrideRepeat});}if(overrideDue){meta.due=overrideDue;meta.props=_objectSpread(_objectSpread({},meta.props||{}),{},{due:formatDate(overrideDue,_set)});}_context40.n=24;return ensureAdvancePreference(uid,block,meta,_set,checkbox);case 24:advanceMode=_context40.v;if(advanceMode){_context40.n=25;break;}processedMap[\"delete\"](uid);return _context40.a(2,null);case 25:meta.advanceFrom=advanceMode;setWithAdvance=_objectSpread(_objectSpread({},_set),{},{advanceFrom:advanceMode});_context40.n=26;return markCompleted(block,meta,setWithAdvance);case 26:completion=_context40.v;processedMap.set(uid,completion.processedAt);logCompletionDebug(\"completion-recurring-marked\",{uid:uid,processedAt:completion.processedAt});_context40.n=27;return resolveMetaAfterCompletion(snapshot,uid,meta,setWithAdvance);case 27:_yield$resolveMetaAft=_context40.v;resolvedMeta=_yield$resolveMetaAft.meta;resolvedBlock=_yield$resolveMetaAft.block;if(overrideRepeat){resolvedMeta.repeat=overrideRepeat;resolvedMeta.props=_objectSpread(_objectSpread({},resolvedMeta.props||{}),{},{repeat:overrideRepeat});}if(overrideDue){resolvedMeta.due=overrideDue;resolvedMeta.props=_objectSpread(_objectSpread({},resolvedMeta.props||{}),{},{due:formatDate(overrideDue,_set)});}overrideRule=overrideRepeat?parseRuleText(overrideRepeat,setWithAdvance):null;nextDueCandidate=overrideDue&&overrideDue instanceof Date&&!Number.isNaN(overrideDue.getTime())?overrideDue:null;nextDue=nextDueCandidate||computeNextDue(resolvedMeta,setWithAdvance,0,overrideRule);if(nextDue){_context40.n=28;break;}processedMap[\"delete\"](uid);return _context40.a(2,null);case 28:startOffsetMs=resolvedMeta.start instanceof Date&&resolvedMeta.due instanceof Date?resolvedMeta.start.getTime()-resolvedMeta.due.getTime():null;deferOffsetMs=resolvedMeta.defer instanceof Date&&resolvedMeta.due instanceof Date?resolvedMeta.defer.getTime()-resolvedMeta.due.getTime():null;nextStartDate=startOffsetMs!=null?applyOffsetToDate(nextDue,startOffsetMs):null;nextDeferDate=deferOffsetMs!=null?applyOffsetToDate(nextDue,deferOffsetMs):null;_t50=resolvedBlock;if(_t50){_context40.n=30;break;}_context40.n=29;return getBlock(uid);case 29:_t50=_context40.v;case 30:_t49=_t50;if(_t49){_context40.n=31;break;}_t49=block;case 31:parentForSpawn=_t49;_context40.n=32;return spawnNextOccurrence(parentForSpawn,resolvedMeta,nextDue,setWithAdvance);case 32:newUid=_context40.v;registerUndoAction({blockUid:uid,snapshot:snapshot,completion:completion,newBlockUid:newUid,nextDue:nextDue,nextAnchor:pickPlacementDate({start:nextStartDate,defer:nextDeferDate,due:nextDue})||nextDue,set:setWithAdvance,overrideEntry:overrideEntry?_objectSpread(_objectSpread({},overrideEntry.repeat?{repeat:overrideEntry.repeat}:{}),overrideEntry.due?{due:new Date(overrideEntry.due.getTime())}:{}):null});repeatOverrides[\"delete\"](uid);void syncPillsForSurface(lastAttrSurface);(_activeDashboardContr59=activeDashboardController)===null||_activeDashboardContr59===void 0||(_activeDashboardContr60=_activeDashboardContr59.notifyBlockChange)===null||_activeDashboardContr60===void 0||_activeDashboardContr60.call(_activeDashboardContr59,uid);if(newUid){(_activeDashboardContr61=activeDashboardController)===null||_activeDashboardContr61===void 0||(_activeDashboardContr62=_activeDashboardContr61.notifyBlockChange)===null||_activeDashboardContr62===void 0||_activeDashboardContr62.call(_activeDashboardContr61,newUid);}logCompletionDebug(\"completion-recurring-spawned\",{uid:uid,nextUid:newUid,nextDue:nextDue===null||nextDue===void 0||(_nextDue$toISOString=nextDue.toISOString)===null||_nextDue$toISOString===void 0?void 0:_nextDue$toISOString.call(nextDue)});return _context40.a(2,{type:\"recurring\",nextUid:newUid});case 33:_context40.p=33;_t51=_context40.v;console.error(\"[RecurringTasks] error:\",_t51);processedMap[\"delete\"](uid);logCompletionDebug(\"completion-error\",{uid:uid,error:_t51===null||_t51===void 0?void 0:_t51.message});return _context40.a(2,null);}},_callee40,null,[[17,19],[3,33]]);}));return _processTaskCompletion.apply(this,arguments);}var BLOCK_CACHE_TTL_MS=800;var BLOCK_CACHE_MAX=5000;var blockCache=new Map();function ensureBlockCache(){if(!blockCache||typeof blockCache.get!==\"function\"||typeof blockCache.set!==\"function\"){blockCache=new Map();}return blockCache;}function invalidateBlockCache(uid){if(!uid)return;ensureBlockCache()[\"delete\"](uid);}function pruneBlockCache(now){var cache=ensureBlockCache();if(blockCache.size<=BLOCK_CACHE_MAX)return;var entries=Array.from(cache.entries());entries.sort(function(a,b){var _a$,_b$;return(((_a$=a[1])===null||_a$===void 0?void 0:_a$.at)||0)-(((_b$=b[1])===null||_b$===void 0?void 0:_b$.at)||0);});var overflow=entries.length-BLOCK_CACHE_MAX;for(var i=0;i<overflow;i++){cache[\"delete\"](entries[i][0]);}}function getBlock(_x14){return _getBlock.apply(this,arguments);}function _getBlock(){_getBlock=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee41(uid){var _res$;var now,cache,cached,safeUid,res,block;return _regenerator().w(function(_context41){while(1)switch(_context41.n){case 0:if(uid){_context41.n=1;break;}return _context41.a(2,null);case 1:now=Date.now();cache=ensureBlockCache();cached=cache.get(uid);if(!(cached&&now-cached.at<BLOCK_CACHE_TTL_MS)){_context41.n=2;break;}return _context41.a(2,cached.block||null);case 2:if(cached)cache[\"delete\"](uid);safeUid=escapeDatalogString(uid);_context41.n=3;return window.roamAlphaAPI.q(\"\\n        [:find\\n          (pull ?b [:block/uid :block/string :block/props :block/order :block/open\\n                    {:block/children [:block/uid :block/string]}\\n                    {:block/page [:block/uid :node/title]}\\n                    {:block/parents [:block/uid]}])\\n         :where [?b :block/uid \\\"\".concat(safeUid,\"\\\"]]\"));case 3:res=_context41.v;block=(res===null||res===void 0||(_res$=res[0])===null||_res$===void 0?void 0:_res$[0])||null;if(block){cache.set(uid,{block:block,at:now});pruneBlockCache(now);}return _context41.a(2,block);}},_callee41);}));return _getBlock.apply(this,arguments);}function clonePlain(value){if(value==null||_typeof(value)!==\"object\")return value;if(value instanceof Date)return new Date(value.getTime());if(Array.isArray(value))return value.map(function(item){return clonePlain(item);});var out={};for(var _i4=0,_Object$keys=Object.keys(value);_i4<_Object$keys.length;_i4++){var key=_Object$keys[_i4];out[key]=clonePlain(value[key]);}return out;}function captureBlockSnapshot(block){var props=parseProps(block===null||block===void 0?void 0:block.props);return{string:(block===null||block===void 0?void 0:block.string)||\"\",props:props&&_typeof(props)===\"object\"?clonePlain(props):{},childAttrs:parseAttrsFromChildBlocks((block===null||block===void 0?void 0:block.children)||[])};}function syncActiveTextarea(uid,string){var _active$closest;var active=typeof document!==\"undefined\"?document.activeElement:null;if(!active||typeof string!==\"string\")return false;var host=(_active$closest=active.closest)===null||_active$closest===void 0?void 0:_active$closest.call(active,\".rm-block-main\");if(!host)return false;var hostUid=host.getAttribute(\"data-uid\");if(hostUid!==uid)return false;if(typeof active.value===\"string\"&&active.value!==string){active.value=string;active.dispatchEvent(new Event(\"input\",{bubbles:true}));}return true;}function updateBlockString(_x15,_x16){return _updateBlockString.apply(this,arguments);}function _updateBlockString(){_updateBlockString=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee42(uid,string){var result,synced,_blockMain$querySelec,_blockMain$querySelec2,blockMain,textarea;return _regenerator().w(function(_context42){while(1)switch(_context42.n){case 0:if(!(PARENT_WRITE_DELAY_MS>0)){_context42.n=1;break;}_context42.n=1;return delay(PARENT_WRITE_DELAY_MS);case 1:_context42.n=2;return window.roamAlphaAPI.updateBlock({block:{uid:uid,string:string}});case 2:result=_context42.v;try{if(typeof string===\"string\"){synced=syncActiveTextarea(uid,string);if(!synced){blockMain=document.querySelector(\".rm-block-main[data-uid=\\\"\".concat(uid,\"\\\"]\"));textarea=(blockMain===null||blockMain===void 0||(_blockMain$querySelec=blockMain.querySelector)===null||_blockMain$querySelec===void 0?void 0:_blockMain$querySelec.call(blockMain,\"textarea.rm-block-input\"))||(blockMain===null||blockMain===void 0||(_blockMain$querySelec2=blockMain.querySelector)===null||_blockMain$querySelec2===void 0?void 0:_blockMain$querySelec2.call(blockMain,\"textarea.rm-block__input\"))||document.querySelector(\"textarea.rm-block-input[data-roamjs-block-uid=\\\"\".concat(uid,\"\\\"]\"));if(textarea&&textarea.value!==string){textarea.value=string;textarea.dispatchEvent(new Event(\"input\",{bubbles:true}));}}}}catch(_){}invalidateBlockCache(uid);return _context42.a(2,result);}},_callee42);}));return _updateBlockString.apply(this,arguments);}function updateBlockProps(_x17,_x18){return _updateBlockProps.apply(this,arguments);}function _updateBlockProps(){_updateBlockProps=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee43(uid,merge){var _current$;var attrSnapshot,enrichedMerge,safeUid,current,props,next,_i0,_Object$keys2,key,result;return _regenerator().w(function(_context43){while(1)switch(_context43.n){case 0:attrSnapshot=lastAttrNames||resolveAttributeNames();enrichedMerge=_objectSpread({},merge||{});if(attrSnapshot){enrichedMerge.rt=_objectSpread(_objectSpread({},enrichedMerge.rt||{}),{},{attrRepeat:attrSnapshot.repeatAttr,attrDue:attrSnapshot.dueAttr,attrRepeatLabel:attrSnapshot.repeatAttr,attrDueLabel:attrSnapshot.dueAttr,attrStart:attrSnapshot.startAttr,attrStartLabel:attrSnapshot.startAttr,attrDefer:attrSnapshot.deferAttr,attrDeferLabel:attrSnapshot.deferAttr,attrCompleted:attrSnapshot.completedAttr,attrCompletedLabel:attrSnapshot.completedAttr});}safeUid=escapeDatalogString(uid);_context43.n=1;return window.roamAlphaAPI.q(\"[:find ?p :where [?b :block/uid \\\"\".concat(safeUid,\"\\\"] [?b :block/props ?p]]\"));case 1:current=_context43.v;props=parseProps(current===null||current===void 0||(_current$=current[0])===null||_current$===void 0?void 0:_current$[0]);next=_objectSpread(_objectSpread({},props),enrichedMerge);if(props.rt&&enrichedMerge!==null&&enrichedMerge!==void 0&&enrichedMerge.rt){next.rt=_objectSpread(_objectSpread({},props.rt),enrichedMerge.rt);}for(_i0=0,_Object$keys2=Object.keys(next);_i0<_Object$keys2.length;_i0++){key=_Object$keys2[_i0];if(next[key]===undefined)delete next[key];}_context43.n=2;return window.roamAlphaAPI.updateBlock({block:{uid:uid,props:next}});case 2:result=_context43.v;invalidateBlockCache(uid);return _context43.a(2,result);}},_callee43);}));return _updateBlockProps.apply(this,arguments);}function setBlockProps(_x19,_x20){return _setBlockProps.apply(this,arguments);}function _setBlockProps(){_setBlockProps=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee44(uid,propsObject){var nextProps,result;return _regenerator().w(function(_context44){while(1)switch(_context44.n){case 0:nextProps=propsObject&&_typeof(propsObject)===\"object\"?_objectSpread({},propsObject):{};if(nextProps.repeat!==undefined)delete nextProps.repeat;if(nextProps.due!==undefined)delete nextProps.due;if(nextProps.start!==undefined)delete nextProps.start;if(nextProps.defer!==undefined)delete nextProps.defer;_context44.n=1;return window.roamAlphaAPI.updateBlock({block:{uid:uid,props:nextProps}});case 1:result=_context44.v;invalidateBlockCache(uid);return _context44.a(2,result);}},_callee44);}));return _setBlockProps.apply(this,arguments);}function delay(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});}function delayWithSignal(ms,signal){if(!signal)return delay(ms);return new Promise(function(resolve,reject){if(signal.aborted){var err=new Error(\"Aborted\");err.name=\"AbortError\";reject(err);return;}var timer=setTimeout(function(){signal.removeEventListener(\"abort\",_onAbort);resolve();},ms);var _onAbort=function onAbort(){clearTimeout(timer);signal.removeEventListener(\"abort\",_onAbort);var err=new Error(\"Aborted\");err.name=\"AbortError\";reject(err);};signal.addEventListener(\"abort\",_onAbort,{once:true});});}function deleteBlock(_x21){return _deleteBlock.apply(this,arguments);}function _deleteBlock(){_deleteBlock=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee45(uid){var result;return _regenerator().w(function(_context45){while(1)switch(_context45.n){case 0:_context45.n=1;return window.roamAlphaAPI.deleteBlock({block:{\"uid\":uid.toString()}});case 1:result=_context45.v;invalidateBlockCache(uid);return _context45.a(2,result);}},_callee45);}));return _deleteBlock.apply(this,arguments);}function createBlock(_x22,_x23,_x24,_x25){return _createBlock.apply(this,arguments);}function _createBlock(){_createBlock=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee46(parentUid,order,string,uid){var result;return _regenerator().w(function(_context46){while(1)switch(_context46.n){case 0:_context46.n=1;return window.roamAlphaAPI.createBlock({location:{\"parent-uid\":parentUid,order:order},block:uid?{uid:uid,string:string}:{string:string}});case 1:result=_context46.v;invalidateBlockCache(parentUid);if(uid)invalidateBlockCache(uid);return _context46.a(2,result);}},_callee46);}));return _createBlock.apply(this,arguments);}function escapeDatalogString(value){return String(value!==null&&value!==void 0?value:\"\").replace(/\\\\/g,\"\\\\\\\\\").replace(/\"/g,'\\\\\"');}function getPageUidByTitle(_x26){return _getPageUidByTitle.apply(this,arguments);}function _getPageUidByTitle(){_getPageUidByTitle=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee47(title){var _found$,safeTitle,found,_t52;return _regenerator().w(function(_context47){while(1)switch(_context47.p=_context47.n){case 0:if(title){_context47.n=1;break;}return _context47.a(2,null);case 1:_context47.p=1;safeTitle=escapeDatalogString(title);_context47.n=2;return window.roamAlphaAPI.q(\"[:find ?u :where [?p :node/title \\\"\".concat(safeTitle,\"\\\"] [?p :block/uid ?u]]\"));case 2:found=_context47.v;return _context47.a(2,(found===null||found===void 0||(_found$=found[0])===null||_found$===void 0?void 0:_found$[0])||null);case 3:_context47.p=3;_t52=_context47.v;debugLog(\"getPageUidByTitle failed\",_t52);return _context47.a(2,null);}},_callee47,null,[[1,3]]);}));return _getPageUidByTitle.apply(this,arguments);}var pendingPageUidByTitle=new Map();function ensurePageUid(_x27){return _ensurePageUid.apply(this,arguments);}function _ensurePageUid(){_ensurePageUid=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee49(title){var existing,promise;return _regenerator().w(function(_context49){while(1)switch(_context49.p=_context49.n){case 0:if(title){_context49.n=1;break;}return _context49.a(2,null);case 1:_context49.n=2;return getPageUidByTitle(title);case 2:existing=_context49.v;if(!existing){_context49.n=3;break;}return _context49.a(2,existing);case 3:if(!pendingPageUidByTitle.has(title)){_context49.n=4;break;}return _context49.a(2,pendingPageUidByTitle.get(title));case 4:promise=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee48(){var uid,msg,i,retry,_t53;return _regenerator().w(function(_context48){while(1)switch(_context48.p=_context48.n){case 0:uid=window.roamAlphaAPI.util.generateUID();_context48.p=1;_context48.n=2;return window.roamAlphaAPI.createPage({page:{title:title,uid:uid}});case 2:_context48.n=4;break;case 3:_context48.p=3;_t53=_context48.v;msg=String((_t53===null||_t53===void 0?void 0:_t53.message)||\"\");if(!/already exists/i.test(msg)){console.warn(\"[BetterTasks] createPage failed\",{title:title,uid:uid,err:_t53});}case 4:i=0;case 5:if(!(i<8)){_context48.n=9;break;}_context48.n=6;return getPageUidByTitle(title);case 6:retry=_context48.v;if(!retry){_context48.n=7;break;}return _context48.a(2,retry);case 7:_context48.n=8;return delay(40*(i+1));case 8:i++;_context48.n=5;break;case 9:_context48.n=10;return getPageUidByTitle(title);case 10:return _context48.a(2,_context48.v);}},_callee48,null,[[1,3]]);}))();pendingPageUidByTitle.set(title,promise);_context49.p=5;_context49.n=6;return promise;case 6:return _context49.a(2,_context49.v);case 7:_context49.p=7;pendingPageUidByTitle[\"delete\"](title);return _context49.f(7);case 8:return _context49.a(2);}},_callee49,null,[[5,,7,8]]);}));return _ensurePageUid.apply(this,arguments);}function getOrCreatePageUid(_x28){return _getOrCreatePageUid.apply(this,arguments);}function _getOrCreatePageUid(){_getOrCreatePageUid=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee50(title){return _regenerator().w(function(_context50){while(1)switch(_context50.n){case 0:return _context50.a(2,ensurePageUid(title));}},_callee50);}));return _getOrCreatePageUid.apply(this,arguments);}function getOrCreateChildUnderHeading(_x29,_x30){return _getOrCreateChildUnderHeading.apply(this,arguments);}// ========================= Metadata =========================\nfunction _getOrCreateChildUnderHeading(){_getOrCreateChildUnderHeading=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee51(parentUid,headingText){var safeParentUid,children,hit,uid;return _regenerator().w(function(_context51){while(1)switch(_context51.n){case 0:safeParentUid=escapeDatalogString(parentUid);_context51.n=1;return window.roamAlphaAPI.q(\"\\n        [:find (pull ?c [:block/uid :block/string])\\n         :where [?p :block/uid \\\"\".concat(safeParentUid,\"\\\"] [?c :block/parents ?p]]\"));case 1:children=_context51.v;hit=children===null||children===void 0?void 0:children.map(function(r){return r[0];}).find(function(c){return(c.string||\"\").trim()===headingText.trim();});if(!hit){_context51.n=2;break;}return _context51.a(2,hit.uid);case 2:uid=window.roamAlphaAPI.util.generateUID();_context51.n=3;return createBlock(parentUid,0,headingText,uid);case 3:return _context51.a(2,uid);}},_callee51);}));return _getOrCreateChildUnderHeading.apply(this,arguments);}var ATTR_RE=/^((?:[\\t-\\r \\x2D\\/-9A-Z_a-z\\xA0\\xAA\\xB2\\xB3\\xB5\\xB9\\xBA\\xBC-\\xBE\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0560-\\u0588\\u05D0-\\u05EA\\u05EF-\\u05F2\\u0620-\\u064A\\u0660-\\u0669\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07C0-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u0870-\\u0887\\u0889-\\u088F\\u08A0-\\u08C9\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0966-\\u096F\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09E6-\\u09F1\\u09F4-\\u09F9\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A6F\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AE6-\\u0AEF\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B66-\\u0B6F\\u0B71-\\u0B77\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0BE6-\\u0BF2\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C5C\\u0C5D\\u0C60\\u0C61\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDC-\\u0CDE\\u0CE0\\u0CE1\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D04-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D58-\\u0D61\\u0D66-\\u0D78\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DE6-\\u0DEF\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E86-\\u0E8A\\u0E8C-\\u0EA3\\u0EA5\\u0EA7-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F20-\\u0F33\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F-\\u1049\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u1090-\\u1099\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1369-\\u137C\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u1711\\u171F-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1820-\\u1878\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19DA\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4C\\u1B50-\\u1B59\\u1B83-\\u1BA0\\u1BAE-\\u1BE5\\u1C00-\\u1C23\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1C80-\\u1C8A\\u1C90-\\u1CBA\\u1CBD-\\u1CBF\\u1CE9-\\u1CEC\\u1CEE-\\u1CF3\\u1CF5\\u1CF6\\u1CFA\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u2070\\u2071\\u2074-\\u2079\\u207F-\\u2089\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2150-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2C00-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2CFD\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3000\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312F\\u3131-\\u318E\\u3192-\\u3195\\u31A0-\\u31BF\\u31F0-\\u31FF\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\u3400-\\u4DBF\\u4E00-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7DC\\uA7F1-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA830-\\uA835\\uA840-\\uA873\\uA882-\\uA8B3\\uA8D0-\\uA8D9\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA8FE\\uA900-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF-\\uA9D9\\uA9E0-\\uA9E4\\uA9E6-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB69\\uAB70-\\uABE2\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFEFF\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD07-\\uDD33\\uDD40-\\uDD78\\uDD8A\\uDD8B\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDEE1-\\uDEFB\\uDF00-\\uDF23\\uDF2D-\\uDF4A\\uDF50-\\uDF75\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCA0-\\uDCA9\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDD70-\\uDD7A\\uDD7C-\\uDD8A\\uDD8C-\\uDD92\\uDD94\\uDD95\\uDD97-\\uDDA1\\uDDA3-\\uDDB1\\uDDB3-\\uDDB9\\uDDBB\\uDDBC\\uDDC0-\\uDDF3\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67\\uDF80-\\uDF85\\uDF87-\\uDFB0\\uDFB2-\\uDFBA]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC58-\\uDC76\\uDC79-\\uDC9E\\uDCA7-\\uDCAF\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDCFB-\\uDD1B\\uDD20-\\uDD39\\uDD40-\\uDD59\\uDD80-\\uDDB7\\uDDBC-\\uDDCF\\uDDD2-\\uDE00\\uDE10-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE35\\uDE40-\\uDE48\\uDE60-\\uDE7E\\uDE80-\\uDE9F\\uDEC0-\\uDEC7\\uDEC9-\\uDEE4\\uDEEB-\\uDEEF\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF58-\\uDF72\\uDF78-\\uDF91\\uDFA9-\\uDFAF]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2\\uDCFA-\\uDD23\\uDD30-\\uDD39\\uDD40-\\uDD65\\uDD6F-\\uDD85\\uDE60-\\uDE7E\\uDE80-\\uDEA9\\uDEB0\\uDEB1\\uDEC2-\\uDEC7\\uDF00-\\uDF27\\uDF30-\\uDF45\\uDF51-\\uDF54\\uDF70-\\uDF81\\uDFB0-\\uDFCB\\uDFE0-\\uDFF6]|\\uD804[\\uDC03-\\uDC37\\uDC52-\\uDC6F\\uDC71\\uDC72\\uDC75\\uDC83-\\uDCAF\\uDCD0-\\uDCE8\\uDCF0-\\uDCF9\\uDD03-\\uDD26\\uDD36-\\uDD3F\\uDD44\\uDD47\\uDD50-\\uDD72\\uDD76\\uDD83-\\uDDB2\\uDDC1-\\uDDC4\\uDDD0-\\uDDDA\\uDDDC\\uDDE1-\\uDDF4\\uDE00-\\uDE11\\uDE13-\\uDE2B\\uDE3F\\uDE40\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEDE\\uDEF0-\\uDEF9\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3D\\uDF50\\uDF5D-\\uDF61\\uDF80-\\uDF89\\uDF8B\\uDF8E\\uDF90-\\uDFB5\\uDFB7\\uDFD1\\uDFD3]|\\uD805[\\uDC00-\\uDC34\\uDC47-\\uDC4A\\uDC50-\\uDC59\\uDC5F-\\uDC61\\uDC80-\\uDCAF\\uDCC4\\uDCC5\\uDCC7\\uDCD0-\\uDCD9\\uDD80-\\uDDAE\\uDDD8-\\uDDDB\\uDE00-\\uDE2F\\uDE44\\uDE50-\\uDE59\\uDE80-\\uDEAA\\uDEB8\\uDEC0-\\uDEC9\\uDED0-\\uDEE3\\uDF00-\\uDF1A\\uDF30-\\uDF3B\\uDF40-\\uDF46]|\\uD806[\\uDC00-\\uDC2B\\uDCA0-\\uDCF2\\uDCFF-\\uDD06\\uDD09\\uDD0C-\\uDD13\\uDD15\\uDD16\\uDD18-\\uDD2F\\uDD3F\\uDD41\\uDD50-\\uDD59\\uDDA0-\\uDDA7\\uDDAA-\\uDDD0\\uDDE1\\uDDE3\\uDE00\\uDE0B-\\uDE32\\uDE3A\\uDE50\\uDE5C-\\uDE89\\uDE9D\\uDEB0-\\uDEF8\\uDFC0-\\uDFE0\\uDFF0-\\uDFF9]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC2E\\uDC40\\uDC50-\\uDC6C\\uDC72-\\uDC8F\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD30\\uDD46\\uDD50-\\uDD59\\uDD60-\\uDD65\\uDD67\\uDD68\\uDD6A-\\uDD89\\uDD98\\uDDA0-\\uDDA9\\uDDB0-\\uDDDB\\uDDE0-\\uDDE9\\uDEE0-\\uDEF2\\uDF02\\uDF04-\\uDF10\\uDF12-\\uDF33\\uDF50-\\uDF59\\uDFB0\\uDFC0-\\uDFD4]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|\\uD80B[\\uDF90-\\uDFF0]|[\\uD80C\\uD80E\\uD80F\\uD81C-\\uD822\\uD840-\\uD868\\uD86A-\\uD86D\\uD86F-\\uD872\\uD874-\\uD879\\uD880-\\uD883\\uD885-\\uD88C][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2F\\uDC41-\\uDC46\\uDC60-\\uDFFF]|\\uD810[\\uDC00-\\uDFFA]|\\uD811[\\uDC00-\\uDE46]|\\uD818[\\uDD00-\\uDD1D\\uDD30-\\uDD39]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDE60-\\uDE69\\uDE70-\\uDEBE\\uDEC0-\\uDEC9\\uDED0-\\uDEED\\uDF00-\\uDF2F\\uDF40-\\uDF43\\uDF50-\\uDF59\\uDF5B-\\uDF61\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDD40-\\uDD6C\\uDD70-\\uDD79\\uDE40-\\uDE96\\uDEA0-\\uDEB8\\uDEBB-\\uDED3\\uDF00-\\uDF4A\\uDF50\\uDF93-\\uDF9F\\uDFE0\\uDFE1\\uDFE3\\uDFF2-\\uDFF6]|\\uD823[\\uDC00-\\uDCD5\\uDCFF-\\uDD1E\\uDD80-\\uDDF2]|\\uD82B[\\uDFF0-\\uDFF3\\uDFF5-\\uDFFB\\uDFFD\\uDFFE]|\\uD82C[\\uDC00-\\uDD22\\uDD32\\uDD50-\\uDD52\\uDD55\\uDD64-\\uDD67\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99]|\\uD833[\\uDCF0-\\uDCF9]|\\uD834[\\uDEC0-\\uDED3\\uDEE0-\\uDEF3\\uDF60-\\uDF78]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB\\uDFCE-\\uDFFF]|\\uD837[\\uDF00-\\uDF1E\\uDF25-\\uDF2A]|\\uD838[\\uDC30-\\uDC6D\\uDD00-\\uDD2C\\uDD37-\\uDD3D\\uDD40-\\uDD49\\uDD4E\\uDE90-\\uDEAD\\uDEC0-\\uDEEB\\uDEF0-\\uDEF9]|\\uD839[\\uDCD0-\\uDCEB\\uDCF0-\\uDCF9\\uDDD0-\\uDDED\\uDDF0-\\uDDFA\\uDEC0-\\uDEDE\\uDEE0-\\uDEE2\\uDEE4\\uDEE5\\uDEE7-\\uDEED\\uDEF0-\\uDEF4\\uDEFE\\uDEFF\\uDFE0-\\uDFE6\\uDFE8-\\uDFEB\\uDFED\\uDFEE\\uDFF0-\\uDFFE]|\\uD83A[\\uDC00-\\uDCC4\\uDCC7-\\uDCCF\\uDD00-\\uDD43\\uDD4B\\uDD50-\\uDD59]|\\uD83B[\\uDC71-\\uDCAB\\uDCAD-\\uDCAF\\uDCB1-\\uDCB4\\uDD01-\\uDD2D\\uDD2F-\\uDD3D\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD83C[\\uDD00-\\uDD0C]|\\uD83E[\\uDFF0-\\uDFF9]|\\uD869[\\uDC00-\\uDEDF\\uDF00-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEAD\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0\\uDFF0-\\uDFFF]|\\uD87B[\\uDC00-\\uDE5D]|\\uD87E[\\uDC00-\\uDE1D]|\\uD884[\\uDC00-\\uDF4A\\uDF50-\\uDFFF]|\\uD88D[\\uDC00-\\uDC79])+)::[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]*((?:[\\0-\\t\\x0B\\f\\x0E-\\u2027\\u202A-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])+)$/;function readRecurringMeta(_x31,_x32){return _readRecurringMeta.apply(this,arguments);}function _readRecurringMeta(){_readRecurringMeta=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee52(block,set){var _block$page5;var attrSurface,attrNames,props,normalizeRt,rt,childAttrMap,repeatChild,dueChild,startChild,deferChild,processedChild,inlineAttrs,inlineRepeat,inlineDue,inlineStart,inlineDefer,canonicalRepeatKey,canonicalDueKey,canonicalStartKey,canonicalDeferKey,hasCanonicalRepeatSignal,hasCanonicalDueSignal,hasCanonicalStartSignal,hasCanonicalDeferSignal,hasCustomRepeatSignal,hasCustomDueSignal,hasCustomStartSignal,hasCustomDeferSignal,propsRepeatMatches,propsDueMatches,propsStartMatches,propsDeferMatches,allowPropsRepeat,allowPropsDue,allowPropsStart,allowPropsDefer,startSignals,deferSignals,dueSignals,hasTimingSignal,richMeta,hasMetadataSignal,repeatText,dueDate,startDate,deferDate,processedTs,dueSource,parsed,startSource,_parsed,deferSource,_parsed2,_parsed3,_dueSource,_parsed4,_startSource,_parsed5,_deferSource,_parsed6,_parsed7,overrideEntry,overrideRepeat,hasTimingValue,hasRepeat,hasTimingAttrs,isOneOff,advanceEntry,advanceFrom;return _regenerator().w(function(_context52){while(1)switch(_context52.n){case 0:attrSurface=(set===null||set===void 0?void 0:set.attributeSurface)||\"Child\";attrNames=(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames();props=parseProps(block.props);normalizeRt=function normalizeRt(){var raw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var out={};for(var _i1=0,_Object$entries=Object.entries(raw);_i1<_Object$entries.length;_i1++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i1],2),k=_Object$entries$_i[0],v=_Object$entries$_i[1];var key=typeof k===\"string\"?k.replace(/^:/,\"\"):k;out[key]=v;}return out;};rt=normalizeRt(props.rt||props[\":rt\"]||{});childAttrMap=parseAttrsFromChildBlocks((block===null||block===void 0?void 0:block.children)||[]);repeatChild=pickChildAttr(childAttrMap,attrNames.repeatAliases,{allowFallback:false});dueChild=pickChildAttr(childAttrMap,attrNames.dueAliases,{allowFallback:false});startChild=pickChildAttr(childAttrMap,attrNames.startAliases,{allowFallback:false});deferChild=pickChildAttr(childAttrMap,attrNames.deferAliases,{allowFallback:false});processedChild=childAttrMap[\"rt-processed\"];inlineAttrs=parseAttrsFromBlockText(block.string||\"\");inlineRepeat=pickInlineAttr(inlineAttrs,attrNames.repeatAliases,{allowFallback:false});inlineDue=pickInlineAttr(inlineAttrs,attrNames.dueAliases,{allowFallback:false});inlineStart=pickInlineAttr(inlineAttrs,attrNames.startAliases,{allowFallback:false});inlineDefer=pickInlineAttr(inlineAttrs,attrNames.deferAliases,{allowFallback:false});canonicalRepeatKey=DEFAULT_REPEAT_ATTR.toLowerCase();canonicalDueKey=DEFAULT_DUE_ATTR.toLowerCase();canonicalStartKey=DEFAULT_START_ATTR.toLowerCase();canonicalDeferKey=DEFAULT_DEFER_ATTR.toLowerCase();hasCanonicalRepeatSignal=!!childAttrMap[canonicalRepeatKey]||inlineAttrs[canonicalRepeatKey]!=null;hasCanonicalDueSignal=!!childAttrMap[canonicalDueKey]||inlineAttrs[canonicalDueKey]!=null;hasCanonicalStartSignal=!!childAttrMap[canonicalStartKey]||inlineAttrs[canonicalStartKey]!=null;hasCanonicalDeferSignal=!!childAttrMap[canonicalDeferKey]||inlineAttrs[canonicalDeferKey]!=null;hasCustomRepeatSignal=!!childAttrMap[attrNames.repeatKey]||inlineAttrs[attrNames.repeatKey]!=null;hasCustomDueSignal=!!childAttrMap[attrNames.dueKey]||inlineAttrs[attrNames.dueKey]!=null;hasCustomStartSignal=!!childAttrMap[attrNames.startKey]||inlineAttrs[attrNames.startKey]!=null;hasCustomDeferSignal=!!childAttrMap[attrNames.deferKey]||inlineAttrs[attrNames.deferKey]!=null;propsRepeatMatches=attrNames.repeatAttr===DEFAULT_REPEAT_ATTR||rt.attrRepeat===attrNames.repeatAttr;propsDueMatches=attrNames.dueAttr===DEFAULT_DUE_ATTR||rt.attrDue===attrNames.dueAttr;propsStartMatches=attrNames.startAttr===DEFAULT_START_ATTR||rt.attrStart===attrNames.startAttr;propsDeferMatches=attrNames.deferAttr===DEFAULT_DEFER_ATTR||rt.attrDefer===attrNames.deferAttr;allowPropsRepeat=propsRepeatMatches||hasCustomRepeatSignal;allowPropsDue=propsDueMatches||hasCustomDueSignal;allowPropsStart=propsStartMatches||hasCustomStartSignal||hasCanonicalStartSignal;allowPropsDefer=propsDeferMatches||hasCustomDeferSignal||hasCanonicalDeferSignal;startSignals=[startChild===null||startChild===void 0?void 0:startChild.value,inlineStart,allowPropsStart?props.start:null];deferSignals=[deferChild===null||deferChild===void 0?void 0:deferChild.value,inlineDefer,allowPropsDefer?props.defer:null];dueSignals=[dueChild===null||dueChild===void 0?void 0:dueChild.value,inlineDue,allowPropsDue?props.due:null];hasTimingSignal=startSignals.some(function(value){return!!value;})||deferSignals.some(function(value){return!!value;})||dueSignals.some(function(value){return!!value;});richMeta=parseRichMetadata(childAttrMap,attrNames);hasMetadataSignal=!!(richMeta.project||richMeta.waitingFor||(richMeta.context||[]).length||richMeta.priority||richMeta.energy||richMeta.gtd);repeatText=null;dueDate=null;startDate=null;deferDate=null;processedTs=rt.processed?Number(rt.processed):null;if(attrSurface===\"Child\"){repeatText=(repeatChild===null||repeatChild===void 0?void 0:repeatChild.value)||inlineRepeat||null;dueDate=null;dueSource=(dueChild===null||dueChild===void 0?void 0:dueChild.value)||inlineDue||null;if(dueSource){parsed=parseRoamDate(dueSource);if(parsed instanceof Date&&!Number.isNaN(parsed.getTime())){dueDate=parsed;clearDueParseFailure((block===null||block===void 0?void 0:block.uid)||null);}else if(dueChild!==null&&dueChild!==void 0&&dueChild.value){noteDueParseFailure((block===null||block===void 0?void 0:block.uid)||null);}}else{clearDueParseFailure((block===null||block===void 0?void 0:block.uid)||null);}startSource=(startChild===null||startChild===void 0?void 0:startChild.value)||inlineStart||null;if(startSource){_parsed=parseRoamDate(startSource);if(_parsed instanceof Date&&!Number.isNaN(_parsed.getTime())){startDate=_parsed;}}deferSource=(deferChild===null||deferChild===void 0?void 0:deferChild.value)||inlineDefer||null;if(deferSource){_parsed2=parseRoamDate(deferSource);if(_parsed2 instanceof Date&&!Number.isNaN(_parsed2.getTime())){deferDate=_parsed2;}}if(processedChild!==null&&processedChild!==void 0&&processedChild.value){_parsed3=Number(processedChild.value);if(!Number.isNaN(_parsed3))processedTs=_parsed3;}}else{if(allowPropsRepeat&&typeof props.repeat===\"string\"&&props.repeat){repeatText=props.repeat;}else if(inlineRepeat){repeatText=inlineRepeat;}else if(repeatChild!==null&&repeatChild!==void 0&&repeatChild.value){repeatText=repeatChild.value;}_dueSource=null;if(allowPropsDue&&typeof props.due===\"string\"&&props.due){_dueSource=props.due;}else if(inlineDue){_dueSource=inlineDue;}else if(dueChild!==null&&dueChild!==void 0&&dueChild.value){_dueSource=dueChild.value;}if(_dueSource){_parsed4=parseRoamDate(_dueSource);if(_parsed4)dueDate=_parsed4;}_startSource=null;if(allowPropsStart&&typeof props.start===\"string\"&&props.start){_startSource=props.start;}else if(inlineStart){_startSource=inlineStart;}else if(startChild!==null&&startChild!==void 0&&startChild.value){_startSource=startChild.value;}if(_startSource){_parsed5=parseRoamDate(_startSource);if(_parsed5)startDate=_parsed5;}_deferSource=null;if(allowPropsDefer&&typeof props.defer===\"string\"&&props.defer){_deferSource=props.defer;}else if(inlineDefer){_deferSource=inlineDefer;}else if(deferChild!==null&&deferChild!==void 0&&deferChild.value){_deferSource=deferChild.value;}if(_deferSource){_parsed6=parseRoamDate(_deferSource);if(_parsed6)deferDate=_parsed6;}if(!processedTs&&processedChild!==null&&processedChild!==void 0&&processedChild.value){_parsed7=Number(processedChild.value);if(!Number.isNaN(_parsed7))processedTs=_parsed7;}}overrideEntry=normalizeOverrideEntry(repeatOverrides.get(block.uid));overrideRepeat=(overrideEntry===null||overrideEntry===void 0?void 0:overrideEntry.repeat)||null;if(overrideRepeat){repeatText=normalizeRepeatRuleText(overrideRepeat)||overrideRepeat;}else{repeatText=normalizeRepeatRuleText(repeatText);}if(overrideEntry!==null&&overrideEntry!==void 0&&overrideEntry.due){dueDate=overrideEntry.due;}hasTimingValue=!!(startDate||deferDate||dueDate);hasRepeat=!!repeatText;hasTimingAttrs=hasTimingSignal||hasTimingValue;isOneOff=!hasRepeat&&hasTimingAttrs;advanceEntry=childAttrMap[ADVANCE_ATTR.toLowerCase()];advanceFrom=normalizeAdvanceValue(advanceEntry===null||advanceEntry===void 0?void 0:advanceEntry.value)||null;return _context52.a(2,{uid:block.uid,repeat:repeatText,due:dueDate,start:startDate,defer:deferDate,childAttrMap:childAttrMap,processedTs:processedTs||null,rtId:rt.id||null,rtParent:rt.parent||null,pageUid:((_block$page5=block.page)===null||_block$page5===void 0?void 0:_block$page5.uid)||null,props:props,advanceFrom:advanceFrom,hasRepeat:hasRepeat,hasTimingAttrs:hasTimingAttrs,hasMetadata:hasMetadataSignal,isRecurring:hasRepeat,isOneOff:isOneOff,metadata:richMeta});}},_callee52);}));return _readRecurringMeta.apply(this,arguments);}function resolveMetaAfterCompletion(_x33,_x34,_x35,_x36){return _resolveMetaAfterCompletion.apply(this,arguments);}function _resolveMetaAfterCompletion(){_resolveMetaAfterCompletion=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee53(snapshot,uid,baseMeta,set){var _metaCandidate,_baseMeta$props,_metaCandidate2,_baseMeta$props2,_metaCandidate3,_baseMeta$props3,_metaCandidate4,_baseMeta$props4,_metaCandidate5,_metaCandidate6,_metaCandidate7,_metaCandidate8;var attempts,lastBlock,metaCandidate,i,block,candidate,fallbackMeta,inlineAttrs,attrNames,inlineRepeat,inlineDue,inlineStart,inlineDefer,valueSources,_i10,_valueSources,value,dueSources,_i11,_dueSources,_value,parsed,startSources,_i12,_startSources,_value2,_parsed8,deferSources,_i13,_deferSources,_value3,_parsed9,_args53=arguments;return _regenerator().w(function(_context53){while(1)switch(_context53.n){case 0:attempts=_args53.length>4&&_args53[4]!==undefined?_args53[4]:3;lastBlock=null;metaCandidate=baseMeta;i=0;case 1:if(!(i<attempts)){_context53.n=7;break;}_context53.n=2;return getBlock(uid);case 2:block=_context53.v;if(block){_context53.n=3;break;}return _context53.a(3,7);case 3:lastBlock=block;_context53.n=4;return readRecurringMeta(block,set);case 4:candidate=_context53.v;if(!(candidate!==null&&candidate!==void 0&&candidate.repeat)){_context53.n=5;break;}return _context53.a(2,{meta:candidate,block:block});case 5:metaCandidate=candidate;_context53.n=6;return delay(60*(i+1));case 6:i++;_context53.n=1;break;case 7:fallbackMeta=_objectSpread({},metaCandidate||baseMeta||{});inlineAttrs=parseAttrsFromBlockText(snapshot.string||\"\");attrNames=(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames();inlineRepeat=pickInlineAttr(inlineAttrs,attrNames.repeatAliases);inlineDue=pickInlineAttr(inlineAttrs,attrNames.dueAliases);inlineStart=pickInlineAttr(inlineAttrs,attrNames.startAliases);inlineDefer=pickInlineAttr(inlineAttrs,attrNames.deferAliases);valueSources=[inlineRepeat,(_metaCandidate=metaCandidate)===null||_metaCandidate===void 0||(_metaCandidate=_metaCandidate.props)===null||_metaCandidate===void 0?void 0:_metaCandidate.repeat,baseMeta===null||baseMeta===void 0||(_baseMeta$props=baseMeta.props)===null||_baseMeta$props===void 0?void 0:_baseMeta$props.repeat,baseMeta===null||baseMeta===void 0?void 0:baseMeta.repeat];_i10=0,_valueSources=valueSources;case 8:if(!(_i10<_valueSources.length)){_context53.n=10;break;}value=_valueSources[_i10];if(!value){_context53.n=9;break;}fallbackMeta.repeat=normalizeRepeatRuleText(value);return _context53.a(3,10);case 9:_i10++;_context53.n=8;break;case 10:dueSources=[inlineDue,(_metaCandidate2=metaCandidate)===null||_metaCandidate2===void 0||(_metaCandidate2=_metaCandidate2.props)===null||_metaCandidate2===void 0?void 0:_metaCandidate2.due,baseMeta===null||baseMeta===void 0||(_baseMeta$props2=baseMeta.props)===null||_baseMeta$props2===void 0?void 0:_baseMeta$props2.due,baseMeta===null||baseMeta===void 0?void 0:baseMeta.due];_i11=0,_dueSources=dueSources;case 11:if(!(_i11<_dueSources.length)){_context53.n=13;break;}_value=_dueSources[_i11];if(!_value){_context53.n=12;break;}parsed=parseRoamDate(_value);if(!parsed){_context53.n=12;break;}fallbackMeta.due=parsed;return _context53.a(3,13);case 12:_i11++;_context53.n=11;break;case 13:startSources=[inlineStart,(_metaCandidate3=metaCandidate)===null||_metaCandidate3===void 0||(_metaCandidate3=_metaCandidate3.props)===null||_metaCandidate3===void 0?void 0:_metaCandidate3.start,baseMeta===null||baseMeta===void 0||(_baseMeta$props3=baseMeta.props)===null||_baseMeta$props3===void 0?void 0:_baseMeta$props3.start,baseMeta===null||baseMeta===void 0?void 0:baseMeta.start];_i12=0,_startSources=startSources;case 14:if(!(_i12<_startSources.length)){_context53.n=16;break;}_value2=_startSources[_i12];if(!_value2){_context53.n=15;break;}_parsed8=parseRoamDate(_value2);if(!_parsed8){_context53.n=15;break;}fallbackMeta.start=_parsed8;return _context53.a(3,16);case 15:_i12++;_context53.n=14;break;case 16:deferSources=[inlineDefer,(_metaCandidate4=metaCandidate)===null||_metaCandidate4===void 0||(_metaCandidate4=_metaCandidate4.props)===null||_metaCandidate4===void 0?void 0:_metaCandidate4.defer,baseMeta===null||baseMeta===void 0||(_baseMeta$props4=baseMeta.props)===null||_baseMeta$props4===void 0?void 0:_baseMeta$props4.defer,baseMeta===null||baseMeta===void 0?void 0:baseMeta.defer];_i13=0,_deferSources=deferSources;case 17:if(!(_i13<_deferSources.length)){_context53.n=19;break;}_value3=_deferSources[_i13];if(!_value3){_context53.n=18;break;}_parsed9=parseRoamDate(_value3);if(!_parsed9){_context53.n=18;break;}fallbackMeta.defer=_parsed9;return _context53.a(3,19);case 18:_i13++;_context53.n=17;break;case 19:fallbackMeta.childAttrMap=((_metaCandidate5=metaCandidate)===null||_metaCandidate5===void 0?void 0:_metaCandidate5.childAttrMap)||(baseMeta===null||baseMeta===void 0?void 0:baseMeta.childAttrMap)||{};fallbackMeta.rtId=((_metaCandidate6=metaCandidate)===null||_metaCandidate6===void 0?void 0:_metaCandidate6.rtId)||(baseMeta===null||baseMeta===void 0?void 0:baseMeta.rtId)||null;fallbackMeta.rtParent=((_metaCandidate7=metaCandidate)===null||_metaCandidate7===void 0?void 0:_metaCandidate7.rtParent)||(baseMeta===null||baseMeta===void 0?void 0:baseMeta.rtParent)||null;fallbackMeta.props=((_metaCandidate8=metaCandidate)===null||_metaCandidate8===void 0?void 0:_metaCandidate8.props)||(baseMeta===null||baseMeta===void 0?void 0:baseMeta.props)||{};return _context53.a(2,{meta:fallbackMeta,block:lastBlock});}},_callee53);}));return _resolveMetaAfterCompletion.apply(this,arguments);}function parseProps(propsJson){if(!propsJson)return{};try{return typeof propsJson===\"string\"?JSON.parse(propsJson):propsJson;}catch(_unused){return{};}}function parseAttrsFromBlockText(text){if(!text)return{};var out={};var attrNames=resolveAttributeNames();var repeatAliases=new Set(attrNames.repeatAliases||[]);var dueAliases=new Set(attrNames.dueAliases||[]);var startAliases=new Set(attrNames.startAliases||[]);var deferAliases=new Set(attrNames.deferAliases||[]);var completedAliases=new Set(attrNames.completedAliases||[]);var lines=text.split(\"\\n\").slice(0,12);var _iterator6=_createForOfIteratorHelper(lines),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var line=_step6.value;var inlineRegex=/(?:^|[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF])((?:[\\x2D\\/-9A-Z_a-z\\xAA\\xB2\\xB3\\xB5\\xB9\\xBA\\xBC-\\xBE\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0560-\\u0588\\u05D0-\\u05EA\\u05EF-\\u05F2\\u0620-\\u064A\\u0660-\\u0669\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07C0-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u0870-\\u0887\\u0889-\\u088F\\u08A0-\\u08C9\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0966-\\u096F\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09E6-\\u09F1\\u09F4-\\u09F9\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A6F\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AE6-\\u0AEF\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B66-\\u0B6F\\u0B71-\\u0B77\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0BE6-\\u0BF2\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C5C\\u0C5D\\u0C60\\u0C61\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDC-\\u0CDE\\u0CE0\\u0CE1\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D04-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D58-\\u0D61\\u0D66-\\u0D78\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DE6-\\u0DEF\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E86-\\u0E8A\\u0E8C-\\u0EA3\\u0EA5\\u0EA7-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F20-\\u0F33\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F-\\u1049\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u1090-\\u1099\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1369-\\u137C\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u1711\\u171F-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1820-\\u1878\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19DA\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4C\\u1B50-\\u1B59\\u1B83-\\u1BA0\\u1BAE-\\u1BE5\\u1C00-\\u1C23\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1C80-\\u1C8A\\u1C90-\\u1CBA\\u1CBD-\\u1CBF\\u1CE9-\\u1CEC\\u1CEE-\\u1CF3\\u1CF5\\u1CF6\\u1CFA\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2070\\u2071\\u2074-\\u2079\\u207F-\\u2089\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2150-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2C00-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2CFD\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312F\\u3131-\\u318E\\u3192-\\u3195\\u31A0-\\u31BF\\u31F0-\\u31FF\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\u3400-\\u4DBF\\u4E00-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7DC\\uA7F1-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA830-\\uA835\\uA840-\\uA873\\uA882-\\uA8B3\\uA8D0-\\uA8D9\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA8FE\\uA900-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF-\\uA9D9\\uA9E0-\\uA9E4\\uA9E6-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB69\\uAB70-\\uABE2\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD07-\\uDD33\\uDD40-\\uDD78\\uDD8A\\uDD8B\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDEE1-\\uDEFB\\uDF00-\\uDF23\\uDF2D-\\uDF4A\\uDF50-\\uDF75\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCA0-\\uDCA9\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDD70-\\uDD7A\\uDD7C-\\uDD8A\\uDD8C-\\uDD92\\uDD94\\uDD95\\uDD97-\\uDDA1\\uDDA3-\\uDDB1\\uDDB3-\\uDDB9\\uDDBB\\uDDBC\\uDDC0-\\uDDF3\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67\\uDF80-\\uDF85\\uDF87-\\uDFB0\\uDFB2-\\uDFBA]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC58-\\uDC76\\uDC79-\\uDC9E\\uDCA7-\\uDCAF\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDCFB-\\uDD1B\\uDD20-\\uDD39\\uDD40-\\uDD59\\uDD80-\\uDDB7\\uDDBC-\\uDDCF\\uDDD2-\\uDE00\\uDE10-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE35\\uDE40-\\uDE48\\uDE60-\\uDE7E\\uDE80-\\uDE9F\\uDEC0-\\uDEC7\\uDEC9-\\uDEE4\\uDEEB-\\uDEEF\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF58-\\uDF72\\uDF78-\\uDF91\\uDFA9-\\uDFAF]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2\\uDCFA-\\uDD23\\uDD30-\\uDD39\\uDD40-\\uDD65\\uDD6F-\\uDD85\\uDE60-\\uDE7E\\uDE80-\\uDEA9\\uDEB0\\uDEB1\\uDEC2-\\uDEC7\\uDF00-\\uDF27\\uDF30-\\uDF45\\uDF51-\\uDF54\\uDF70-\\uDF81\\uDFB0-\\uDFCB\\uDFE0-\\uDFF6]|\\uD804[\\uDC03-\\uDC37\\uDC52-\\uDC6F\\uDC71\\uDC72\\uDC75\\uDC83-\\uDCAF\\uDCD0-\\uDCE8\\uDCF0-\\uDCF9\\uDD03-\\uDD26\\uDD36-\\uDD3F\\uDD44\\uDD47\\uDD50-\\uDD72\\uDD76\\uDD83-\\uDDB2\\uDDC1-\\uDDC4\\uDDD0-\\uDDDA\\uDDDC\\uDDE1-\\uDDF4\\uDE00-\\uDE11\\uDE13-\\uDE2B\\uDE3F\\uDE40\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEDE\\uDEF0-\\uDEF9\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3D\\uDF50\\uDF5D-\\uDF61\\uDF80-\\uDF89\\uDF8B\\uDF8E\\uDF90-\\uDFB5\\uDFB7\\uDFD1\\uDFD3]|\\uD805[\\uDC00-\\uDC34\\uDC47-\\uDC4A\\uDC50-\\uDC59\\uDC5F-\\uDC61\\uDC80-\\uDCAF\\uDCC4\\uDCC5\\uDCC7\\uDCD0-\\uDCD9\\uDD80-\\uDDAE\\uDDD8-\\uDDDB\\uDE00-\\uDE2F\\uDE44\\uDE50-\\uDE59\\uDE80-\\uDEAA\\uDEB8\\uDEC0-\\uDEC9\\uDED0-\\uDEE3\\uDF00-\\uDF1A\\uDF30-\\uDF3B\\uDF40-\\uDF46]|\\uD806[\\uDC00-\\uDC2B\\uDCA0-\\uDCF2\\uDCFF-\\uDD06\\uDD09\\uDD0C-\\uDD13\\uDD15\\uDD16\\uDD18-\\uDD2F\\uDD3F\\uDD41\\uDD50-\\uDD59\\uDDA0-\\uDDA7\\uDDAA-\\uDDD0\\uDDE1\\uDDE3\\uDE00\\uDE0B-\\uDE32\\uDE3A\\uDE50\\uDE5C-\\uDE89\\uDE9D\\uDEB0-\\uDEF8\\uDFC0-\\uDFE0\\uDFF0-\\uDFF9]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC2E\\uDC40\\uDC50-\\uDC6C\\uDC72-\\uDC8F\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD30\\uDD46\\uDD50-\\uDD59\\uDD60-\\uDD65\\uDD67\\uDD68\\uDD6A-\\uDD89\\uDD98\\uDDA0-\\uDDA9\\uDDB0-\\uDDDB\\uDDE0-\\uDDE9\\uDEE0-\\uDEF2\\uDF02\\uDF04-\\uDF10\\uDF12-\\uDF33\\uDF50-\\uDF59\\uDFB0\\uDFC0-\\uDFD4]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|\\uD80B[\\uDF90-\\uDFF0]|[\\uD80C\\uD80E\\uD80F\\uD81C-\\uD822\\uD840-\\uD868\\uD86A-\\uD86D\\uD86F-\\uD872\\uD874-\\uD879\\uD880-\\uD883\\uD885-\\uD88C][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2F\\uDC41-\\uDC46\\uDC60-\\uDFFF]|\\uD810[\\uDC00-\\uDFFA]|\\uD811[\\uDC00-\\uDE46]|\\uD818[\\uDD00-\\uDD1D\\uDD30-\\uDD39]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDE60-\\uDE69\\uDE70-\\uDEBE\\uDEC0-\\uDEC9\\uDED0-\\uDEED\\uDF00-\\uDF2F\\uDF40-\\uDF43\\uDF50-\\uDF59\\uDF5B-\\uDF61\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDD40-\\uDD6C\\uDD70-\\uDD79\\uDE40-\\uDE96\\uDEA0-\\uDEB8\\uDEBB-\\uDED3\\uDF00-\\uDF4A\\uDF50\\uDF93-\\uDF9F\\uDFE0\\uDFE1\\uDFE3\\uDFF2-\\uDFF6]|\\uD823[\\uDC00-\\uDCD5\\uDCFF-\\uDD1E\\uDD80-\\uDDF2]|\\uD82B[\\uDFF0-\\uDFF3\\uDFF5-\\uDFFB\\uDFFD\\uDFFE]|\\uD82C[\\uDC00-\\uDD22\\uDD32\\uDD50-\\uDD52\\uDD55\\uDD64-\\uDD67\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99]|\\uD833[\\uDCF0-\\uDCF9]|\\uD834[\\uDEC0-\\uDED3\\uDEE0-\\uDEF3\\uDF60-\\uDF78]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB\\uDFCE-\\uDFFF]|\\uD837[\\uDF00-\\uDF1E\\uDF25-\\uDF2A]|\\uD838[\\uDC30-\\uDC6D\\uDD00-\\uDD2C\\uDD37-\\uDD3D\\uDD40-\\uDD49\\uDD4E\\uDE90-\\uDEAD\\uDEC0-\\uDEEB\\uDEF0-\\uDEF9]|\\uD839[\\uDCD0-\\uDCEB\\uDCF0-\\uDCF9\\uDDD0-\\uDDED\\uDDF0-\\uDDFA\\uDEC0-\\uDEDE\\uDEE0-\\uDEE2\\uDEE4\\uDEE5\\uDEE7-\\uDEED\\uDEF0-\\uDEF4\\uDEFE\\uDEFF\\uDFE0-\\uDFE6\\uDFE8-\\uDFEB\\uDFED\\uDFEE\\uDFF0-\\uDFFE]|\\uD83A[\\uDC00-\\uDCC4\\uDCC7-\\uDCCF\\uDD00-\\uDD43\\uDD4B\\uDD50-\\uDD59]|\\uD83B[\\uDC71-\\uDCAB\\uDCAD-\\uDCAF\\uDCB1-\\uDCB4\\uDD01-\\uDD2D\\uDD2F-\\uDD3D\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD83C[\\uDD00-\\uDD0C]|\\uD83E[\\uDFF0-\\uDFF9]|\\uD869[\\uDC00-\\uDEDF\\uDF00-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEAD\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0\\uDFF0-\\uDFFF]|\\uD87B[\\uDC00-\\uDE5D]|\\uD87E[\\uDC00-\\uDE1D]|\\uD884[\\uDC00-\\uDF4A\\uDF50-\\uDFFF]|\\uD88D[\\uDC00-\\uDC79])+)::[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]*((?:[\\0-\\t\\x0B-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])*?)(?=(?:[\\t-\\r \\xA0\\u1680\\u2000-\\u200A\\u2028\\u2029\\u202F\\u205F\\u3000\\uFEFF]+(?:[\\x2D\\/-9A-Z_a-z\\xAA\\xB2\\xB3\\xB5\\xB9\\xBA\\xBC-\\xBE\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0560-\\u0588\\u05D0-\\u05EA\\u05EF-\\u05F2\\u0620-\\u064A\\u0660-\\u0669\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07C0-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u0870-\\u0887\\u0889-\\u088F\\u08A0-\\u08C9\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0966-\\u096F\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09E6-\\u09F1\\u09F4-\\u09F9\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A6F\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AE6-\\u0AEF\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B66-\\u0B6F\\u0B71-\\u0B77\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0BE6-\\u0BF2\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C5C\\u0C5D\\u0C60\\u0C61\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDC-\\u0CDE\\u0CE0\\u0CE1\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D04-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D58-\\u0D61\\u0D66-\\u0D78\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DE6-\\u0DEF\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E86-\\u0E8A\\u0E8C-\\u0EA3\\u0EA5\\u0EA7-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F20-\\u0F33\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F-\\u1049\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u1090-\\u1099\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1369-\\u137C\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u1711\\u171F-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1820-\\u1878\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19DA\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4C\\u1B50-\\u1B59\\u1B83-\\u1BA0\\u1BAE-\\u1BE5\\u1C00-\\u1C23\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1C80-\\u1C8A\\u1C90-\\u1CBA\\u1CBD-\\u1CBF\\u1CE9-\\u1CEC\\u1CEE-\\u1CF3\\u1CF5\\u1CF6\\u1CFA\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2070\\u2071\\u2074-\\u2079\\u207F-\\u2089\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2150-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2C00-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2CFD\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312F\\u3131-\\u318E\\u3192-\\u3195\\u31A0-\\u31BF\\u31F0-\\u31FF\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\u3400-\\u4DBF\\u4E00-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7DC\\uA7F1-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA830-\\uA835\\uA840-\\uA873\\uA882-\\uA8B3\\uA8D0-\\uA8D9\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA8FE\\uA900-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF-\\uA9D9\\uA9E0-\\uA9E4\\uA9E6-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB69\\uAB70-\\uABE2\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD07-\\uDD33\\uDD40-\\uDD78\\uDD8A\\uDD8B\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDEE1-\\uDEFB\\uDF00-\\uDF23\\uDF2D-\\uDF4A\\uDF50-\\uDF75\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCA0-\\uDCA9\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDD70-\\uDD7A\\uDD7C-\\uDD8A\\uDD8C-\\uDD92\\uDD94\\uDD95\\uDD97-\\uDDA1\\uDDA3-\\uDDB1\\uDDB3-\\uDDB9\\uDDBB\\uDDBC\\uDDC0-\\uDDF3\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67\\uDF80-\\uDF85\\uDF87-\\uDFB0\\uDFB2-\\uDFBA]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC58-\\uDC76\\uDC79-\\uDC9E\\uDCA7-\\uDCAF\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDCFB-\\uDD1B\\uDD20-\\uDD39\\uDD40-\\uDD59\\uDD80-\\uDDB7\\uDDBC-\\uDDCF\\uDDD2-\\uDE00\\uDE10-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE35\\uDE40-\\uDE48\\uDE60-\\uDE7E\\uDE80-\\uDE9F\\uDEC0-\\uDEC7\\uDEC9-\\uDEE4\\uDEEB-\\uDEEF\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF58-\\uDF72\\uDF78-\\uDF91\\uDFA9-\\uDFAF]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2\\uDCFA-\\uDD23\\uDD30-\\uDD39\\uDD40-\\uDD65\\uDD6F-\\uDD85\\uDE60-\\uDE7E\\uDE80-\\uDEA9\\uDEB0\\uDEB1\\uDEC2-\\uDEC7\\uDF00-\\uDF27\\uDF30-\\uDF45\\uDF51-\\uDF54\\uDF70-\\uDF81\\uDFB0-\\uDFCB\\uDFE0-\\uDFF6]|\\uD804[\\uDC03-\\uDC37\\uDC52-\\uDC6F\\uDC71\\uDC72\\uDC75\\uDC83-\\uDCAF\\uDCD0-\\uDCE8\\uDCF0-\\uDCF9\\uDD03-\\uDD26\\uDD36-\\uDD3F\\uDD44\\uDD47\\uDD50-\\uDD72\\uDD76\\uDD83-\\uDDB2\\uDDC1-\\uDDC4\\uDDD0-\\uDDDA\\uDDDC\\uDDE1-\\uDDF4\\uDE00-\\uDE11\\uDE13-\\uDE2B\\uDE3F\\uDE40\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEDE\\uDEF0-\\uDEF9\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3D\\uDF50\\uDF5D-\\uDF61\\uDF80-\\uDF89\\uDF8B\\uDF8E\\uDF90-\\uDFB5\\uDFB7\\uDFD1\\uDFD3]|\\uD805[\\uDC00-\\uDC34\\uDC47-\\uDC4A\\uDC50-\\uDC59\\uDC5F-\\uDC61\\uDC80-\\uDCAF\\uDCC4\\uDCC5\\uDCC7\\uDCD0-\\uDCD9\\uDD80-\\uDDAE\\uDDD8-\\uDDDB\\uDE00-\\uDE2F\\uDE44\\uDE50-\\uDE59\\uDE80-\\uDEAA\\uDEB8\\uDEC0-\\uDEC9\\uDED0-\\uDEE3\\uDF00-\\uDF1A\\uDF30-\\uDF3B\\uDF40-\\uDF46]|\\uD806[\\uDC00-\\uDC2B\\uDCA0-\\uDCF2\\uDCFF-\\uDD06\\uDD09\\uDD0C-\\uDD13\\uDD15\\uDD16\\uDD18-\\uDD2F\\uDD3F\\uDD41\\uDD50-\\uDD59\\uDDA0-\\uDDA7\\uDDAA-\\uDDD0\\uDDE1\\uDDE3\\uDE00\\uDE0B-\\uDE32\\uDE3A\\uDE50\\uDE5C-\\uDE89\\uDE9D\\uDEB0-\\uDEF8\\uDFC0-\\uDFE0\\uDFF0-\\uDFF9]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC2E\\uDC40\\uDC50-\\uDC6C\\uDC72-\\uDC8F\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD30\\uDD46\\uDD50-\\uDD59\\uDD60-\\uDD65\\uDD67\\uDD68\\uDD6A-\\uDD89\\uDD98\\uDDA0-\\uDDA9\\uDDB0-\\uDDDB\\uDDE0-\\uDDE9\\uDEE0-\\uDEF2\\uDF02\\uDF04-\\uDF10\\uDF12-\\uDF33\\uDF50-\\uDF59\\uDFB0\\uDFC0-\\uDFD4]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|\\uD80B[\\uDF90-\\uDFF0]|[\\uD80C\\uD80E\\uD80F\\uD81C-\\uD822\\uD840-\\uD868\\uD86A-\\uD86D\\uD86F-\\uD872\\uD874-\\uD879\\uD880-\\uD883\\uD885-\\uD88C][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2F\\uDC41-\\uDC46\\uDC60-\\uDFFF]|\\uD810[\\uDC00-\\uDFFA]|\\uD811[\\uDC00-\\uDE46]|\\uD818[\\uDD00-\\uDD1D\\uDD30-\\uDD39]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDE60-\\uDE69\\uDE70-\\uDEBE\\uDEC0-\\uDEC9\\uDED0-\\uDEED\\uDF00-\\uDF2F\\uDF40-\\uDF43\\uDF50-\\uDF59\\uDF5B-\\uDF61\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDD40-\\uDD6C\\uDD70-\\uDD79\\uDE40-\\uDE96\\uDEA0-\\uDEB8\\uDEBB-\\uDED3\\uDF00-\\uDF4A\\uDF50\\uDF93-\\uDF9F\\uDFE0\\uDFE1\\uDFE3\\uDFF2-\\uDFF6]|\\uD823[\\uDC00-\\uDCD5\\uDCFF-\\uDD1E\\uDD80-\\uDDF2]|\\uD82B[\\uDFF0-\\uDFF3\\uDFF5-\\uDFFB\\uDFFD\\uDFFE]|\\uD82C[\\uDC00-\\uDD22\\uDD32\\uDD50-\\uDD52\\uDD55\\uDD64-\\uDD67\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99]|\\uD833[\\uDCF0-\\uDCF9]|\\uD834[\\uDEC0-\\uDED3\\uDEE0-\\uDEF3\\uDF60-\\uDF78]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB\\uDFCE-\\uDFFF]|\\uD837[\\uDF00-\\uDF1E\\uDF25-\\uDF2A]|\\uD838[\\uDC30-\\uDC6D\\uDD00-\\uDD2C\\uDD37-\\uDD3D\\uDD40-\\uDD49\\uDD4E\\uDE90-\\uDEAD\\uDEC0-\\uDEEB\\uDEF0-\\uDEF9]|\\uD839[\\uDCD0-\\uDCEB\\uDCF0-\\uDCF9\\uDDD0-\\uDDED\\uDDF0-\\uDDFA\\uDEC0-\\uDEDE\\uDEE0-\\uDEE2\\uDEE4\\uDEE5\\uDEE7-\\uDEED\\uDEF0-\\uDEF4\\uDEFE\\uDEFF\\uDFE0-\\uDFE6\\uDFE8-\\uDFEB\\uDFED\\uDFEE\\uDFF0-\\uDFFE]|\\uD83A[\\uDC00-\\uDCC4\\uDCC7-\\uDCCF\\uDD00-\\uDD43\\uDD4B\\uDD50-\\uDD59]|\\uD83B[\\uDC71-\\uDCAB\\uDCAD-\\uDCAF\\uDCB1-\\uDCB4\\uDD01-\\uDD2D\\uDD2F-\\uDD3D\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD83C[\\uDD00-\\uDD0C]|\\uD83E[\\uDFF0-\\uDFF9]|\\uD869[\\uDC00-\\uDEDF\\uDF00-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEAD\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0\\uDFF0-\\uDFFF]|\\uD87B[\\uDC00-\\uDE5D]|\\uD87E[\\uDC00-\\uDE1D]|\\uD884[\\uDC00-\\uDF4A\\uDF50-\\uDFFF]|\\uD88D[\\uDC00-\\uDC79])+::)|$)/g;var match=void 0;while((match=inlineRegex.exec(line))!==null){var key=match[1].trim().toLowerCase();var value=match[2].trim();if(!(key in out))out[key]=value;if(repeatAliases.has(key)&&out.repeat==null){out.repeat=value;}else if(dueAliases.has(key)&&out.due==null){out.due=value;}else if(startAliases.has(key)&&out.start==null){out.start=value;}else if(deferAliases.has(key)&&out.defer==null){out.defer=value;}else if(completedAliases.has(key)&&out.completed==null){out.completed=value;}}}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}return out;}function parseAttrsFromChildBlocks(children){if(!Array.isArray(children))return{};var out={};var attrNames=resolveAttributeNames();var repeatAliases=new Set(attrNames.repeatAliases||[]);var dueAliases=new Set(attrNames.dueAliases||[]);var startAliases=new Set(attrNames.startAliases||[]);var deferAliases=new Set(attrNames.deferAliases||[]);var completedAliases=new Set(attrNames.completedAliases||[]);var projectAliases=new Set(attrNames.projectAliases||[]);var gtdAliases=new Set(attrNames.gtdAliases||[]);var waitingAliases=new Set(attrNames.waitingForAliases||[]);var contextAliases=new Set(attrNames.contextAliases||[]);var priorityAliases=new Set(attrNames.priorityAliases||[]);var energyAliases=new Set(attrNames.energyAliases||[]);var _iterator7=_createForOfIteratorHelper(children),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var child=_step7.value;var text=typeof(child===null||child===void 0?void 0:child.string)===\"string\"?child.string:null;if(!text)continue;var m=text.match(ATTR_RE);if(m){var originalKey=m[1].trim();var key=originalKey.toLowerCase();if(!(key in out)){out[key]={value:m[2].trim(),uid:(child===null||child===void 0?void 0:child.uid)||null,originalKey:originalKey};}if(repeatAliases.has(key)&&out.repeat==null){out.repeat=out[key];}else if(dueAliases.has(key)&&out.due==null){out.due=out[key];}else if(startAliases.has(key)&&out.start==null){out.start=out[key];}else if(deferAliases.has(key)&&out.defer==null){out.defer=out[key];}else if(completedAliases.has(key)&&out.completed==null){out.completed=out[key];}else if(projectAliases.has(key)&&out.project==null){out.project=out[key];}else if(gtdAliases.has(key)&&out.gtd==null){out.gtd=out[key];}else if(waitingAliases.has(key)&&out.waitingFor==null){out.waitingFor=out[key];}else if(contextAliases.has(key)&&out.context==null){out.context=out[key];}else if(priorityAliases.has(key)&&out.priority==null){out.priority=out[key];}else if(energyAliases.has(key)&&out.energy==null){out.energy=out[key];}}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}return out;}function stripLinkOrTag(value){if(typeof value!==\"string\")return\"\";var v=value.trim();if(v.startsWith(\"#\"))v=v.slice(1).trim();var pageMatch=v.match(/^\\[\\[(.*)\\]\\]$/);if(pageMatch)return pageMatch[1].trim();return v;}function normalizeContextList(value){if(typeof value!==\"string\")return[];return value.split(\",\").map(function(token){return stripLinkOrTag(token);}).map(function(token){return token.replace(/^@+/,\"\").trim();}).filter(Boolean);}function normalizeFromLocalized(raw,keys){if(!raw||typeof raw!==\"string\"||!Array.isArray(keys))return null;var input=raw.trim().toLowerCase();var langs=Array.from(new Set([currentLanguage,getLanguageSetting()].concat(_toConsumableArray(SUPPORTED_LANGUAGES||[])).filter(Boolean)));var _iterator8=_createForOfIteratorHelper(keys),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var key=_step8.value;var _iterator9=_createForOfIteratorHelper(langs),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var lang=_step9.value;var localized=t([\"dashboard\",\"filterValues\",key],lang);if(typeof localized===\"string\"&&localized.trim().toLowerCase()===input)return key;}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}if(input===key.toLowerCase())return key;}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}return null;}function normalizePriorityValue(raw){if(!raw||typeof raw!==\"string\")return null;var s=raw.trim().toLowerCase();var localized=normalizeFromLocalized(s,[\"low\",\"medium\",\"high\"]);if(localized)return localized;if([\"high\",\"h\",\"p1\",\"urgent\",\"important\",\"critical\"].includes(s))return\"high\";if([\"medium\",\"med\",\"m\",\"p2\",\"normal\",\"standard\"].includes(s))return\"medium\";if([\"low\",\"l\",\"p3\",\"minor\"].includes(s))return\"low\";return null;}function normalizeEnergyValue(raw){if(!raw||typeof raw!==\"string\")return null;var s=raw.trim().toLowerCase();var localized=normalizeFromLocalized(s,[\"low\",\"medium\",\"high\"]);if(localized)return localized;if([\"high\",\"h\",\"p1\",\"full\"].includes(s))return\"high\";if([\"medium\",\"med\",\"m\",\"p2\",\"normal\"].includes(s))return\"medium\";if([\"low\",\"l\",\"p3\",\"tired\"].includes(s))return\"low\";return null;}function normalizeGtdStatus(raw){if(!raw||typeof raw!==\"string\")return null;var stripped=stripLinkOrTag(raw).replace(/:+$/,\"\");var s=stripped.replace(/[_-]+/g,\" \").replace(/\\s+/g,\" \").trim().toLowerCase();var localized=normalizeFromLocalized(s,[\"next action\",\"delegated\",\"deferred\",\"someday\"]);if(localized)return localized;var aliases={\"next action\":\"next action\",\"next\":\"next action\",\"na\":\"next action\",\"nextaction\":\"next action\",\"delegated\":\"delegated\",\"waiting for\":\"delegated\",\"waiting\":\"delegated\",\"deferred\":\"deferred\",\"defer\":\"deferred\",\"someday\":\"someday\",\"someday maybe\":\"someday\",\"maybe\":\"someday\"};var match=aliases[s];if(match)return match;var orderedHit=GTD_STATUS_ORDER.find(function(status){return status===s;});return orderedHit||null;}function formatGtdStatusDisplay(value){var lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:getLanguageSetting();var normalized=normalizeGtdStatus(value);var source=normalized||(typeof value===\"string\"?value.trim().toLowerCase():\"\");if(!source)return\"\";var translated=t([\"dashboard\",\"filterValues\",source],lang);if(translated)return translated;return source.split(/\\s+/).filter(Boolean).map(function(word){return word.charAt(0).toUpperCase()+word.slice(1);}).join(\" \");}function cycleGtdStatus(current){var normalized=current?normalizeGtdStatus(current):null;var order=[].concat(GTD_STATUS_ORDER,[null]);var idx=order.indexOf(normalized!==null&&normalized!==void 0?normalized:null);var next=order[(idx+1)%order.length];return next;}function formatPriorityEnergyDisplay(value){var lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:getLanguageSetting();if(!value||typeof value!==\"string\")return\"\";var v=value.trim().toLowerCase();var translated=t([\"dashboard\",\"filterValues\",v],lang);if(translated)return translated;if(v===\"low\"||v===\"medium\"||v===\"high\"){return v.charAt(0).toUpperCase()+v.slice(1);}return value;}function parseRichMetadata(childAttrMap){var attrNames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:resolveAttributeNames();var projectEntry=pickChildAttr(childAttrMap,attrNames.projectAliases||[],{allowFallback:true});var waitingEntry=pickChildAttr(childAttrMap,attrNames.waitingForAliases||[],{allowFallback:true});var contextEntry=pickChildAttr(childAttrMap,attrNames.contextAliases||[],{allowFallback:true});var priorityEntry=pickChildAttr(childAttrMap,attrNames.priorityAliases||[],{allowFallback:true});var energyEntry=pickChildAttr(childAttrMap,attrNames.energyAliases||[],{allowFallback:true});var gtdEntry=pickChildAttr(childAttrMap,attrNames.gtdAliases||[],{allowFallback:true});var project=projectEntry!==null&&projectEntry!==void 0&&projectEntry.value?stripLinkOrTag(projectEntry.value)||null:null;var waitingFor=waitingEntry!==null&&waitingEntry!==void 0&&waitingEntry.value?stripLinkOrTag(waitingEntry.value)||null:null;var context=contextEntry!==null&&contextEntry!==void 0&&contextEntry.value?normalizeContextList(contextEntry.value):[];var priority=normalizePriorityValue((priorityEntry===null||priorityEntry===void 0?void 0:priorityEntry.value)||null);var energy=normalizeEnergyValue((energyEntry===null||energyEntry===void 0?void 0:energyEntry.value)||null);var gtd=normalizeGtdStatus((gtdEntry===null||gtdEntry===void 0?void 0:gtdEntry.value)||null);return{project:project,waitingFor:waitingFor,context:context,priority:priority,energy:energy,gtd:gtd};}function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");}function hasInlineAttrLabel(text,label){if(!text||!label)return false;var escaped=escapeRegExp(label.trim());if(!escaped)return false;var regex=new RegExp(\"(^|\\\\s)\".concat(escaped,\"::\"),\"i\");return regex.test(text);}function hasChildAttrLabel(children,label){if(!Array.isArray(children)||!label)return false;var escaped=escapeRegExp(label.trim());if(!escaped)return false;var regex=new RegExp(\"^\\\\s*\".concat(escaped,\"::\"),\"i\");return children.some(function(child){return regex.test(((child===null||child===void 0?void 0:child.string)||\"\").trim());});}function hasAnyAttributeChild(children){if(!Array.isArray(children))return false;return children.some(function(child){var text=((child===null||child===void 0?void 0:child.string)||\"\").trim();return ATTR_RE.test(text);});}function sanitizeAttrName(value,fallback){if(value==null)return fallback;var trimmed=String(value).trim().replace(/:+$/,\"\");return trimmed||fallback;}function normalizeAttrLabel(value){if(typeof value!==\"string\")return\"\";return value.trim().replace(/:+$/,\"\").toLowerCase();}var ATTR_NAME_HISTORY_KEY=\"bt-attr-name-history\";var attrNameHistory=null;function loadAttrNameHistory(){if(attrNameHistory)return;attrNameHistory={};if(typeof window===\"undefined\")return;try{var _window$localStorage2;var raw=(_window$localStorage2=window.localStorage)===null||_window$localStorage2===void 0?void 0:_window$localStorage2.getItem(ATTR_NAME_HISTORY_KEY);if(!raw)return;var parsed=JSON.parse(raw);if(parsed&&_typeof(parsed)===\"object\"){attrNameHistory=parsed;}}catch(_){attrNameHistory={};}}function saveAttrNameHistory(){if(typeof window===\"undefined\")return;try{var _window$localStorage3;(_window$localStorage3=window.localStorage)===null||_window$localStorage3===void 0||_window$localStorage3.setItem(ATTR_NAME_HISTORY_KEY,JSON.stringify(attrNameHistory||{}));}catch(_){// ignore storage errors\n}}function getAttrNameHistory(settingId){var _attrNameHistory;loadAttrNameHistory();var list=(_attrNameHistory=attrNameHistory)===null||_attrNameHistory===void 0?void 0:_attrNameHistory[settingId];return Array.isArray(list)?list:[];}function rememberAttrName(settingId,name){var _attrNameHistory2;var normalized=normalizeAttrLabel(name);if(!normalized)return;loadAttrNameHistory();var list=Array.isArray((_attrNameHistory2=attrNameHistory)===null||_attrNameHistory2===void 0?void 0:_attrNameHistory2[settingId])?attrNameHistory[settingId]:[];if(!list.includes(normalized)){attrNameHistory[settingId]=[].concat(_toConsumableArray(list),[normalized]);saveAttrNameHistory();}}function updateAttrNameHistory(prev,next){var map=[{type:\"repeat\",settingId:\"rt-repeat-attr\"},{type:\"due\",settingId:\"rt-due-attr\"},{type:\"start\",settingId:\"rt-start-attr\"},{type:\"defer\",settingId:\"rt-defer-attr\"},{type:\"completed\",settingId:\"rt-completed-attr\"},{type:\"project\",settingId:\"bt-attr-project\"},{type:\"gtd\",settingId:\"bt-attr-gtd\"},{type:\"waitingFor\",settingId:\"bt-attr-waitingFor\"},{type:\"context\",settingId:\"bt-attr-context\"},{type:\"priority\",settingId:\"bt-attr-priority\"},{type:\"energy\",settingId:\"bt-attr-energy\"}];map.forEach(function(_ref1){var type=_ref1.type,settingId=_ref1.settingId;var prevLabel=prev===null||prev===void 0?void 0:prev[\"\".concat(type,\"Attr\")];var nextLabel=next===null||next===void 0?void 0:next[\"\".concat(type,\"Attr\")];if(prevLabel&&prevLabel!==nextLabel){rememberAttrName(settingId,prevLabel);}});}function isChildrenVisible(el){var _el$style,_el$style2;if(!el)return false;if(el.childElementCount===0)return false;if(((_el$style=el.style)===null||_el$style===void 0?void 0:_el$style.display)===\"none\"||((_el$style2=el.style)===null||_el$style2===void 0?void 0:_el$style2.visibility)===\"hidden\")return false;var computed=typeof window!==\"undefined\"&&window.getComputedStyle?window.getComputedStyle(el):null;if(computed&&(computed.display===\"none\"||computed.visibility===\"hidden\"))return false;return el.offsetHeight>0;}function buildAttrConfig(settingId,defaultName){var attr=sanitizeAttrName(extensionAPI.settings.get(settingId)||defaultName,defaultName);var key=attr.toLowerCase();var defaultKey=defaultName.toLowerCase();var history=getAttrNameHistory(settingId);var aliasKeys=Array.from(new Set([key,defaultKey].concat(_toConsumableArray(history)))).filter(Boolean);return{attr:attr,key:key,aliases:aliasKeys,removalKeys:Array.from(new Set([attr,defaultName].concat(_toConsumableArray(history)))).filter(Boolean),defaultName:defaultName,canonicalKey:defaultKey,isDefault:key===defaultKey};}function resolveAttributeNames(){var repeat=buildAttrConfig(\"rt-repeat-attr\",DEFAULT_REPEAT_ATTR);var due=buildAttrConfig(\"rt-due-attr\",DEFAULT_DUE_ATTR);var start=buildAttrConfig(\"rt-start-attr\",DEFAULT_START_ATTR);var defer=buildAttrConfig(\"rt-defer-attr\",DEFAULT_DEFER_ATTR);var completed=buildAttrConfig(\"rt-completed-attr\",DEFAULT_COMPLETED_ATTR);var project=buildAttrConfig(\"bt-attr-project\",DEFAULT_PROJECT_ATTR);var gtd=buildAttrConfig(\"bt-attr-gtd\",DEFAULT_GTD_ATTR);var waitingFor=buildAttrConfig(\"bt-attr-waitingFor\",DEFAULT_WAITING_FOR_ATTR);var context=buildAttrConfig(\"bt-attr-context\",DEFAULT_CONTEXT_ATTR);var priority=buildAttrConfig(\"bt-attr-priority\",DEFAULT_PRIORITY_ATTR);var energy=buildAttrConfig(\"bt-attr-energy\",DEFAULT_ENERGY_ATTR);var attrByType={repeat:repeat,due:due,start:start,defer:defer,completed:completed,project:project,gtd:gtd,waitingFor:waitingFor,context:context,priority:priority,energy:energy};return{repeatAttr:repeat.attr,repeatKey:repeat.key,repeatAliases:repeat.aliases,repeatRemovalKeys:repeat.removalKeys,dueAttr:due.attr,dueKey:due.key,dueAliases:due.aliases,dueRemovalKeys:due.removalKeys,startAttr:start.attr,startKey:start.key,startAliases:start.aliases,startRemovalKeys:start.removalKeys,deferAttr:defer.attr,deferKey:defer.key,deferAliases:defer.aliases,deferRemovalKeys:defer.removalKeys,completedAttr:completed.attr,completedKey:completed.key,completedAliases:completed.aliases,completedRemovalKeys:completed.removalKeys,projectAttr:project.attr,projectKey:project.key,projectAliases:project.aliases,projectRemovalKeys:project.removalKeys,gtdAttr:gtd.attr,gtdKey:gtd.key,gtdAliases:gtd.aliases,gtdRemovalKeys:gtd.removalKeys,waitingForAttr:waitingFor.attr,waitingForKey:waitingFor.key,waitingForAliases:waitingFor.aliases,waitingForRemovalKeys:waitingFor.removalKeys,contextAttr:context.attr,contextKey:context.key,contextAliases:context.aliases,contextRemovalKeys:context.removalKeys,priorityAttr:priority.attr,priorityKey:priority.key,priorityAliases:priority.aliases,priorityRemovalKeys:priority.removalKeys,energyAttr:energy.attr,energyKey:energy.key,energyAliases:energy.aliases,energyRemovalKeys:energy.removalKeys,attrByType:attrByType};}function pickInlineAttr(inlineMap,aliases){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!inlineMap)return null;var _options$allowFallbac=options.allowFallback,allowFallback=_options$allowFallbac===void 0?true:_options$allowFallbac;var _aliases=_toArray(aliases),primary=_aliases[0],fallbacks=_arrayLikeToArray(_aliases).slice(1);if(primary&&inlineMap[primary]!=null&&inlineMap[primary]!==\"\"){return inlineMap[primary];}if(!allowFallback)return null;var _iterator0=_createForOfIteratorHelper(fallbacks),_step0;try{for(_iterator0.s();!(_step0=_iterator0.n()).done;){var key=_step0.value;if(inlineMap[key]!=null&&inlineMap[key]!==\"\"){return inlineMap[key];}}}catch(err){_iterator0.e(err);}finally{_iterator0.f();}return null;}function pickChildAttr(childMap,aliases){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!childMap)return null;var _options$allowFallbac2=options.allowFallback,allowFallback=_options$allowFallbac2===void 0?true:_options$allowFallbac2;var _aliases2=_toArray(aliases),primary=_aliases2[0],fallbacks=_arrayLikeToArray(_aliases2).slice(1);if(primary&&childMap[primary])return childMap[primary];if(!allowFallback)return null;var _iterator1=_createForOfIteratorHelper(fallbacks),_step1;try{for(_iterator1.s();!(_step1=_iterator1.n()).done;){var key=_step1.value;if(childMap[key])return childMap[key];}}catch(err){_iterator1.e(err);}finally{_iterator1.f();}return null;}var CHILD_ATTR_ORDER={completed:0,repeat:1,advance:2,start:3,defer:4,due:5,project:6,gtd:7,waitingfor:8,context:9,priority:10,energy:11};function getChildOrderForType(type){if(!type)return 0;var key=String(type).toLowerCase();return Number.isFinite(CHILD_ATTR_ORDER[key])?CHILD_ATTR_ORDER[key]:0;}function buildOrderedChildAttrLabels(){var attrNames=arguments.length>0&&arguments[0]!==undefined?arguments[0]:resolveAttributeNames();return[{type:\"completed\",label:getAttrLabel(\"completed\",attrNames)||\"completed\"},{type:\"repeat\",label:getAttrLabel(\"repeat\",attrNames)},{type:\"advance\",label:ADVANCE_ATTR},{type:\"start\",label:getAttrLabel(\"start\",attrNames)},{type:\"defer\",label:getAttrLabel(\"defer\",attrNames)},{type:\"due\",label:getAttrLabel(\"due\",attrNames)},{type:\"project\",label:getAttrLabel(\"project\",attrNames)},{type:\"gtd\",label:getAttrLabel(\"gtd\",attrNames)},{type:\"waitingFor\",label:getAttrLabel(\"waitingFor\",attrNames)},{type:\"context\",label:getAttrLabel(\"context\",attrNames)},{type:\"priority\",label:getAttrLabel(\"priority\",attrNames)},{type:\"energy\",label:getAttrLabel(\"energy\",attrNames)}].filter(function(entry){return typeof entry.label===\"string\"&&entry.label.trim();});}function enforceChildAttrOrder(_x37){return _enforceChildAttrOrder.apply(this,arguments);}function _enforceChildAttrOrder(){_enforceChildAttrOrder=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee54(parentUid){var attrNames,parent,children,orderedLabels,labelToIndex,managed,_iterator24,_step24,child,text,match,label,nextOrder,_i14,_managed,entry,_args54=arguments,_t54,_t55;return _regenerator().w(function(_context54){while(1)switch(_context54.p=_context54.n){case 0:attrNames=_args54.length>1&&_args54[1]!==undefined?_args54[1]:resolveAttributeNames();if(parentUid){_context54.n=1;break;}return _context54.a(2);case 1:_context54.n=2;return getBlock(parentUid);case 2:parent=_context54.v;if(parent){_context54.n=3;break;}return _context54.a(2);case 3:children=Array.isArray(parent.children)?parent.children:[];if(children.length){_context54.n=4;break;}return _context54.a(2);case 4:orderedLabels=buildOrderedChildAttrLabels(attrNames);labelToIndex=new Map(orderedLabels.map(function(entry,idx){return[entry.label.trim().toLowerCase(),idx];}));managed=[];_iterator24=_createForOfIteratorHelper(children);_context54.p=5;_iterator24.s();case 6:if((_step24=_iterator24.n()).done){_context54.n=10;break;}child=_step24.value;text=typeof(child===null||child===void 0?void 0:child.string)===\"string\"?child.string:\"\";match=text.match(/^\\s*([^:]+)::/);if(match){_context54.n=7;break;}return _context54.a(3,9);case 7:label=match[1].trim().toLowerCase();if(labelToIndex.has(label)){_context54.n=8;break;}return _context54.a(3,9);case 8:managed.push({uid:child.uid,desiredIndex:labelToIndex.get(label)});case 9:_context54.n=6;break;case 10:_context54.n=12;break;case 11:_context54.p=11;_t54=_context54.v;_iterator24.e(_t54);case 12:_context54.p=12;_iterator24.f();return _context54.f(12);case 13:if(!(managed.length<=1)){_context54.n=14;break;}return _context54.a(2);case 14:managed.sort(function(a,b){return a.desiredIndex-b.desiredIndex;});nextOrder=0;_i14=0,_managed=managed;case 15:if(!(_i14<_managed.length)){_context54.n=21;break;}entry=_managed[_i14];if(entry.uid){_context54.n=16;break;}return _context54.a(3,20);case 16:_context54.p=16;_context54.n=17;return window.roamAlphaAPI.moveBlock({location:{\"parent-uid\":parentUid,order:nextOrder},block:{uid:entry.uid}});case 17:_context54.n=19;break;case 18:_context54.p=18;_t55=_context54.v;console.warn(\"[RecurringTasks] enforceChildAttrOrder move failed\",_t55);case 19:nextOrder+=1;case 20:_i14++;_context54.n=15;break;case 21:return _context54.a(2);}},_callee54,null,[[16,18],[5,11,12,13]]);}));return _enforceChildAttrOrder.apply(this,arguments);}function getAttrMeta(type,attrNames){if(!type||!attrNames)return null;if(attrNames.attrByType&&attrNames.attrByType[type]){return attrNames.attrByType[type];}switch(type){case\"repeat\":return{attr:attrNames.repeatAttr,key:attrNames.repeatKey,aliases:attrNames.repeatAliases,removalKeys:attrNames.repeatRemovalKeys};case\"due\":return{attr:attrNames.dueAttr,key:attrNames.dueKey,aliases:attrNames.dueAliases,removalKeys:attrNames.dueRemovalKeys};case\"start\":return{attr:attrNames.startAttr,key:attrNames.startKey,aliases:attrNames.startAliases,removalKeys:attrNames.startRemovalKeys};case\"defer\":return{attr:attrNames.deferAttr,key:attrNames.deferKey,aliases:attrNames.deferAliases,removalKeys:attrNames.deferRemovalKeys};case\"completed\":return{attr:attrNames.completedAttr,key:attrNames.completedKey,aliases:attrNames.completedAliases,removalKeys:attrNames.completedRemovalKeys};case\"project\":return{attr:attrNames.projectAttr,key:attrNames.projectKey,aliases:attrNames.projectAliases,removalKeys:attrNames.projectRemovalKeys};case\"gtd\":return{attr:attrNames.gtdAttr,key:attrNames.gtdKey,aliases:attrNames.gtdAliases,removalKeys:attrNames.gtdRemovalKeys};case\"waitingFor\":case\"waitingfor\":return{attr:attrNames.waitingForAttr,key:attrNames.waitingForKey,aliases:attrNames.waitingForAliases,removalKeys:attrNames.waitingForRemovalKeys};case\"context\":return{attr:attrNames.contextAttr,key:attrNames.contextKey,aliases:attrNames.contextAliases,removalKeys:attrNames.contextRemovalKeys};case\"priority\":return{attr:attrNames.priorityAttr,key:attrNames.priorityKey,aliases:attrNames.priorityAliases,removalKeys:attrNames.priorityRemovalKeys};case\"energy\":return{attr:attrNames.energyAttr,key:attrNames.energyKey,aliases:attrNames.energyAliases,removalKeys:attrNames.energyRemovalKeys};default:return null;}}function getAttrLabel(type,attrNames){var _getAttrMeta;return((_getAttrMeta=getAttrMeta(type,attrNames))===null||_getAttrMeta===void 0?void 0:_getAttrMeta.attr)||\"\";}function getAttrKey(type,attrNames){var _getAttrMeta2;return((_getAttrMeta2=getAttrMeta(type,attrNames))===null||_getAttrMeta2===void 0?void 0:_getAttrMeta2.key)||\"\";}function getAttrRemovalKeys(type,attrNames){var _getAttrMeta3;return((_getAttrMeta3=getAttrMeta(type,attrNames))===null||_getAttrMeta3===void 0?void 0:_getAttrMeta3.removalKeys)||[];}function getAttrAliases(type,attrNames){var _getAttrMeta4;return((_getAttrMeta4=getAttrMeta(type,attrNames))===null||_getAttrMeta4===void 0?void 0:_getAttrMeta4.aliases)||[];}function ensureChildAttrForType(_x38,_x39,_x40,_x41){return _ensureChildAttrForType.apply(this,arguments);}function _ensureChildAttrForType(){_ensureChildAttrForType=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee55(uid,type,value,attrNames){var order,result;return _regenerator().w(function(_context55){while(1)switch(_context55.n){case 0:order=getChildOrderForType(type);_context55.n=1;return ensureChildAttr(uid,getAttrLabel(type,attrNames),value,order);case 1:result=_context55.v;_context55.n=2;return enforceChildAttrOrder(uid,attrNames);case 2:return _context55.a(2,result);}},_callee55);}));return _ensureChildAttrForType.apply(this,arguments);}function setRichAttribute(_x42,_x43,_x44){return _setRichAttribute.apply(this,arguments);}function _setRichAttribute(){_setRichAttribute=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee56(uid,type,value){var attrNames,hasValue,writeValue,normalized,_args56=arguments;return _regenerator().w(function(_context56){while(1)switch(_context56.n){case 0:attrNames=_args56.length>3&&_args56[3]!==undefined?_args56[3]:resolveAttributeNames();if(uid){_context56.n=1;break;}return _context56.a(2);case 1:hasValue=Array.isArray(value)&&value.length>0||typeof value===\"string\"&&value.trim()||value!=null;if(hasValue){_context56.n=3;break;}_context56.n=2;return removeChildAttrsForType(uid,type,attrNames);case 2:if(type===\"project\"){if(value)(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.removeProjectOption)(value);// Refresh the project index so stale entries drop quickly\nvoid (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)(true);}else if(type===\"waitingFor\"){if(value)(0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.removeWaitingOption)(value);void (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)(true);}else if(type===\"context\"){if(Array.isArray(value)){value.forEach(function(ctx){return (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.removeContextOption)(ctx);});}else if(value){(0,_context_store__WEBPACK_IMPORTED_MODULE_5__.removeContextOption)(value);}void (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)(true);}return _context56.a(2);case 3:writeValue=value;if(!Array.isArray(value)){_context56.n=4;break;}writeValue=value.join(\", \");_context56.n=10;break;case 4:if(!(typeof value===\"string\")){_context56.n=9;break;}writeValue=value.trim();if(type===\"project\"){writeValue=(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.normalizeProjectValue)(writeValue);}if(!(type===\"priority\"||type===\"energy\")){_context56.n=5;break;}writeValue=formatPriorityEnergyDisplay(writeValue);_context56.n=8;break;case 5:if(!(type===\"gtd\")){_context56.n=8;break;}normalized=normalizeGtdStatus(writeValue);if(normalized){_context56.n=7;break;}_context56.n=6;return removeChildAttrsForType(uid,type,attrNames);case 6:return _context56.a(2);case 7:writeValue=formatGtdStatusDisplay(normalized);case 8:_context56.n=10;break;case 9:if(value&&_typeof(value)===\"object\"&&value.label){writeValue=String(value.label).trim();}case 10:if(!(writeValue==null||typeof writeValue===\"string\"&&!writeValue.trim())){_context56.n=12;break;}_context56.n=11;return removeChildAttrsForType(uid,type,attrNames);case 11:if(type===\"project\"){void (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)(true);}return _context56.a(2);case 12:_context56.n=13;return ensureChildAttrForType(uid,type,writeValue,attrNames);case 13:if(type===\"project\"&&writeValue){(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption)(writeValue);}case 14:return _context56.a(2);}},_callee56);}));return _setRichAttribute.apply(this,arguments);}function ensurePageAndOpen(_x45){return _ensurePageAndOpen.apply(this,arguments);}function _ensurePageAndOpen(){_ensurePageAndOpen=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee57(title){var options,name,uid,_window$roamAlphaAPI23,_window$roamAlphaAPI24,_window$roamAlphaAPI25,_window$roamAlphaAPI26,_args57=arguments;return _regenerator().w(function(_context57){while(1)switch(_context57.n){case 0:options=_args57.length>1&&_args57[1]!==undefined?_args57[1]:{};name=typeof title===\"string\"?title.trim():\"\";if(name){_context57.n=1;break;}return _context57.a(2);case 1:_context57.n=2;return getOrCreatePageUid(name);case 2:uid=_context57.v;if(uid){_context57.n=3;break;}return _context57.a(2);case 3:try{if(options.inSidebar){(_window$roamAlphaAPI23=window.roamAlphaAPI)===null||_window$roamAlphaAPI23===void 0||(_window$roamAlphaAPI23=_window$roamAlphaAPI23.ui)===null||_window$roamAlphaAPI23===void 0||(_window$roamAlphaAPI23=_window$roamAlphaAPI23.rightSidebar)===null||_window$roamAlphaAPI23===void 0||(_window$roamAlphaAPI24=_window$roamAlphaAPI23.addWindow)===null||_window$roamAlphaAPI24===void 0||_window$roamAlphaAPI24.call(_window$roamAlphaAPI23,{window:{type:\"outline\",\"page-uid\":uid,\"block-uid\":uid}});}else{(_window$roamAlphaAPI25=window.roamAlphaAPI)===null||_window$roamAlphaAPI25===void 0||(_window$roamAlphaAPI25=_window$roamAlphaAPI25.ui)===null||_window$roamAlphaAPI25===void 0||(_window$roamAlphaAPI25=_window$roamAlphaAPI25.mainWindow)===null||_window$roamAlphaAPI25===void 0||(_window$roamAlphaAPI26=_window$roamAlphaAPI25.openPage)===null||_window$roamAlphaAPI26===void 0||_window$roamAlphaAPI26.call(_window$roamAlphaAPI25,{page:{uid:uid}});}}catch(err){console.warn(\"[BetterTasks] open page failed\",err);}case 4:return _context57.a(2);}},_callee57);}));return _ensurePageAndOpen.apply(this,arguments);}function handleMetadataClick(_x46,_x47){return _handleMetadataClick.apply(this,arguments);}function _handleMetadataClick(){_handleMetadataClick=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee58(uid,type){var payload,event,controllerRef,rawList,rawValue,title,attrNames,isMeta,inSidebar,_activeDashboardContr63,next,trimmed,contexts,notifier,_window$__btInlineMet6,_args58=arguments;return _regenerator().w(function(_context58){while(1)switch(_context58.n){case 0:payload=_args58.length>2&&_args58[2]!==undefined?_args58[2]:{};event=_args58.length>3&&_args58[3]!==undefined?_args58[3]:null;controllerRef=_args58.length>4&&_args58[4]!==undefined?_args58[4]:null;if(!(!uid||!type)){_context58.n=1;break;}return _context58.a(2);case 1:rawList=Array.isArray(payload.list)?payload.list:[];rawValue=typeof payload.value===\"string\"?payload.value:rawList[0]||\"\";title=stripLinkOrTag(rawValue);attrNames=resolveAttributeNames();isMeta=!!(event!==null&&event!==void 0&&event.metaKey||event!==null&&event!==void 0&&event.ctrlKey);inSidebar=!!(event!==null&&event!==void 0&&event.shiftKey);if(!isMeta){_context58.n=12;break;}_context58.n=2;return promptForValue({title:\"Better Tasks\",message:\"Set \".concat(type),placeholder:type,initial:rawValue||\"\"});case 2:next=_context58.v;if(!(next==null)){_context58.n=3;break;}return _context58.a(2);case 3:trimmed=String(next).trim();if(!(type===\"context\")){_context58.n=5;break;}contexts=trimmed?trimmed.split(\",\").map(function(t){return t.replace(/^#/,\"\").replace(/^@/,\"\").replace(/^\\[\\[(.*)\\]\\]$/,\"$1\").trim();}).filter(Boolean):[];_context58.n=4;return setRichAttribute(uid,\"context\",contexts,attrNames);case 4:_context58.n=10;break;case 5:if(!(type===\"project\")){_context58.n=7;break;}_context58.n=6;return setRichAttribute(uid,\"project\",trimmed||null,attrNames);case 6:_context58.n=10;break;case 7:if(!(type===\"waitingFor\")){_context58.n=9;break;}_context58.n=8;return setRichAttribute(uid,\"waitingFor\",trimmed||null,attrNames);case 8:_context58.n=10;break;case 9:if(!(type===\"priority\"||type===\"energy\")){_context58.n=10;break;}_context58.n=10;return setRichAttribute(uid,type,trimmed||null,attrNames);case 10:notifier=(controllerRef===null||controllerRef===void 0?void 0:controllerRef.notifyBlockChange)||((_activeDashboardContr63=activeDashboardController)===null||_activeDashboardContr63===void 0?void 0:_activeDashboardContr63.notifyBlockChange);if(!(typeof notifier===\"function\")){_context58.n=11;break;}_context58.n=11;return notifier(uid,{bypassFilters:true});case 11:if(typeof window!==\"undefined\"){(_window$__btInlineMet6=window.__btInlineMetaCache)===null||_window$__btInlineMet6===void 0||_window$__btInlineMet6[\"delete\"](uid);}void syncPillsForSurface(lastAttrSurface);return _context58.a(2);case 12:if(title){_context58.n=13;break;}return _context58.a(2);case 13:_context58.n=14;return ensurePageAndOpen(title,{inSidebar:inSidebar});case 14:return _context58.a(2);}},_callee58);}));return _handleMetadataClick.apply(this,arguments);}function removeChildAttrsForType(_x48,_x49,_x50){return _removeChildAttrsForType.apply(this,arguments);}function _removeChildAttrsForType(){_removeChildAttrsForType=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee59(uid,type,attrNames){var _iterator25,_step25,key,_t56;return _regenerator().w(function(_context59){while(1)switch(_context59.p=_context59.n){case 0:_iterator25=_createForOfIteratorHelper(getAttrRemovalKeys(type,attrNames));_context59.p=1;_iterator25.s();case 2:if((_step25=_iterator25.n()).done){_context59.n=4;break;}key=_step25.value;_context59.n=3;return removeChildAttr(uid,key);case 3:_context59.n=2;break;case 4:_context59.n=6;break;case 5:_context59.p=5;_t56=_context59.v;_iterator25.e(_t56);case 6:_context59.p=6;_iterator25.f();return _context59.f(6);case 7:return _context59.a(2);}},_callee59,null,[[1,5,6,7]]);}));return _removeChildAttrsForType.apply(this,arguments);}function clearAttrForType(_x51,_x52){return _clearAttrForType.apply(this,arguments);}function _clearAttrForType(){_clearAttrForType=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee60(uid,type){var options,allowed,set,attrNames,block,removalKeys,cleaned,_args60=arguments,_t57;return _regenerator().w(function(_context60){while(1)switch(_context60.n){case 0:options=_args60.length>2&&_args60[2]!==undefined?_args60[2]:{};if(uid){_context60.n=1;break;}return _context60.a(2,false);case 1:allowed=new Set([\"repeat\",\"start\",\"defer\",\"due\"]);if(allowed.has(type)){_context60.n=2;break;}return _context60.a(2,false);case 2:set=options.set||S();attrNames=(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames();_t57=options.block;if(_t57){_context60.n=4;break;}_context60.n=3;return getBlock(uid);case 3:_t57=_context60.v;case 4:block=_t57;if(block){_context60.n=5;break;}return _context60.a(2,false);case 5:_context60.n=6;return updateBlockProps(uid,_defineProperty({},type,undefined));case 6:_context60.n=7;return removeChildAttrsForType(uid,type,attrNames);case 7:removalKeys=getAttrRemovalKeys(type,attrNames);if(!removalKeys.length){_context60.n=8;break;}cleaned=removeInlineAttributes(block.string||\"\",removalKeys);if(!(cleaned!==(block.string||\"\"))){_context60.n=8;break;}_context60.n=8;return updateBlockString(uid,cleaned);case 8:if(type===\"repeat\"){repeatOverrides[\"delete\"](uid);}else if(type===\"due\"){mergeRepeatOverride(uid,{due:null});}return _context60.a(2,true);}},_callee60);}));return _clearAttrForType.apply(this,arguments);}function ensureInlineAttrForType(_x53,_x54,_x55,_x56){return _ensureInlineAttrForType.apply(this,arguments);}function _ensureInlineAttrForType(){_ensureInlineAttrForType=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee61(block,type,value,attrNames){var label,aliases;return _regenerator().w(function(_context61){while(1)switch(_context61.n){case 0:label=getAttrLabel(type,attrNames);aliases=getAttrRemovalKeys(type,attrNames).filter(function(name){return name!==label;});_context61.n=1;return ensureInlineAttribute(block,label,value,{aliases:aliases});case 1:return _context61.a(2);}},_callee61);}));return _ensureInlineAttrForType.apply(this,arguments);}function replaceInlineAttrForType(text,type,value,attrNames){if(!text)return text;var keys=getAttrRemovalKeys(type,attrNames);var current=text;var _iterator10=_createForOfIteratorHelper(keys),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var key=_step10.value;var next=replaceAttributeInString(current,key,value);if(next!==current){current=next;break;}}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}return current;}function getMetaChildAttr(meta,type,attrNames){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!meta)return null;return pickChildAttr(meta.childAttrMap||{},getAttrAliases(type,attrNames),options);}function setMetaChildAttr(meta,type,entry,attrNames){if(!meta)return;meta.childAttrMap=meta.childAttrMap||{};var label=getAttrLabel(type,attrNames);meta.childAttrMap[label]=entry;if(label===type){meta.childAttrMap[type]=entry;}else{delete meta.childAttrMap[type];}}function clearMetaChildAttr(meta,type,attrNames){if(!meta||!meta.childAttrMap)return;delete meta.childAttrMap[getAttrLabel(type,attrNames)];var label=getAttrLabel(type,attrNames);if(label===type)delete meta.childAttrMap[type];}function normalizeAdvanceValue(value){if(!value)return null;var v=String(value).trim().toLowerCase();if(v===\"completion\"||v===\"completion date\")return\"completion\";if(v===\"due\"||v===\"due date\")return\"due\";return null;}function advanceLabelForMode(mode){return mode===\"completion\"?\"completion date\":\"due date\";}function ensureAdvanceChildAttr(_x57,_x58,_x59){return _ensureAdvanceChildAttr.apply(this,arguments);}function _ensureAdvanceChildAttr(){_ensureAdvanceChildAttr=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee62(uid,mode,meta){var attrNames,label,order,result,_args62=arguments;return _regenerator().w(function(_context62){while(1)switch(_context62.n){case 0:attrNames=_args62.length>3&&_args62[3]!==undefined?_args62[3]:resolveAttributeNames();label=advanceLabelForMode(mode);order=getChildOrderForType(\"advance\");_context62.n=1;return ensureChildAttr(uid,ADVANCE_ATTR,label,order);case 1:result=_context62.v;_context62.n=2;return enforceChildAttrOrder(uid,attrNames);case 2:if(meta){meta.childAttrMap=meta.childAttrMap||{};meta.childAttrMap[ADVANCE_ATTR.toLowerCase()]={value:label,uid:result.uid};}case 3:return _context62.a(2);}},_callee62);}));return _ensureAdvanceChildAttr.apply(this,arguments);}function revertBlockCompletion(_x60){return _revertBlockCompletion.apply(this,arguments);}function _revertBlockCompletion(){_revertBlockCompletion=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee63(block){var uid,current,reverted;return _regenerator().w(function(_context63){while(1)switch(_context63.n){case 0:if(block){_context63.n=1;break;}return _context63.a(2);case 1:uid=block.uid;current=block.string||\"\";reverted=current.replace(/{{\\[\\[DONE\\]\\]}}/i,\"{{[[TODO]]}}\");if(!(reverted!==current)){_context63.n=2;break;}_context63.n=2;return updateBlockString(uid,reverted);case 2:return _context63.a(2);}},_callee63);}));return _revertBlockCompletion.apply(this,arguments);}function normalizeRepeatRuleText(value){if(!value)return null;var s=String(value).trim();if(!s)return null;s=s.replace(/\\[\\[([^\\]]+)\\]\\]/g,\"$1\");s=s.replace(/\\{\\{([^\\}]+)\\}\\}/g,\"$1\");s=s.replace(/\\(\\(([^\\)]+)\\)\\)/g,\"$1\");s=s.replace(/^\\s*-/g,\"\").trim();return s||null;}// ========================= Completion + next spawn =========================\nfunction withChildAttrLock(_x61,_x62,_x63){return _withChildAttrLock.apply(this,arguments);}function _withChildAttrLock(){_withChildAttrLock=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee64(uid,key,fn){var token,previous,release,next,_release;return _regenerator().w(function(_context64){while(1)switch(_context64.p=_context64.n){case 0:if(!(!uid||!key)){_context64.n=1;break;}return _context64.a(2,fn());case 1:token=\"\".concat(uid,\"::\").concat(key).toLowerCase();previous=childAttrLocks.get(token)||Promise.resolve();release=null;next=new Promise(function(resolve){release=resolve;});childAttrLocks.set(token,previous.then(function(){return next;}));_context64.p=2;_context64.n=3;return previous;case 3:_context64.n=4;return fn();case 4:return _context64.a(2,_context64.v);case 5:_context64.p=5;(_release=release)===null||_release===void 0||_release();if(childAttrLocks.get(token)===next){childAttrLocks[\"delete\"](token);}return _context64.f(5);case 6:return _context64.a(2);}},_callee64,null,[[2,,5,6]]);}));return _withChildAttrLock.apply(this,arguments);}function dedupeChildAttr(_x64,_x65,_x66){return _dedupeChildAttr.apply(this,arguments);}function _dedupeChildAttr(){_dedupeChildAttr=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee65(uid,key,keepUid){var block,children,keyRegex,matches,_iterator26,_step26,matchUid,_t58,_t59;return _regenerator().w(function(_context65){while(1)switch(_context65.p=_context65.n){case 0:_context65.n=1;return getBlock(uid);case 1:block=_context65.v;if(block){_context65.n=2;break;}return _context65.a(2);case 2:children=Array.isArray(block===null||block===void 0?void 0:block.children)?block.children:[];keyRegex=new RegExp(\"^\\\\s*\".concat(escapeRegExp(String(key||\"\").trim()),\"::\\\\s*\"),\"i\");matches=children.filter(function(child){return keyRegex.test(((child===null||child===void 0?void 0:child.string)||\"\").trim());}).map(function(child){return typeof(child===null||child===void 0?void 0:child.uid)===\"string\"?child.uid.trim():\"\";}).filter(Boolean);_iterator26=_createForOfIteratorHelper(matches);_context65.p=3;_iterator26.s();case 4:if((_step26=_iterator26.n()).done){_context65.n=9;break;}matchUid=_step26.value;if(!(keepUid&&matchUid===keepUid)){_context65.n=5;break;}return _context65.a(3,8);case 5:_context65.p=5;_context65.n=6;return deleteBlock(matchUid);case 6:_context65.n=8;break;case 7:_context65.p=7;_t58=_context65.v;console.warn(\"[RecurringTasks] dedupeChildAttr failed\",_t58);case 8:_context65.n=4;break;case 9:_context65.n=11;break;case 10:_context65.p=10;_t59=_context65.v;_iterator26.e(_t59);case 11:_context65.p=11;_iterator26.f();return _context65.f(11);case 12:return _context65.a(2);}},_callee65,null,[[5,7],[3,10,11,12]]);}));return _dedupeChildAttr.apply(this,arguments);}function ensureChildAttr(_x67,_x68,_x69){return _ensureChildAttr.apply(this,arguments);}function _ensureChildAttr(){_ensureChildAttr=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee67(uid,key,value){var order,_args67=arguments;return _regenerator().w(function(_context67){while(1)switch(_context67.n){case 0:order=_args67.length>3&&_args67[3]!==undefined?_args67[3]:0;return _context67.a(2,withChildAttrLock(uid,key,/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee66(){var _existingChild$string,_match$string;var parent,children,keyRegex,match,matchUid,newUid,existingChild,_newUid,curVal,_newUid2,_t60;return _regenerator().w(function(_context66){while(1)switch(_context66.p=_context66.n){case 0:_context66.n=1;return getBlock(uid);case 1:parent=_context66.v;if(parent){_context66.n=2;break;}return _context66.a(2,{created:false,uid:null,previousValue:null});case 2:children=Array.isArray(parent.children)?parent.children:[];keyRegex=new RegExp(\"^\\\\s*\".concat(escapeRegExp(String(key||\"\").trim()),\"::\\\\s*\"),\"i\");match=children.find(function(child){return keyRegex.test(((child===null||child===void 0?void 0:child.string)||\"\").trim());});matchUid=typeof(match===null||match===void 0?void 0:match.uid)===\"string\"?match.uid.trim():\"\";if(matchUid){_context66.n=6;break;}newUid=window.roamAlphaAPI.util.generateUID();_context66.n=3;return createBlock(uid,order,\"\".concat(key,\":: \").concat(value),newUid);case 3:_context66.n=4;return moveChildToOrder(uid,newUid,order);case 4:_context66.n=5;return dedupeChildAttr(uid,key,newUid);case 5:return _context66.a(2,{created:true,uid:newUid,previousValue:null});case 6:_context66.n=7;return getBlock(matchUid);case 7:existingChild=_context66.v;if(existingChild){_context66.n=11;break;}_newUid=window.roamAlphaAPI.util.generateUID();_context66.n=8;return createBlock(uid,order,\"\".concat(key,\":: \").concat(value),_newUid);case 8:_context66.n=9;return moveChildToOrder(uid,_newUid,order);case 9:_context66.n=10;return dedupeChildAttr(uid,key,_newUid);case 10:return _context66.a(2,{created:true,uid:_newUid,previousValue:null});case 11:curVal=((_existingChild$string=existingChild.string)===null||_existingChild$string===void 0||(_existingChild$string=_existingChild$string.replace(/^[^:]+::\\s*/i,\"\"))===null||_existingChild$string===void 0?void 0:_existingChild$string.trim())||((_match$string=match.string)===null||_match$string===void 0||(_match$string=_match$string.replace(/^[^:]+::\\s*/i,\"\"))===null||_match$string===void 0?void 0:_match$string.trim())||\"\";if(!(curVal!==value)){_context66.n=18;break;}_context66.p=12;_context66.n=13;return window.roamAlphaAPI.updateBlock({block:{uid:matchUid,string:\"\".concat(key,\":: \").concat(value)}});case 13:_context66.n=18;break;case 14:_context66.p=14;_t60=_context66.v;console.warn(\"[RecurringTasks] ensureChildAttr update failed, recreating\",_t60);_newUid2=window.roamAlphaAPI.util.generateUID();_context66.n=15;return createBlock(uid,order,\"\".concat(key,\":: \").concat(value),_newUid2);case 15:_context66.n=16;return moveChildToOrder(uid,_newUid2,order);case 16:_context66.n=17;return dedupeChildAttr(uid,key,_newUid2);case 17:return _context66.a(2,{created:true,uid:_newUid2,previousValue:curVal});case 18:_context66.n=19;return moveChildToOrder(uid,matchUid,order);case 19:_context66.n=20;return dedupeChildAttr(uid,key,matchUid);case 20:return _context66.a(2,{created:false,uid:matchUid,previousValue:curVal});}},_callee66,null,[[12,14]]);}))));}},_callee67);}));return _ensureChildAttr.apply(this,arguments);}function moveChildToOrder(_x70,_x71,_x72){return _moveChildToOrder.apply(this,arguments);}function _moveChildToOrder(){_moveChildToOrder=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee68(parentUid,childUid,order){var normalizedOrder,_t61;return _regenerator().w(function(_context68){while(1)switch(_context68.p=_context68.n){case 0:if(!(!parentUid||!childUid||!Number.isFinite(order))){_context68.n=1;break;}return _context68.a(2);case 1:normalizedOrder=Math.max(0,Math.floor(order));_context68.p=2;_context68.n=3;return window.roamAlphaAPI.moveBlock({location:{\"parent-uid\":parentUid,order:normalizedOrder},block:{uid:childUid}});case 3:invalidateBlockCache(parentUid);invalidateBlockCache(childUid);_context68.n=5;break;case 4:_context68.p=4;_t61=_context68.v;console.warn(\"[RecurringTasks] moveChildToOrder failed\",_t61);case 5:return _context68.a(2);}},_callee68,null,[[2,4]]);}));return _moveChildToOrder.apply(this,arguments);}function removeChildAttr(_x73,_x74){return _removeChildAttr.apply(this,arguments);}function _removeChildAttr(){_removeChildAttr=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee70(uid,key){return _regenerator().w(function(_context70){while(1)switch(_context70.n){case 0:return _context70.a(2,withChildAttrLock(uid,key,/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee69(){var token,block,children,keyRegex,matches,_iterator27,_step27,entry,targetUid,exists,_t62,_t63;return _regenerator().w(function(_context69){while(1)switch(_context69.p=_context69.n){case 0:token=\"\".concat(uid,\"::\").concat(key).toLowerCase();if(!deletingChildAttrs.has(token)){_context69.n=1;break;}return _context69.a(2);case 1:deletingChildAttrs.add(token);_context69.p=2;_context69.n=3;return getBlock(uid);case 3:block=_context69.v;if(block){_context69.n=4;break;}return _context69.a(2);case 4:children=Array.isArray(block===null||block===void 0?void 0:block.children)?block.children:[];keyRegex=new RegExp(\"^\\\\s*\".concat(escapeRegExp(String(key||\"\").trim()),\"::\\\\s*\"),\"i\");matches=children.filter(function(entry){return keyRegex.test(((entry===null||entry===void 0?void 0:entry.string)||\"\").trim());});if(matches.length){_context69.n=5;break;}return _context69.a(2);case 5:_iterator27=_createForOfIteratorHelper(matches);_context69.p=6;_iterator27.s();case 7:if((_step27=_iterator27.n()).done){_context69.n=14;break;}entry=_step27.value;targetUid=typeof(entry===null||entry===void 0?void 0:entry.uid)===\"string\"?entry.uid.trim():\"\";if(targetUid){_context69.n=8;break;}return _context69.a(3,13);case 8:_context69.p=8;_context69.n=9;return getBlock(targetUid);case 9:exists=_context69.v;if(exists){_context69.n=10;break;}return _context69.a(3,13);case 10:_context69.n=11;return deleteBlock(targetUid);case 11:_context69.n=13;break;case 12:_context69.p=12;_t62=_context69.v;console.warn(\"[RecurringTasks] removeChildAttr failed\",_t62);case 13:_context69.n=7;break;case 14:_context69.n=16;break;case 15:_context69.p=15;_t63=_context69.v;_iterator27.e(_t63);case 16:_context69.p=16;_iterator27.f();return _context69.f(16);case 17:_context69.p=17;deletingChildAttrs[\"delete\"](token);return _context69.f(17);case 18:return _context69.a(2);}},_callee69,null,[[8,12],[6,15,16,17],[2,,17,18]]);}))));}},_callee70);}));return _removeChildAttr.apply(this,arguments);}function markCompleted(_x75,_x76,_x77){return _markCompleted.apply(this,arguments);}function _markCompleted(){_markCompleted=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee71(block,meta,set){var uid,beforeString,processedAt,completedDate,updatedString,stringChanged,completedAttrChange;return _regenerator().w(function(_context71){while(1)switch(_context71.n){case 0:uid=block.uid;beforeString=block.string||\"\";processedAt=Date.now();completedDate=formatDate(todayLocal(),set);updatedString=beforeString;stringChanged=false;completedAttrChange=null;_context71.n=1;return ensureChildAttrForType(uid,\"completed\",completedDate,set.attrNames);case 1:completedAttrChange=_context71.v;_context71.n=2;return removeChildAttr(uid,\"rt-processed\");case 2:_context71.n=3;return updateBlockProps(uid,{rt:{lastCompleted:new Date(processedAt).toISOString(),processed:processedAt,tz:set.timezone}});case 3:return _context71.a(2,{processedAt:processedAt,completedDate:completedDate,stringChanged:stringChanged,beforeString:beforeString,updatedString:updatedString,childChanges:{completed:completedAttrChange}});}},_callee71);}));return _markCompleted.apply(this,arguments);}var undoRegistry=new Map();function registerUndoAction(data){undoRegistry.set(data.blockUid,data);showUndoToast(data);}function showUndoToast(data){var _translateString;var nextAnchor=data.nextAnchor,nextDue=data.nextDue,toastMessage=data.toastMessage;var displaySource=nextAnchor||nextDue;var displayDate=displaySource?formatRoamDateTitle(displaySource):\"\";var message=toastMessage?toastMessage:displaySource?((_translateString=translateString(\"Next occurrence scheduled for {{date}}\",getLanguageSetting()))===null||_translateString===void 0?void 0:_translateString.replace(\"{{date}}\",displayDate))||\"Next occurrence scheduled for \".concat(displayDate):translateString(\"Next occurrence scheduled\",getLanguageSetting());izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",\"class\":\"betterTasks bt-toast-undo\",position:\"center\",message:message,timeout:5000,close:true,closeOnEscape:true,closeOnClick:false,buttons:[[\"<button>\".concat(escapeHtml(t([\"buttons\",\"undo\"],getLanguageSetting())||\"Undo\"),\"</button>\"),function(instance,toastEl){instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");performUndo(data)[\"catch\"](function(err){return console.error(\"[RecurringTasks] undo failed\",err);});},true]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},onClosed:function onClosed(){undoRegistry[\"delete\"](data.blockUid);}});}function performUndo(_x78){return _performUndo.apply(this,arguments);}function _performUndo(){_performUndo=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee73(data){var _snapshot$childAttrs7,_snapshot$childAttrs8;var blockUid,snapshot,completion,newBlockUid,set,overrideEntry,attrNames,restoredString,_snapshot$childAttrs3,_snapshot$childAttrs4,_snapshot$childAttrs5,_snapshot$childAttrs6,hadRepeatChild,hadDueChild,hadStartChild,hadDeferChild,restoreOrRemove,processedSnapshot,_activeDashboardContr64,_activeDashboardContr65,_activeDashboardContr68,_activeDashboardContr69,_activeDashboardContr66,_activeDashboardContr67,_activeDashboardContr70,_activeDashboardContr71,_t64,_t65,_t66,_t67,_t68;return _regenerator().w(function(_context73){while(1)switch(_context73.p=_context73.n){case 0:blockUid=data.blockUid,snapshot=data.snapshot,completion=data.completion,newBlockUid=data.newBlockUid,set=data.set,overrideEntry=data.overrideEntry;attrNames=(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames();undoRegistry[\"delete\"](blockUid);_context73.p=1;restoredString=normalizeToTodoMacro(snapshot.string);_context73.n=2;return updateBlockString(blockUid,restoredString);case 2:_context73.n=4;break;case 3:_context73.p=3;_t64=_context73.v;console.warn(\"[RecurringTasks] undo string failed\",_t64);case 4:_context73.p=4;_context73.n=5;return setBlockProps(blockUid,snapshot.props);case 5:_context73.n=7;break;case 6:_context73.p=6;_t65=_context73.v;console.warn(\"[RecurringTasks] undo props failed\",_t65);case 7:_context73.p=7;hadRepeatChild=!!((_snapshot$childAttrs3=snapshot.childAttrs)!==null&&_snapshot$childAttrs3!==void 0&&_snapshot$childAttrs3[\"repeat\"]);hadDueChild=!!((_snapshot$childAttrs4=snapshot.childAttrs)!==null&&_snapshot$childAttrs4!==void 0&&_snapshot$childAttrs4[\"due\"]);hadStartChild=!!((_snapshot$childAttrs5=snapshot.childAttrs)!==null&&_snapshot$childAttrs5!==void 0&&_snapshot$childAttrs5[\"start\"]);hadDeferChild=!!((_snapshot$childAttrs6=snapshot.childAttrs)!==null&&_snapshot$childAttrs6!==void 0&&_snapshot$childAttrs6[\"defer\"]);restoreOrRemove=/*#__PURE__*/function(){var _ref40=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee72(type,snapshotEntry){return _regenerator().w(function(_context72){while(1)switch(_context72.n){case 0:if(!snapshotEntry){_context72.n=2;break;}_context72.n=1;return ensureChildAttrForType(blockUid,type,snapshotEntry.value||\"\",attrNames);case 1:_context72.n=3;break;case 2:_context72.n=3;return removeChildAttrsForType(blockUid,type,attrNames);case 3:return _context72.a(2);}},_callee72);}));return function restoreOrRemove(_x197,_x198){return _ref40.apply(this,arguments);};}();_context73.n=8;return restoreOrRemove(\"repeat\",hadRepeatChild?snapshot.childAttrs[\"repeat\"]:null);case 8:_context73.n=9;return restoreOrRemove(\"due\",hadDueChild?snapshot.childAttrs[\"due\"]:null);case 9:_context73.n=10;return restoreOrRemove(\"start\",hadStartChild?snapshot.childAttrs[\"start\"]:null);case 10:_context73.n=11;return restoreOrRemove(\"defer\",hadDeferChild?snapshot.childAttrs[\"defer\"]:null);case 11:_context73.n=13;break;case 12:_context73.p=12;_t66=_context73.v;console.warn(\"[RecurringTasks] undo restore recurring attrs failed\",_t66);case 13:if(!newBlockUid){_context73.n=17;break;}_context73.p=14;_context73.n=15;return deleteBlock(newBlockUid);case 15:_context73.n=17;break;case 16:_context73.p=16;_t67=_context73.v;console.warn(\"[RecurringTasks] undo remove new block failed\",_t67);case 17:_context73.n=18;return restoreChildAttr(blockUid,\"completed\",(_snapshot$childAttrs7=snapshot.childAttrs)===null||_snapshot$childAttrs7===void 0?void 0:_snapshot$childAttrs7[\"completed\"],completion.childChanges.completed,attrNames);case 18:processedSnapshot=(_snapshot$childAttrs8=snapshot.childAttrs)===null||_snapshot$childAttrs8===void 0?void 0:_snapshot$childAttrs8[\"rt-processed\"];if(!(processedSnapshot!==null&&processedSnapshot!==void 0&&processedSnapshot.uid)){_context73.n=23;break;}_context73.p=19;_context73.n=20;return window.roamAlphaAPI.updateBlock({block:{uid:processedSnapshot.uid,string:\"rt-processed:: \".concat(processedSnapshot.value)}});case 20:_context73.n=22;break;case 21:_context73.p=21;_t68=_context73.v;console.warn(\"[RecurringTasks] restore processed attr failed\",_t68);case 22:_context73.n=24;break;case 23:_context73.n=24;return removeChildAttr(blockUid,\"rt-processed\");case 24:processedMap.set(blockUid,Date.now());setTimeout(function(){return processedMap[\"delete\"](blockUid);},750);if(overrideEntry)mergeRepeatOverride(blockUid,overrideEntry);if(!activeDashboardController){_context73.n=26;break;}_context73.n=25;return(_activeDashboardContr64=(_activeDashboardContr65=activeDashboardController).notifyBlockChange)===null||_activeDashboardContr64===void 0?void 0:_activeDashboardContr64.call(_activeDashboardContr65,blockUid);case 25:if(newBlockUid){(_activeDashboardContr66=(_activeDashboardContr67=activeDashboardController).removeTask)===null||_activeDashboardContr66===void 0||_activeDashboardContr66.call(_activeDashboardContr67,newBlockUid);}if(!((_activeDashboardContr68=(_activeDashboardContr69=activeDashboardController).isOpen)!==null&&_activeDashboardContr68!==void 0&&_activeDashboardContr68.call(_activeDashboardContr69))){_context73.n=26;break;}_context73.n=26;return(_activeDashboardContr70=(_activeDashboardContr71=activeDashboardController).refresh)===null||_activeDashboardContr70===void 0?void 0:_activeDashboardContr70.call(_activeDashboardContr71,{reason:\"undo\"});case 26:toast(t([\"toasts\",\"undoSuccess\"],getLanguageSetting())||\"Changes un-done successfully\");void syncPillsForSurface(lastAttrSurface);case 27:return _context73.a(2);}},_callee73,null,[[19,21],[14,16],[7,12],[4,6],[1,3]]);}));return _performUndo.apply(this,arguments);}function restoreChildAttr(_x79,_x80,_x81,_x82){return _restoreChildAttr.apply(this,arguments);}function _restoreChildAttr(){_restoreChildAttr=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee74(blockUid,type,beforeInfo,changeInfo){var attrNames,label,value,_args74=arguments,_t69,_t70;return _regenerator().w(function(_context74){while(1)switch(_context74.p=_context74.n){case 0:attrNames=_args74.length>4&&_args74[4]!==undefined?_args74[4]:resolveAttributeNames();label=getAttrLabel(type,attrNames)||type;if(!(beforeInfo!==null&&beforeInfo!==void 0&&beforeInfo.uid)){_context74.n=5;break;}value=beforeInfo.value||\"\";_context74.p=1;_context74.n=2;return window.roamAlphaAPI.updateBlock({block:{uid:beforeInfo.uid,string:\"\".concat(label,\":: \").concat(value)}});case 2:_context74.n=4;break;case 3:_context74.p=3;_t69=_context74.v;console.warn(\"[RecurringTasks] restore child attr failed\",_t69);case 4:return _context74.a(2);case 5:if(!(changeInfo!==null&&changeInfo!==void 0&&changeInfo.uid)){_context74.n=10;break;}_context74.p=6;_context74.n=7;return deleteBlock(changeInfo.uid);case 7:_context74.n=9;break;case 8:_context74.p=8;_t70=_context74.v;console.warn(\"[RecurringTasks] remove child attr failed\",_t70);case 9:_context74.n=11;break;case 10:_context74.n=11;return removeChildAttr(blockUid,label);case 11:return _context74.a(2);}},_callee74,null,[[6,8],[1,3]]);}));return _restoreChildAttr.apply(this,arguments);}function spawnNextOccurrence(_x83,_x84,_x85,_x86){return _spawnNextOccurrence.apply(this,arguments);}// ========================= Destination helpers =========================\nfunction _spawnNextOccurrence(){_spawnNextOccurrence=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee75(prevBlock,meta,nextDueDate,set){var _meta$childAttrMap3;var nextDueStr,startOffsetMs,deferOffsetMs,nextStartDate,nextDeferDate,nextStartStr,nextDeferStr,removalKeys,prevText,seriesId,placementDate,targetPageUid,parentBlock,dnpTitle,dnpUid,_prevBlock$page,parent,_dnpTitle2,taskLine,newUid,advanceEntry,_t71;return _regenerator().w(function(_context75){while(1)switch(_context75.n){case 0:nextDueStr=formatDate(nextDueDate,set);startOffsetMs=(meta===null||meta===void 0?void 0:meta.start)instanceof Date&&(meta===null||meta===void 0?void 0:meta.due)instanceof Date?meta.start.getTime()-meta.due.getTime():null;deferOffsetMs=(meta===null||meta===void 0?void 0:meta.defer)instanceof Date&&(meta===null||meta===void 0?void 0:meta.due)instanceof Date?meta.defer.getTime()-meta.due.getTime():null;nextStartDate=startOffsetMs!=null?applyOffsetToDate(nextDueDate,startOffsetMs):null;nextDeferDate=deferOffsetMs!=null?applyOffsetToDate(nextDueDate,deferOffsetMs):null;nextStartStr=nextStartDate?formatDate(nextStartDate,set):null;nextDeferStr=nextDeferDate?formatDate(nextDeferDate,set):null;removalKeys=_toConsumableArray(new Set([].concat(_toConsumableArray(set.attrNames.repeatRemovalKeys),_toConsumableArray(set.attrNames.dueRemovalKeys),_toConsumableArray(set.attrNames.startRemovalKeys),_toConsumableArray(set.attrNames.deferRemovalKeys),[\"completed\"])));prevText=removeInlineAttributes(prevBlock.string||\"\",removalKeys);seriesId=meta.rtId||shortId();if(meta.rtId){_context75.n=1;break;}_context75.n=1;return updateBlockProps(prevBlock.uid,{rt:{id:seriesId,tz:set.timezone}});case 1:placementDate=pickPlacementDate({start:nextStartDate,defer:nextDeferDate,due:nextDueDate})||nextDueDate;_context75.n=2;return chooseTargetPageUid(placementDate,prevBlock,set);case 2:targetPageUid=_context75.v;_context75.n=3;return getBlock(targetPageUid);case 3:parentBlock=_context75.v;if(parentBlock){_context75.n=6;break;}_context75.n=4;return new Promise(function(resolve){return setTimeout(resolve,80);});case 4:_context75.n=5;return getBlock(targetPageUid);case 5:parentBlock=_context75.v;case 6:if(parentBlock){_context75.n=17;break;}if(!(set.destination===\"DNP under heading\"&&set.dnpHeading)){_context75.n=10;break;}dnpTitle=toDnpTitle(placementDate);_context75.n=7;return getOrCreatePageUid(dnpTitle);case 7:dnpUid=_context75.v;_context75.n=8;return getOrCreateChildUnderHeading(dnpUid,set.dnpHeading);case 8:targetPageUid=_context75.v;_context75.n=9;return getBlock(targetPageUid);case 9:parentBlock=_context75.v;_context75.n=17;break;case 10:if(!(set.destination===\"Same Page\")){_context75.n=14;break;}_t71=(_prevBlock$page=prevBlock.page)===null||_prevBlock$page===void 0?void 0:_prevBlock$page.uid;if(_t71){_context75.n=12;break;}_context75.n=11;return getOrCreatePageUid(\"Misc\");case 11:_t71=_context75.v;case 12:parent=_t71;targetPageUid=parent;_context75.n=13;return getBlock(targetPageUid);case 13:parentBlock=_context75.v;_context75.n=17;break;case 14:_dnpTitle2=toDnpTitle(placementDate);_context75.n=15;return getOrCreatePageUid(_dnpTitle2);case 15:targetPageUid=_context75.v;_context75.n=16;return getBlock(targetPageUid);case 16:parentBlock=_context75.v;case 17:if(parentBlock){_context75.n=18;break;}throw new Error(\"Parent entity \".concat(targetPageUid,\" unavailable\"));case 18:taskLine=normalizeToTodoMacro(prevText).trim();newUid=window.roamAlphaAPI.util.generateUID();_context75.n=19;return createBlock(targetPageUid,0,taskLine,newUid);case 19:_context75.n=20;return ensureChildAttrForType(newUid,\"repeat\",meta.repeat,set.attrNames);case 20:_context75.n=21;return ensureChildAttrForType(newUid,\"due\",nextDueStr,set.attrNames);case 21:if(!nextStartStr){_context75.n=23;break;}_context75.n=22;return ensureChildAttrForType(newUid,\"start\",nextStartStr,set.attrNames);case 22:_context75.n=24;break;case 23:_context75.n=24;return removeChildAttrsForType(newUid,\"start\",set.attrNames);case 24:if(!nextDeferStr){_context75.n=26;break;}_context75.n=25;return ensureChildAttrForType(newUid,\"defer\",nextDeferStr,set.attrNames);case 25:_context75.n=27;break;case 26:_context75.n=27;return removeChildAttrsForType(newUid,\"defer\",set.attrNames);case 27:advanceEntry=(_meta$childAttrMap3=meta.childAttrMap)===null||_meta$childAttrMap3===void 0?void 0:_meta$childAttrMap3[ADVANCE_ATTR.toLowerCase()];if(!(advanceEntry!==null&&advanceEntry!==void 0&&advanceEntry.value)){_context75.n=29;break;}_context75.n=28;return ensureChildAttr(newUid,ADVANCE_ATTR,advanceEntry.value,getChildOrderForType(\"advance\"));case 28:_context75.n=29;return enforceChildAttrOrder(newUid,set.attrNames);case 29:_context75.n=30;return updateBlockProps(newUid,{repeat:meta.repeat,due:nextDueStr,start:nextStartStr||undefined,defer:nextDeferStr||undefined,rt:{id:shortId(),parent:seriesId,tz:set.timezone}});case 30:return _context75.a(2,newUid);}},_callee75);}));return _spawnNextOccurrence.apply(this,arguments);}function chooseTargetPageUid(_x87,_x88,_x89){return _chooseTargetPageUid.apply(this,arguments);}function _chooseTargetPageUid(){_chooseTargetPageUid=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee76(anchorDate,prevBlock,set){var _prevBlock$page2,targetDate,dnpTitle,dnpUid,headingUid,_t72;return _regenerator().w(function(_context76){while(1)switch(_context76.n){case 0:if(!(set.destination===\"Same Page\")){_context76.n=3;break;}_t72=(_prevBlock$page2=prevBlock.page)===null||_prevBlock$page2===void 0?void 0:_prevBlock$page2.uid;if(_t72){_context76.n=2;break;}_context76.n=1;return getOrCreatePageUid(\"Misc\");case 1:_t72=_context76.v;case 2:return _context76.a(2,_t72);case 3:targetDate=anchorDate instanceof Date&&!Number.isNaN(anchorDate.getTime())?anchorDate:todayLocal();dnpTitle=toDnpTitle(targetDate);_context76.n=4;return getOrCreatePageUid(dnpTitle);case 4:dnpUid=_context76.v;if(!(set.destination===\"DNP under heading\"&&set.dnpHeading)){_context76.n=6;break;}_context76.n=5;return getOrCreateChildUnderHeading(dnpUid,set.dnpHeading);case 5:headingUid=_context76.v;return _context76.a(2,headingUid||dnpUid);case 6:return _context76.a(2,dnpUid);}},_callee76);}));return _chooseTargetPageUid.apply(this,arguments);}function toDnpTitle(d){var _window$roamAlphaAPI5;var util=(_window$roamAlphaAPI5=window.roamAlphaAPI)===null||_window$roamAlphaAPI5===void 0?void 0:_window$roamAlphaAPI5.util;if(util!==null&&util!==void 0&&util.dateToPageTitle){try{return util.dateToPageTitle(d);}catch(err){console.warn(\"[RecurringTasks] dateToPageTitle failed, falling back to ISO\",err);}}// Fallback: ISO style\nreturn\"\".concat(d.getFullYear(),\"-\").concat(String(d.getMonth()+1).padStart(2,\"0\"),\"-\").concat(String(d.getDate()).padStart(2,\"0\"));}function parseDateFromText(value,set){if(typeof value!==\"string\"||!value.trim())return{date:null,text:null};var original=value.trim();var cleaned=stripTimeFromDateText(original);var dt=parseRoamDate(cleaned)||parseRelativeDateText(cleaned,set.weekStartCode);if(!dt&&hasTimeOnlyHint(original)){dt=pickAnchorDateFromTimeHint(original,set);}if(!(dt instanceof Date)||Number.isNaN(dt.getTime()))return{date:null,text:null};return{date:dt,text:formatDate(dt,set)};}function createQuickTaskFromParsed(_x90){return _createQuickTaskFromParsed.apply(this,arguments);}function _createQuickTaskFromParsed(){_createQuickTaskFromParsed=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee77(parsed){var _activeDashboardContr72,_activeDashboardContr73;var rawInput,set,title,cleanedTitle,todoString,repeatVal,normalized,dueInfo,startInfo,deferInfo,anchorDate,targetPageUid,newUid,props,hasAiMeta,_args77=arguments;return _regenerator().w(function(_context77){while(1)switch(_context77.n){case 0:rawInput=_args77.length>1&&_args77[1]!==undefined?_args77[1]:\"\";if(parsed){_context77.n=1;break;}return _context77.a(2,false);case 1:set=S();title=typeof parsed.title===\"string\"?parsed.title.trim():\"\";if(title){_context77.n=2;break;}return _context77.a(2,false);case 2:cleanedTitle=stripSchedulingFromTitle(title,parsed);todoString=normalizeToTodoMacro(cleanedTitle);repeatVal=\"\";if(typeof parsed.repeatRule===\"string\"&&parsed.repeatRule.trim()){normalized=normalizeRepeatRuleText(parsed.repeatRule)||parsed.repeatRule.trim();if(parseRuleText(normalized,set)){repeatVal=normalized;}}dueInfo=parseDateFromText(parsed.dueDateText||\"\",set);startInfo=parseDateFromText(parsed.startDateText||\"\",set);deferInfo=parseDateFromText(parsed.deferDateText||\"\",set);anchorDate=dueInfo.date||deferInfo.date||startInfo.date||todayLocal();_context77.n=3;return ensureTargetReady(anchorDate,{page:{uid:null}},set);case 3:targetPageUid=_context77.v;if(targetPageUid){_context77.n=5;break;}_context77.n=4;return chooseTargetPageUid(anchorDate,{page:{uid:null}},set);case 4:targetPageUid=_context77.v;case 5:if(targetPageUid){_context77.n=6;break;}console.warn(\"[BetterTasks] quick add parsed task missing target page\");toast(t([\"toasts\",\"pageNotFound\"],getLanguageSetting())||\"Couldn't find a page to create that task.\");return _context77.a(2,false);case 6:newUid=window.roamAlphaAPI.util.generateUID();_context77.n=7;return createBlock(targetPageUid,0,todoString,newUid);case 7:props={rt:{id:shortId(),tz:set.timezone}};_context77.n=8;return updateBlockProps(newUid,props);case 8:if(!repeatVal){_context77.n=10;break;}_context77.n=9;return ensureChildAttrForType(newUid,\"repeat\",repeatVal,set.attrNames);case 9:_context77.n=11;break;case 10:_context77.n=11;return removeChildAttrsForType(newUid,\"repeat\",set.attrNames);case 11:if(!dueInfo.text){_context77.n=13;break;}_context77.n=12;return ensureChildAttrForType(newUid,\"due\",dueInfo.text,set.attrNames);case 12:_context77.n=14;break;case 13:_context77.n=14;return removeChildAttrsForType(newUid,\"due\",set.attrNames);case 14:if(!startInfo.text){_context77.n=16;break;}_context77.n=15;return ensureChildAttrForType(newUid,\"start\",startInfo.text,set.attrNames);case 15:_context77.n=17;break;case 16:_context77.n=17;return removeChildAttrsForType(newUid,\"start\",set.attrNames);case 17:if(!deferInfo.text){_context77.n=19;break;}_context77.n=18;return ensureChildAttrForType(newUid,\"defer\",deferInfo.text,set.attrNames);case 18:_context77.n=20;break;case 19:_context77.n=20;return removeChildAttrsForType(newUid,\"defer\",set.attrNames);case 20:hasAiMeta=!!((parsed.project||\"\").trim()||(parsed.context||\"\").trim()||(parsed.priority||\"\").trim()||(parsed.energy||\"\").trim());if(!hasAiMeta){_context77.n=21;break;}_context77.n=21;return applyMetadataFromPrompt(newUid,{project:parsed.project||\"\",context:parsed.context||\"\",priority:parsed.priority||\"\",energy:parsed.energy||\"\"},set.attrNames);case 21:scheduleSurfaceSync(set.attributeSurface);(_activeDashboardContr72=activeDashboardController)===null||_activeDashboardContr72===void 0||(_activeDashboardContr73=_activeDashboardContr72.notifyBlockChange)===null||_activeDashboardContr73===void 0||_activeDashboardContr73.call(_activeDashboardContr72,newUid,{bypassFilters:true});return _context77.a(2,true);}},_callee77);}));return _createQuickTaskFromParsed.apply(this,arguments);}function createQuickTaskFromPrompt(_x91){return _createQuickTaskFromPrompt.apply(this,arguments);}// === Merged + extended parser ===\nfunction _createQuickTaskFromPrompt(){_createQuickTaskFromPrompt=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee78(promptResult){var _activeDashboardContr74,_activeDashboardContr75;var set,attrNames,title,cleanedTitle,todoString,repeatVal,dueDate,startDate,deferDate,dueStr,startStr,deferStr,anchorDate,targetPageUid,newUid,props;return _regenerator().w(function(_context78){while(1)switch(_context78.n){case 0:if(promptResult){_context78.n=1;break;}return _context78.a(2,false);case 1:set=S();attrNames=set.attrNames;title=typeof promptResult.taskText===\"string\"&&promptResult.taskText.trim()||typeof promptResult.taskTextRaw===\"string\"&&promptResult.taskTextRaw.trim()||\"\";if(title){_context78.n=2;break;}toast(t([\"toasts\",\"taskTextRequired\"],getLanguageSetting())||\"Task text is required.\");return _context78.a(2,false);case 2:cleanedTitle=stripSchedulingFromTitle(title,null);todoString=normalizeToTodoMacro(cleanedTitle);repeatVal=promptResult.repeat||\"\";if(!(repeatVal&&!parseRuleText(repeatVal,set))){_context78.n=3;break;}toast(t([\"toasts\",\"unableUnderstandRepeat\"],getLanguageSetting())||\"Unable to understand that repeat rule.\");return _context78.a(2,false);case 3:dueDate=promptResult.dueDate instanceof Date&&!Number.isNaN(promptResult.dueDate.getTime())?promptResult.dueDate:promptResult.due?parseRoamDate(promptResult.due):null;startDate=promptResult.startDate instanceof Date&&!Number.isNaN(promptResult.startDate.getTime())?promptResult.startDate:promptResult.start?parseRoamDate(promptResult.start):null;deferDate=promptResult.deferDate instanceof Date&&!Number.isNaN(promptResult.deferDate.getTime())?promptResult.deferDate:promptResult.defer?parseRoamDate(promptResult.defer):null;dueStr=dueDate?formatDate(dueDate,set):null;startStr=startDate?formatDate(startDate,set):null;deferStr=deferDate?formatDate(deferDate,set):null;anchorDate=dueDate||deferDate||startDate||todayLocal();_context78.n=4;return ensureTargetReady(anchorDate,{page:{uid:null}},set);case 4:targetPageUid=_context78.v;if(targetPageUid){_context78.n=6;break;}_context78.n=5;return chooseTargetPageUid(anchorDate,{page:{uid:null}},set);case 5:targetPageUid=_context78.v;case 6:if(targetPageUid){_context78.n=7;break;}console.warn(\"[BetterTasks] quick add prompt task missing target page\");toast(t([\"toasts\",\"pageNotFound\"],getLanguageSetting())||\"Couldn't find a page to create that task.\");return _context78.a(2,false);case 7:newUid=window.roamAlphaAPI.util.generateUID();_context78.n=8;return createBlock(targetPageUid,0,todoString,newUid);case 8:props={rt:{id:shortId(),tz:set.timezone}};_context78.n=9;return updateBlockProps(newUid,{rt:props.rt});case 9:if(!repeatVal){_context78.n=11;break;}_context78.n=10;return ensureChildAttrForType(newUid,\"repeat\",repeatVal,attrNames);case 10:_context78.n=12;break;case 11:_context78.n=12;return removeChildAttrsForType(newUid,\"repeat\",attrNames);case 12:if(!dueStr){_context78.n=14;break;}_context78.n=13;return ensureChildAttrForType(newUid,\"due\",dueStr,attrNames);case 13:_context78.n=15;break;case 14:_context78.n=15;return removeChildAttrsForType(newUid,\"due\",attrNames);case 15:if(!startStr){_context78.n=17;break;}_context78.n=16;return ensureChildAttrForType(newUid,\"start\",startStr,attrNames);case 16:_context78.n=18;break;case 17:_context78.n=18;return removeChildAttrsForType(newUid,\"start\",attrNames);case 18:if(!deferStr){_context78.n=20;break;}_context78.n=19;return ensureChildAttrForType(newUid,\"defer\",deferStr,attrNames);case 19:_context78.n=21;break;case 20:_context78.n=21;return removeChildAttrsForType(newUid,\"defer\",attrNames);case 21:_context78.n=22;return applyMetadataFromPrompt(newUid,promptResult,attrNames);case 22:scheduleSurfaceSync(set.attributeSurface);(_activeDashboardContr74=activeDashboardController)===null||_activeDashboardContr74===void 0||(_activeDashboardContr75=_activeDashboardContr74.notifyBlockChange)===null||_activeDashboardContr75===void 0||_activeDashboardContr75.call(_activeDashboardContr74,newUid,{bypassFilters:true});return _context78.a(2,true);}},_callee78);}));return _createQuickTaskFromPrompt.apply(this,arguments);}function parseRuleText(s){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!s)return null;var t=s.trim().replace(/\\s+/g,\" \").toLowerCase();var weekStartCode=normalizeWeekStartCode(options.weekStartCode||options.weekStart||getWeekStartSetting());var ordinalHint=/\\b(first|second|third|fourth|fifth|last|day|month)\\b/.test(t)||/\\d/.test(t);if(!ordinalHint){var quickSet=parseAbbrevSet(t);if(quickSet)return{kind:\"WEEKLY\",interval:1,byDay:quickSet};var looseDays=normalizeByDayList(t,weekStartCode);if(looseDays.length)return{kind:\"WEEKLY\",interval:1,byDay:looseDays};}var keywordInterval=keywordIntervalFromText(t);if(keywordInterval){return{kind:\"MONTHLY_DAY\",interval:keywordInterval};}// 0) Simple daily & weekday/weekend anchors\nif(t===\"daily\"||t===\"every day\")return{kind:\"DAILY\",interval:1};if(t===\"every other day\"||t===\"every second day\"||t===\"every two days\"||t===\"second daily\")return{kind:\"DAILY\",interval:2};if(t===\"every third day\"||t===\"every three days\")return{kind:\"DAILY\",interval:3};if(t===\"every fourth day\"||t===\"every four days\")return{kind:\"DAILY\",interval:4};if(t===\"every fifth day\"||t===\"every five days\")return{kind:\"DAILY\",interval:5};if(t===\"every weekday\"||t===\"weekdays\"||t===\"on weekdays\"||t===\"business days\"||t===\"workdays\")return{kind:\"WEEKDAY\"};if(t===\"every weekend\"||t===\"weekend\"||t===\"weekends\")return{kind:\"WEEKLY\",interval:1,byDay:[\"SA\",\"SU\"]};// 1) \"every <dow>\" (singular/plural) â€” use your DOW_MAP and aliases\nvar singleDow=Object.keys(DOW_ALIASES).find(function(a){return t===\"every \".concat(a)||t===\"every \".concat(a,\"s\");});if(singleDow)return{kind:\"WEEKLY\",interval:1,byDay:[dowFromAlias(singleDow)]};// 2) \"every N days\"\nvar m=t.match(/^every (\\d+)\\s*days?$/);if(m)return{kind:\"DAILY\",interval:parseInt(m[1],10)};// 3) \"every N weekdays/business days\"\nm=t.match(/^every (\\d+)\\s*(?:weekdays?|business days?)$/);if(m)return{kind:\"BUSINESS_DAILY\",interval:parseInt(m[1],10)};// 4) Weekly base words + biweekly/fortnightly\nif(t===\"weekly\"||t===\"every week\")return{kind:\"WEEKLY\",interval:1,byDay:null};if(t===\"every other week\"||t===\"every second week\"||t===\"biweekly\"||t===\"fortnightly\"||t===\"every fortnight\")return{kind:\"WEEKLY\",interval:2,byDay:null};m=t.match(/^every\\s+(other|second|2nd)\\s+([a-z]+)s?$/);if(m){var dowCode=dowFromAlias(m[2]);if(dowCode)return{kind:\"WEEKLY\",interval:2,byDay:[dowCode]};}m=t.match(/^every\\s+(\\d+)(?:st|nd|rd|th)?\\s+([a-z]+)s?$/);if(m){var intervalNum=parseInt(m[1],10);var _dowCode=dowFromAlias(m[2]);if(_dowCode&&intervalNum>=1){if(intervalNum===1)return{kind:\"WEEKLY\",interval:1,byDay:[_dowCode]};return{kind:\"WEEKLY\",interval:intervalNum,byDay:[_dowCode]};}}// 5) Weekly with \"on â€¦\"\nvar weeklyOn=t.match(/^(?:every week|weekly)\\s+on\\s+(.+)$/);if(weeklyOn){var byDay=normalizeByDayList(weeklyOn[1],weekStartCode);return{kind:\"WEEKLY\",interval:1,byDay:byDay.length?byDay:null};}// 5b) \"every N weeks (on â€¦)?\"\nm=t.match(/^every (\\d+)\\s*weeks?(?:\\s*on\\s*(.+))?$/);if(m){var interval=parseInt(m[1],10);var _byDay=m[2]?normalizeByDayList(m[2],weekStartCode):null;return{kind:\"WEEKLY\",interval:interval,byDay:_byDay&&_byDay.length?_byDay:null};}// 5c) \"weekly on â€¦\"\nm=t.match(/^weekly on (.+)$/);if(m){var _byDay2=normalizeByDayList(m[1],weekStartCode);if(_byDay2.length)return{kind:\"WEEKLY\",interval:1,byDay:_byDay2};}// 5d) Bare \"every <list/range/shorthand>\"\nif(t.startsWith(\"every \")){var after=t.slice(6).trim();var _byDay3=normalizeByDayList(after,weekStartCode);if(_byDay3.length)return{kind:\"WEEKLY\",interval:1,byDay:_byDay3};// also accept \"every monday(s)\" etc. via your earlier path already handled above\n}// 6) Monthly: explicit EOM\nif(t===\"last day of the month\"||t===\"last day of each month\"||t===\"last day of every month\"||t===\"last day each month\"||t===\"last day every month\"||t===\"eom\")return{kind:\"MONTHLY_LAST_DAY\"};// 7) Monthly: semimonthly / multi-day\nm=t.match(/^(?:on\\s+)?(?:the\\s+)?(\\d{1,2})(?:st|nd|rd|th)?\\s*(?:,|and|&)\\s*(\\d{1,2})(?:st|nd|rd|th)?\\s+(?:of\\s+)?(?:each|every)\\s+month$/);if(m){var d1=parseInt(m[1],10),d2=parseInt(m[2],10);return{kind:\"MONTHLY_MULTI_DAY\",days:[d1,d2]};}m=t.match(/^(?:on\\s+)?(?:the\\s+)?(\\d{1,2})(?:st|nd|rd|th)?\\s+and\\s+last\\s+day\\s+(?:of\\s+)?(?:each|every)\\s+month$/);if(m){var d=parseInt(m[1],10);return{kind:\"MONTHLY_MIXED_DAY\",days:[d],last:true};}m=t.match(/^on\\s+the\\s+(.+)\\s+of\\s+(?:each|every)\\s+month$/);if(m){var parts=splitList(m[1].replace(/\\b(?:and|&)\\b/g,\",\"));var days=parts.map(function(x){return x.replace(/(st|nd|rd|th)$/i,\"\");}).map(function(x){return parseInt(x,10);}).filter(function(n){return Number.isInteger(n)&&n>=1&&n<=31;});if(days.length>=1)return{kind:\"MONTHLY_MULTI_DAY\",days:days};}// 8) Monthly: your existing single-day variants\nif(t===\"monthly\")return{kind:\"MONTHLY_DAY\",day:todayLocal().getDate()};m=t.match(/^every month on day (\\d{1,2})$/);if(m)return{kind:\"MONTHLY_DAY\",day:parseInt(m[1],10)};m=t.match(/^(?:the\\s+)?(\\d{1,2}|1st|2nd|3rd|4th)\\s+day\\s+of\\s+(?:each|every)\\s+month$/);if(m)return{kind:\"MONTHLY_DAY\",day:ordFromText(m[1])};m=t.match(/^day\\s+(\\d{1,2})\\s+(?:of|in)?\\s*(?:each|every)\\s+month$/);if(m)return{kind:\"MONTHLY_DAY\",day:parseInt(m[1],10)};// 9) Monthly: ordinal weekday (incl. compact), plus penultimate/weekday\nm=t.match(/^(?:every month on the|on the|every month the|the)\\s+(1st|first|2nd|second|3rd|third|4th|fourth|last)\\s+([a-z]+)$/);if(m){var nth=m[1].toLowerCase();var dow=dowFromAlias(m[2]);if(dow)return{kind:\"MONTHLY_NTH\",nth:nth,dow:dow};}m=t.match(/^(?:the\\s+)?(1st|first|2nd|second|3rd|third|4th|fourth|last)\\s+([a-z]+)\\s+(?:of\\s+)?(?:each|every)\\s+month$/);if(m){var _nth=m[1].toLowerCase();var _dow=dowFromAlias(m[2]);if(_dow)return{kind:\"MONTHLY_NTH\",nth:_nth,dow:_dow};}m=t.match(/^(?:the\\s+)?(1st|first|2nd|second|3rd|third|4th|fourth)\\s+and\\s+(1st|first|2nd|second|3rd|third|4th|fourth)\\s+([a-z]+)\\s+(?:of\\s+)?(?:each|every)\\s+month$/);if(m){var nths=[m[1].toLowerCase(),m[2].toLowerCase()];var _dow2=dowFromAlias(m[3]);if(_dow2)return{kind:\"MONTHLY_MULTI_NTH\",nths:nths,dow:_dow2};}m=t.match(/^(?:second\\s+last|penultimate)\\s+([a-z]+)\\s+(?:of\\s+)?(?:each|every)\\s+month$/);if(m){var _dow3=dowFromAlias(m[1]);if(_dow3)return{kind:\"MONTHLY_NTH_FROM_END\",nth:2,dow:_dow3};}m=t.match(/^(first|last)\\s+weekday\\s+(?:of\\s+)?(?:each|every)\\s+month$/);if(m)return{kind:\"MONTHLY_NTH_WEEKDAY\",nth:m[1].toLowerCase()};// 10) Every N months (date or ordinal weekday)\nm=t.match(/^every (\\d+)\\s*months?(?:\\s+on\\s+the\\s+(\\d{1,2})(?:st|nd|rd|th)?)?$/);if(m){var _interval=parseInt(m[1],10);var day=m[2]?parseInt(m[2],10):todayLocal().getDate();return{kind:\"MONTHLY_DAY\",interval:_interval,day:day};}m=t.match(/^every (\\d+)\\s*months?\\s+on\\s+the\\s+(1st|first|2nd|second|3rd|third|4th|fourth|last)\\s+([a-z]+)$/);if(m){var _interval2=parseInt(m[1],10);var _nth2=m[2].toLowerCase();var _dow4=dowFromAlias(m[3]);if(_dow4)return{kind:\"MONTHLY_NTH\",interval:_interval2,nth:_nth2,dow:_dow4};}// 11) Quarterly / semiannual / annual synonyms\nvar yearlyKeyword=t.match(/^(annually|yearly|every year)$/);if(yearlyKeyword){return{kind:\"YEARLY\"};}// 12) Yearly: explicit month/day or ordinal weekday-in-month\nm=t.match(/^(?:every|each)\\s+([a-z]+)\\s+(\\d{1,2})(?:st|nd|rd|th)?$/);if(m){var month=monthFromText(m[1]);var _day=parseInt(m[2],10);if(month)return{kind:\"YEARLY\",month:month,day:_day};}m=t.match(/^every\\s+(\\d{1,2})(?:st|nd|rd|th)?\\s+([a-z]+)$/);if(m){var _day2=parseInt(m[1],10);var _month=monthFromText(m[2]);if(_month)return{kind:\"YEARLY\",month:_month,day:_day2};}m=t.match(/^on\\s+(\\d{1,2})(?:st|nd|rd|th)?\\s+([a-z]+)\\s+(?:every\\s+year|annually|yearly)$/);if(m){var _day3=parseInt(m[1],10);var _month2=monthFromText(m[2]);if(_month2)return{kind:\"YEARLY\",month:_month2,day:_day3};}m=t.match(/^([a-z]+)\\s+(\\d{1,2})(?:st|nd|rd|th)?$/);if(m){var _month3=monthFromText(m[1]);var _day4=parseInt(m[2],10);if(_month3&&_day4)return{kind:\"YEARLY\",month:_month3,day:_day4};}m=t.match(/^(\\d{1,2})(?:st|nd|rd|th)?\\s+([a-z]+)\\s+(?:every\\s+year)?$/);if(m){var _day5=parseInt(m[1],10);var _month4=monthFromText(m[2]);if(_month4&&_day5)return{kind:\"YEARLY\",month:_month4,day:_day5};}m=t.match(/^(?:the\\s+)?(1st|first|2nd|second|3rd|third|4th|fourth|last)\\s+([a-z]+)\\s+of\\s+([a-z]+)\\s+(?:every\\s+year|annually|yearly)?$/);if(m){var _nth3=m[1].toLowerCase();var _dow5=dowFromAlias(m[2]);var _month5=monthFromText(m[3]);if(_dow5&&_month5)return{kind:\"YEARLY_NTH\",month:_month5,nth:_nth3,dow:_dow5};}// No match\nreturn null;}function resolveMonthlyInterval(rule){var raw=Number.parseInt(rule===null||rule===void 0?void 0:rule.interval,10);return Number.isFinite(raw)&&raw>0?raw:1;}function resolveMonthlyDay(rule,meta){if(Number.isInteger(rule===null||rule===void 0?void 0:rule.day)&&rule.day>=1)return rule.day;var due=(meta===null||meta===void 0?void 0:meta.due)instanceof Date&&!Number.isNaN(meta.due.getTime())?meta.due:null;if(due)return due.getDate();return todayLocal().getDate();}function computeNextDue(meta,set){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var ruleOverride=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var rule=ruleOverride||parseRuleText(meta.repeat,set);if(rule){clearRepeatParseFailure((meta===null||meta===void 0?void 0:meta.uid)||null);}if(!rule){console.warn(\"[RecurringTasks] Unable to parse repeat rule \\\"\".concat(meta.repeat,\"\\\"\"));noteRepeatParseFailure((meta===null||meta===void 0?void 0:meta.uid)||null);return null;}var base=set.advanceFrom===\"completion\"?todayLocal():meta.due||todayLocal();var next=null;switch(rule.kind){case\"DAILY\":next=addDaysLocal(base,rule.interval||1);break;case\"WEEKDAY\":next=nextWeekday(base);break;case\"WEEKLY\":next=nextWeekly(base,rule,set);break;case\"MONTHLY_DAY\":{var interval=resolveMonthlyInterval(rule);var day=resolveMonthlyDay(rule,meta);next=nextMonthOnDay(base,day,interval);break;}case\"MONTHLY_NTH\":{var _interval3=resolveMonthlyInterval(rule);next=nextMonthOnNthDow(base,rule.nth,rule.dow,_interval3);break;}case\"MONTHLY_LAST_DAY\":next=nextMonthLastDay(base);break;case\"MONTHLY_MULTI_DAY\":next=nextMonthlyMultiDay(base,rule);break;case\"MONTHLY_MIXED_DAY\":next=nextMonthlyMixedDay(base,rule);break;case\"MONTHLY_MULTI_NTH\":next=nextMonthlyMultiNth(base,rule);break;case\"MONTHLY_NTH_FROM_END\":next=nextMonthlyNthFromEnd(base,rule);break;case\"MONTHLY_NTH_WEEKDAY\":next=nextMonthlyWeekday(base,rule);break;case\"YEARLY\":next=nextYearlyOnDay(base,rule,meta);break;case\"YEARLY_NTH\":next=nextYearlyNthDow(base,rule,meta);break;default:next=null;}if(!next)return null;var today=todayLocal();if(next<today&&depth<36){var updatedMeta=_objectSpread(_objectSpread({},meta),{},{due:next});return computeNextDue(updatedMeta,set,depth+1,ruleOverride);}return next;}function nextWeekday(d){var x=addDaysLocal(d,1);while(isWeekend(x))x=addDaysLocal(x,1);return x;}function nextWeekly(base,rule,set){var interval=Math.max(1,rule.interval||1);var weekStartCode=set&&(set.weekStartCode||normalizeWeekStartCode(set.weekStart))||DEFAULT_WEEK_START_CODE;if(!rule.byDay||rule.byDay.length===0){return addDaysLocal(base,7*interval);}var offsets=getOrderedWeekdayOffsets(rule.byDay,weekStartCode);if(!offsets.length)return addDaysLocal(base,7*interval);var weekAnchor=startOfWeek(base,weekStartCode);var _iterator11=_createForOfIteratorHelper(offsets),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var offset=_step11.value;var candidate=addDaysLocal(weekAnchor,offset);if(candidate>base)return candidate;}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}var nextAnchor=addDaysLocal(weekAnchor,7*interval);return addDaysLocal(nextAnchor,offsets[0]);}function nextMonthOnDay(base,day){var interval=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var step=Number.isFinite(interval)&&interval>0?Math.trunc(interval):1;var year=base.getFullYear();var monthIndex=base.getMonth();var currentMonthCandidate=new Date(year,monthIndex,clampDayInMonth(year,monthIndex,day),12,0,0,0);if(currentMonthCandidate>base&&step===1)return currentMonthCandidate;var _advanceMonth=advanceMonth(year,monthIndex,step);year=_advanceMonth.year;monthIndex=_advanceMonth.month;var safeDay=clampDayInMonth(year,monthIndex,day);return new Date(year,monthIndex,safeDay,12,0,0,0);}function nextMonthOnNthDow(base,nthText,dowCode){var interval=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var nthValue=ordFromText(nthText);if(nthValue==null)return null;var step=Number.isFinite(interval)&&interval>0?Math.trunc(interval):1;var year=base.getFullYear();var monthIndex=base.getMonth();var candidate=computeNthDowForMonth(year,monthIndex,nthValue,dowCode);if(candidate&&candidate>base&&step===1){return candidate;}for(var attempts=0;attempts<48;attempts++){var _advanceMonth2=advanceMonth(year,monthIndex,step);year=_advanceMonth2.year;monthIndex=_advanceMonth2.month;candidate=computeNthDowForMonth(year,monthIndex,nthValue,dowCode);if(candidate)return candidate;}return null;}function clampDayInMonth(year,monthIndex,desired){var lastDay=new Date(year,monthIndex+1,0,12,0,0,0).getDate();var numeric=Number.isFinite(desired)?Math.trunc(desired):lastDay;if(numeric<1)return 1;if(numeric>lastDay)return lastDay;return numeric;}function applyOffsetToDate(base,offsetMs){if(!(base instanceof Date)||Number.isNaN(base.getTime()))return null;if(!Number.isFinite(offsetMs))return null;var next=new Date(base.getTime()+offsetMs);next.setHours(12,0,0,0);return next;}function advanceMonth(year,monthIndex,step){var nextMonth=monthIndex+step;var nextYear=year;while(nextMonth>11){nextMonth-=12;nextYear+=1;}while(nextMonth<0){nextMonth+=12;nextYear-=1;}return{year:nextYear,month:nextMonth};}function nextMonthLastDay(base){var y=base.getFullYear();var m=base.getMonth();var thisMonthEom=new Date(y,m+1,0,12,0,0,0);var isAtOrAfterEom=base.getDate()>=thisMonthEom.getDate();var targetMonth=isAtOrAfterEom?m+2:m+1;return new Date(y,targetMonth,0,12,0,0,0);}function resolveYearlyMonth(rule,meta){if(Number.isInteger(rule===null||rule===void 0?void 0:rule.month)&&rule.month>=1&&rule.month<=12){return Math.trunc(rule.month);}var due=(meta===null||meta===void 0?void 0:meta.due)instanceof Date&&!Number.isNaN(meta.due.getTime())?meta.due:null;if(due)return due.getMonth()+1;return todayLocal().getMonth()+1;}function resolveYearlyDay(rule,meta){if(Number.isInteger(rule===null||rule===void 0?void 0:rule.day)&&rule.day>=1&&rule.day<=31){return Math.trunc(rule.day);}var due=(meta===null||meta===void 0?void 0:meta.due)instanceof Date&&!Number.isNaN(meta.due.getTime())?meta.due:null;if(due)return due.getDate();return todayLocal().getDate();}function nextYearlyOnDay(base,rule,meta){var month=resolveYearlyMonth(rule,meta);var day=resolveYearlyDay(rule,meta);if(!month||!day)return null;var monthIndex=month-1;var year=base.getFullYear();var candidate=new Date(year,monthIndex,clampDayInMonth(year,monthIndex,day),12,0,0,0);if(candidate>base)return candidate;year+=1;return new Date(year,monthIndex,clampDayInMonth(year,monthIndex,day),12,0,0,0);}function nextYearlyNthDow(base,rule,meta){var month=resolveYearlyMonth(rule,meta);var nthValue=ordFromText(rule===null||rule===void 0?void 0:rule.nth);var dow=rule===null||rule===void 0?void 0:rule.dow;if(!month||nthValue==null||!dow)return null;var monthIndex=month-1;var year=base.getFullYear();var candidate=computeNthDowForMonth(year,monthIndex,nthValue,dow);if(candidate&&candidate>base)return candidate;for(var i=0;i<5;i++){year+=1;candidate=computeNthDowForMonth(year,monthIndex,nthValue,dow);if(candidate)return candidate;}return null;}function nextMonthlyMultiNth(base,rule){var dow=rule===null||rule===void 0?void 0:rule.dow;var nths=Array.isArray(rule===null||rule===void 0?void 0:rule.nths)?rule.nths:[];if(!dow||!nths.length)return null;var ordinalValues=nths.map(function(token){return ordFromText(token);}).filter(function(value){return value!=null;}).sort(function(a,b){return a-b;});if(!ordinalValues.length)return null;var year=base.getFullYear();var monthIndex=base.getMonth();for(var attempts=0;attempts<48;attempts++){var monthCandidates=ordinalValues.map(function(nth){return computeNthDowForMonth(year,monthIndex,nth,dow);}).filter(Boolean).sort(function(a,b){return a-b;});var _iterator12=_createForOfIteratorHelper(monthCandidates),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var candidate=_step12.value;if(attempts>0||candidate>base){return candidate;}}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}var _advanceMonth3=advanceMonth(year,monthIndex,1);year=_advanceMonth3.year;monthIndex=_advanceMonth3.month;}return null;}function nextMonthlyNthFromEnd(base,rule){var nth=Number.isInteger(rule===null||rule===void 0?void 0:rule.nth)?rule.nth:Number.parseInt(rule===null||rule===void 0?void 0:rule.nth,10);var dow=rule===null||rule===void 0?void 0:rule.dow;if(!nth||!dow)return null;var year=base.getFullYear();var monthIndex=base.getMonth();for(var attempts=0;attempts<48;attempts++){var candidate=nthDowFromEnd(year,monthIndex,dow,nth);if(candidate&&(attempts>0||candidate>base))return candidate;var _advanceMonth4=advanceMonth(year,monthIndex,1);year=_advanceMonth4.year;monthIndex=_advanceMonth4.month;}return null;}function nextMonthlyWeekday(base,rule){var nth=((rule===null||rule===void 0?void 0:rule.nth)||\"\").toString().toLowerCase();if(nth!==\"first\"&&nth!==\"last\")return null;var year=base.getFullYear();var monthIndex=base.getMonth();for(var attempts=0;attempts<48;attempts++){var candidate=nth===\"first\"?firstWeekdayOfMonth(year,monthIndex):lastWeekdayOfMonth(year,monthIndex);if(candidate&&(attempts>0||candidate>base))return candidate;var _advanceMonth5=advanceMonth(year,monthIndex,1);year=_advanceMonth5.year;monthIndex=_advanceMonth5.month;}return null;}function firstWeekdayOfMonth(year,monthIndex){var d=new Date(year,monthIndex,1,12,0,0,0);for(var i=0;i<7;i++){if(!isWeekend(d))return d;d=addDaysLocal(d,1);}return null;}function lastWeekdayOfMonth(year,monthIndex){var d=new Date(year,monthIndex+1,0,12,0,0,0);for(var i=0;i<7;i++){if(!isWeekend(d))return d;d=addDaysLocal(d,-1);}return null;}function nextMonthlyMultiDay(base,rule){var list=Array.isArray(rule.days)?rule.days:[];if(!list.length)return null;var normalized=list.map(function(token){return typeof token===\"string\"?token.toUpperCase():token;}).map(function(token){return token===\"LAST\"?\"LAST\":Number(token);}).filter(function(token){return token===\"LAST\"||Number.isInteger(token)&&token>=1&&token<=31;}).sort(function(a,b){if(a===\"LAST\")return 1;if(b===\"LAST\")return-1;return a-b;});if(!normalized.length)return null;var y=base.getFullYear();var m=base.getMonth();var day=base.getDate();var _iterator13=_createForOfIteratorHelper(normalized),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var token=_step13.value;if(token===\"LAST\"){var candidate=new Date(y,m+1,0,12,0,0,0);if(candidate.getDate()>day)return candidate;}else if(token>day){return new Date(y,m,token,12,0,0,0);}}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}var nextMonthBase=new Date(y,m+1,1,12,0,0,0);return nextMonthlyMultiDay(nextMonthBase,rule);}function nextMonthlyMixedDay(base,rule){var days=Array.isArray(rule.days)?rule.days:[];var includeLast=!!rule.last;var combined=_toConsumableArray(days);if(includeLast)combined.push(\"LAST\");return nextMonthlyMultiDay(base,{days:combined});}function nthDowOfMonth(first,dowCode,nth){var target=DOW_IDX.indexOf(dowCode);if(target<0)return null;var d=new Date(first.getTime());while(d.getDay()!==target)d=addDaysLocal(d,1);d=addDaysLocal(d,7*(nth-1));if(d.getMonth()!==first.getMonth())return null;return d;}function nthDowFromEnd(year,monthIndex,dowCode,nthFromEnd){var target=DOW_IDX.indexOf(dowCode);if(target<0)return null;var x=new Date(year,monthIndex+1,0,12,0,0,0);var count=0;while(x.getMonth()===monthIndex){if(x.getDay()===target){count+=1;if(count===nthFromEnd)return new Date(x.getTime());}x=addDaysLocal(x,-1);}return null;}function computeNthDowForMonth(year,monthIndex,nthValue,dowCode){if(nthValue==null)return null;if(nthValue>0){return nthDowOfMonth(new Date(year,monthIndex,1,12,0,0,0),dowCode,nthValue);}return nthDowFromEnd(year,monthIndex,dowCode,Math.abs(nthValue));}// ========================= Date utils & formatting =========================\nfunction todayLocal(){var d=new Date();d.setHours(12,0,0,0);// noon to dodge DST edges\nreturn d;}function startOfDayLocal(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0);}function addDaysLocal(d,n){var x=new Date(d.getTime());x.setDate(x.getDate()+n);return x;}function startOfWeek(date,weekStartCode){var target=weekStartCode&&DOW_IDX.includes(weekStartCode)?weekStartCode:DEFAULT_WEEK_START_CODE;var cursor=new Date(date.getFullYear(),date.getMonth(),date.getDate(),12,0,0,0);for(var i=0;i<7&&DOW_IDX[cursor.getDay()]!==target;i++){cursor=addDaysLocal(cursor,-1);}return cursor;}function isWeekend(d){var w=d.getDay();// 0 Sun .. 6 Sat\nreturn w===0||w===6;}function parseRoamDate(s){var _window$roamAlphaAPI6;if(!s)return null;var raw=String(s).trim();// 1) [[YYYY-MM-DD]] or bare YYYY-MM-DD\nvar m=raw.match(/^\\[\\[(\\d{4})-(\\d{2})-(\\d{2})\\]\\]$/);if(m)return new Date(\"\".concat(m[1],\"-\").concat(m[2],\"-\").concat(m[3],\"T12:00:00\"));if(/^\\d{4}-\\d{2}-\\d{2}$/.test(raw))return new Date(\"\".concat(raw,\"T12:00:00\"));// 2) [[DNP title]] e.g. [[November 5th, 2025]] or bare DNP title \"November 5th, 2025\"\nvar dnpTitle=raw.startsWith(\"[[\")&&raw.endsWith(\"]]\")?raw.slice(2,-2):raw;// Prefer Roam's converter if available\nvar util=(_window$roamAlphaAPI6=window.roamAlphaAPI)===null||_window$roamAlphaAPI6===void 0?void 0:_window$roamAlphaAPI6.util;if(util!==null&&util!==void 0&&util.pageTitleToDate){try{var dt=util.pageTitleToDate(dnpTitle);if(dt instanceof Date&&!Number.isNaN(dt.getTime())){// Normalize to noon to dodge DST edges\ndt.setHours(12,0,0,0);return dt;}}catch(_){}}// Fallback: strip ordinal (\"st/nd/rd/th\") and parse \"Month Day, Year\"\nvar cleaned=dnpTitle.replace(/\\b(\\d{1,2})(st|nd|rd|th)\\b/i,\"$1\");var parsed=new Date(\"\".concat(cleaned,\" 12:00:00\"));if(!Number.isNaN(parsed.getTime()))return parsed;return null;}function stripTimeFromDateText(text){if(!text||typeof text!==\"string\")return text;var t=text.trim();// strip \"at 3pm\" or \"at 15:30\"\nt=t.replace(/\\s+at\\s+\\d{1,2}(:\\d{2})?\\s*(am|pm)?\\b/i,\"\");// strip trailing \"3pm\" or \"15:30\"\nt=t.replace(/\\s+\\d{1,2}(:\\d{2})?\\s*(am|pm)?\\b/i,\"\");// strip time-of-day words\nt=t.replace(/\\b(morning|afternoon|evening|night)\\b/gi,\"\").replace(/\\b(before|by)\\s*\\d{1,2}(:\\d{2})?\\s*(am|pm)?\\b/gi,\"\").replace(/\\b(before|by)\\s+lunch\\b/gi,\"\").replace(/\\blunch\\b/gi,\"\").replace(/\\b(noon|midnight)\\b/gi,\"\").replace(/\\b(end of day|eod)\\b/gi,\"\").replace(/\\bat\\b\\s*$/gi,\"\").trim();// strip leading \"every \"\nt=t.replace(/^\\s*every\\s+/i,\"\").trim();return t.trim();}function hasTimeOnlyHint(text){if(!text||typeof text!==\"string\")return false;var raw=text.toLowerCase();return /\\b(before|by)\\s*\\d{1,2}(:\\d{2})?\\s*(am|pm)?\\b/.test(raw)||/\\b\\d{1,2}(:\\d{2})?\\s*(am|pm)?\\b/.test(raw)||/\\b(morning|afternoon|evening|night|end of day|eod|lunch)\\b/.test(raw)||/\\b(before|by)\\s+lunch\\b/.test(raw)||/\\b(noon|midnight)\\b/.test(raw);}function pickAnchorDateFromTimeHint(text,set){var _m$;if(!text||typeof text!==\"string\")return todayLocal();var raw=text.toLowerCase();var m=raw.match(/(before|by)?\\s*(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm)?/)||(/\\bmorning\\b/.test(raw)?[\"\",\"\",\"9\",\"00\",\"am\"]:null)||(/\\bafternoon\\b/.test(raw)?[\"\",\"\",\"14\",\"00\",\"\"]:null)||(/\\bevening\\b/.test(raw)?[\"\",\"\",\"18\",\"00\",\"\"]:null)||(/\\bnight\\b/.test(raw)?[\"\",\"\",\"20\",\"00\",\"\"]:null)||(/\\b(end of day|eod)\\b/.test(raw)?[\"\",\"\",\"17\",\"00\",\"\"]:null)||(/\\blunch\\b/.test(raw)?[\"\",\"\",\"12\",\"30\",\"\"]:null)||(/\\bnoon\\b/.test(raw)?[\"\",\"\",\"12\",\"00\",\"\"]:null)||(/\\bmidnight\\b/.test(raw)?[\"\",\"\",\"00\",\"00\",\"\"]:null);if(!m)return todayLocal();var hour=parseInt(m[2],10);var minute=m[3]?parseInt(m[3],10):0;var suffix=(_m$=m[4])===null||_m$===void 0?void 0:_m$.toLowerCase();if(suffix===\"pm\"&&hour<12)hour+=12;if(suffix===\"am\"&&hour===12)hour=0;var now=new Date();var target=new Date(now.getFullYear(),now.getMonth(),now.getDate(),hour,minute,0,0);var anchor=now.getTime()<=target.getTime()?todayLocal():addDaysLocal(todayLocal(),1);return anchor;}function parseWeekSpan(text,set){if(!text||typeof text!==\"string\")return null;var raw=text.toLowerCase();if(!/\\b(this week|sometime this week|later this week|start of this week|end of the week|end of week|before the end of the week)\\b/.test(raw))return null;var start=startOfWeek(todayLocal(),set===null||set===void 0?void 0:set.weekStartCode);var due=addDaysLocal(start,6);return{start:start,due:due};}function parseWeekendSpan(text,set){if(!text||typeof text!==\"string\")return null;var raw=text.toLowerCase();if(!/\\b(this weekend|next weekend)\\b/.test(raw))return null;var now=new Date();var dow=now.getDay();// 0 Sun .. 6 Sat\nvar baseStart=startOfWeek(todayLocal(),set===null||set===void 0?void 0:set.weekStartCode);var isLateSunday=raw.includes(\"this weekend\")&&dow===0&&now.getHours()>=12;var weekOffset=raw.includes(\"next weekend\")||isLateSunday?7:0;var saturday=addDaysLocal(baseStart,weekOffset+5);var sunday=addDaysLocal(saturday,1);return{start:saturday,due:sunday};}function parseRelativeDateText(s){var weekStartCode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_WEEK_START_CODE;if(!s||typeof s!==\"string\")return null;var raw=s.trim().toLowerCase();if(!raw)return null;if(raw.startsWith(\"[[\")&&raw.endsWith(\"]]\")){raw=raw.slice(2,-2).trim();}if(raw===\"today\")return todayLocal();if(/^tomor+ow$/.test(raw)||raw===\"tmr\"||raw===\"tmrw\"){return addDaysLocal(todayLocal(),1);}if(raw===\"tonight\"){return todayLocal();}if(raw===\"next month\"){var now=todayLocal();var y=now.getFullYear();var m=now.getMonth();var d=new Date(y,m+1,1,12,0,0,0);return d;}var nextMonthMatch=raw.match(/^(early|mid|late)\\s+next\\s+([a-z]+)$/);if(nextMonthMatch){var descriptor=nextMonthMatch[1];var monthName=nextMonthMatch[2];var monthIndex=MONTH_MAP[monthName];if(monthIndex!=null){var _now=todayLocal();var year=_now.getFullYear()+(monthIndex-1<_now.getMonth()?1:0);var day=descriptor===\"early\"?5:descriptor===\"mid\"?15:25;return new Date(year,monthIndex-1,day,12,0,0,0);}}var earlyMonthMatch=raw.match(/^(?:early|mid|late)\\s+([a-z]+)$/);if(earlyMonthMatch){var _monthName=earlyMonthMatch[1];var _monthIndex=MONTH_MAP[_monthName];if(_monthIndex!=null){var _now2=todayLocal();var _year=_now2.getFullYear()+(_monthIndex-1<_now2.getMonth()?1:0);var _day6=raw.startsWith(\"early\")?5:raw.startsWith(\"mid\")?15:25;return new Date(_year,_monthIndex-1,_day6,12,0,0,0);}}var nextWeekMatch=raw.match(/^(early|mid|late)\\s+next\\s+week$/);if(nextWeekMatch){var _descriptor=nextWeekMatch[1];var anchor=addDaysLocal(startOfWeek(todayLocal(),weekStartCode),7);if(_descriptor===\"early\")return anchor;if(_descriptor===\"mid\")return addDaysLocal(anchor,3);return addDaysLocal(anchor,5);}if(raw===\"next week\"){var _anchor=todayLocal();var thisWeekStart=startOfWeek(_anchor,weekStartCode);return addDaysLocal(thisWeekStart,7);}var thisWeekMatch=raw.match(/^(?:sometime|later|early)\\s+this\\s+week$/);if(thisWeekMatch){var _anchor2=startOfWeek(todayLocal(),weekStartCode);if(/early/.test(raw))return _anchor2;if(/later/.test(raw))return addDaysLocal(_anchor2,4);return _anchor2;}var thisDowMatch=raw.match(/^this\\s+([a-z]+)$/);if(thisDowMatch){var dowCode=dowFromAlias(thisDowMatch[1]);if(dowCode){var today=todayLocal();var todayIdx=today.getDay();// 0 Sun .. 6 Sat\nvar targetIdx=DOW_IDX.indexOf(dowCode);var delta=targetIdx-todayIdx;if(delta<=0)delta+=7;return addDaysLocal(today,delta);}}var theFirstMatch=raw.match(/^the\\s+first(?:\\s+of)?\\s+every\\s+month$/);if(theFirstMatch){var _now3=todayLocal();var _y=_now3.getFullYear();var _m=_now3.getMonth();var todayDay=_now3.getDate();// if past the first, move to next month\nvar targetMonth=todayDay>1?_m+1:_m;return new Date(_y,targetMonth,1,12,0,0,0);}var nextDowMatch=raw.match(/^next\\s+([a-z]+)$/);if(nextDowMatch){var _dowCode2=dowFromAlias(nextDowMatch[1]);if(_dowCode2)return nextDowDate(todayLocal(),_dowCode2);}var weekdayCode=dowFromAlias(raw);if(weekdayCode)return nextDowDate(todayLocal(),weekdayCode);if(raw===\"this weekend\"){var _now4=new Date();var dow=_now4.getDay();// 0 Sun .. 6 Sat\nif(dow===0&&_now4.getHours()>=12){var anchorNext=addDaysLocal(startOfWeek(todayLocal(),weekStartCode),7);return addDaysLocal(anchorNext,5);}var _anchor3=startOfWeek(todayLocal(),weekStartCode);// weekend = Saturday of this week\nreturn addDaysLocal(_anchor3,5);}if(raw===\"next weekend\"){var _anchor4=addDaysLocal(startOfWeek(todayLocal(),weekStartCode),7);return addDaysLocal(_anchor4,5);}return null;}function nextDowDate(anchor,dowCode){if(!(anchor instanceof Date)||Number.isNaN(anchor.getTime()))return null;if(!dowCode||!DOW_IDX.includes(dowCode))return null;var current=DOW_IDX[anchor.getDay()];var curIdx=DOW_IDX.indexOf(current);var targetIdx=DOW_IDX.indexOf(dowCode);var delta=targetIdx-curIdx;if(delta<=0)delta+=7;return addDaysLocal(anchor,delta);}function formatDate(d,set){if(set.dateFormat===\"ISO\"){return\"\".concat(d.getFullYear(),\"-\").concat(String(d.getMonth()+1).padStart(2,\"0\"),\"-\").concat(String(d.getDate()).padStart(2,\"0\"));}// ROAM: always link to the Daily Note Page title, e.g. [[November 5th, 2025]]\nvar title=toDnpTitle(d);return\"[[\".concat(title,\"]]\");}// ========================= Render helpers =========================\nvar TODO_MACRO_PREFIX_RE=/^\\s*\\{\\{\\s*(?:\\[\\[\\s*TODO\\s*\\]\\]|TODO)\\s*\\}\\}\\s*/i;var TODO_WORD_PREFIX_RE=/^\\s*TODO\\s+/i;var DONE_MACRO_PREFIX_RE=/^\\s*\\{\\{\\s*(?:\\[\\[\\s*(?:DONE)\\s*\\]\\]|DONE)\\s*\\}\\}\\s*/i;var DONE_WORD_PREFIX_RE=/^\\s*DONE\\s+/i;function normalizeToTodoMacro(s){var t=s.replace(/^\\s+/,\"\");if(/^\\-\\s+/.test(t))t=t.replace(/^\\-\\s+/,\"\");// Match {{[[TODO]]}}, {{TODO}}, {{ [[DONE]] }}, etc.\nt=t.replace(/^\\{\\{\\s*(?:\\[\\[(?:TODO|DONE)\\]\\]|(?:TODO|DONE))\\s*\\}\\}\\s*/i,\"\");t=t.replace(/^(?:TODO|DONE)\\s+/i,\"\");return\"{{[[TODO]]}} \"+t;}function isBlockCompleted(block){var text=((block===null||block===void 0?void 0:block.string)||\"\").trim();if(!text)return false;return DONE_MACRO_PREFIX_RE.test(text)||DONE_WORD_PREFIX_RE.test(text);}function isTaskBlock(block){var text=((block===null||block===void 0?void 0:block.string)||\"\").trim();if(!text)return false;return TODO_MACRO_PREFIX_RE.test(text)||TODO_WORD_PREFIX_RE.test(text)||DONE_MACRO_PREFIX_RE.test(text)||DONE_WORD_PREFIX_RE.test(text);}function formatTodoStateString(text){var state=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"TODO\";var base=normalizeToTodoMacro(text||\"\");if(state===\"DONE\"){return base.replace(\"{{[[TODO]]}}\",\"{{[[DONE]]}}\");}return base;}function setTaskTodoState(_x92){return _setTaskTodoState.apply(this,arguments);}function _setTaskTodoState(){_setTaskTodoState=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee79(uid){var state,block,alreadyDone,next,_args79=arguments;return _regenerator().w(function(_context79){while(1)switch(_context79.n){case 0:state=_args79.length>1&&_args79[1]!==undefined?_args79[1]:\"TODO\";_context79.n=1;return getBlock(uid);case 1:block=_context79.v;if(block){_context79.n=2;break;}return _context79.a(2);case 2:alreadyDone=isBlockCompleted(block);if(!(state===\"DONE\"&&alreadyDone)){_context79.n=3;break;}return _context79.a(2);case 3:if(!(state===\"TODO\"&&!alreadyDone)){_context79.n=4;break;}return _context79.a(2);case 4:next=formatTodoStateString(block.string||\"\",state);if(!(next===block.string)){_context79.n=5;break;}return _context79.a(2);case 5:_context79.n=6;return updateBlockString(uid,next);case 6:return _context79.a(2);}},_callee79);}));return _setTaskTodoState.apply(this,arguments);}function removeInlineAttributes(text,keys){if(!text)return text;var lower=keys.map(function(k){return k.toLowerCase();});var cleanedLines=text.split(\"\\n\").map(function(line){var result=line;var _iterator14=_createForOfIteratorHelper(lower),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var key=_step14.value;var keyEsc=escapeRegExp(key);var inlinePattern=new RegExp(\"(^|\\\\s)(\".concat(keyEsc,\"::\\\\s*[^\\\\n]*?)(?=(?:\\\\s+[\\\\p{L}\\\\p{N}_\\\\-/]+::)|$)\"),\"giu\");result=result.replace(inlinePattern,function(match,leading){return leading||\"\";});}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}return result;});return cleanedLines.filter(function(line){var trimmed=line.trim().toLowerCase();if(!trimmed)return false;return!lower.some(function(key){return trimmed.startsWith(\"\".concat(key,\"::\"));});}).join(\"\\n\").trimEnd();}function escapeRegExp(s){return String(s).replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");}function replaceAttributeInString(text,key,value){var source=typeof text===\"string\"?text:\"\";var keyEsc=escapeRegExp(key);var regex=new RegExp(\"(^|\\\\s)(\".concat(keyEsc,\"::\\\\s*)([^\\\\n]*?)(?=(?:\\\\s+[\\\\p{L}\\\\p{N}_\\\\-/]+::)|$)\"),\"iu\");if(regex.test(source)){return source.replace(regex,function(match,leading,prefix){return\"\".concat(leading).concat(prefix).concat(value);});}return source;}function ensureInlineAttribute(_x93,_x94,_x95){return _ensureInlineAttribute.apply(this,arguments);}function _ensureInlineAttribute(){_ensureInlineAttribute=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee80(block,key,value){var options,original,candidateKeys,current,_i15,_candidateKeys,candidate,keyEsc,hasAttr,next,_args80=arguments;return _regenerator().w(function(_context80){while(1)switch(_context80.n){case 0:options=_args80.length>3&&_args80[3]!==undefined?_args80[3]:{};if(!(!block||!block.uid)){_context80.n=1;break;}return _context80.a(2);case 1:original=block.string||\"\";candidateKeys=Array.from(new Set([key].concat(_toConsumableArray(options.aliases||[]))));current=original;_i15=0,_candidateKeys=candidateKeys;case 2:if(!(_i15<_candidateKeys.length)){_context80.n=7;break;}candidate=_candidateKeys[_i15];keyEsc=escapeRegExp(candidate);hasAttr=new RegExp(\"\".concat(keyEsc,\"::\"),\"i\").test(current);if(hasAttr){_context80.n=3;break;}return _context80.a(3,6);case 3:next=replaceAttributeInString(current,candidate,value);if(!(next&&next!==current)){_context80.n=5;break;}_context80.n=4;return updateBlockString(block.uid,next);case 4:block.string=next;current=next;case 5:return _context80.a(2);case 6:_i15++;_context80.n=2;break;case 7:return _context80.a(2);}},_callee80);}));return _ensureInlineAttribute.apply(this,arguments);}function shortId(){return Math.random().toString(36).slice(2,8);}function requestSpawnConfirmation(meta,set){return new Promise(function(resolve){var settled=false;var finish=function finish(value){if(settled)return;settled=true;resolve(value);};var lang=getLanguageSetting();var titleText=translateString(\"Better Tasks\",lang);var messageText=translateString(\"Spawn next occurrence?\",lang);var yesLabel=t(\"buttons.yes\",lang)||\"Yes\";var noLabel=t(\"buttons.no\",lang)||\"No\";izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:'light',color:'black',layout:2,\"class\":'betterTasks bt-toast-strong-icon',drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#1f7a34\",title:titleText,message:messageText,position:'center',onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},buttons:[[\"<button>\".concat(escapeHtml(yesLabel),\"</button>\"),function(instance,toast,button,e,inputs){instance.hide({transitionOut:'fadeOut'},toast,'button');finish(true);},true],// true to focus\n[\"<button>\".concat(escapeHtml(noLabel),\"</button>\"),function(instance,toast,button,e){instance.hide({transitionOut:\"fadeOut\"},toast,\"button\");finish(false);}]],onClosed:function onClosed(){return finish(false);}});});}function applyToastA11y(toastEl){if(!toastEl)return;toastEl.setAttribute(\"role\",\"alert\");toastEl.setAttribute(\"aria-live\",\"polite\");toastEl.setAttribute(\"aria-atomic\",\"true\");}function toast(msg){var timer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:3000;var className=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"betterTasks bt-toast-info\";var lang=getLanguageSetting();var message=typeof msg===\"string\"?translateString(msg,lang):msg;izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:'light',color:'black',message:message,\"class\":className,position:'center',close:false,closeOnEscape:true,timeout:timer,closeOnClick:true,displayMode:2,onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);}});}function showPersistentToast(msg){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var lang=getLanguageSetting();var message=typeof msg===\"string\"?translateString(msg,lang):msg;try{return izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",message:message,\"class\":\"betterTasks\",position:\"center\",id:\"betterTasks-ai-pending\",close:true,closeOnEscape:true,timeout:false,closeOnClick:true,displayMode:2,onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},onClosed:function onClosed(){if(typeof opts.onClosed===\"function\"){opts.onClosed();}}});}catch(err){console.warn(\"[BetterTasks] showPersistentToast failed\",err);return null;}}function hideToastInstance(instance){var fallbackId=\"betterTasks-ai-pending\";var targetEl=instance&&instance.toastRef||instance&&instance.toast||instance&&instance.el||(typeof instance===\"string\"?document.getElementById(instance):null)||document.getElementById(fallbackId);if(!targetEl)return;try{izitoast__WEBPACK_IMPORTED_MODULE_0___default().hide({transitionOut:\"fadeOut\"},targetEl);}catch(err){console.warn(\"[BetterTasks] hideToastInstance failed\",err);}try{if(targetEl.id){izitoast__WEBPACK_IMPORTED_MODULE_0___default().destroy(targetEl.id);}}catch(_){// best effort cleanup\n}}function pruneSetMax(set,maxSize){if(!set||maxSize<=0)return;while(set.size>maxSize){var oldest=set.values().next().value;if(oldest===undefined)break;set[\"delete\"](oldest);}}function noteRepeatParseFailure(uid){if(!uid||invalidRepeatToasted.has(uid))return;invalidRepeatToasted.add(uid);pruneSetMax(invalidRepeatToasted,MAX_INVALID_PARSE_TOASTED);toast(t([\"toasts\",\"couldNotParseRecurrence\"],getLanguageSetting())||\"Could not parse the task recurrence pattern. Please check your task and review the README for supported patterns.\");}function clearRepeatParseFailure(uid){if(!uid)return;invalidRepeatToasted[\"delete\"](uid);}function noteDueParseFailure(uid){if(!uid||invalidDueToasted.has(uid))return;invalidDueToasted.add(uid);pruneSetMax(invalidDueToasted,MAX_INVALID_PARSE_TOASTED);toast(t([\"toasts\",\"cannotParseDue\"],getLanguageSetting())||\"Could not parse the task due date. Please ensure it uses Roam's standard date format (e.g. [[November 8th, 2025]]).\");}function clearDueParseFailure(uid){if(!uid)return;invalidDueToasted[\"delete\"](uid);}// ========================= Pill UI helpers =========================\nfunction escapeHtml(value){return String(value||\"\").replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\");}function promptForValue(_ref10){var title=_ref10.title,message=_ref10.message,placeholder=_ref10.placeholder,initial=_ref10.initial;return new Promise(function(resolve){var settled=false;var finish=function finish(value){if(settled)return;settled=true;resolve(value);};var lang=getLanguageSetting();var titleText=translateString(title,lang);var messageText=translateString(message,lang);var placeholderText=translateString(placeholder||\"\",lang);var saveLabel=t(\"buttons.save\",lang)||\"Save\";var cancelLabel=t(\"buttons.cancel\",lang)||\"Cancel\";var inputClass=\"rt-prompt-input-\".concat(Date.now());var inputHtml=\"<input type=\\\"text\\\" class=\\\"\".concat(inputClass,\"\\\" placeholder=\\\"\").concat(escapeHtml(placeholderText||\"\"),\"\\\" value=\\\"\").concat(escapeHtml(initial||\"\"),\"\\\" />\");izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:\"light\",color:\"black\",layout:2,\"class\":\"betterTasks bt-toast-strong-icon\",position:\"center\",drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#1f7a34\",title:titleText,message:messageText,inputs:[[inputHtml,\"keyup\",function(_instance,_toast,input){initial=input.value;}]],buttons:[/*\n            [\n              \"<button>Today</button>\",\n              (instance, toastInstance) => {\n                const today = todayLocal();\n                const formatted = formatDate(today, S());\n                instance.hide({ transitionOut: \"fadeOut\" }, toastInstance, \"button\");\n                finish(formatted);\n              },\n            ],\n            [\n              \"<button>Tomorrow</button>\",\n              (instance, toastInstance) => {\n                const tomorrow = addDaysLocal(todayLocal(), 1);\n                const formatted = formatDate(tomorrow, S());\n                instance.hide({ transitionOut: \"fadeOut\" }, toastInstance, \"button\");\n                finish(formatted);\n              },\n            ],*/[\"<button>\".concat(escapeHtml(saveLabel),\"</button>\"),function(instance,toastInstance,_button,_e,inputs){var _inputs$;var val=inputs===null||inputs===void 0||(_inputs$=inputs[0])===null||_inputs$===void 0||(_inputs$=_inputs$.value)===null||_inputs$===void 0?void 0:_inputs$.trim();instance.hide({transitionOut:\"fadeOut\"},toastInstance,\"button\");finish(val||null);},true],[\"<button>\".concat(escapeHtml(cancelLabel),\"</button>\"),function(instance,toastInstance){instance.hide({transitionOut:\"fadeOut\"},toastInstance,\"button\");finish(null);}]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},onOpened:function onOpened(_instance,toastEl){var _toastEl$querySelecto,_input$focus;var input=(_toastEl$querySelecto=toastEl.querySelector)===null||_toastEl$querySelecto===void 0?void 0:_toastEl$querySelecto.call(toastEl,\".\".concat(inputClass));input===null||input===void 0||(_input$focus=input.focus)===null||_input$focus===void 0||_input$focus.call(input);if(input&&typeof input.selectionStart===\"number\"){var len=input.value.length;input.setSelectionRange(len,len);}},onClosed:function onClosed(){return finish(null);}});});}var projectPickerStylesInjected=false;function ensureProjectPickerStyles(){if(projectPickerStylesInjected||typeof document===\"undefined\")return;projectPickerStylesInjected=true;var style=document.createElement(\"style\");style.id=\"rt-project-picker-style\";style.textContent=\"\\n        .rt-project-picker {\\n          display: flex;\\n          flex-direction: column;\\n          gap: 8px;\\n          max-width: 360px;\\n        }\\n        .rt-project-picker__list {\\n          max-height: 220px;\\n          overflow-y: auto;\\n          border: 1px solid rgba(0,0,0,0.1);\\n          border-radius: 6px;\\n          padding: 4px;\\n          background: #fff;\\n        }\\n        .rt-project-picker__option {\\n          all: unset;\\n          display: block;\\n          width: 100%;\\n          padding: 6px 8px;\\n          border-radius: 4px;\\n          cursor: pointer;\\n        }\\n        .rt-project-picker__option:hover {\\n          background: rgba(0,0,0,0.06);\\n        }\\n        .rt-project-picker__empty {\\n          color: rgba(0,0,0,0.6);\\n          padding: 6px 8px;\\n        }\\n        .rt-project-picker__input {\\n          width: 100%;\\n          padding: 6px 8px;\\n          border-radius: 4px;\\n          border: 1px solid rgba(0,0,0,0.2);\\n        }\\n      \";document.head.appendChild(style);}function promptForDashView(){var _ref11=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref11$title=_ref11.title,title=_ref11$title===void 0?\"Better Tasks\":_ref11$title,_ref11$placeholder=_ref11.placeholder,placeholder=_ref11$placeholder===void 0?\"Filter views\":_ref11$placeholder,_ref11$views=_ref11.views,views=_ref11$views===void 0?[]:_ref11$views,_ref11$initialId=_ref11.initialId,initialId=_ref11$initialId===void 0?null:_ref11$initialId;var options=Array.isArray(views)?views:[];var lang=getLanguageSetting();var titleText=translateString(title,lang);var placeholderText=translateString(placeholder,lang);var cancelLabel=t(\"buttons.cancel\",lang)||\"Cancel\";var inputClass=\"bt-view-input-\".concat(Date.now());var listId=\"bt-view-list-\".concat(Date.now());ensureProjectPickerStyles();var sortByName=function sortByName(a,b){return String((a===null||a===void 0?void 0:a.name)||\"\").localeCompare(String((b===null||b===void 0?void 0:b.name)||\"\"),undefined,{sensitivity:\"base\"});};var sorted=options.slice().sort(sortByName);return new Promise(function(resolve){var settled=false;var toastElement=null;var finish=function finish(value){if(settled)return;settled=true;resolve(typeof value===\"string\"?value:null);};var hideToast=function hideToast(){if(toastElement){izitoast__WEBPACK_IMPORTED_MODULE_0___default().hide({},toastElement);}};var renderOptions=function renderOptions(container,filterText){if(!container)return;container.textContent=\"\";var filter=(filterText||\"\").trim().toLowerCase();var matches=sorted.filter(function(v){return filter?String((v===null||v===void 0?void 0:v.name)||\"\").toLowerCase().includes(filter):true;});if(!matches.length){var empty=document.createElement(\"div\");empty.className=\"rt-project-picker__empty\";empty.textContent=\"No views\";container.appendChild(empty);return;}matches.forEach(function(v){var btn=document.createElement(\"button\");btn.type=\"button\";btn.className=\"rt-project-picker__option\";btn.textContent=v.name;if(initialId&&v.id===initialId){btn.style.background=\"rgba(0,0,0,0.08)\";btn.style.fontWeight=\"600\";}btn.addEventListener(\"click\",function(){hideToast();finish(v.id);});container.appendChild(btn);});};izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:\"light\",color:\"black\",layout:2,\"class\":\"betterTasks bt-toast-strong-icon\",position:\"center\",drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,icon:\"icon-check\",iconText:\"âœ“\",title:titleText,message:\"\\n            <div class=\\\"rt-project-picker\\\">\\n              <input type=\\\"text\\\" class=\\\"rt-project-picker__input \".concat(inputClass,\"\\\" placeholder=\\\"\").concat(escapeHtml(placeholderText),\"\\\" value=\\\"\\\" />\\n              <div class=\\\"rt-project-picker__list\\\" id=\\\"\").concat(listId,\"\\\"></div>\\n            </div>\\n          \"),buttons:[[\"<button>\".concat(escapeHtml(cancelLabel),\"</button>\"),function(_instance,toastEl){toastElement=toastEl||toastElement;hideToast();finish(null);}]],onOpening:function onOpening(_instance,toastEl){var _toastEl$querySelecto2,_toastEl$querySelecto3;toastElement=toastEl;applyToastA11y(toastEl);var input=(_toastEl$querySelecto2=toastEl.querySelector)===null||_toastEl$querySelecto2===void 0?void 0:_toastEl$querySelecto2.call(toastEl,\".\".concat(inputClass));var list=(_toastEl$querySelecto3=toastEl.querySelector)===null||_toastEl$querySelecto3===void 0?void 0:_toastEl$querySelecto3.call(toastEl,\"#\".concat(listId));renderOptions(list,\"\");if(input){input.addEventListener(\"input\",function(){return renderOptions(list,input.value);});input.addEventListener(\"keydown\",function(event){if(event.key===\"Escape\"){event.preventDefault();hideToast();finish(null);}});input.focus();}},onClosed:function onClosed(){return finish(null);}});});}var ATTR_PICKER_CONFIG={project:{refresh:_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions,getOptions:_project_store__WEBPACK_IMPORTED_MODULE_3__.getProjectOptions,addOption:_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption,normalize:_project_store__WEBPACK_IMPORTED_MODULE_3__.normalizeProjectValue,stringsKey:\"projectPicker\",emptyKey:\"projectPicker\"},waitingFor:{refresh:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions,getOptions:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.getWaitingOptions,addOption:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.addWaitingOption,normalize:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.normalizeWaitingValue,stringsKey:\"waitingPicker\",emptyKey:\"waitingPicker\"},context:{refresh:_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions,getOptions:_context_store__WEBPACK_IMPORTED_MODULE_5__.getContextOptions,addOption:_context_store__WEBPACK_IMPORTED_MODULE_5__.addContextOption,normalize:_context_store__WEBPACK_IMPORTED_MODULE_5__.normalizeContextValue,stringsKey:\"contextPicker\",emptyKey:\"contextPicker\"}};function promptForAttribute(){return _promptForAttribute.apply(this,arguments);}function _promptForAttribute(){_promptForAttribute=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee81(){var _cfg$refresh;var type,_ref41,_ref41$initialValue,initialValue,_ref41$allowMulti,allowMulti,cfg,lang,pickerStrings,titleText,placeholderText,noItemsText,saveLabel,cancelLabel,inputClass,listId,normalize,initialList,_args81=arguments;return _regenerator().w(function(_context81){while(1)switch(_context81.n){case 0:type=_args81.length>0&&_args81[0]!==undefined?_args81[0]:\"project\";_ref41=_args81.length>1&&_args81[1]!==undefined?_args81[1]:{},_ref41$initialValue=_ref41.initialValue,initialValue=_ref41$initialValue===void 0?\"\":_ref41$initialValue,_ref41$allowMulti=_ref41.allowMulti,allowMulti=_ref41$allowMulti===void 0?false:_ref41$allowMulti;cfg=ATTR_PICKER_CONFIG[type]||ATTR_PICKER_CONFIG.project;_context81.n=1;return(_cfg$refresh=cfg.refresh)===null||_cfg$refresh===void 0?void 0:_cfg$refresh.call(cfg,true);case 1:lang=getLanguageSetting();pickerStrings=t(cfg.stringsKey,lang)||{};titleText=translateString(pickerStrings.title||\"Select\",lang);placeholderText=translateString(pickerStrings.placeholder||\"Search or create\",lang);noItemsText=translateString(pickerStrings.noItems||\"No options yet â€” type to create one\",lang);saveLabel=t(\"buttons.save\",lang)||\"Save\";cancelLabel=t(\"buttons.cancel\",lang)||\"Cancel\";inputClass=\"rt-attr-input-\".concat(Date.now());listId=\"rt-attr-list-\".concat(Date.now());ensureProjectPickerStyles();normalize=cfg.normalize||function(v){return typeof v===\"string\"?v.trim():\"\";};initialList=allowMulti?Array.isArray(initialValue)?initialValue.map(normalize).filter(Boolean):typeof initialValue===\"string\"&&initialValue.includes(\",\")?initialValue.split(\",\").map(normalize).filter(Boolean):initialValue?[normalize(initialValue)]:[]:[initialValue].filter(Boolean).map(normalize);return _context81.a(2,new Promise(function(resolve){var settled=false;var current=allowMulti?initialList:initialList[0]||\"\";var toastElement=null;var hideToast=function hideToast(){if(toastElement){izitoast__WEBPACK_IMPORTED_MODULE_0___default().hide({},toastElement);}};var finish=function finish(value){if(settled)return;settled=true;if(allowMulti){var list=Array.isArray(value)?value:typeof value===\"string\"?value.split(\",\"):[];var normalizedList=list.map(normalize).filter(Boolean);resolve(normalizedList.length?normalizedList:null);}else{var normalized=normalize(value);resolve(normalized||null);}};var renderOptions=function renderOptions(container,filterText,onSelect,selectedSet){if(!container)return;container.textContent=\"\";var filter=(filterText||\"\").trim().toLowerCase();var options=cfg.getOptions?cfg.getOptions():[];var matches=options.filter(function(opt){return filter?opt.toLowerCase().includes(filter):true;});if(!matches.length){var empty=document.createElement(\"div\");empty.className=\"rt-project-picker__empty\";empty.textContent=noItemsText;container.appendChild(empty);return;}matches.forEach(function(opt){var btn=document.createElement(\"button\");btn.type=\"button\";btn.className=\"rt-project-picker__option\";btn.textContent=opt;if(allowMulti&&selectedSet!==null&&selectedSet!==void 0&&selectedSet.has(opt)){btn.style.background=\"rgba(0,0,0,0.08)\";btn.style.fontWeight=\"600\";}btn.addEventListener(\"click\",function(){return onSelect(opt);});container.appendChild(btn);});};izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:\"light\",color:\"black\",layout:2,\"class\":\"betterTasks bt-toast-strong-icon\",position:\"center\",drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,icon:\"icon-check\",iconText:\"âœ“\",title:titleText,message:\"\\n            <div class=\\\"rt-project-picker\\\">\\n              <input type=\\\"text\\\" class=\\\"rt-project-picker__input \".concat(inputClass,\"\\\" placeholder=\\\"\").concat(escapeHtml(placeholderText),\"\\\" value=\\\"\").concat(allowMulti?\"\":escapeHtml(current||\"\"),\"\\\" />\\n              <div class=\\\"rt-project-picker__list\\\" id=\\\"\").concat(listId,\"\\\"></div>\\n            </div>\\n          \"),buttons:[[\"<button>\".concat(escapeHtml(saveLabel),\"</button>\"),function(_instance,toastEl){toastElement=toastEl||toastElement;var input=toastEl===null||toastEl===void 0?void 0:toastEl.querySelector(\".\".concat(inputClass));var domVal=typeof(input===null||input===void 0?void 0:input.value)===\"string\"?input.value:\"\";if(allowMulti){var selected=new Set(Array.isArray(current)?current:[]);if(domVal&&domVal.trim())selected.add(normalize(domVal));finish(Array.from(selected));}else{finish(domVal||current||\"\");}hideToast();},true],[\"<button>\".concat(escapeHtml(cancelLabel),\"</button>\"),function(_instance,toastEl){toastElement=toastEl||toastElement;hideToast();finish(null);}]],onOpening:function onOpening(_instance,toastEl){toastElement=toastEl;applyToastA11y(toastEl);var input=toastEl.querySelector(\".\".concat(inputClass));var list=toastEl.querySelector(\"#\".concat(listId));var selectAndClose=function selectAndClose(val){if(allowMulti){var selected=new Set(Array.isArray(current)?current:[]);selected.add(normalize(val));var next=Array.from(selected);current=next;finish(next);hideToast();}else{if(toastElement){izitoast__WEBPACK_IMPORTED_MODULE_0___default().hide({},toastElement);}finish(val);}};var selectedSet=new Set(Array.isArray(current)?current:[]);renderOptions(list,\"\",selectAndClose,selectedSet);if(input){input.addEventListener(\"input\",function(){var filterVal=input.value;renderOptions(list,filterVal,selectAndClose,selectedSet);});input.addEventListener(\"keydown\",function(event){if(event.key===\"Enter\"){event.preventDefault();selectAndClose(input.value);}});input.focus();input.setSelectionRange(input.value.length,input.value.length);}},onClosed:function onClosed(){return finish(null);}});}));}},_callee81);}));return _promptForAttribute.apply(this,arguments);}var promptForProject=function promptForProject(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return promptForAttribute(\"project\",_objectSpread(_objectSpread({},opts),{},{allowMulti:false}));};var promptForWaiting=function promptForWaiting(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return promptForAttribute(\"waitingFor\",_objectSpread(_objectSpread({},opts),{},{allowMulti:false}));};var promptForContext=function promptForContext(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return promptForAttribute(\"context\",_objectSpread(_objectSpread({},opts),{},{allowMulti:true}));};function promptForDate(_ref12){var title=_ref12.title,message=_ref12.message,initial=_ref12.initial;return new Promise(function(resolve){var settled=false;var current=typeof initial===\"string\"?initial:\"\";var inputEl=null;var finish=function finish(value){if(settled)return;settled=true;resolve(value);};var lang=getLanguageSetting();var titleText=translateString(title,lang);var messageText=translateString(message,lang);var saveLabel=t(\"buttons.save\",lang)||\"Save\";var cancelLabel=t(\"buttons.cancel\",lang)||\"Cancel\";var dateInputClass=\"rt-inline-date-\".concat(Date.now());var inputHtml=\"<input type=\\\"date\\\" class=\\\"\".concat(dateInputClass,\"\\\" value=\\\"\").concat(escapeHtml(current),\"\\\" />\");var shortcutSet=S();izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:\"light\",color:\"black\",layout:2,\"class\":\"betterTasks bt-toast-strong-icon\",position:\"center\",drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#1f7a34\",title:titleText,message:messageText,inputs:[[inputHtml,\"input\",function(_instance,_toast,input){current=input.value;},true]],buttons:[[\"<button>\".concat(escapeHtml(saveLabel),\"</button>\"),function(instance,toastInstance,_button,_e,inputs){var _ref13,_ref14,_inputEl$value,_inputEl,_inputs$2;var raw=(_ref13=(_ref14=(_inputEl$value=(_inputEl=inputEl)===null||_inputEl===void 0?void 0:_inputEl.value)!==null&&_inputEl$value!==void 0?_inputEl$value:inputs===null||inputs===void 0||(_inputs$2=inputs[0])===null||_inputs$2===void 0?void 0:_inputs$2.value)!==null&&_ref14!==void 0?_ref14:current)!==null&&_ref13!==void 0?_ref13:\"\";var val=raw.trim();instance.hide({transitionOut:\"fadeOut\"},toastInstance,\"button\");finish(val||null);},true],[\"<button>\".concat(escapeHtml(cancelLabel),\"</button>\"),function(instance,toastInstance){instance.hide({transitionOut:\"fadeOut\"},toastInstance,\"button\");finish(null);}]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);var input=toastEl.querySelector(\".\".concat(dateInputClass));if(!input)return;inputEl=input;var row=input.parentElement;if(!row||!row.classList.contains(\"rt-date-inline-wrap\")){var _input$parentNode;row=document.createElement(\"div\");row.className=\"rt-date-inline-wrap\";(_input$parentNode=input.parentNode)===null||_input$parentNode===void 0||_input$parentNode.insertBefore(row,input);row.appendChild(input);}var shortcutWrap=document.createElement(\"div\");shortcutWrap.className=\"rt-date-shortcuts-inline\";var makeBtn=function makeBtn(label,offsetDays){var btn=document.createElement(\"button\");btn.type=\"button\";btn.textContent=label;btn.addEventListener(\"click\",function(){var date=addDaysLocal(todayLocal(),offsetDays);var iso=formatIsoDate(date,shortcutSet);input.value=iso;current=iso;input.dispatchEvent(new Event(\"input\",{bubbles:true}));});return btn;};shortcutWrap.appendChild(makeBtn(\"Today\",0));shortcutWrap.appendChild(makeBtn(\"Tomorrow\",1));row.appendChild(shortcutWrap);},onClosed:function onClosed(){return finish(null);}});});}function promptForRepeatAndDue(){return _promptForRepeatAndDue.apply(this,arguments);}function _promptForRepeatAndDue(){_promptForRepeatAndDue=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee86(){var initial,includeTaskText,setSnapshot,snapshot,initialDueDate,initialDueIso,initialStartDate,initialStartIso,initialDeferDate,initialDeferIso,projectOptions,projectDatalistId,projectDatalistOptions,projectPickerLabel,waitingPickerLabel,contextPickerLabel,_args86=arguments;return _regenerator().w(function(_context86){while(1)switch(_context86.n){case 0:initial=_args86.length>0&&_args86[0]!==undefined?_args86[0]:{};includeTaskText=true;setSnapshot=S();snapshot={repeat:typeof initial.repeat===\"string\"&&initial.repeat?initial.repeat:initial.repeatRaw||\"\",due:typeof initial.due===\"string\"&&initial.due?initial.due:initial.dueText||initial.rawDue||\"\",task:includeTaskText&&typeof initial.taskText===\"string\"&&initial.taskText?initial.taskText:includeTaskText&&typeof initial.taskTextRaw===\"string\"?initial.taskTextRaw:\"\",start:typeof initial.start===\"string\"&&initial.start?initial.start:initial.startText||initial.rawStart||\"\",defer:typeof initial.defer===\"string\"&&initial.defer?initial.defer:initial.deferText||initial.rawDefer||\"\",project:typeof initial.project===\"string\"?initial.project:\"\",waitingFor:typeof initial.waitingFor===\"string\"?initial.waitingFor:\"\",context:Array.isArray(initial.context)?initial.context.join(\", \"):typeof initial.context===\"string\"?initial.context:\"\",priority:typeof initial.priority===\"string\"?initial.priority:\"\",energy:typeof initial.energy===\"string\"?initial.energy:\"\",gtd:typeof initial.gtd===\"string\"?initial.gtd:\"\"};initialDueDate=snapshot.due?parseRoamDate(snapshot.due):null;initialDueIso=initialDueDate instanceof Date&&!Number.isNaN(initialDueDate.getTime())?formatIsoDate(initialDueDate,setSnapshot):/^\\d{4}-\\d{2}-\\d{2}$/.test(snapshot.due||\"\")?snapshot.due:\"\";snapshot.dueIso=initialDueIso;initialStartDate=snapshot.start?parseRoamDate(snapshot.start):null;initialStartIso=initialStartDate instanceof Date&&!Number.isNaN(initialStartDate.getTime())?formatIsoDate(initialStartDate,setSnapshot):/^\\d{4}-\\d{2}-\\d{2}$/.test(snapshot.start||\"\")?snapshot.start:\"\";snapshot.startIso=initialStartIso;initialDeferDate=snapshot.defer?parseRoamDate(snapshot.defer):null;initialDeferIso=initialDeferDate instanceof Date&&!Number.isNaN(initialDeferDate.getTime())?formatIsoDate(initialDeferDate,setSnapshot):/^\\d{4}-\\d{2}-\\d{2}$/.test(snapshot.defer||\"\")?snapshot.defer:\"\";snapshot.deferIso=initialDeferIso;_context86.n=1;return (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)();case 1:_context86.n=2;return (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)();case 2:_context86.n=3;return (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)();case 3:projectOptions=(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.getProjectOptions)();projectDatalistId=\"rt-project-options-\".concat(Date.now());projectDatalistOptions=projectOptions.map(function(opt){return\"<option value=\\\"\".concat(escapeHtml(opt),\"\\\"></option>\");}).join(\"\");projectPickerLabel=t([\"projectPicker\",\"button\"],getLanguageSetting())||\"Select\";waitingPickerLabel=t([\"waitingPicker\",\"button\"],getLanguageSetting())||projectPickerLabel;contextPickerLabel=t([\"contextPicker\",\"button\"],getLanguageSetting())||projectPickerLabel;return _context86.a(2,new Promise(function(resolve){var settled=false;var finish=function finish(value){if(settled)return;settled=true;resolve(value);};var lang=getLanguageSetting();var formStrings=t(\"prompts.form\",lang)||{};var metaStrings=t(\"metadata\",lang)||{};var filterValues=t(\"dashboard.filterValues\",lang)||{};var labelOr=function labelOr(key,fallback){return formStrings[key]||metaStrings[key]||fallback;};var placeholderOr=function placeholderOr(key,fallback){return formStrings[key]||fallback;};var optionLabel=function optionLabel(group,val,fallback){var grp=formStrings[group]||{};if(grp&&grp[val])return grp[val];if(filterValues&&filterValues[val])return filterValues[val];return fallback;};var taskInputHtml=\"<label class=\\\"rt-input-wrap\\\">\".concat(escapeHtml(formStrings.taskLabel||\"Task *\"),\"<br/><input data-rt-field=\\\"task\\\" type=\\\"text\\\" placeholder=\\\"\").concat(escapeHtml(formStrings.taskPlaceholder||\"Task text\"),\"\\\" value=\\\"\").concat(escapeHtml(snapshot.task||\"\"),\"\\\" /></label>\");var repeatInputHtml=\"<label class=\\\"rt-input-wrap\\\">\".concat(escapeHtml(formStrings.repeatLabel||\"Repeat\"),\"<br/><input data-rt-field=\\\"repeat\\\" type=\\\"text\\\" placeholder=\\\"\").concat(escapeHtml(formStrings.repeatPlaceholder||\"Repeat rule (optional)\"),\"\\\" value=\\\"\").concat(escapeHtml(snapshot.repeat||\"\"),\"\\\" /></label>\");var dateInputClass=\"rt-date-input-\".concat(Date.now());var startInputHtml=\"<label class=\\\"rt-input-wrap\\\">\".concat(escapeHtml(formStrings.startLabel||\"Start\"),\"<br/><input data-rt-field=\\\"start\\\" type=\\\"date\\\" value=\\\"\").concat(escapeHtml(snapshot.startIso||\"\"),\"\\\" /></label>\");var deferInputHtml=\"<label class=\\\"rt-input-wrap\\\">\".concat(escapeHtml(formStrings.deferLabel||\"Defer\"),\"<br/><input data-rt-field=\\\"defer\\\" type=\\\"date\\\" value=\\\"\").concat(escapeHtml(snapshot.deferIso||\"\"),\"\\\" /></label>\");var dueInputHtml=\"<label class=\\\"rt-input-wrap\\\">\".concat(escapeHtml(formStrings.dueLabel||\"Due\"),\"<br/><input data-rt-field=\\\"due\\\" type=\\\"date\\\" class=\\\"\").concat(dateInputClass,\"\\\" value=\\\"\").concat(escapeHtml(snapshot.dueIso||\"\"),\"\\\" /></label>\");var projectLabel=formStrings.projectLabel||metaStrings.project||\"Project\";var gtdLabel=formStrings.gtdLabel||metaStrings.gtd||\"GTD status\";var waitingLabel=formStrings.waitingLabel||metaStrings.waitingFor||\"Waiting-for\";var priorityLabel=formStrings.priorityLabel||metaStrings.priority||\"Priority\";var energyLabel=formStrings.energyLabel||metaStrings.energy||\"Energy\";var contextLabel=formStrings.contextLabel||metaStrings.context||\"Context(s)\";var metadataHtml=\"\\n          <div class=\\\"rt-meta-section\\\">\\n            <div class=\\\"rt-meta-grid\\\">\\n              <label class=\\\"rt-input-wrap\\\">\".concat(escapeHtml(projectLabel),\"<br/>\\n                <div class=\\\"rt-project-inline-row\\\">\\n                  <input data-rt-field=\\\"project\\\" type=\\\"text\\\" list=\\\"\").concat(projectDatalistId,\"\\\" placeholder=\\\"\").concat(escapeHtml(placeholderOr(\"projectPlaceholder\",\"Project\")),\"\\\" value=\\\"\").concat(escapeHtml(snapshot.project||\"\"),\"\\\" />\\n                  <button type=\\\"button\\\" class=\\\"rt-project-inline-btn\\\" data-rt-action=\\\"project-picker\\\">\").concat(escapeHtml(projectPickerLabel),\"</button>\\n                </div>\\n                <datalist id=\\\"\").concat(projectDatalistId,\"\\\">\").concat(projectDatalistOptions,\"</datalist>\\n              </label>\\n              <label class=\\\"rt-input-wrap\\\">\").concat(escapeHtml(gtdLabel),\"<br/>\\n                <select data-rt-field=\\\"gtd\\\">\\n                  <option value=\\\"\\\"></option>\\n                  <option value=\\\"next action\\\"\").concat(snapshot.gtd===\"next action\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"gtdOptions\",\"next action\",\"Next Action\")),\"</option>\\n                  <option value=\\\"delegated\\\"\").concat(snapshot.gtd===\"delegated\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"gtdOptions\",\"delegated\",\"Delegated\")),\"</option>\\n                  <option value=\\\"deferred\\\"\").concat(snapshot.gtd===\"deferred\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"gtdOptions\",\"deferred\",\"Deferred\")),\"</option>\\n                  <option value=\\\"someday\\\"\").concat(snapshot.gtd===\"someday\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"gtdOptions\",\"someday\",\"Someday\")),\"</option>\\n                </select>\\n              </label>\\n              <label class=\\\"rt-input-wrap\\\">\").concat(escapeHtml(waitingLabel),\"<br/>\\n                <div class=\\\"rt-project-inline-row\\\">\\n                  <input data-rt-field=\\\"waitingFor\\\" type=\\\"text\\\" placeholder=\\\"\").concat(escapeHtml(placeholderOr(\"waitingPlaceholder\",\"Waiting-for\")),\"\\\" value=\\\"\").concat(escapeHtml(snapshot.waitingFor||\"\"),\"\\\" />\\n                  <button type=\\\"button\\\" class=\\\"rt-project-inline-btn\\\" data-rt-action=\\\"waiting-picker\\\">\").concat(escapeHtml(waitingPickerLabel),\"</button>\\n                </div>\\n              </label>\\n              <label class=\\\"rt-input-wrap\\\">\").concat(escapeHtml(priorityLabel),\"<br/>\\n                <select data-rt-field=\\\"priority\\\">\\n                  <option value=\\\"\\\"></option>\\n                  <option value=\\\"low\\\"\").concat(snapshot.priority===\"low\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"priorityOptions\",\"low\",\"Low\")),\"</option>\\n                  <option value=\\\"medium\\\"\").concat(snapshot.priority===\"medium\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"priorityOptions\",\"medium\",\"Medium\")),\"</option>\\n                  <option value=\\\"high\\\"\").concat(snapshot.priority===\"high\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"priorityOptions\",\"high\",\"High\")),\"</option>\\n                </select>\\n              </label>\\n              <label class=\\\"rt-input-wrap\\\">\").concat(escapeHtml(contextLabel),\"<br/>\\n                <div class=\\\"rt-project-inline-row\\\">\\n                  <input data-rt-field=\\\"context\\\" type=\\\"text\\\" placeholder=\\\"\").concat(escapeHtml(placeholderOr(\"contextPlaceholder\",\"@home, @work\")),\"\\\" value=\\\"\").concat(escapeHtml(snapshot.context||\"\"),\"\\\" />\\n                  <button type=\\\"button\\\" class=\\\"rt-project-inline-btn\\\" data-rt-action=\\\"context-picker\\\">\").concat(escapeHtml(contextPickerLabel),\"</button>\\n                </div>\\n              </label>\\n              <label class=\\\"rt-input-wrap\\\">\").concat(escapeHtml(energyLabel),\"<br/>\\n                <select data-rt-field=\\\"energy\\\">\\n                  <option value=\\\"\\\"></option>\\n                  <option value=\\\"low\\\"\").concat(snapshot.energy===\"low\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"energyOptions\",\"low\",\"Low\")),\"</option>\\n                  <option value=\\\"medium\\\"\").concat(snapshot.energy===\"medium\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"energyOptions\",\"medium\",\"Medium\")),\"</option>\\n                  <option value=\\\"high\\\"\").concat(snapshot.energy===\"high\"?\" selected\":\"\",\">\").concat(escapeHtml(optionLabel(\"energyOptions\",\"high\",\"High\")),\"</option>\\n                </select>\\n              </label>\\n            </div>\\n          </div>\\n        \");var fieldSelectors={task:'[data-rt-field=\"task\"]',repeat:'[data-rt-field=\"repeat\"]',due:'[data-rt-field=\"due\"]',start:'[data-rt-field=\"start\"]',defer:'[data-rt-field=\"defer\"]',project:'[data-rt-field=\"project\"]',waitingFor:'[data-rt-field=\"waitingFor\"]',context:'[data-rt-field=\"context\"]',priority:'[data-rt-field=\"priority\"]',energy:'[data-rt-field=\"energy\"]',gtd:'[data-rt-field=\"gtd\"]'};var promptMessage=includeTaskText?formStrings.messageWithTask||\"Enter the task text, optional repeat rule, dates, and metadata.\":formStrings.messageWithoutTask||\"Enter an optional repeat rule, dates, and metadata.\";var messageHtml=promptMessage;var inputs=[];if(includeTaskText){inputs.push([taskInputHtml,\"input\",function(_instance,_toast,input){snapshot.task=input.value;},true]);}var repeatConfig=[repeatInputHtml,\"input\",function(_instance,_toast,input){snapshot.repeat=input.value;}];if(!includeTaskText)repeatConfig.push(true);inputs.push(repeatConfig);inputs.push([startInputHtml,\"input\",function(_instance,_toast,input){if((input===null||input===void 0?void 0:input.type)===\"date\"){snapshot.startIso=input.value;}}]);inputs.push([deferInputHtml,\"input\",function(_instance,_toast,input){if((input===null||input===void 0?void 0:input.type)===\"date\"){snapshot.deferIso=input.value;}}]);inputs.push([dueInputHtml,\"input\",function(_instance,_toast,input){if((input===null||input===void 0?void 0:input.type)===\"date\"){snapshot.dueIso=input.value;}}]);var titleText=translateString(\"Better Tasks\",lang);var saveLabel=t(\"buttons.save\",lang)||\"Save\";var cancelLabel=t(\"buttons.cancel\",lang)||\"Cancel\";izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:\"light\",color:\"black\",layout:2,\"class\":\"betterTasks2 bt-toast-strong-icon\",position:\"center\",drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,title:titleText,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#3a7c2b\",message:translateString(messageHtml,lang),inputs:inputs,buttons:[[\"<button type=\\\"button\\\">\".concat(escapeHtml(saveLabel),\"</button>\"),(/*#__PURE__*/function(){var _ref42=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee82(instance,toastEl,_btn,_event,inputsArray){var getFieldValue,taskValueRaw,taskValue,_toastEl$querySelecto4,_toastEl$querySelecto5,repeatValue,dueIso,startIso,deferIso,projectVal,waitingVal,contextVal,priorityVal,energyVal,gtdVal,normalizedRepeat,dueText,dueDate,_toastEl$querySelecto6,_toastEl$querySelecto7,startText,startDate,_toastEl$querySelecto8,_toastEl$querySelecto9,deferText,deferDate,_toastEl$querySelecto0,_toastEl$querySelecto1;return _regenerator().w(function(_context82){while(1)switch(_context82.n){case 0:getFieldValue=function getFieldValue(name){var el=toastEl===null||toastEl===void 0?void 0:toastEl.querySelector(fieldSelectors[name]);var domVal=typeof(el===null||el===void 0?void 0:el.value)===\"string\"?el.value:\"\";if(domVal&&domVal.trim())return domVal.trim();if(Array.isArray(inputsArray)){var _inputsArray$idx;var indexMap=includeTaskText?{task:0,repeat:1,start:2,defer:3,due:4}:{repeat:0,start:1,defer:2,due:3};var idx=indexMap[name];if(idx!=null&&(_inputsArray$idx=inputsArray[idx])!==null&&_inputsArray$idx!==void 0&&_inputsArray$idx.value){var v=String(inputsArray[idx].value).trim();if(v)return v;}}switch(name){case\"task\":return(snapshot.task||\"\").trim();case\"repeat\":return(snapshot.repeat||\"\").trim();case\"start\":return snapshot.startIso||\"\";case\"defer\":return snapshot.deferIso||\"\";case\"due\":return snapshot.dueIso||\"\";case\"project\":return snapshot.project||\"\";case\"waitingFor\":return snapshot.waitingFor||\"\";case\"context\":return snapshot.context||\"\";case\"priority\":return snapshot.priority||\"\";case\"energy\":return snapshot.energy||\"\";case\"gtd\":return snapshot.gtd||\"\";default:return\"\";}};taskValueRaw=includeTaskText?getFieldValue(\"task\"):\"\";if(includeTaskText)snapshot.task=taskValueRaw;taskValue=taskValueRaw.trim();if(!(includeTaskText&&!taskValue)){_context82.n=1;break;}toast(\"Task text is required.\");toastEl===null||toastEl===void 0||(_toastEl$querySelecto4=toastEl.querySelector(fieldSelectors.task))===null||_toastEl$querySelecto4===void 0||(_toastEl$querySelecto5=_toastEl$querySelecto4.focus)===null||_toastEl$querySelecto5===void 0||_toastEl$querySelecto5.call(_toastEl$querySelecto4);return _context82.a(2);case 1:repeatValue=getFieldValue(\"repeat\");dueIso=getFieldValue(\"due\");startIso=getFieldValue(\"start\");deferIso=getFieldValue(\"defer\");projectVal=(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.normalizeProjectValue)(getFieldValue(\"project\"));waitingVal=getFieldValue(\"waitingFor\");contextVal=getFieldValue(\"context\");priorityVal=getFieldValue(\"priority\");energyVal=getFieldValue(\"energy\");gtdVal=getFieldValue(\"gtd\");normalizedRepeat=repeatValue?normalizeRepeatRuleText(repeatValue)||repeatValue:\"\";dueText=null;dueDate=null;if(!dueIso){_context82.n=3;break;}dueDate=parseRoamDate(dueIso);if(!(!(dueDate instanceof Date)||Number.isNaN(dueDate.getTime()))){_context82.n=2;break;}toast(\"Couldn't parse that date.\");toastEl===null||toastEl===void 0||(_toastEl$querySelecto6=toastEl.querySelector(fieldSelectors.due))===null||_toastEl$querySelecto6===void 0||(_toastEl$querySelecto7=_toastEl$querySelecto6.focus)===null||_toastEl$querySelecto7===void 0||_toastEl$querySelecto7.call(_toastEl$querySelecto6);return _context82.a(2);case 2:dueText=dueIso;case 3:startText=null;startDate=null;if(!startIso){_context82.n=5;break;}startDate=parseRoamDate(startIso);if(!(!(startDate instanceof Date)||Number.isNaN(startDate.getTime()))){_context82.n=4;break;}toast(\"Couldn't parse that date.\");toastEl===null||toastEl===void 0||(_toastEl$querySelecto8=toastEl.querySelector(fieldSelectors.start))===null||_toastEl$querySelecto8===void 0||(_toastEl$querySelecto9=_toastEl$querySelecto8.focus)===null||_toastEl$querySelecto9===void 0||_toastEl$querySelecto9.call(_toastEl$querySelecto8);return _context82.a(2);case 4:startText=startIso;case 5:deferText=null;deferDate=null;if(!deferIso){_context82.n=7;break;}deferDate=parseRoamDate(deferIso);if(!(!(deferDate instanceof Date)||Number.isNaN(deferDate.getTime()))){_context82.n=6;break;}toast(\"Couldn't parse that date.\");toastEl===null||toastEl===void 0||(_toastEl$querySelecto0=toastEl.querySelector(fieldSelectors.defer))===null||_toastEl$querySelecto0===void 0||(_toastEl$querySelecto1=_toastEl$querySelecto0.focus)===null||_toastEl$querySelecto1===void 0||_toastEl$querySelecto1.call(_toastEl$querySelecto0);return _context82.a(2);case 6:deferText=deferIso;case 7:_context82.n=8;return delay(TOAST_HIDE_DELAY_MS);case 8:instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");if(projectVal)(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption)(projectVal);finish({repeat:normalizedRepeat||\"\",repeatRaw:repeatValue,due:dueText,dueDate:dueDate,start:startText,startDate:startDate,defer:deferText,deferDate:deferDate,taskText:includeTaskText?taskValue:undefined,taskTextRaw:includeTaskText?taskValueRaw:undefined,project:projectVal||\"\",waitingFor:waitingVal||\"\",context:contextVal||\"\",priority:priorityVal||\"\",energy:energyVal||\"\",gtd:gtdVal||\"\"});case 9:return _context82.a(2);}},_callee82);}));return function(_x199,_x200,_x201,_x202,_x203){return _ref42.apply(this,arguments);};}()),true],[\"<button type=\\\"button\\\">\".concat(escapeHtml(cancelLabel),\"</button>\"),function(instance,toastEl){instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");finish(null);}]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},onOpened:function onOpened(_instance,toastEl){if(!toastEl)return;var inputsContainer=toastEl.querySelector(\".iziToast-inputs\");if(inputsContainer){var _inputsContainer$quer;(_inputsContainer$quer=inputsContainer.querySelector(\".rt-meta-section\"))===null||_inputsContainer$quer===void 0||_inputsContainer$quer.remove();var frag=document.createElement(\"div\");frag.innerHTML=metadataHtml;var section=frag.firstElementChild;if(section)inputsContainer.appendChild(section);}// Ensure metadata fields reflect current snapshot values (e.g., after back navigation)\nvar assignIfPresent=function assignIfPresent(selector,value){var el=toastEl.querySelector(selector);if(el)el.value=value;};assignIfPresent(fieldSelectors.gtd,snapshot.gtd||\"\");assignIfPresent(fieldSelectors.project,snapshot.project||\"\");assignIfPresent(fieldSelectors.waitingFor,snapshot.waitingFor||\"\");assignIfPresent(fieldSelectors.context,snapshot.context||\"\");assignIfPresent(fieldSelectors.priority,snapshot.priority||\"\");assignIfPresent(fieldSelectors.energy,snapshot.energy||\"\");var projectButton=toastEl.querySelector('[data-rt-action=\"project-picker\"]');if(projectButton){projectButton.addEventListener(\"click\",/*#__PURE__*/function(){var _ref43=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee83(event){var _toastEl$querySelecto10;var currentVal,selection,normalized,projectInput;return _regenerator().w(function(_context83){while(1)switch(_context83.n){case 0:event.preventDefault();_context83.n=1;return (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)();case 1:currentVal=((_toastEl$querySelecto10=toastEl.querySelector(fieldSelectors.project))===null||_toastEl$querySelecto10===void 0?void 0:_toastEl$querySelecto10.value)||snapshot.project||\"\";_context83.n=2;return promptForProject({initialValue:currentVal});case 2:selection=_context83.v;if(selection!=null){normalized=(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.normalizeProjectValue)(selection);snapshot.project=normalized;projectInput=toastEl.querySelector(fieldSelectors.project);if(projectInput)projectInput.value=normalized;(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption)(normalized);}case 3:return _context83.a(2);}},_callee83);}));return function(_x204){return _ref43.apply(this,arguments);};}());}var waitingButton=toastEl.querySelector('[data-rt-action=\"waiting-picker\"]');if(waitingButton){waitingButton.addEventListener(\"click\",/*#__PURE__*/function(){var _ref44=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee84(event){var _toastEl$querySelecto11;var currentVal,selection,input;return _regenerator().w(function(_context84){while(1)switch(_context84.n){case 0:event.preventDefault();_context84.n=1;return (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)();case 1:currentVal=((_toastEl$querySelecto11=toastEl.querySelector(fieldSelectors.waitingFor))===null||_toastEl$querySelecto11===void 0?void 0:_toastEl$querySelecto11.value)||snapshot.waitingFor||\"\";_context84.n=2;return promptForWaiting({initialValue:currentVal});case 2:selection=_context84.v;if(selection!=null){snapshot.waitingFor=selection;input=toastEl.querySelector(fieldSelectors.waitingFor);if(input)input.value=selection;(0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.addWaitingOption)(selection);}case 3:return _context84.a(2);}},_callee84);}));return function(_x205){return _ref44.apply(this,arguments);};}());}var contextButton=toastEl.querySelector('[data-rt-action=\"context-picker\"]');if(contextButton){contextButton.addEventListener(\"click\",/*#__PURE__*/function(){var _ref45=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee85(event){var _toastEl$querySelecto12;var currentVal,initialContexts,selection,val,input;return _regenerator().w(function(_context85){while(1)switch(_context85.n){case 0:event.preventDefault();_context85.n=1;return (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)();case 1:currentVal=((_toastEl$querySelecto12=toastEl.querySelector(fieldSelectors.context))===null||_toastEl$querySelecto12===void 0?void 0:_toastEl$querySelecto12.value)||snapshot.context||\"\";initialContexts=currentVal?currentVal.split(\",\").map(function(v){return v.trim();}).filter(Boolean):[];_context85.n=2;return promptForContext({initialValue:initialContexts});case 2:selection=_context85.v;if(selection!=null){val=Array.isArray(selection)?selection.join(\", \"):selection||\"\";snapshot.context=val;input=toastEl.querySelector(fieldSelectors.context);if(input)input.value=val;(Array.isArray(selection)?selection:[val]).forEach(function(ctx){return (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.addContextOption)(ctx);});}case 3:return _context85.a(2);}},_callee85);}));return function(_x206){return _ref45.apply(this,arguments);};}());}var focusPrimaryInput=function focusPrimaryInput(){var selectors=includeTaskText?[\"input[data-rt-field=\\\"task\\\"]\",\"input[data-rt-field=\\\"repeat\\\"]\"]:[\"input[data-rt-field=\\\"repeat\\\"]\"];for(var _i16=0,_selectors=selectors;_i16<_selectors.length;_i16++){var selector=_selectors[_i16];var field=toastEl.querySelector(selector);if(field){field.focus();if(field.setSelectionRange&&typeof field.value===\"string\"){var len=field.value.length;field.setSelectionRange(len,len);}return true;}}return false;};var attempts=0;var _tryFocus=function tryFocus(){attempts+=1;if(focusPrimaryInput())return;if(attempts<5)requestAnimationFrame(_tryFocus);};requestAnimationFrame(_tryFocus);var handleArrowToPicker=function handleArrowToPicker(event){if(event.key!==\"ArrowDown\")return;var input=event.currentTarget;if(!input)return;event.preventDefault();if(typeof input.showPicker===\"function\"){try{input.showPicker();return;}catch(_){}}try{input.focus();input.click();}catch(_){}};for(var _i17=0,_arr=[\"start\",\"defer\",\"due\"];_i17<_arr.length;_i17++){var _toastEl$querySelecto13;var key=_arr[_i17];(_toastEl$querySelecto13=toastEl.querySelectorAll(fieldSelectors[key]))===null||_toastEl$querySelecto13===void 0||_toastEl$querySelecto13.forEach(function(input){input.addEventListener(\"keydown\",handleArrowToPicker);});}},onClosed:function onClosed(){return finish(null);}});}));}},_callee86);}));return _promptForRepeatAndDue.apply(this,arguments);}function ensureAdvancePreference(_x96,_x97,_x98,_x99,_x100){return _ensureAdvancePreference.apply(this,arguments);}function _ensureAdvancePreference(){_ensureAdvancePreference=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee87(uid,block,meta,set,checkbox){var existing,defaultChoice,choice,_activeDashboardContr76,_activeDashboardContr77,_activeDashboardContr78,_activeDashboardContr79,_activeDashboardContr80,_activeDashboardContr81;return _regenerator().w(function(_context87){while(1)switch(_context87.n){case 0:existing=normalizeAdvanceValue(meta.advanceFrom);if(!existing){_context87.n=1;break;}return _context87.a(2,existing);case 1:if(!bulkOperationInProgress){_context87.n=3;break;}defaultChoice=\"due\";_context87.n=2;return ensureAdvanceChildAttr(uid,defaultChoice,meta,set.attrNames);case 2:meta.advanceFrom=defaultChoice;return _context87.a(2,defaultChoice);case 3:_context87.n=4;return promptAdvanceModeSelection(meta,set);case 4:choice=_context87.v;if(choice){_context87.n=8;break;}_context87.n=5;return revertBlockCompletion(block);case 5:if(checkbox)checkbox.checked=false;toast(\"Better Task completion cancelled.\");if(!activeDashboardController){_context87.n=7;break;}_context87.n=6;return(_activeDashboardContr76=(_activeDashboardContr77=activeDashboardController).notifyBlockChange)===null||_activeDashboardContr76===void 0?void 0:_activeDashboardContr76.call(_activeDashboardContr77,uid);case 6:if(!((_activeDashboardContr78=(_activeDashboardContr79=activeDashboardController).isOpen)!==null&&_activeDashboardContr78!==void 0&&_activeDashboardContr78.call(_activeDashboardContr79))){_context87.n=7;break;}_context87.n=7;return(_activeDashboardContr80=(_activeDashboardContr81=activeDashboardController).refresh)===null||_activeDashboardContr80===void 0?void 0:_activeDashboardContr80.call(_activeDashboardContr81,{reason:\"advance-cancel\"});case 7:return _context87.a(2,null);case 8:_context87.n=9;return ensureAdvanceChildAttr(uid,choice,meta,set.attrNames);case 9:meta.advanceFrom=choice;return _context87.a(2,choice);}},_callee87);}));return _ensureAdvancePreference.apply(this,arguments);}function promptAdvanceModeSelection(_x101,_x102){return _promptAdvanceModeSelection.apply(this,arguments);}function _promptAdvanceModeSelection(){_promptAdvanceModeSelection=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee88(meta,set){var rule,dueSet,completionSet,previewLimit,duePreview,completionPreview,message;return _regenerator().w(function(_context88){while(1)switch(_context88.n){case 0:rule=parseRuleText(meta.repeat,set);dueSet=_objectSpread(_objectSpread({},set),{},{advanceFrom:\"due\"});completionSet=_objectSpread(_objectSpread({},set),{},{advanceFrom:\"completion\"});previewLimit=determineAdvancePreviewLimit(rule);duePreview=previewOccurrences(meta,dueSet,previewLimit);completionPreview=previewOccurrences(meta,completionSet,previewLimit);message=\"\\n        <div class=\\\"rt-advance-choice\\\">\\n          <p>Select how this series should schedule future occurrences.</p>\\n          <p><strong>Due date</strong>: \".concat(escapeHtml(formatPreviewDates(duePreview,set)),\"</p>\\n          <p><strong>Completion date</strong>: \").concat(escapeHtml(formatPreviewDates(completionPreview,set)),\"</p>\\n          <p class=\\\"rt-note\\\">You can change this later by editing the <code>\").concat(ADVANCE_ATTR,\"</code> child block.</p>\\n        </div>\\n      \");return _context88.a(2,new Promise(function(resolve){var resolved=false;var finish=function finish(value){if(resolved)return;resolved=true;resolve(value);};izitoast__WEBPACK_IMPORTED_MODULE_0___default().question({theme:\"light\",color:\"black\",layout:2,\"class\":\"betterTasks bt-toast-strong-icon\",position:\"center\",drag:false,timeout:false,close:true,closeOnEscape:true,overlay:true,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#1f7a34\",title:translateString(\"Choose scheduling mode\",getLanguageSetting()),message:message,buttons:[[\"<button>\".concat(escapeHtml(t([\"buttons\",\"dueDate\"],getLanguageSetting())||\"Due date\"),\"</button>\"),function(instance,toastEl){instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");finish(\"due\");},true],[\"<button>\".concat(escapeHtml(t([\"buttons\",\"completionDate\"],getLanguageSetting())||\"Completion date\"),\"</button>\"),function(instance,toastEl){instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");finish(\"completion\");}],[\"<button>\".concat(escapeHtml(t([\"buttons\",\"cancel\"],getLanguageSetting())||\"Cancel\"),\"</button>\"),function(instance,toastEl){instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");finish(null);}]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);},onClosed:function onClosed(){return finish(null);}});}));}},_callee88);}));return _promptAdvanceModeSelection.apply(this,arguments);}function determineAdvancePreviewLimit(rule){if(!rule)return 1;if(rule.kind===\"WEEKLY\"&&Array.isArray(rule.byDay)&&rule.byDay.length>1){return Math.min(rule.byDay.length,3);}return 1;}function previewOccurrences(meta,setOverride){var limit=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var clone=cloneMetaForPreview(meta);var dates=[];for(var i=0;i<limit;i++){var next=computeNextDue(clone,setOverride);if(!(next instanceof Date))break;dates.push(new Date(next.getTime()));clone.due=new Date(next.getTime());}return dates;}function cloneMetaForPreview(meta){return{uid:meta.uid,repeat:meta.repeat,due:meta.due?new Date(meta.due.getTime()):null,start:meta.start?new Date(meta.start.getTime()):null,defer:meta.defer?new Date(meta.defer.getTime()):null,childAttrMap:clonePlain(meta.childAttrMap||{}),props:clonePlain(meta.props||{}),advanceFrom:meta.advanceFrom||null};}function formatPreviewDates(dates,set){if(!dates.length)return\"Not available\";if(dates.length===1)return formatFriendlyDate(dates[0],set);return dates.map(function(d){return formatFriendlyDate(d,set);}).join(\" â†’ \");}function handleAttributeNameChange(){var prev=lastAttrNames||resolveAttributeNames();var next=resolveAttributeNames();updateAttrNameHistory(prev,next);lastAttrNames=next;repeatOverrides.clear();scheduleSurfaceSync(lastAttrSurface);void (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)(true);}function scheduleSurfaceSync(surface){if(pendingSurfaceSync)clearTimeout(pendingSurfaceSync);pendingSurfaceSync=setTimeout(function(){pendingSurfaceSync=null;var current=lastAttrSurface||surface||\"Child\";void syncPillsForSurface(current);},200);}function clearAllPills(){var _document$querySelect3,_document5;var removeStyle=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;(_document$querySelect3=(_document5=document).querySelectorAll)===null||_document$querySelect3===void 0||(_document$querySelect3=_document$querySelect3.call(_document5,\".rt-pill-wrap\"))===null||_document$querySelect3===void 0||_document$querySelect3.forEach(function(el){return el.remove();});if(removeStyle){var style=document.getElementById(\"rt-pill-style\");if(style!==null&&style!==void 0&&style.parentNode)style.parentNode.removeChild(style);var menuStyle=document.getElementById(\"rt-pill-menu-style\");if(menuStyle!==null&&menuStyle!==void 0&&menuStyle.parentNode)menuStyle.parentNode.removeChild(menuStyle);}}function ensurePillStyles(){if(document.getElementById(\"rt-pill-style\"))return;var style=document.createElement(\"style\");style.id=\"rt-pill-style\";style.textContent=\"\\n        .rt-pill-wrap {\\n          display: inline-flex;\\n          align-items: center;\\n          gap: 8px;\\n          margin-left: 12px;\\n          flex-wrap: wrap;\\n        }\\n        .rt-pill {\\n          display: inline-flex;\\n          align-items: center;\\n          padding: 2px 8px;\\n          border-radius: 12px;\\n          border: 1px solid var(--rt-pill-border, #ccc);\\n          font-size: 12px;\\n          cursor: pointer;\\n          user-select: none;\\n          transition: background 0.15s ease, border-color 0.15s ease;\\n          background: var(--rt-pill-bg, rgba(0, 0, 0, 0.03));\\n        }\\n        .rt-pill:hover {\\n          background: rgba(0,0,0,0.08);\\n          border-color: var(--rt-pill-border-hover, #bbb);\\n        }\\n        .rt-pill-inline {\\n          float: right;\\n        }\\n        .rt-pill-repeat,\\n        .rt-pill-due,\\n        .rt-pill-start,\\n        .rt-pill-defer {\\n          cursor: pointer;\\n          display: inline-flex;\\n          align-items: center;\\n          gap: 4px;\\n        }\\n        .rt-pill-meta {\\n          display: inline-flex;\\n          align-items: center;\\n          gap: 4px;\\n          cursor: pointer;\\n        }\\n        .rt-pill-icon {\\n          font-size: 11px;\\n          line-height: 1;\\n          opacity: 0.8;\\n        }\\n        .rt-pill-text {\\n          line-height: 1.2;\\n        }\\n        .rt-pill-menu-btn {\\n          margin-left: 6px;\\n          font-weight: 600;\\n          cursor: pointer;\\n          padding: 0 4px;\\n        }\\n        .rt-pill-menu-btn:hover {\\n          background: rgba(0,0,0,0.12);\\n        }\\n      \";document.head.appendChild(style);}function ensureTodayPanelStyles(){if(document.getElementById(\"bt-today-style\"))return;var style=document.createElement(\"style\");style.id=\"bt-today-style\";style.textContent=\"\\n        .bt-today-panel-root {\\n          width: 100%;\\n          box-sizing: border-box;\\n          padding: 6px 8px;\\n          margin-left: 14px;\\n        }\\n        .bt-today-panel__header {\\n          display: flex;\\n          align-items: center;\\n          gap: 6px;\\n          font-weight: 600;\\n          margin-bottom: 6px;\\n        }\\n        .bt-today-panel__section {\\n          margin-bottom: 6px;\\n        }\\n        .bt-today-panel__section-header {\\n          font-weight: 600;\\n          cursor: default;\\n          margin-bottom: 4px;\\n        }\\n        .bt-today-panel__list {\\n          list-style: none;\\n          padding-left: 14px;\\n          margin: 0;\\n        }\\n        .bt-today-panel__row {\\n          display: flex;\\n          justify-content: space-between;\\n          align-items: center;\\n          gap: 8px;\\n          padding: 4px 0;\\n        }\\n        .bt-today-panel__row-title {\\n          background: transparent;\\n          border: none;\\n          padding: 0;\\n          text-align: left;\\n          cursor: pointer;\\n          font: inherit;\\n          color: inherit;\\n        }\\n        .bt-today-panel__item--completed .bt-today-panel__row-title {\\n          text-decoration: line-through;\\n          opacity: 0.6;\\n        }\\n        .bt-today-panel__row-actions {\\n          display: flex;\\n          gap: 6px;\\n        }\\n        .bt-today-panel__icon-btn {\\n          border: 1px solid var(--bt-border, rgba(0,0,0,0.22));\\n          border-radius: 6px;\\n          background: var(--bt-panel-bg, #fff);\\n          padding: 2px 6px;\\n          cursor: pointer;\\n          color: var(--bt-panel-text, inherit);\\n          box-shadow: 0 1px 2px rgba(0,0,0,0.14);\\n        }\\n      \";document.head.appendChild(style);}function getTodaySetting(settingId){return extensionAPI.settings.get(settingId);}function getLanguageSetting(){var _extensionAPI$setting19,_extensionAPI$setting20;var override=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var normalizeLanguageValue=function normalizeLanguageValue(raw){var val=normalizeTodaySettingValue(raw);if(val&&_typeof(val)===\"object\"&&\"value\"in val){val=val.value;}if(typeof val!==\"string\")return null;var cleaned=val.trim();if(!cleaned)return null;var lower=cleaned.toLowerCase();if(lower===\"zh-hant\"||lower===\"zh_hant\"||lower===\"zh-tw\"||lower===\"zh-hk\"){return\"zhHant\";}if(lower===\"zh-hans\"||lower===\"zh_hans\"||lower===\"zh-cn\"){return\"zh\";}return cleaned;};var candidates=[override,extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting19=extensionAPI.settings)===null||_extensionAPI$setting19===void 0||(_extensionAPI$setting20=_extensionAPI$setting19.get)===null||_extensionAPI$setting20===void 0?void 0:_extensionAPI$setting20.call(_extensionAPI$setting19,LANGUAGE_SETTING),currentLanguage];for(var _i5=0,_candidates2=candidates;_i5<_candidates2.length;_i5++){var raw=_candidates2[_i5];var normalized=normalizeLanguageValue(raw);if(normalized&&SUPPORTED_LANGUAGES.includes(normalized)){currentLanguage=normalized;return currentLanguage;}}currentLanguage=\"en\";return currentLanguage;}function t(path){var lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"en\";var parts=Array.isArray(path)?path:String(path||\"\").split(\".\");var resolve=function resolve(obj){return parts.reduce(function(acc,key){return acc&&Object.prototype.hasOwnProperty.call(acc,key)?acc[key]:undefined;},obj);};var primary=resolve(_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===null||_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===void 0?void 0:_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n[lang]);if(primary!==undefined)return primary;if(lang!==\"en\"){var fallback=resolve(_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===null||_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===void 0?void 0:_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n.en);if(fallback!==undefined)return fallback;}return undefined;}function translateString(raw){var lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:getLanguageSetting();if(typeof raw!==\"string\")return raw;var path=EN_STRING_PATH_MAP.get(raw);if(path){var translated=t(path,lang);if(typeof translated===\"string\")return translated;}return raw;}function translateMetaValue(type,value){var lang=arguments.length>2&&arguments[2]!==undefined?arguments[2]:getLanguageSetting();if(!value)return\"\";var key=String(value).trim().toLowerCase();var val=t([\"dashboard\",\"filterValues\",key],lang)||t([\"metadata\",type],lang)||null;if(val)return val;if(type===\"gtd\")return formatGtdStatusDisplay(value);if(type===\"priority\"||type===\"energy\")return formatPriorityEnergyDisplay(value);return value;}function normalizeTodayWidgetEnabled(raw){if(raw===undefined||raw===null)return false;// default off (first install)\nif(raw===true||raw===\"true\"||raw===1||raw===\"1\")return true;if(raw===false||raw===\"false\"||raw===0||raw===\"0\")return false;var norm=typeof raw===\"string\"?raw.trim().toLowerCase():raw;if(norm===\"off\"||norm===\"no\")return false;return!!raw;}function getTodayWidgetEnabled(){if(todayEnabledOverride!==null&&todayEnabledOverride!==undefined){return!!todayEnabledOverride;}var raw=getTodaySetting(TODAY_WIDGET_ENABLE_SETTING);return normalizeTodayWidgetEnabled(raw);}function normalizeTodaySettingValue(raw){if(raw&&_typeof(raw)===\"object\"&&raw.target){var _t6=raw.target;if(_t6.type===\"checkbox\"&&\"checked\"in _t6)return _t6.checked;if(\"value\"in _t6)return _t6.value;if(\"checked\"in _t6)return _t6.checked;}return raw;}function setTodayEnabledOverride(value){todayEnabledOverride=value;var clearIfPersisted=function clearIfPersisted(){var stored=normalizeTodayWidgetEnabled(extensionAPI.settings.get(TODAY_WIDGET_ENABLE_SETTING));if(stored===normalizeTodayWidgetEnabled(value)){todayEnabledOverride=null;}};setTimeout(clearIfPersisted,6000);setTimeout(clearIfPersisted,12000);}function handleTodaySettingChange(){return _handleTodaySettingChange.apply(this,arguments);}function _handleTodaySettingChange(){_handleTodaySettingChange=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee89(){var _dashboardTaskCache$c;var settingId,value,prevAnchorText,prevAnchorNormalized,normalizedValue,_args89=arguments;return _regenerator().w(function(_context89){while(1)switch(_context89.n){case 0:settingId=_args89.length>0&&_args89[0]!==undefined?_args89[0]:null;value=_args89.length>1&&_args89[1]!==undefined?_args89[1]:undefined;prevAnchorText=settingId===TODAY_WIDGET_TITLE_SETTING?getTodayAnchorText():null;prevAnchorNormalized=prevAnchorText?normalizeMatchText(prevAnchorText):\"\";normalizedValue=normalizeTodaySettingValue(value);if(settingId){try{extensionAPI.settings.set(settingId,normalizedValue);}catch(err){console.warn(\"[BetterTasks] failed to persist Today setting\",settingId,err);}}// Force next render to bypass caches/snapshots when settings change.\ndashboardTaskCache===null||dashboardTaskCache===void 0||(_dashboardTaskCache$c=dashboardTaskCache.clear)===null||_dashboardTaskCache$c===void 0||_dashboardTaskCache$c.call(dashboardTaskCache);lastTodayWidgetSignature=null;lastTodayInlineSignature=null;if(!(settingId===TODAY_WIDGET_ENABLE_SETTING&&!normalizeTodayWidgetEnabled(normalizedValue))){_context89.n=2;break;}setTodayEnabledOverride(normalizedValue);rebuildSettingsPanel(false);_context89.n=1;return disableTodayWidgetUI();case 1:return _context89.a(2);case 2:if(settingId===TODAY_WIDGET_ENABLE_SETTING){setTodayEnabledOverride(normalizedValue);rebuildSettingsPanel(normalizeTodayWidgetEnabled(normalizedValue),currentLanguage,getTodayBadgeEnabled());}if(todayWidgetRenderTimer){clearTimeout(todayWidgetRenderTimer);todayWidgetRenderTimer=null;}if(!(settingId===TODAY_WIDGET_TITLE_SETTING)){_context89.n=3;break;}if(todayTitleChangeDebounceTimer){clearTimeout(todayTitleChangeDebounceTimer);todayTitleChangeDebounceTimer=null;}// Debounce title changes to avoid creating/moving anchors while the user types.\ntodayTitleChangeDebounceTimer=setTimeout(function(){todayTitleChangeDebounceTimer=null;var nextAnchorNormalized=normalizeMatchText(getTodayAnchorText());if(prevAnchorNormalized&&prevAnchorNormalized!==nextAnchorNormalized){todayAnchorTextHistory[\"delete\"](prevAnchorNormalized);void removeAllTodayAnchorsByQuery({includeHeading:false,textsOverride:[prevAnchorNormalized]});}scheduleTodayWidgetRender(120,true);scheduleTodayBadgeRefresh(120,true);},450);return _context89.a(2);case 3:// Single forced render using the override to avoid flicker from double renders.\nscheduleTodayWidgetRender(40,true);scheduleTodayBadgeRefresh(80,true);case 4:return _context89.a(2);}},_callee89);}));return _handleTodaySettingChange.apply(this,arguments);}function handleTodayBadgeSettingChange(){return _handleTodayBadgeSettingChange.apply(this,arguments);}function _handleTodayBadgeSettingChange(){_handleTodayBadgeSettingChange=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee90(){var settingId,value,normalizedValue,isVisualChange,currentCount,existingColors,sanitizeColor,nextBg,nextFg,nextLabel,_args90=arguments;return _regenerator().w(function(_context90){while(1)switch(_context90.n){case 0:settingId=_args90.length>0&&_args90[0]!==undefined?_args90[0]:null;value=_args90.length>1&&_args90[1]!==undefined?_args90[1]:undefined;normalizedValue=normalizeTodaySettingValue(value);if(settingId){try{extensionAPI.settings.set(settingId,normalizedValue);}catch(err){console.warn(\"[BetterTasks] failed to persist Today badge setting\",settingId,err);}}if(!(settingId===TODAY_BADGE_ENABLE_SETTING)){_context90.n=1;break;}rebuildSettingsPanel(getTodayWidgetEnabled(),currentLanguage,!!normalizedValue);if(normalizedValue){_context90.n=1;break;}removeTodayBadge();return _context90.a(2);case 1:isVisualChange=settingId===TODAY_BADGE_BG_SETTING||settingId===TODAY_BADGE_FG_SETTING||settingId===TODAY_BADGE_LABEL_SETTING;if(isVisualChange){lastTodayBadgeSignature=null;// force DOM update for visual changes\ncurrentCount=todayBadgeCountNode?parseInt(todayBadgeCountNode.textContent||\"0\",10)||0:0;existingColors=getTodayBadgeColors();sanitizeColor=function sanitizeColor(val){if(typeof val!==\"string\")return null;var trimmed=val.trim();if(!trimmed)return null;// empty means fall back to default\nif(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/.test(trimmed))return trimmed;if(/^rgba?\\(/i.test(trimmed))return trimmed;if(/^hsla?\\(/i.test(trimmed))return trimmed;if(/^[a-zA-Z]+$/.test(trimmed))return trimmed;// allow named colors\nreturn null;};nextBg=settingId===TODAY_BADGE_BG_SETTING?sanitizeColor(normalizedValue):existingColors.bg;nextFg=settingId===TODAY_BADGE_FG_SETTING?sanitizeColor(normalizedValue):existingColors.fg;nextLabel=settingId===TODAY_BADGE_LABEL_SETTING&&typeof normalizedValue===\"string\"?normalizedValue:null;if(settingId===TODAY_BADGE_BG_SETTING){todayBadgeOverrides.bg=nextBg;}if(settingId===TODAY_BADGE_FG_SETTING){todayBadgeOverrides.fg=nextFg;}if(settingId===TODAY_BADGE_LABEL_SETTING&&typeof normalizedValue===\"string\"){todayBadgeOverrides.label=normalizedValue;}ensureTodayBadgeDom(currentCount,{colors:{bg:nextBg||null,fg:nextFg||null},labelText:nextLabel||undefined});if(todayBadgeCountNode){todayBadgeCountNode.style.backgroundColor=nextBg||\"\";todayBadgeCountNode.style.color=nextFg||\"\";}if(todayBadgeLabelNode&&nextLabel){todayBadgeLabelNode.textContent=nextLabel;}}scheduleTodayBadgeRefresh(0,true);case 2:return _context90.a(2);}},_callee90);}));return _handleTodayBadgeSettingChange.apply(this,arguments);}function handleLanguageChange(){var _ref15,_nextValue$value,_nextValue$target;var nextValue=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var raw=(_ref15=(_nextValue$value=nextValue===null||nextValue===void 0?void 0:nextValue.value)!==null&&_nextValue$value!==void 0?_nextValue$value:nextValue===null||nextValue===void 0||(_nextValue$target=nextValue.target)===null||_nextValue$target===void 0?void 0:_nextValue$target.value)!==null&&_ref15!==void 0?_ref15:nextValue;if(typeof raw===\"string\"&&SUPPORTED_LANGUAGES.includes(raw)){currentLanguage=raw;}else{currentLanguage=getLanguageSetting();}rebuildSettingsPanel(getTodayWidgetEnabled(),currentLanguage,getTodayBadgeEnabled());try{var _activeDashboardContr42,_activeDashboardContr43;(_activeDashboardContr42=activeDashboardController)===null||_activeDashboardContr42===void 0||(_activeDashboardContr43=_activeDashboardContr42.refreshLanguage)===null||_activeDashboardContr43===void 0||_activeDashboardContr43.call(_activeDashboardContr42);}catch(err){console.warn(\"[BetterTasks] failed to refresh dashboard for language change\",err);}scheduleTodayWidgetRender(100,true);scheduleSurfaceSync(lastAttrSurface||\"Child\");}function getTodayWidgetLayout(){var raw=getTodaySetting(TODAY_WIDGET_LAYOUT_SETTING);if(raw===\"Panel\")return\"panel\";if(raw===\"Roam-style inline\")return\"roamInline\";var norm=typeof raw===\"string\"?raw.trim().toLowerCase():String(raw!==null&&raw!==void 0?raw:\"\").toLowerCase();if(norm===\"panel\")return\"panel\";if(norm===\"roam-style inline\"||norm===\"inline\")return\"roamInline\";if(raw===1||raw===\"1\")return\"roamInline\";if(raw===0||raw===\"0\")return\"panel\";return\"roamInline\";}function getTodayWidgetIncludeOverdue(){var raw=getTodaySetting(TODAY_WIDGET_OVERDUE_SETTING);if(raw===undefined||raw===null)return false;// default off (first install)\nif(raw===false)return false;var norm=typeof raw===\"string\"?raw.trim().toLowerCase():String(raw!==null&&raw!==void 0?raw:\"\").toLowerCase();if([\"false\",\"0\",\"off\",\"no\"].includes(norm))return false;return true;}function getTodayWidgetShowCompleted(){return!!getTodaySetting(TODAY_WIDGET_COMPLETED_SETTING);}function getTodayWidgetPlacement(){var raw=getTodaySetting(TODAY_WIDGET_PLACEMENT_SETTING);return raw===\"Bottom\"?\"Bottom\":\"Top\";}function getTodayBadgeEnabled(){return!!extensionAPI.settings.get(TODAY_BADGE_ENABLE_SETTING);}function getTodayBadgeLabel(){if(todayBadgeOverrides.label)return todayBadgeOverrides.label;var raw=extensionAPI.settings.get(TODAY_BADGE_LABEL_SETTING);var configured=typeof raw===\"string\"&&raw.trim()?raw.trim():null;return configured||getTodayAnchorText();}function getTodayBadgeIncludeOverdue(){var raw=extensionAPI.settings.get(TODAY_BADGE_OVERDUE_SETTING);if(raw===false||raw===\"false\"||raw===0||raw===\"0\")return false;return true;}function getTodayBadgeColors(){var bg=todayBadgeOverrides.bg||extensionAPI.settings.get(TODAY_BADGE_BG_SETTING);var fg=todayBadgeOverrides.fg||extensionAPI.settings.get(TODAY_BADGE_FG_SETTING);return{bg:typeof bg===\"string\"&&bg.trim()||null,fg:typeof fg===\"string\"&&fg.trim()||null};}function getTodayWidgetHeadingLevel(){var raw=getTodaySetting(TODAY_WIDGET_HEADING_SETTING);if(raw===1||raw===\"1\"||raw===\"H1\")return 1;if(raw===2||raw===\"2\"||raw===\"H2\")return 2;if(raw===3||raw===\"3\"||raw===\"H3\")return 3;if(typeof raw===\"string\"){var norm=raw.trim().toLowerCase();if(norm===\"h1\"||norm===\"heading 1\")return 1;if(norm===\"h2\"||norm===\"heading 2\")return 2;if(norm===\"h3\"||norm===\"heading 3\")return 3;}return 0;// None / default\n}function readTodayConfig(){var layout=getTodayWidgetLayout();var includeOverdue=getTodayWidgetIncludeOverdue();var showCompleted=getTodayWidgetShowCompleted();var placement=getTodayWidgetPlacement();var heading=getTodayWidgetHeadingLevel();var anchorText=getTodayAnchorText();var signature=[layout,includeOverdue?\"overdue\":\"nooverdue\",showCompleted?\"showdone\":\"hidedone\",placement,\"h\".concat(heading),\"t:\".concat(anchorText)].join(\"|\");return{layout:layout,includeOverdue:includeOverdue,showCompleted:showCompleted,placement:placement,heading:heading,anchorText:anchorText,signature:signature};}function getPillCheckboxThreshold(){var raw=extensionAPI.settings.get(PILL_THRESHOLD_SETTING);if(typeof raw===\"string\"){var match=raw.trim().match(/^\\d+$/);if(match){var parsed=parseInt(match[0],10);if(Number.isFinite(parsed)&&parsed>0)return parsed;}}return DEFAULT_PILL_THRESHOLD;}function scheduleTodayWidgetRender(){var delayMs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:200;var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!TODAY_WIDGET_ENABLED||!getTodayWidgetEnabled())return;var now=Date.now();// If circuit breaker is tripped, ignore schedules until cooldown ends.\nif(todayWidgetCbTrippedUntil&&now<todayWidgetCbTrippedUntil){// Optional: once per cooldown, log a warning (avoid spamming console)\nif(!scheduleTodayWidgetRender._cbWarnedAt||now-scheduleTodayWidgetRender._cbWarnedAt>1000){scheduleTodayWidgetRender._cbWarnedAt=now;console.warn(\"[BetterTasks] Today widget circuit breaker active; skipping render scheduling for \".concat(Math.ceil((todayWidgetCbTrippedUntil-now)/1000),\"s\"));}return;}// Reset breaker window if needed\nif(!todayWidgetCbWindowStart||now-todayWidgetCbWindowStart>TODAY_WIDGET_CB_WINDOW_MS){todayWidgetCbWindowStart=now;todayWidgetCbCount=0;}todayWidgetCbCount++;// Trip breaker if too many schedules in the window\nif(todayWidgetCbCount>TODAY_WIDGET_CB_MAX){todayWidgetCbTrippedUntil=now+TODAY_WIDGET_CB_COOLDOWN_MS;// Stop any pending timer; weâ€™re bailing out.\nif(todayWidgetRenderTimer){clearTimeout(todayWidgetRenderTimer);todayWidgetRenderTimer=null;}console.error(\"[BetterTasks] Today widget circuit breaker TRIPPED (>\".concat(TODAY_WIDGET_CB_MAX,\" schedules in \").concat(TODAY_WIDGET_CB_WINDOW_MS,\"ms). \")+\"Pausing renders for \".concat(Math.ceil(TODAY_WIDGET_CB_COOLDOWN_MS/1000),\"s.\"));/*\n        try {\n          window.roamAlphaAPI?.ui?.showToast?.({\n            message:\n              \"Better Tasks paused Today widget renders temporarily (safety circuit breaker). \" +\n              \"If this persists, please disable/re-enable the Today widget in settings.\",\n            intent: \"warning\",\n            timeout: 8000,\n          });\n        } catch (_) { }\n        */return;}if(todayWidgetRenderTimer)clearTimeout(todayWidgetRenderTimer);todayWidgetRenderTimer=setTimeout(function(){todayWidgetRenderTimer=null;var idle=typeof requestIdleCallback===\"function\"?requestIdleCallback:null;if(idle){idle(function(){void renderTodayWidget(force);},{timeout:1200});}else{void renderTodayWidget(force);}},delayMs);}function resetTodayWidgetCircuitBreaker(){todayWidgetCbWindowStart=0;todayWidgetCbCount=0;todayWidgetCbTrippedUntil=0;scheduleTodayWidgetRender._cbWarnedAt=0;}function attachTodayNavigationListener(){if(todayNavListenerAttached)return;if(typeof window===\"undefined\")return;todayNavListener=function todayNavListener(){return scheduleTodayWidgetRender(80,true);};try{window.addEventListener(\"hashchange\",todayNavListener,{passive:true});window.addEventListener(\"popstate\",todayNavListener,{passive:true});todayNavListenerAttached=true;}catch(_){// ignore\n}}function detachTodayNavigationListener(){if(!todayNavListenerAttached||typeof window===\"undefined\")return;var trigger=todayNavListener;try{window.removeEventListener(\"hashchange\",trigger,{passive:true});window.removeEventListener(\"popstate\",trigger,{passive:true});}catch(_){// ignore\n}finally{todayNavListenerAttached=false;todayNavListener=null;}}detachTodayNavigationListenerGlobal=detachTodayNavigationListener;function scheduleTodayBadgeRefresh(){var delayMs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:120;var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!getTodayBadgeEnabled())return;if(todayBadgeRefreshTimer)clearTimeout(todayBadgeRefreshTimer);todayBadgeRefreshTimer=setTimeout(function(){todayBadgeRefreshTimer=null;void renderTodayBadge(force);},delayMs);}function disableTodayWidgetUI(){return _disableTodayWidgetUI.apply(this,arguments);}function _disableTodayWidgetUI(){_disableTodayWidgetUI=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee91(){var anchorUid,_t73,_t74;return _regenerator().w(function(_context91){while(1)switch(_context91.p=_context91.n){case 0:if(todayWidgetRenderTimer){clearTimeout(todayWidgetRenderTimer);todayWidgetRenderTimer=null;}todayWidgetForceNext=false;lastTodayWidgetSignature=null;lastTodayInlineSignature=null;lastTodayRenderAt=0;todayInlineChildUids.clear();todayHeadingRecheckPending=false;todayHeadingRetryCount=0;_context91.p=1;_context91.n=2;return teardownTodayPanel();case 2:_context91.n=4;break;case 3:_context91.p=3;_t73=_context91.v;case 4:_t74=lastTodayAnchorUid;if(_t74){_context91.n=6;break;}_context91.n=5;return findTodayAnchorUid();case 5:_t74=_context91.v;case 6:anchorUid=_t74;lastTodayAnchorUid=anchorUid||null;if(!anchorUid){_context91.n=7;break;}_context91.n=7;return removeTodayAnchor(anchorUid);case 7:_context91.n=8;return delay(180);case 8:_context91.n=9;return removeTodayAnchor();case 9:_context91.n=10;return delay(600);case 10:_context91.n=11;return removeAllTodayAnchorsByQuery();case 11:_context91.n=12;return delay(600);case 12:_context91.n=13;return removeAllTodayAnchorsByQuery();case 13:return _context91.a(2);}},_callee91,null,[[1,3]]);}));return _disableTodayWidgetUI.apply(this,arguments);}function removeTodayAnchor(){return _removeTodayAnchor.apply(this,arguments);}function _removeTodayAnchor(){_removeTodayAnchor=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee92(){var anchorUid,attempts,uid,anchorIsHeading,i,_args92=arguments,_t75,_t76,_t77,_t78,_t79;return _regenerator().w(function(_context92){while(1)switch(_context92.p=_context92.n){case 0:anchorUid=_args92.length>0&&_args92[0]!==undefined?_args92[0]:null;attempts=_args92.length>1&&_args92[1]!==undefined?_args92[1]:3;_t75=anchorUid||lastTodayAnchorUid;if(_t75){_context92.n=2;break;}_context92.n=1;return findTodayAnchorUid();case 1:_t75=_context92.v;case 2:uid=_t75;if(uid){_context92.n=4;break;}_context92.n=3;return removeAllTodayAnchorsByQuery();case 3:return _context92.a(2);case 4:anchorIsHeading=lastTodayAnchorIsHeading;i=0;case 5:if(!(i<attempts)){_context92.n=20;break;}_context92.p=6;_context92.n=7;return clearTodayInlineChildren(uid);case 7:_context92.n=9;break;case 8:_context92.p=8;_t76=_context92.v;case 9:if(!anchorIsHeading){_context92.n=10;break;}lastTodayAnchorUid=uid;return _context92.a(2);case 10:_context92.p=10;_context92.n=11;return deleteBlockAndDescendants(uid);case 11:lastTodayAnchorUid=null;return _context92.a(2);case 12:_context92.p=12;_t77=_context92.v;_context92.p=13;_context92.n=14;return window.roamAlphaAPI.updateBlock({block:{uid:uid,string:\"\"}});case 14:lastTodayAnchorUid=null;return _context92.a(2);case 15:_context92.p=15;_t78=_context92.v;_context92.n=16;return delay(120);case 16:_context92.n=17;return findTodayAnchorUid();case 17:_t79=_context92.v;if(_t79){_context92.n=18;break;}_t79=uid;case 18:uid=_t79;case 19:i++;_context92.n=5;break;case 20:lastTodayAnchorUid=null;case 21:return _context92.a(2);}},_callee92,null,[[13,15],[10,12],[6,8]]);}));return _removeTodayAnchor.apply(this,arguments);}function collectAnchorsUnder(_x103,_x104){return _collectAnchorsUnder.apply(this,arguments);}function _collectAnchorsUnder(){_collectAnchorsUnder=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee93(uid,anchorTexts){var ignoredUid,cache,depth,maxDepth,block,matches,text,children,_iterator28,_step28,child,childUid,_args93=arguments,_t80,_t81,_t82,_t83;return _regenerator().w(function(_context93){while(1)switch(_context93.p=_context93.n){case 0:ignoredUid=_args93.length>2&&_args93[2]!==undefined?_args93[2]:null;cache=_args93.length>3&&_args93[3]!==undefined?_args93[3]:null;depth=_args93.length>4&&_args93[4]!==undefined?_args93[4]:0;maxDepth=_args93.length>5&&_args93[5]!==undefined?_args93[5]:3;if(!(!uid||depth>maxDepth)){_context93.n=1;break;}return _context93.a(2,[]);case 1:if(!(ignoredUid&&uid===ignoredUid)){_context93.n=2;break;}return _context93.a(2,[]);case 2:_context93.n=3;return getBlockCached(uid,cache);case 3:block=_context93.v;matches=[];text=((block===null||block===void 0?void 0:block.string)||\"\").trim().toLowerCase();if(text&&anchorTexts.has(text)){matches.push(uid);}children=Array.isArray(block===null||block===void 0?void 0:block.children)?block.children:[];_iterator28=_createForOfIteratorHelper(children);_context93.p=4;_iterator28.s();case 5:if((_step28=_iterator28.n()).done){_context93.n=8;break;}child=_step28.value;childUid=child===null||child===void 0?void 0:child.uid;if(!childUid){_context93.n=7;break;}_t80=matches.push;_t81=matches;_t82=_toConsumableArray;_context93.n=6;return collectAnchorsUnder(childUid,anchorTexts,ignoredUid,cache,depth+1,maxDepth);case 6:_t80.apply.call(_t80,_t81,_t82(_context93.v));case 7:_context93.n=5;break;case 8:_context93.n=10;break;case 9:_context93.p=9;_t83=_context93.v;_iterator28.e(_t83);case 10:_context93.p=10;_iterator28.f();return _context93.f(10);case 11:return _context93.a(2,matches);}},_callee93,null,[[4,9,10,11]]);}));return _collectAnchorsUnder.apply(this,arguments);}function removeAllTodayAnchorsByQuery(){return _removeAllTodayAnchorsByQuery.apply(this,arguments);}function _removeAllTodayAnchorsByQuery(){_removeAllTodayAnchorsByQuery=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee94(){var _ref46,_ref46$includeHeading,includeHeading,_ref46$textsOverride,textsOverride,cache,dnpUid,_yield$getTodayParent2,headingUid,baseTexts,texts,_iterator29,_step29,_t84,ignoreUid,uids,_iterator30,_step30,u,_args94=arguments,_t85,_t86;return _regenerator().w(function(_context94){while(1)switch(_context94.p=_context94.n){case 0:_ref46=_args94.length>0&&_args94[0]!==undefined?_args94[0]:{},_ref46$includeHeading=_ref46.includeHeading,includeHeading=_ref46$includeHeading===void 0?false:_ref46$includeHeading,_ref46$textsOverride=_ref46.textsOverride,textsOverride=_ref46$textsOverride===void 0?null:_ref46$textsOverride;_context94.p=1;cache=createTodayRenderCache();_context94.n=2;return getOrCreatePageUidCached(toDnpTitle(todayLocal()),cache);case 2:dnpUid=_context94.v;_context94.n=3;return getTodayParentInfo(cache);case 3:_yield$getTodayParent2=_context94.v;headingUid=_yield$getTodayParent2.headingUid;baseTexts=Array.isArray(textsOverride)?textsOverride:[getTodayAnchorText()].concat(TODAY_WIDGET_ANCHOR_TEXT_LEGACY);texts=new Set(baseTexts.map(function(s){return normalizeMatchText(s||\"\");}));if(!textsOverride){_iterator29=_createForOfIteratorHelper(todayAnchorTextHistory);try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){_t84=_step29.value;texts.add(_t84);}}catch(err){_iterator29.e(err);}finally{_iterator29.f();}}ignoreUid=includeHeading?null:headingUid||null;_context94.n=4;return collectAnchorsUnder(dnpUid,texts,ignoreUid,cache,0,4);case 4:uids=_context94.v;_iterator30=_createForOfIteratorHelper(uids);_context94.p=5;_iterator30.s();case 6:if((_step30=_iterator30.n()).done){_context94.n=8;break;}u=_step30.value;_context94.n=7;return deleteBlockAndDescendants(u);case 7:_context94.n=6;break;case 8:_context94.n=10;break;case 9:_context94.p=9;_t85=_context94.v;_iterator30.e(_t85);case 10:_context94.p=10;_iterator30.f();return _context94.f(10);case 11:lastTodayAnchorUid=null;_context94.n=13;break;case 12:_context94.p=12;_t86=_context94.v;case 13:return _context94.a(2);}},_callee94,null,[[5,9,10,11],[1,12]]);}));return _removeAllTodayAnchorsByQuery.apply(this,arguments);}function deleteBlockAndDescendants(_x105){return _deleteBlockAndDescendants.apply(this,arguments);}function _deleteBlockAndDescendants(){_deleteBlockAndDescendants=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee95(uid){var depth,maxDepth,safeUid,children,childUids,_iterator31,_step31,child,_args95=arguments,_t87,_t88,_t89,_t90;return _regenerator().w(function(_context95){while(1)switch(_context95.p=_context95.n){case 0:depth=_args95.length>1&&_args95[1]!==undefined?_args95[1]:0;maxDepth=_args95.length>2&&_args95[2]!==undefined?_args95[2]:12;if(!(!uid||depth>maxDepth)){_context95.n=1;break;}return _context95.a(2);case 1:_context95.p=1;safeUid=escapeDatalogString(uid);_context95.n=2;return window.roamAlphaAPI.q(\"[:find ?c :where [?c :block/parents ?p] [?p :block/uid \\\"\".concat(safeUid,\"\\\"]]\"));case 2:children=_context95.v;childUids=Array.isArray(children)?children.map(function(r){return r===null||r===void 0?void 0:r[0];}).filter(Boolean):[];_iterator31=_createForOfIteratorHelper(childUids);_context95.p=3;_iterator31.s();case 4:if((_step31=_iterator31.n()).done){_context95.n=6;break;}child=_step31.value;_context95.n=5;return deleteBlockAndDescendants(child,depth+1,maxDepth);case 5:_context95.n=4;break;case 6:_context95.n=8;break;case 7:_context95.p=7;_t87=_context95.v;_iterator31.e(_t87);case 8:_context95.p=8;_iterator31.f();return _context95.f(8);case 9:_context95.n=11;break;case 10:_context95.p=10;_t88=_context95.v;case 11:_context95.p=11;_context95.n=12;return deleteBlock(uid);case 12:_context95.n=17;break;case 13:_context95.p=13;_t89=_context95.v;_context95.p=14;_context95.n=15;return window.roamAlphaAPI.updateBlock({block:{uid:uid,string:\"\"}});case 15:_context95.n=17;break;case 16:_context95.p=16;_t90=_context95.v;case 17:return _context95.a(2);}},_callee95,null,[[14,16],[11,13],[3,7,8,9],[1,10]]);}));return _deleteBlockAndDescendants.apply(this,arguments);}function createTodayRenderCache(){return{blocks:new Map(),pages:new Map()};}function getBlockCached(_x106){return _getBlockCached.apply(this,arguments);}function _getBlockCached(){_getBlockCached=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee96(uid){var _cache$blocks,_cache$blocks2;var cache,block,_args96=arguments;return _regenerator().w(function(_context96){while(1)switch(_context96.n){case 0:cache=_args96.length>1&&_args96[1]!==undefined?_args96[1]:null;if(uid){_context96.n=1;break;}return _context96.a(2,null);case 1:if(!(cache!==null&&cache!==void 0&&(_cache$blocks=cache.blocks)!==null&&_cache$blocks!==void 0&&_cache$blocks.has(uid))){_context96.n=2;break;}return _context96.a(2,cache.blocks.get(uid));case 2:_context96.n=3;return getBlock(uid);case 3:block=_context96.v;cache===null||cache===void 0||(_cache$blocks2=cache.blocks)===null||_cache$blocks2===void 0||_cache$blocks2.set(uid,block);return _context96.a(2,block);}},_callee96);}));return _getBlockCached.apply(this,arguments);}function getOrCreatePageUidCached(_x107){return _getOrCreatePageUidCached.apply(this,arguments);}function _getOrCreatePageUidCached(){_getOrCreatePageUidCached=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee97(title){var _cache$pages,_cache$pages2;var cache,uid,_args97=arguments;return _regenerator().w(function(_context97){while(1)switch(_context97.n){case 0:cache=_args97.length>1&&_args97[1]!==undefined?_args97[1]:null;if(title){_context97.n=1;break;}return _context97.a(2,null);case 1:if(!(cache!==null&&cache!==void 0&&(_cache$pages=cache.pages)!==null&&_cache$pages!==void 0&&_cache$pages.has(title))){_context97.n=2;break;}return _context97.a(2,cache.pages.get(title));case 2:_context97.n=3;return getOrCreatePageUid(title);case 3:uid=_context97.v;cache===null||cache===void 0||(_cache$pages2=cache.pages)===null||_cache$pages2===void 0||_cache$pages2.set(title,uid);return _context97.a(2,uid);}},_callee97);}));return _getOrCreatePageUidCached.apply(this,arguments);}function getOpenPageTitleSafe(){return _getOpenPageTitleSafe.apply(this,arguments);}function _getOpenPageTitleSafe(){_getOpenPageTitleSafe=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee98(){var cache,_window$roamAlphaAPI27,_info$page,_info$block,main,info,pageUid,blockUid,_window$roamAlphaAPI$,_window$roamAlphaAPI28,page,title,_block$page6,_block$page7,block,_args98=arguments,_t91;return _regenerator().w(function(_context98){while(1)switch(_context98.p=_context98.n){case 0:cache=_args98.length>0&&_args98[0]!==undefined?_args98[0]:null;_context98.p=1;main=(_window$roamAlphaAPI27=window.roamAlphaAPI)===null||_window$roamAlphaAPI27===void 0||(_window$roamAlphaAPI27=_window$roamAlphaAPI27.ui)===null||_window$roamAlphaAPI27===void 0?void 0:_window$roamAlphaAPI27.mainWindow;info=typeof(main===null||main===void 0?void 0:main.getOpenPageOrBlock)===\"function\"?main.getOpenPageOrBlock():null;pageUid=(info===null||info===void 0?void 0:info[\"page-uid\"])||(info===null||info===void 0?void 0:info.pageUid)||(info===null||info===void 0||(_info$page=info.page)===null||_info$page===void 0?void 0:_info$page.uid)||null;blockUid=(info===null||info===void 0?void 0:info[\"block-uid\"])||(info===null||info===void 0?void 0:info.blockUid)||(info===null||info===void 0||(_info$block=info.block)===null||_info$block===void 0?void 0:_info$block.uid)||null;if(!pageUid){_context98.n=3;break;}_context98.n=2;return(_window$roamAlphaAPI$=(_window$roamAlphaAPI28=window.roamAlphaAPI).pull)===null||_window$roamAlphaAPI$===void 0?void 0:_window$roamAlphaAPI$.call(_window$roamAlphaAPI28,\"[:node/title]\",[\":block/uid\",pageUid]);case 2:page=_context98.v;title=(page===null||page===void 0?void 0:page[\":node/title\"])||(page===null||page===void 0?void 0:page.title);if(!title){_context98.n=3;break;}return _context98.a(2,title);case 3:if(!blockUid){_context98.n=5;break;}_context98.n=4;return getBlockCached(blockUid,cache);case 4:block=_context98.v;return _context98.a(2,(block===null||block===void 0||(_block$page6=block.page)===null||_block$page6===void 0?void 0:_block$page6.title)||(block===null||block===void 0||(_block$page7=block.page)===null||_block$page7===void 0?void 0:_block$page7[\"node/title\"])||null);case 5:_context98.n=7;break;case 6:_context98.p=6;_t91=_context98.v;case 7:return _context98.a(2,null);}},_callee98,null,[[1,6]]);}));return _getOpenPageTitleSafe.apply(this,arguments);}function shouldRenderTodayWidgetNow(){return _shouldRenderTodayWidgetNow.apply(this,arguments);}function _shouldRenderTodayWidgetNow(){_shouldRenderTodayWidgetNow=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee100(){var cache,todayTitle,check,match,_args100=arguments;return _regenerator().w(function(_context100){while(1)switch(_context100.n){case 0:cache=_args100.length>0&&_args100[0]!==undefined?_args100[0]:null;todayTitle=toDnpTitle(todayLocal());check=/*#__PURE__*/function(){var _ref47=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee99(){var currentTitle;return _regenerator().w(function(_context99){while(1)switch(_context99.n){case 0:_context99.n=1;return getOpenPageTitleSafe(cache);case 1:currentTitle=_context99.v;if(currentTitle){_context99.n=2;break;}return _context99.a(2,null);case 2:return _context99.a(2,currentTitle===todayTitle);}},_callee99);}));return function check(){return _ref47.apply(this,arguments);};}();_context100.n=1;return check();case 1:match=_context100.v;if(!(match===null||match===false)){_context100.n=4;break;}_context100.n=2;return delay(160);case 2:_context100.n=3;return check();case 3:match=_context100.v;case 4:if(!(match===null)){_context100.n=5;break;}return _context100.a(2,true);case 5:return _context100.a(2,!!match);}},_callee100);}));return _shouldRenderTodayWidgetNow.apply(this,arguments);}function shouldRenderTodayWidgetNowCached(){return _shouldRenderTodayWidgetNowCached.apply(this,arguments);}function _shouldRenderTodayWidgetNowCached(){_shouldRenderTodayWidgetNowCached=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee102(){var cache,now,_args102=arguments;return _regenerator().w(function(_context102){while(1)switch(_context102.n){case 0:cache=_args102.length>0&&_args102[0]!==undefined?_args102[0]:null;now=Date.now();if(!todayWidgetPageGuard.inFlight){_context102.n=1;break;}return _context102.a(2,todayWidgetPageGuard.inFlight);case 1:if(!(todayWidgetPageGuard.at&&now-todayWidgetPageGuard.at<TODAY_WIDGET_PAGE_GUARD_TTL_MS)){_context102.n=2;break;}return _context102.a(2,todayWidgetPageGuard.value);case 2:todayWidgetPageGuard.inFlight=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee101(){var value,_t92;return _regenerator().w(function(_context101){while(1)switch(_context101.p=_context101.n){case 0:_context101.p=0;_context101.n=1;return shouldRenderTodayWidgetNow(cache);case 1:value=_context101.v;todayWidgetPageGuard.at=Date.now();todayWidgetPageGuard.value=!!value;return _context101.a(2,todayWidgetPageGuard.value);case 2:_context101.p=2;_t92=_context101.v;// Fail open so we don't \"break\" rendering when Roam APIs are flaky.\ntodayWidgetPageGuard.at=Date.now();todayWidgetPageGuard.value=true;return _context101.a(2,true);case 3:_context101.p=3;todayWidgetPageGuard.inFlight=null;return _context101.f(3);case 4:return _context101.a(2);}},_callee101,null,[[0,2,3,4]]);}))();return _context102.a(2,todayWidgetPageGuard.inFlight);}},_callee102);}));return _shouldRenderTodayWidgetNowCached.apply(this,arguments);}function scheduleTodayWidgetRenderIfOnDnp(){var delayMs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:200;var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!TODAY_WIDGET_ENABLED||!getTodayWidgetEnabled())return;void _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(){var ok;return _regenerator().w(function(_context6){while(1)switch(_context6.n){case 0:_context6.n=1;return shouldRenderTodayWidgetNowCached(null);case 1:ok=_context6.v;if(ok){_context6.n=2;break;}return _context6.a(2);case 2:scheduleTodayWidgetRender(delayMs,force);case 3:return _context6.a(2);}},_callee6);}))();}function requestTodayWidgetRenderOnDnp(){var delayMs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:200;var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!TODAY_WIDGET_ENABLED||!getTodayWidgetEnabled())return;if(force)todayWidgetRefreshForcePending=true;if(todayWidgetRefreshTimer)return;todayWidgetRefreshTimer=setTimeout(function(){todayWidgetRefreshTimer=null;var shouldForce=todayWidgetRefreshForcePending;todayWidgetRefreshForcePending=false;scheduleTodayWidgetRenderIfOnDnp(0,shouldForce);},Math.max(0,delayMs));}function renderPillDateSpan(span,_ref17){var icon=_ref17.icon,date=_ref17.date,set=_ref17.set,label=_ref17.label,tooltip=_ref17.tooltip;if(!span)return;span.textContent=\"\";if(icon){var iconEl=document.createElement(\"span\");iconEl.className=\"rt-pill-icon\";iconEl.textContent=icon;iconEl.setAttribute(\"aria-hidden\",\"true\");span.appendChild(iconEl);}var textEl=document.createElement(\"span\");textEl.className=\"rt-pill-text\";var formatted=formatPillDateText(date,set);textEl.textContent=formatted;span.appendChild(textEl);if(tooltip)span.title=tooltip;if(label)span.setAttribute(\"aria-label\",\"\".concat(label,\": \").concat(formatted));}function formatPillDateText(date,set){if(!(date instanceof Date)||Number.isNaN(date.getTime()))return\"\";var today=todayLocal();var diffMs=date.getTime()-today.getTime();var diffDays=Math.round(diffMs/(24*60*60*1000));if(diffDays>=0&&diffDays<=7){return new Intl.DateTimeFormat(set.locale||undefined,{weekday:\"short\"}).format(date);}return new Intl.DateTimeFormat(set.locale||undefined,{month:\"short\",day:\"numeric\"}).format(date);}function schedulePillRefreshAll(){var delayMs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:120;if(pillRefreshTimer)return;var now=Date.now();var MIN_INTERVAL=500;var remaining=Math.max(0,MIN_INTERVAL-(now-lastPillDecorateRun));var effectiveDelay=Math.max(delayMs,remaining);pillRefreshTimer=setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(){var root,_t7;return _regenerator().w(function(_context7){while(1)switch(_context7.p=_context7.n){case 0:pillRefreshTimer=null;_context7.p=1;root=document.body||document;if(!root){_context7.n=2;break;}_context7.n=2;return decorateBlockPills(root);case 2:_context7.n=4;break;case 3:_context7.p=3;_t7=_context7.v;console.warn(\"[BetterTasks] pill refresh failed\",_t7);case 4:return _context7.a(2);}},_callee7,null,[[1,3]]);})),effectiveDelay);}var pillDelegationAttached=false;var pillDelegationClickHandler=null;var pillDelegationPointerHandler=null;var pillDelegationLastClickAt=0;var pillDelegationLastClickKey=\"\";var PILL_DELEGATION_GLOBAL_KEY=\"__btPillDelegationV1\";var PILL_DELEGATION_CLICK_GATE_KEY=\"__btPillDelegationClickGateV1\";var activeDatePrompts=new Set();function getGlobalPillClickGate(){if(typeof window===\"undefined\")return null;if(!window[PILL_DELEGATION_CLICK_GATE_KEY]){window[PILL_DELEGATION_CLICK_GATE_KEY]={lastKey:\"\",lastAt:0};}return window[PILL_DELEGATION_CLICK_GATE_KEY];}function runDatePromptOnce(_x108,_x109){return _runDatePromptOnce.apply(this,arguments);}function _runDatePromptOnce(){_runDatePromptOnce=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee103(key,fn){return _regenerator().w(function(_context103){while(1)switch(_context103.p=_context103.n){case 0:if(!(!key||typeof fn!==\"function\")){_context103.n=1;break;}return _context103.a(2,null);case 1:if(!activeDatePrompts.has(key)){_context103.n=2;break;}return _context103.a(2,null);case 2:activeDatePrompts.add(key);_context103.p=3;_context103.n=4;return fn();case 4:return _context103.a(2,_context103.v);case 5:_context103.p=5;activeDatePrompts[\"delete\"](key);return _context103.f(5);case 6:return _context103.a(2);}},_callee103,null,[[3,,5,6]]);}));return _runDatePromptOnce.apply(this,arguments);}function getInlineMetaCache(){if(typeof window===\"undefined\")return null;return window.__btInlineMetaCache||(window.__btInlineMetaCache=new Map());}function readInlineMetaCache(uid){var metaCache=getInlineMetaCache();if(!metaCache||!uid)return null;var entry=metaCache.get(uid);if(!entry)return null;if(entry&&_typeof(entry)===\"object\"&&Object.prototype.hasOwnProperty.call(entry,\"metadata\")){var at=entry.at||0;if(at&&Date.now()-at>INLINE_META_CACHE_TTL_MS){metaCache[\"delete\"](uid);return null;}return entry.metadata||null;}return entry;}function writeInlineMetaCache(uid,metadata){var now=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Date.now();var metaCache=getInlineMetaCache();if(!metaCache||!uid)return;metaCache.set(uid,{metadata:metadata,at:now});if(metaCache.size>INLINE_META_CACHE_MAX){var entries=Array.from(metaCache.entries());entries.sort(function(a,b){var _a$2,_b$2;return(((_a$2=a[1])===null||_a$2===void 0?void 0:_a$2.at)||0)-(((_b$2=b[1])===null||_b$2===void 0?void 0:_b$2.at)||0);});var overflow=entries.length-INLINE_META_CACHE_MAX;for(var i=0;i<overflow;i++){metaCache[\"delete\"](entries[i][0]);}}var _iterator15=_createForOfIteratorHelper(metaCache.entries()),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var _step15$value=_slicedToArray(_step15.value,2),cacheUid=_step15$value[0],entry=_step15$value[1];var at=(entry===null||entry===void 0?void 0:entry.at)||0;if(at&&now-at>INLINE_META_CACHE_TTL_MS){metaCache[\"delete\"](cacheUid);}}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}function attachPillEventDelegation(){if(pillDelegationAttached||typeof document===\"undefined\")return;// Ensure only one delegated handler is attached globally (Roam can load/reload extensions without clean unload).\ntry{var prev=typeof window!==\"undefined\"?window[PILL_DELEGATION_GLOBAL_KEY]:null;if(prev!==null&&prev!==void 0&&prev.attached&&(prev===null||prev===void 0?void 0:prev.doc)===document){if(typeof prev.pointerHandler===\"function\"){document.removeEventListener(\"pointerdown\",prev.pointerHandler,true);}if(typeof prev.clickHandler===\"function\"){document.removeEventListener(\"click\",prev.clickHandler,true);}}}catch(_){// ignore\n}pillDelegationPointerHandler=function pillDelegationPointerHandler(event){try{var _target$closest2;var target=(event===null||event===void 0?void 0:event.target)instanceof Element?event.target:null;if(!target)return;var wrap=(_target$closest2=target.closest)===null||_target$closest2===void 0?void 0:_target$closest2.call(target,\".rt-pill-wrap\");if(!wrap)return;event.preventDefault();event.stopPropagation();}catch(_){// ignore\n}};pillDelegationClickHandler=/*#__PURE__*/function(){var _ref19=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(event){var _target$closest3,_wrap$dataset,_target$closest4,_actionEl$dataset,_wrap$dataset2,_metadataInfo$context,target,wrap,uid,actionEl,action,clickKey,now,globalGate,set,attrNames,metadataInfo,isRecurring,removeSpanAndSeparator,notifyDashboardIfOpen,first,_actionEl$dataset2,current,next,_window$__btInlineMet,_window$__btInlineMet2,display,metaLabels,_actionEl$dataset3,type,order,_current,idx,_next2,_display,_metaLabels,labelKey,cycleHint,_t0;return _regenerator().w(function(_context9){while(1)switch(_context9.p=_context9.n){case 0:_context9.p=0;target=(event===null||event===void 0?void 0:event.target)instanceof Element?event.target:null;if(target){_context9.n=1;break;}return _context9.a(2);case 1:wrap=(_target$closest3=target.closest)===null||_target$closest3===void 0?void 0:_target$closest3.call(target,\".rt-pill-wrap\");if(wrap){_context9.n=2;break;}return _context9.a(2);case 2:uid=((_wrap$dataset=wrap.dataset)===null||_wrap$dataset===void 0?void 0:_wrap$dataset.btUid)||null;if(uid){_context9.n=3;break;}return _context9.a(2);case 3:event.preventDefault();event.stopPropagation();actionEl=((_target$closest4=target.closest)===null||_target$closest4===void 0?void 0:_target$closest4.call(target,\"[data-bt-pill-action]\"))||null;action=(actionEl===null||actionEl===void 0||(_actionEl$dataset=actionEl.dataset)===null||_actionEl$dataset===void 0?void 0:_actionEl$dataset.btPillAction)||null;// Debounce to avoid double/triple triggers from Roam/DOM churn or multiple event sources.\n// Keyed by UID + action so different pill targets can still be clicked rapidly.\nclickKey=\"\".concat(uid,\"|\").concat(action||\"menu\");now=Date.now();globalGate=getGlobalPillClickGate();if(!(globalGate&&clickKey===globalGate.lastKey&&now-globalGate.lastAt<350)){_context9.n=4;break;}return _context9.a(2);case 4:if(!(clickKey===pillDelegationLastClickKey&&now-pillDelegationLastClickAt<350)){_context9.n=5;break;}return _context9.a(2);case 5:pillDelegationLastClickKey=clickKey;pillDelegationLastClickAt=now;if(globalGate){globalGate.lastKey=clickKey;globalGate.lastAt=now;}set=S();attrNames=set.attrNames;metadataInfo=readInlineMetaCache(uid);isRecurring=((_wrap$dataset2=wrap.dataset)===null||_wrap$dataset2===void 0?void 0:_wrap$dataset2.btIsRecurring)===\"1\";removeSpanAndSeparator=function removeSpanAndSeparator(el){var _prev$classList2;if(!(el instanceof Element))return;var prev=el.previousElementSibling;if(prev&&(_prev$classList2=prev.classList)!==null&&_prev$classList2!==void 0&&_prev$classList2.contains(\"rt-pill-separator\")){prev.remove();}else{var _next$classList;var next=el.nextElementSibling;if(next&&(_next$classList=next.classList)!==null&&_next$classList!==void 0&&_next$classList.contains(\"rt-pill-separator\")){next.remove();}}el.remove();};if(!(!action||action===\"menu\")){_context9.n=6;break;}showPillMenu({uid:uid,set:set,isRecurring:isRecurring,metadata:metadataInfo||undefined});return _context9.a(2);case 6:if(!(action===\"repeat\")){_context9.n=8;break;}_context9.n=7;return handleRepeatEdit(event,{uid:uid,set:set,span:actionEl});case 7:return _context9.a(2);case 8:if(!(action===\"start\")){_context9.n=10;break;}_context9.n=9;return handleStartClick(event,{uid:uid,set:set,span:actionEl,allowCreate:true});case 9:return _context9.a(2);case 10:if(!(action===\"defer\")){_context9.n=12;break;}_context9.n=11;return handleDeferClick(event,{uid:uid,set:set,span:actionEl,allowCreate:true});case 11:return _context9.a(2);case 12:if(!(action===\"due\")){_context9.n=14;break;}_context9.n=13;return handleDueClick(event,{uid:uid,set:set,span:actionEl,allowCreate:true});case 13:return _context9.a(2);case 14:notifyDashboardIfOpen=/*#__PURE__*/function(){var _ref20=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(){var opts,_activeDashboardContr44,_activeDashboardContr45,_activeDashboardContr46,_activeDashboardContr47,_args8=arguments,_t8,_t9;return _regenerator().w(function(_context8){while(1)switch(_context8.p=_context8.n){case 0:opts=_args8.length>0&&_args8[0]!==undefined?_args8[0]:{};_context8.p=1;if((_activeDashboardContr44=activeDashboardController)!==null&&_activeDashboardContr44!==void 0&&(_activeDashboardContr45=_activeDashboardContr44.isOpen)!==null&&_activeDashboardContr45!==void 0&&_activeDashboardContr45.call(_activeDashboardContr44)){_context8.n=2;break;}return _context8.a(2);case 2:_context8.n=4;break;case 3:_context8.p=3;_t8=_context8.v;return _context8.a(2);case 4:_context8.p=4;_context8.n=5;return(_activeDashboardContr46=activeDashboardController)===null||_activeDashboardContr46===void 0||(_activeDashboardContr47=_activeDashboardContr46.notifyBlockChange)===null||_activeDashboardContr47===void 0?void 0:_activeDashboardContr47.call(_activeDashboardContr46,uid,opts);case 5:_context8.n=7;break;case 6:_context8.p=6;_t9=_context8.v;case 7:return _context8.a(2);}},_callee8,null,[[4,6],[1,3]]);}));return function notifyDashboardIfOpen(){return _ref20.apply(this,arguments);};}();if(!(action===\"meta-project\"&&metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.project)){_context9.n=15;break;}handleMetadataClick(uid,\"project\",{value:metadataInfo.project},event,activeDashboardController);return _context9.a(2);case 15:if(!(action===\"meta-waitingFor\"&&metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.waitingFor)){_context9.n=16;break;}handleMetadataClick(uid,\"waitingFor\",{value:metadataInfo.waitingFor},event,activeDashboardController);return _context9.a(2);case 16:if(!(action===\"meta-context\"&&metadataInfo!==null&&metadataInfo!==void 0&&(_metadataInfo$context=metadataInfo.context)!==null&&_metadataInfo$context!==void 0&&_metadataInfo$context.length)){_context9.n=17;break;}first=metadataInfo.context[0];handleMetadataClick(uid,\"context\",{value:first,list:metadataInfo.context},event,activeDashboardController);return _context9.a(2);case 17:if(!(action===\"cycle-gtd\")){_context9.n=20;break;}current=(actionEl===null||actionEl===void 0||(_actionEl$dataset2=actionEl.dataset)===null||_actionEl$dataset2===void 0?void 0:_actionEl$dataset2.metaValue)||null;next=cycleGtdStatus(current);_context9.n=18;return setRichAttribute(uid,\"gtd\",next,attrNames);case 18:pillSkipDecorate.add(uid);setTimeout(function(){return pillSkipDecorate[\"delete\"](uid);},800);if(typeof window!==\"undefined\"){(_window$__btInlineMet=window.__btInlineMetaCache)===null||_window$__btInlineMet===void 0||(_window$__btInlineMet2=_window$__btInlineMet[\"delete\"])===null||_window$__btInlineMet2===void 0||_window$__btInlineMet2.call(_window$__btInlineMet,uid);}_context9.n=19;return notifyDashboardIfOpen({bypassFilters:true});case 19:if(next){display=formatGtdStatusDisplay(next,getLanguageSetting());actionEl.dataset.metaValue=next||\"\";actionEl.textContent=\"\\u27A1 \".concat(display);metaLabels=t([\"metadata\"],getLanguageSetting())||{};actionEl.title=\"\".concat(metaLabels.gtdLabel||metaLabels.gtd||\"GTD\",\": \").concat(display);}else{removeSpanAndSeparator(actionEl);}return _context9.a(2);case 20:if(!(action===\"cycle-priority\"||action===\"cycle-energy\")){_context9.n=23;break;}type=action===\"cycle-priority\"?\"priority\":\"energy\";order=[null,\"low\",\"medium\",\"high\"];_current=actionEl!==null&&actionEl!==void 0&&(_actionEl$dataset3=actionEl.dataset)!==null&&_actionEl$dataset3!==void 0&&_actionEl$dataset3.metaValue?actionEl.dataset.metaValue.toLowerCase():null;idx=order.indexOf(_current);_next2=order[(idx+1)%order.length];_context9.n=21;return setRichAttribute(uid,type,_next2,attrNames);case 21:pillSkipDecorate.add(uid);setTimeout(function(){return pillSkipDecorate[\"delete\"](uid);},800);_context9.n=22;return notifyDashboardIfOpen({bypassFilters:true});case 22:if(_next2){_display=formatPriorityEnergyDisplay(_next2,getLanguageSetting());actionEl.dataset.metaValue=_next2||\"\";actionEl.textContent=\"\".concat(type===\"priority\"?\"!\":\"ðŸ”‹\",\" \").concat(_display);_metaLabels=t([\"metadata\"],getLanguageSetting())||{};labelKey=type===\"priority\"?_metaLabels.priorityLabel||_metaLabels.priority||\"Priority\":_metaLabels.energyLabel||_metaLabels.energy||\"Energy\";cycleHint=type===\"priority\"?t([\"pillMenu\",\"cyclePriority\"],getLanguageSetting())||\"Click to cycle\":t([\"pillMenu\",\"cycleEnergy\"],getLanguageSetting())||\"Click to cycle\";actionEl.title=\"\".concat(labelKey,\": \").concat(_display,\" (\").concat(cycleHint,\")\");}else{removeSpanAndSeparator(actionEl);}return _context9.a(2);case 23:_context9.n=25;break;case 24:_context9.p=24;_t0=_context9.v;console.warn(\"[BetterTasks] pill delegated click failed\",_t0);case 25:return _context9.a(2);}},_callee9,null,[[0,24]]);}));return function pillDelegationClickHandler(_x110){return _ref19.apply(this,arguments);};}();document.addEventListener(\"pointerdown\",pillDelegationPointerHandler,true);document.addEventListener(\"click\",pillDelegationClickHandler,true);pillDelegationAttached=true;try{if(typeof window!==\"undefined\"){window[PILL_DELEGATION_GLOBAL_KEY]={attached:true,doc:document,pointerHandler:pillDelegationPointerHandler,clickHandler:pillDelegationClickHandler};}}catch(_){// ignore\n}}function detachPillEventDelegation(){if(!pillDelegationAttached||typeof document===\"undefined\")return;try{document.removeEventListener(\"pointerdown\",pillDelegationPointerHandler,true);document.removeEventListener(\"click\",pillDelegationClickHandler,true);}catch(_){// ignore\n}finally{pillDelegationAttached=false;pillDelegationPointerHandler=null;pillDelegationClickHandler=null;pillDelegationLastClickAt=0;pillDelegationLastClickKey=\"\";try{if(typeof window!==\"undefined\"){var prev=window[PILL_DELEGATION_GLOBAL_KEY];if((prev===null||prev===void 0?void 0:prev.doc)===document){delete window[PILL_DELEGATION_GLOBAL_KEY];}}}catch(_){// ignore\n}}}function syncPillsForSurface(_x111){return _syncPillsForSurface.apply(this,arguments);}function _syncPillsForSurface(){_syncPillsForSurface=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee104(surface){var root,once,_t93;return _regenerator().w(function(_context104){while(1)switch(_context104.p=_context104.n){case 0:if(surface){_context104.n=1;break;}return _context104.a(2);case 1:ensurePillStyles();root=document.body||document;if(root){_context104.n=2;break;}return _context104.a(2);case 2:_context104.p=2;attachPillEventDelegation();once=function once(){return Promise.resolve(decorateBlockPills(root));};_context104.n=3;return once();case 3:_context104.n=4;return new Promise(function(resolve){return requestAnimationFrame(function(){return once().then(resolve,resolve);});});case 4:_context104.n=5;return new Promise(function(resolve){return setTimeout(function(){return once().then(resolve,resolve);},50);});case 5:_context104.n=7;break;case 6:_context104.p=6;_t93=_context104.v;console.warn(\"[RecurringTasks] pill decoration failed\",_t93);case 7:return _context104.a(2);}},_callee104,null,[[2,6]]);}));return _syncPillsForSurface.apply(this,arguments);}function decorateBlockPills(_x112){return _decorateBlockPills.apply(this,arguments);}function _decorateBlockPills(){_decorateBlockPills=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee105(rootEl){var _rootEl$matches,_rootEl$querySelector;var now,sliceNow,yieldToBrowser,SLICE_BUDGET_MS,sliceStart,pillSigCache,PILL_SIG_CACHE_MAX,PILL_SIG_CACHE_TTL_MS,canUseGlobalCounts,nowCounts,hasFreshCounts,globalBlockCount,globalCheckboxCount,restrictToVisible,_document$querySelect5,_document7,blockCount,checkboxThreshold,_checkboxRoot$querySe,checkboxRoot,canUseGlobalCheckboxCount,hasFreshCheckboxCount,checkboxCount,selector,nodes,viewport,decoratedThisPass,MAX_DECORATIONS_PER_PASS,seen,set,attrNames,_iterator32,_step32,_loop3,_ret3,entries,overflow,i,_iterator33,_step33,_step33$value,uid,entry,lastSeen,_t96,_t97;return _regenerator().w(function(_context106){while(1)switch(_context106.p=_context106.n){case 0:if(rootEl){_context106.n=1;break;}return _context106.a(2);case 1:now=Date.now();if(!(now-lastPillDecorateRun<500)){_context106.n=2;break;}return _context106.a(2);case 2:lastPillDecorateRun=now;sliceNow=typeof performance!==\"undefined\"&&typeof performance.now===\"function\"?function(){return performance.now();}:function(){return Date.now();};yieldToBrowser=function yieldToBrowser(){return new Promise(function(resolve){if(typeof requestAnimationFrame===\"function\"){requestAnimationFrame(function(){return resolve();});}else{setTimeout(resolve,0);}});};SLICE_BUDGET_MS=12;sliceStart=sliceNow();pillSigCache=function(){if(typeof window===\"undefined\")return new Map();var existing=window.__btPillSignatureCache;if(existing&&typeof existing.get===\"function\"&&typeof existing.set===\"function\"){return existing;}var fresh=new Map();window.__btPillSignatureCache=fresh;return fresh;}();if(!pillSigCache||typeof pillSigCache.get!==\"function\"||typeof pillSigCache.set!==\"function\"){pillSigCache=new Map();if(typeof window!==\"undefined\"){window.__btPillSignatureCache=pillSigCache;}}PILL_SIG_CACHE_MAX=5000;PILL_SIG_CACHE_TTL_MS=10*60*1000;if(!pillScrollHandlerAttached&&typeof document!==\"undefined\"){pillScrollHandler=function(){var t=null;return function(){if(t)clearTimeout(t);t=setTimeout(function(){t=null;// Only refresh once scrolling has paused.\nschedulePillRefreshAll(0);},pillScrollDebounceMs);};}();try{// Roam scrolls inside nested containers; use capture so we receive non-bubbling scroll events.\ndocument.addEventListener(\"scroll\",pillScrollHandler,{passive:true,capture:true});pillScrollHandlerAttached=true;}catch(_){// ignore attach errors\n}}canUseGlobalCounts=typeof document!==\"undefined\"&&(rootEl===document||rootEl===document.body)&&typeof document.querySelectorAll===\"function\";nowCounts=Date.now();hasFreshCounts=canUseGlobalCounts&&pillDomCountsCache.at&&nowCounts-pillDomCountsCache.at<PILL_DOM_COUNT_TTL_MS;globalBlockCount=hasFreshCounts?pillDomCountsCache.blockCount:null;globalCheckboxCount=hasFreshCounts?pillDomCountsCache.checkboxCount:null;restrictToVisible=false;try{blockCount=typeof globalBlockCount===\"number\"?globalBlockCount:((_document$querySelect5=(_document7=document).querySelectorAll)===null||_document$querySelect5===void 0||(_document$querySelect5=_document$querySelect5.call(_document7,\".rm-block-main, .roam-block-container, .roam-block\"))===null||_document$querySelect5===void 0?void 0:_document$querySelect5.length)||0;globalBlockCount=blockCount;if(blockCount>MAX_BLOCKS_FOR_PILLS){if(canUseGlobalCounts&&!hasFreshCounts){pillDomCountsCache={at:nowCounts,blockCount:blockCount,checkboxCount:globalCheckboxCount};}restrictToVisible=true;}}catch(_){// ignore count errors\n}checkboxThreshold=getPillCheckboxThreshold();if(!(checkboxThreshold>0)){_context106.n=6;break;}_context106.p=3;checkboxRoot=rootEl===document||rootEl===document.body?document:rootEl;canUseGlobalCheckboxCount=checkboxRoot===document&&typeof document.querySelectorAll===\"function\";hasFreshCheckboxCount=!!(canUseGlobalCheckboxCount&&hasFreshCounts);checkboxCount=hasFreshCheckboxCount?typeof globalCheckboxCount===\"number\"?globalCheckboxCount:0:((_checkboxRoot$querySe=checkboxRoot.querySelectorAll)===null||_checkboxRoot$querySe===void 0||(_checkboxRoot$querySe=_checkboxRoot$querySe.call(checkboxRoot,\".rm-checkbox\"))===null||_checkboxRoot$querySe===void 0?void 0:_checkboxRoot$querySe.length)||0;globalCheckboxCount=checkboxCount;if(!(checkboxCount>checkboxThreshold)){_context106.n=4;break;}/*\n            console.warn(\n              `[BetterTasks] Skipping pill decoration: ${checkboxCount} checkboxes exceed threshold ${checkboxThreshold}`\n            );\n            */if(canUseGlobalCheckboxCount&&!hasFreshCheckboxCount){pillDomCountsCache={at:nowCounts,blockCount:globalBlockCount,checkboxCount:checkboxCount};}return _context106.a(2);case 4:if((canUseGlobalCounts||canUseGlobalCheckboxCount)&&!hasFreshCounts){pillDomCountsCache={at:nowCounts,blockCount:canUseGlobalCounts?globalBlockCount:pillDomCountsCache.blockCount,checkboxCount:canUseGlobalCheckboxCount?globalCheckboxCount:pillDomCountsCache.checkboxCount};}_context106.n=6;break;case 5:_context106.p=5;_t96=_context106.v;case 6:selector=restrictToVisible?\".rm-block-main\":\".rm-block-main, .roam-block-container, .roam-block\";nodes=(_rootEl$matches=rootEl.matches)!==null&&_rootEl$matches!==void 0&&_rootEl$matches.call(rootEl,selector)?[rootEl]:Array.from(((_rootEl$querySelector=rootEl.querySelectorAll)===null||_rootEl$querySelector===void 0?void 0:_rootEl$querySelector.call(rootEl,selector))||[]);viewport=function(){try{var _ref49,_ref49$getBoundingCli;var rect=(_ref49=document.documentElement||document.body)===null||_ref49===void 0||(_ref49$getBoundingCli=_ref49.getBoundingClientRect)===null||_ref49$getBoundingCli===void 0?void 0:_ref49$getBoundingCli.call(_ref49);var height=typeof window!==\"undefined\"?window.innerHeight||(rect===null||rect===void 0?void 0:rect.height)||0:0;return{height:height};}catch(_){return null;}}();decoratedThisPass=0;MAX_DECORATIONS_PER_PASS=restrictToVisible?120:300;seen=new Set();set=S();attrNames=set.attrNames;ensurePillMenuStyles();_iterator32=_createForOfIteratorHelper(nodes);_context106.p=7;_loop3=/*#__PURE__*/_regenerator().m(function _loop3(){var node,_node$classList2,_node$closest2,_node$querySelector5,_node$getAttribute,_node$dataset,_main$closest,_node$getAttribute2,_node$dataset2,_main$querySelector5,_main$querySelector6,_caret$classList,_caret$classList2,_caret$getAttribute,_caret$getAttribute2,_main$closest2,_blockContainer$query,_main$querySelectorAl5,_metadataInfo$context2,_main$querySelector7,mainCandidate,main,_main$getBoundingClie,r,_uid7,isFocused,block,originalString,isAttrLine,_main$querySelectorAl,meta,hasTiming,isRecurring,isBetterTask,metadataInfo,hasMetadataSignal,_main$querySelectorAl2,_activeDashboardContr82,_activeDashboardContr83,_window$__btInlineMet7,_window$__btInlineMet8,_main$querySelectorAl3,_main$querySelectorAl4,inlineAttrs,inlineRepeatVal,inlineDueVal,inlineStartVal,inlineDeferVal,caret,caretClosed,caretOpen,inlineCaretOpen,inlineCaretClosed,blockContainer,childrenContainer,childrenVisible,isOpen,humanRepeat,startDate,deferDate,dueDate,startDisplay,deferDisplay,dueDisplay,lang,metaLabels,tooltipParts,tooltip,contextSig,signatureParts,signature,existingPill,prevEntry,prevSig,pillWrap,repeatSpan,startSpan,deferSpan,dueSpan,pill,addSeparator,appendMetaSpan,span,_span,first,extra,display,_span2,_display3,_tooltip,_span3,_span4,_span5,menuBtn,check,_t94,_t95;return _regenerator().w(function(_context105){while(1)switch(_context105.p=_context105.n){case 0:node=_step32.value;if(!(sliceNow()-sliceStart>SLICE_BUDGET_MS)){_context105.n=2;break;}_context105.n=1;return yieldToBrowser();case 1:sliceStart=sliceNow();case 2:_context105.p=2;if(!(MAX_DECORATIONS_PER_PASS&&decoratedThisPass>=MAX_DECORATIONS_PER_PASS)){_context105.n=3;break;}schedulePillRefresh(rootEl,null,80);return _context105.a(2,0);case 3:mainCandidate=(_node$classList2=node.classList)!==null&&_node$classList2!==void 0&&_node$classList2.contains(\"rm-block-main\")?node:((_node$closest2=node.closest)===null||_node$closest2===void 0?void 0:_node$closest2.call(node,\".rm-block-main\"))||((_node$querySelector5=node.querySelector)===null||_node$querySelector5===void 0?void 0:_node$querySelector5.call(node,\".rm-block-main\"));main=mainCandidate||document.querySelector(\".rm-block-main[data-uid=\\\"\".concat(normalizeUid(((_node$getAttribute=node.getAttribute)===null||_node$getAttribute===void 0?void 0:_node$getAttribute.call(node,\"data-uid\"))||((_node$dataset=node.dataset)===null||_node$dataset===void 0?void 0:_node$dataset.uid)),\"\\\"]\"));if(main){_context105.n=4;break;}return _context105.a(2,1);case 4:if(!((_main$closest=main.closest)!==null&&_main$closest!==void 0&&_main$closest.call(main,\".rm-code-block\"))){_context105.n=5;break;}return _context105.a(2,1);case 5:if(!viewport){_context105.n=9;break;}_context105.p=6;r=(_main$getBoundingClie=main.getBoundingClientRect)===null||_main$getBoundingClie===void 0?void 0:_main$getBoundingClie.call(main);if(!(r&&(r.bottom<-120||r.top>viewport.height+120))){_context105.n=7;break;}return _context105.a(2,1);case 7:_context105.n=9;break;case 8:_context105.p=8;_t94=_context105.v;case 9:if(!(restrictToVisible&&!viewport)){_context105.n=10;break;}return _context105.a(2,1);case 10:_uid7=findBlockUidFromElement(main)||findBlockUidFromElement(node)||normalizeUid(((_node$getAttribute2=node.getAttribute)===null||_node$getAttribute2===void 0?void 0:_node$getAttribute2.call(node,\"data-uid\"))||((_node$dataset2=node.dataset)===null||_node$dataset2===void 0?void 0:_node$dataset2.uid));if(_uid7){_context105.n=11;break;}return _context105.a(2,1);case 11:if(!pillSkipDecorate.has(_uid7)){_context105.n=12;break;}return _context105.a(2,1);case 12:clearPendingPillTimer(_uid7);if(!seen.has(_uid7)){_context105.n=13;break;}return _context105.a(2,1);case 13:seen.add(_uid7);isFocused=!!((_main$querySelector5=main.querySelector)!==null&&_main$querySelector5!==void 0&&_main$querySelector5.call(main,\".rm-block__input--active, .rm-block__input--focused\"));if(isFocused){schedulePillRefresh(main,_uid7,120);}_context105.n=14;return getBlock(_uid7);case 14:block=_context105.v;if(block){_context105.n=15;break;}return _context105.a(2,1);case 15:if(!isTaskInCodeBlock(block)){_context105.n=16;break;}return _context105.a(2,1);case 16:originalString=block.string;isAttrLine=ATTR_RE.test((originalString||\"\").trim());if(!isAttrLine){_context105.n=17;break;}(_main$querySelectorAl=main.querySelectorAll(\".rt-pill-wrap\"))===null||_main$querySelectorAl===void 0||_main$querySelectorAl.forEach(function(el){return el.remove();});return _context105.a(2,1);case 17:_context105.n=18;return readRecurringMeta(block,set);case 18:meta=_context105.v;hasTiming=!!meta.hasTimingAttrs;isRecurring=!!meta.repeat;isBetterTask=isBetterTasksTask(meta);if(isBetterTask)enqueueDashboardNotifyBlockChange(_uid7);metadataInfo=meta.metadata||parseRichMetadata(meta.childAttrMap||{},attrNames);writeInlineMetaCache(_uid7,metadataInfo,now);hasMetadataSignal=!!(metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.project||metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.waitingFor||((metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.context)||[]).length||metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.priority||metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.energy||metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.gtd);if(!(!isBetterTask&&!hasMetadataSignal)){_context105.n=19;break;}(_main$querySelectorAl2=main.querySelectorAll(\".rt-pill-wrap\"))===null||_main$querySelectorAl2===void 0||_main$querySelectorAl2.forEach(function(el){return el.remove();});if(typeof window!==\"undefined\"){(_window$__btInlineMet7=window.__btInlineMetaCache)===null||_window$__btInlineMet7===void 0||(_window$__btInlineMet8=_window$__btInlineMet7[\"delete\"])===null||_window$__btInlineMet8===void 0||_window$__btInlineMet8.call(_window$__btInlineMet7,_uid7);}(_activeDashboardContr82=activeDashboardController)===null||_activeDashboardContr82===void 0||(_activeDashboardContr83=_activeDashboardContr82.removeTask)===null||_activeDashboardContr83===void 0||_activeDashboardContr83.call(_activeDashboardContr82,_uid7);return _context105.a(2,1);case 19:if(!(!isRecurring&&!hasTiming&&!hasMetadataSignal)){_context105.n=20;break;}(_main$querySelectorAl3=main.querySelectorAll(\".rt-pill-wrap\"))===null||_main$querySelectorAl3===void 0||_main$querySelectorAl3.forEach(function(el){return el.remove();});return _context105.a(2,1);case 20:if(!isBlockCompleted(block)){_context105.n=21;break;}(_main$querySelectorAl4=main.querySelectorAll(\".rt-pill-wrap\"))===null||_main$querySelectorAl4===void 0||_main$querySelectorAl4.forEach(function(el){return el.remove();});return _context105.a(2,1);case 21:inlineAttrs=parseAttrsFromBlockText(block.string||\"\");inlineRepeatVal=pickInlineAttr(inlineAttrs,attrNames.repeatAliases);inlineDueVal=pickInlineAttr(inlineAttrs,attrNames.dueAliases);inlineStartVal=pickInlineAttr(inlineAttrs,attrNames.startAliases);inlineDeferVal=pickInlineAttr(inlineAttrs,attrNames.deferAliases);caret=(_main$querySelector6=main.querySelector)===null||_main$querySelector6===void 0?void 0:_main$querySelector6.call(main,\".rm-caret\");caretClosed=caret===null||caret===void 0||(_caret$classList=caret.classList)===null||_caret$classList===void 0?void 0:_caret$classList.contains(\"rm-caret-right\");caretOpen=caret===null||caret===void 0||(_caret$classList2=caret.classList)===null||_caret$classList2===void 0?void 0:_caret$classList2.contains(\"rm-caret-down\");inlineCaretOpen=(caret===null||caret===void 0||(_caret$getAttribute=caret.getAttribute)===null||_caret$getAttribute===void 0?void 0:_caret$getAttribute.call(caret,\"aria-expanded\"))===\"true\";inlineCaretClosed=(caret===null||caret===void 0||(_caret$getAttribute2=caret.getAttribute)===null||_caret$getAttribute2===void 0?void 0:_caret$getAttribute2.call(caret,\"aria-expanded\"))===\"false\";blockContainer=((_main$closest2=main.closest)===null||_main$closest2===void 0?void 0:_main$closest2.call(main,\".roam-block-container, .roam-block\"))||null;childrenContainer=(blockContainer===null||blockContainer===void 0||(_blockContainer$query=blockContainer.querySelector)===null||_blockContainer$query===void 0?void 0:_blockContainer$query.call(blockContainer,\":scope > .rm-block__children, :scope > .rm-block-children\"))||null;childrenVisible=isChildrenVisible(childrenContainer);// Use DOM state for this specific instance; ignore persisted block.open to avoid cross-pane bleed.\nisOpen=inlineCaretOpen||caretOpen||childrenVisible?true:inlineCaretClosed||caretClosed?false:childrenContainer?childrenVisible:block.open===true;(_main$querySelectorAl5=main.querySelectorAll(\".rt-pill-wrap\"))===null||_main$querySelectorAl5===void 0||_main$querySelectorAl5.forEach(function(el){return el.remove();});if(!isOpen){_context105.n=22;break;}return _context105.a(2,1);case 22:humanRepeat=meta.repeat||inlineRepeatVal||\"\";startDate=meta.start||(inlineStartVal?parseRoamDate(inlineStartVal):null);deferDate=meta.defer||(inlineDeferVal?parseRoamDate(inlineDeferVal):null);dueDate=meta.due||(inlineDueVal?parseRoamDate(inlineDueVal):null);startDisplay=startDate?formatFriendlyDate(startDate,set):null;deferDisplay=deferDate?formatFriendlyDate(deferDate,set):null;dueDisplay=dueDate?formatFriendlyDate(dueDate,set):null;lang=getLanguageSetting();metaLabels=t([\"metadata\"],lang)||{};tooltipParts=[];if(startDate)tooltipParts.push(\"\".concat(metaLabels.start||\"Start\",\": \").concat(formatIsoDate(startDate,set)));if(deferDate)tooltipParts.push(\"\".concat(metaLabels.defer||\"Defer\",\": \").concat(formatIsoDate(deferDate,set)));if(dueDate)tooltipParts.push(\"\".concat(metaLabels.next||metaLabels.due||\"Next\",\": \").concat(formatIsoDate(dueDate,set)));tooltip=tooltipParts.length?tooltipParts.join(\" â€¢ \"):isRecurring?metaLabels.repeatingTask||\"Repeating Better Task\":metaLabels.scheduledTask||\"Scheduled Better Task\";contextSig=Array.isArray(metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.context)?_toConsumableArray(metadataInfo.context).sort().join(\",\"):\"\";signatureParts=[humanRepeat||\"\",startDate instanceof Date?startDate.getTime():\"\",deferDate instanceof Date?deferDate.getTime():\"\",dueDate instanceof Date?dueDate.getTime():\"\",(metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.project)||\"\",(metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.waitingFor)||\"\",contextSig,(metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.priority)||\"\",(metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.energy)||\"\",(metadataInfo===null||metadataInfo===void 0?void 0:metadataInfo.gtd)||\"\"];signature=signatureParts.join(\"|\");existingPill=main.querySelector(\".rt-pill-wrap\");prevEntry=pillSigCache.get(_uid7);prevSig=prevEntry&&_typeof(prevEntry)===\"object\"?prevEntry.sig:prevEntry;if(!(prevSig===signature&&existingPill)){_context105.n=23;break;}return _context105.a(2,1);case 23:if(existingPill)existingPill.remove();pillWrap=document.createElement(\"span\");pillWrap.className=\"rt-pill-wrap\";pillWrap.dataset.btUid=_uid7;pillWrap.dataset.btIsRecurring=isRecurring?\"1\":\"0\";repeatSpan=null;startSpan=null;deferSpan=null;dueSpan=null;pill=document.createElement(\"span\");pill.className=\"rt-pill\";pill.title=tooltip;if(isRecurring&&humanRepeat){repeatSpan=document.createElement(\"span\");repeatSpan.className=\"rt-pill-repeat\";repeatSpan.textContent=\"\\u21BB \".concat(humanRepeat);repeatSpan.title=\"\".concat(t([\"metadata\",\"repeatRule\"],getLanguageSetting())||\"Repeat rule\",\": \").concat(humanRepeat);repeatSpan.dataset.btPillAction=\"repeat\";pill.appendChild(repeatSpan);}addSeparator=function addSeparator(){var sep=document.createElement(\"span\");sep.className=\"rt-pill-separator\";sep.textContent=\" Â· \";pill.appendChild(sep);};if(startDisplay){if(repeatSpan)addSeparator();else if(pill.childElementCount>0)addSeparator();startSpan=document.createElement(\"span\");startSpan.className=\"rt-pill-start\";renderPillDateSpan(startSpan,{icon:START_ICON,date:startDate,set:set,label:metaLabels.start||\"Start\",tooltip:\"\".concat(metaLabels.start||\"Start\",\": \").concat(formatIsoDate(startDate,set))});startSpan.dataset.btPillAction=\"start\";pill.appendChild(startSpan);}if(deferDisplay){if(repeatSpan||startSpan)addSeparator();else if(pill.childElementCount>0)addSeparator();deferSpan=document.createElement(\"span\");deferSpan.className=\"rt-pill-defer\";renderPillDateSpan(deferSpan,{icon:DEFER_ICON,date:deferDate,set:set,label:metaLabels.defer||\"Defer\",tooltip:\"\".concat(metaLabels.defer||\"Defer\",\": \").concat(formatIsoDate(deferDate,set))});deferSpan.dataset.btPillAction=\"defer\";pill.appendChild(deferSpan);}if(dueDisplay){if(repeatSpan||startSpan||deferSpan)addSeparator();else if(pill.childElementCount>0)addSeparator();dueSpan=document.createElement(\"span\");dueSpan.className=\"rt-pill-due\";renderPillDateSpan(dueSpan,{icon:DUE_ICON,date:dueDate,set:set,label:metaLabels.due||\"Due\",tooltip:\"\".concat(metaLabels.due||\"Due\",\": \").concat(formatIsoDate(dueDate,set))});dueSpan.dataset.btPillAction=\"due\";pill.appendChild(dueSpan);}appendMetaSpan=function appendMetaSpan(icon,text,title){if(!text)return null;if(pill.childElementCount>0)addSeparator();var span=document.createElement(\"span\");span.className=\"rt-pill-meta\";span.textContent=\"\".concat(icon,\" \").concat(text);span.title=title;pill.appendChild(span);return span;};if(metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.project){span=appendMetaSpan(\"ðŸ“\",metadataInfo.project,\"\".concat(metaLabels.projectLabel||metaLabels.project||\"Project\",\": \").concat(metadataInfo.project));if(span)span.dataset.btPillAction=\"meta-project\";}if(metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.waitingFor){_span=appendMetaSpan(\"âŒ›\",metadataInfo.waitingFor,\"\".concat(metaLabels.waitingLabel||metaLabels.waitingFor||\"Waiting for\",\": \").concat(metadataInfo.waitingFor));if(_span)_span.dataset.btPillAction=\"meta-waitingFor\";}if(metadataInfo!==null&&metadataInfo!==void 0&&(_metadataInfo$context2=metadataInfo.context)!==null&&_metadataInfo$context2!==void 0&&_metadataInfo$context2.length){first=metadataInfo.context[0];extra=metadataInfo.context.length>1?\" (+\".concat(metadataInfo.context.length-1,\")\"):\"\";display=\"\".concat(first).concat(extra);_span2=appendMetaSpan(\"@\",display,\"\".concat(metaLabels.contextLabel||metaLabels.context||\"Context\",\": \").concat(metadataInfo.context.join(\", \")));if(_span2)_span2.dataset.btPillAction=\"meta-context\";}if(metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.gtd){_display3=formatGtdStatusDisplay(metadataInfo.gtd,getLanguageSetting());_tooltip=\"\".concat(metaLabels.gtdLabel||metaLabels.gtd||\"GTD\",\": \").concat(_display3);_span3=appendMetaSpan(\"âž¡\",_display3,_tooltip);if(_span3){_span3.dataset.metaValue=metadataInfo.gtd||\"\";_span3.dataset.btPillAction=\"cycle-gtd\";}}if(metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.priority){_span4=appendMetaSpan(\"!\",formatPriorityEnergyDisplay(metadataInfo.priority,getLanguageSetting()),\"\".concat(metaLabels.priorityLabel||metaLabels.priority||\"Priority\",\": \").concat(formatPriorityEnergyDisplay(metadataInfo.priority,getLanguageSetting()),\" (\").concat(t([\"pillMenu\",\"cyclePriority\"],getLanguageSetting())||\"Click to cycle\",\")\"));if(_span4){_span4.dataset.metaValue=metadataInfo.priority||\"\";_span4.dataset.btPillAction=\"cycle-priority\";}}if(metadataInfo!==null&&metadataInfo!==void 0&&metadataInfo.energy){_span5=appendMetaSpan(\"ðŸ”‹\",formatPriorityEnergyDisplay(metadataInfo.energy,getLanguageSetting()),\"\".concat(metaLabels.energyLabel||metaLabels.energy||\"Energy\",\": \").concat(formatPriorityEnergyDisplay(metadataInfo.energy,getLanguageSetting()),\" (\").concat(t([\"pillMenu\",\"cycleEnergy\"],getLanguageSetting())||\"Click to cycle\",\")\"));if(_span5){_span5.dataset.metaValue=metadataInfo.energy||\"\";_span5.dataset.btPillAction=\"cycle-energy\";}}menuBtn=document.createElement(\"span\");menuBtn.className=\"rt-pill-menu-btn\";menuBtn.textContent=\"â‹¯\";menuBtn.title=\"More task actions\";menuBtn.setAttribute(\"aria-label\",\"More task actions\");menuBtn.dataset.btPillAction=\"menu\";pill.appendChild(menuBtn);pillWrap.appendChild(pill);pillWrap.dataset.btSig=signature;pillSigCache.set(_uid7,{sig:signature,lastSeen:now});decoratedThisPass+=1;check=((_main$querySelector7=main.querySelector)===null||_main$querySelector7===void 0?void 0:_main$querySelector7.call(main,\".check-container, .rm-checkbox\"))||main.firstElementChild;insertPillWrap(main,check,pillWrap);_context105.n=25;break;case 24:_context105.p=24;_t95=_context105.v;console.warn(\"[RecurringTasks] decorate pill failed\",_t95);case 25:return _context105.a(2);}},_loop3,null,[[6,8],[2,24]]);});_iterator32.s();case 8:if((_step32=_iterator32.n()).done){_context106.n=12;break;}return _context106.d(_regeneratorValues(_loop3()),9);case 9:_ret3=_context106.v;if(!(_ret3===0)){_context106.n=10;break;}return _context106.a(3,12);case 10:if(!(_ret3===1)){_context106.n=11;break;}return _context106.a(3,11);case 11:_context106.n=8;break;case 12:_context106.n=14;break;case 13:_context106.p=13;_t97=_context106.v;_iterator32.e(_t97);case 14:_context106.p=14;_iterator32.f();return _context106.f(14);case 15:if(pillSigCache.size>PILL_SIG_CACHE_MAX){entries=Array.from(pillSigCache.entries());entries.sort(function(a,b){var _a$3,_b$3;var aSeen=((_a$3=a[1])===null||_a$3===void 0?void 0:_a$3.lastSeen)||0;var bSeen=((_b$3=b[1])===null||_b$3===void 0?void 0:_b$3.lastSeen)||0;return aSeen-bSeen;});overflow=entries.length-PILL_SIG_CACHE_MAX;for(i=0;i<overflow;i++){pillSigCache[\"delete\"](entries[i][0]);}}if(PILL_SIG_CACHE_TTL_MS>0){_iterator33=_createForOfIteratorHelper(pillSigCache.entries());try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){_step33$value=_slicedToArray(_step33.value,2),uid=_step33$value[0],entry=_step33$value[1];lastSeen=(entry===null||entry===void 0?void 0:entry.lastSeen)||0;if(lastSeen&&now-lastSeen>PILL_SIG_CACHE_TTL_MS){pillSigCache[\"delete\"](uid);}}}catch(err){_iterator33.e(err);}finally{_iterator33.f();}}case 16:return _context106.a(2);}},_callee105,null,[[7,13,14,15],[3,5]]);}));return _decorateBlockPills.apply(this,arguments);}function handleRepeatEdit(_x113,_x114){return _handleRepeatEdit.apply(this,arguments);}function _handleRepeatEdit(){_handleRepeatEdit=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee106(event,context){var uid,set,span,block,meta,attrNames,contextSnapshot,current,priorDue,_navigator$clipboard,_navigator$clipboard$,next,normalized,dueDateToPersist,updates,repeatRes,dueRes,currentLocation,relocation,_pill,dueSpanEl,friendly,tooltip,repeatLabel,repeatMsgTemplate,repeatMsg,dueChanged,nextTemplate,cleared,message,_t98;return _regenerator().w(function(_context107){while(1)switch(_context107.p=_context107.n){case 0:uid=context.uid,set=context.set,span=context.span;_context107.n=1;return getBlock(uid);case 1:block=_context107.v;if(block){_context107.n=2;break;}return _context107.a(2);case 2:_context107.n=3;return readRecurringMeta(block,set);case 3:meta=_context107.v;attrNames=set.attrNames;contextSnapshot=prepareDueChangeContext(block,meta,set);current=meta.repeat||\"\";priorDue=contextSnapshot.previousDueDate;if(!event.altKey){_context107.n=8;break;}_context107.p=4;_context107.n=5;return(_navigator$clipboard=navigator.clipboard)===null||_navigator$clipboard===void 0||(_navigator$clipboard$=_navigator$clipboard.writeText)===null||_navigator$clipboard$===void 0?void 0:_navigator$clipboard$.call(_navigator$clipboard,current);case 5:toast(\"Repeat copied\");_context107.n=7;break;case 6:_context107.p=6;_t98=_context107.v;console.warn(\"[RecurringTasks] copy repeat failed\",_t98);case 7:return _context107.a(2);case 8:_context107.n=9;return promptForValue({title:\"Edit Repeat\",message:\"Update repeat rule\",placeholder:\"e.g. every Friday\",initial:current});case 9:next=_context107.v;if(!(!next||next===current)){_context107.n=10;break;}return _context107.a(2);case 10:normalized=normalizeRepeatRuleText(next)||next.trim();dueDateToPersist=priorDue||null;updates={repeat:normalized};if(dueDateToPersist){updates.due=formatDate(dueDateToPersist,set);}_context107.n=11;return updateBlockProps(uid,updates);case 11:_context107.n=12;return ensureChildAttrForType(uid,\"repeat\",normalized,attrNames);case 12:repeatRes=_context107.v;meta.childAttrMap=meta.childAttrMap||{};setMetaChildAttr(meta,\"repeat\",{uid:repeatRes.uid,value:normalized},attrNames);if(!dueDateToPersist){_context107.n=14;break;}_context107.n=13;return ensureChildAttrForType(uid,\"due\",updates.due,attrNames);case 13:dueRes=_context107.v;setMetaChildAttr(meta,\"due\",{uid:dueRes.uid,value:updates.due},attrNames);_context107.n=16;break;case 14:_context107.n=15;return removeChildAttrsForType(uid,\"due\",attrNames);case 15:clearMetaChildAttr(meta,\"due\",attrNames);case 16:_context107.n=17;return ensureInlineAttrForType(block,\"repeat\",normalized,attrNames);case 17:if(!dueDateToPersist){_context107.n=18;break;}_context107.n=18;return ensureInlineAttrForType(block,\"due\",updates.due,attrNames);case 18:meta.repeat=normalized;meta.due=dueDateToPersist||null;mergeRepeatOverride(uid,{repeat:normalized,due:dueDateToPersist||null});currentLocation=captureBlockLocation(block);relocation={moved:false,targetUid:currentLocation.parentUid};if(span){span.textContent=\"\\u21BB \".concat(normalized);span.title=\"\".concat(t([\"metadata\",\"repeatRule\"],getLanguageSetting())||\"Repeat rule\",\": \").concat(normalized);_pill=span.closest(\".rt-pill\");if(_pill){dueSpanEl=_pill.querySelector(\".rt-pill-due\");if(dueDateToPersist&&dueSpanEl){friendly=formatFriendlyDate(dueDateToPersist,set);tooltip=\"\".concat(t([\"metadata\",\"due\"],getLanguageSetting())||\"Due\",\": \").concat(formatIsoDate(dueDateToPersist,set));renderPillDateSpan(dueSpanEl,{icon:DUE_ICON,date:dueDateToPersist,set:set,label:t([\"metadata\",\"due\"],getLanguageSetting())||\"Due\",tooltip:tooltip});_pill.title=tooltip;}else{repeatLabel=t([\"metadata\",\"repeatRule\"],getLanguageSetting())||\"Repeat rule\";_pill.title=\"\".concat(repeatLabel,\": \").concat(normalized);}}}repeatMsgTemplate=t([\"toasts\",\"repeatUpdated\"],getLanguageSetting());repeatMsg=repeatMsgTemplate?repeatMsgTemplate.replace(\"{{value}}\",normalized):\"Repeat \\u2192 \".concat(normalized);toast(repeatMsg);dueChanged=(priorDue?priorDue.getTime():null)!==(dueDateToPersist?dueDateToPersist.getTime():null);if(dueChanged||relocation.moved){nextTemplate=t([\"toasts\",\"nextOccurrenceTo\"],getLanguageSetting());cleared=translateString(\"Next occurrence cleared\",getLanguageSetting())||\"Next occurrence cleared\";message=dueDateToPersist?nextTemplate?nextTemplate.replace(\"{{date}}\",formatRoamDateTitle(dueDateToPersist)):\"Next occurrence \\u2192 [[\".concat(formatRoamDateTitle(dueDateToPersist),\"]]\"):cleared;registerDueUndoAction({blockUid:uid,message:message,setSnapshot:_objectSpread({},set),previousDueDate:priorDue?new Date(priorDue.getTime()):null,previousDueStr:contextSnapshot.previousDueStr||null,previousInlineDue:contextSnapshot.previousInlineDue,hadInlineDue:contextSnapshot.hadInlineDue,previousInlineRepeat:contextSnapshot.previousInlineRepeat,hadInlineRepeat:contextSnapshot.hadInlineRepeat,previousChildDue:contextSnapshot.previousChildDue,previousChildDueUid:contextSnapshot.previousChildDueUid||null,hadChildDue:contextSnapshot.hadChildDue,previousChildRepeat:contextSnapshot.previousChildRepeat,previousChildRepeatUid:contextSnapshot.previousChildRepeatUid||null,previousParentUid:contextSnapshot.previousParentUid,previousOrder:contextSnapshot.previousOrder,newDue:dueDateToPersist?new Date(dueDateToPersist.getTime()):null,newDueStr:dueDateToPersist?formatDate(dueDateToPersist,set):null,newParentUid:relocation.targetUid,wasMoved:relocation.moved,snapshot:contextSnapshot.snapshot});}void syncPillsForSurface(lastAttrSurface);return _context107.a(2,normalized);}},_callee106,null,[[4,6]]);}));return _handleRepeatEdit.apply(this,arguments);}function handleStartClick(_x115,_x116){return _handleStartClick.apply(this,arguments);}function _handleStartClick(){_handleStartClick=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee107(event,context){return _regenerator().w(function(_context108){while(1)switch(_context108.n){case 0:_context108.n=1;return handleFlexibleDateAttrClick(event,_objectSpread(_objectSpread({},context),{},{type:\"start\"}));case 1:return _context108.a(2);}},_callee107);}));return _handleStartClick.apply(this,arguments);}function handleDeferClick(_x117,_x118){return _handleDeferClick.apply(this,arguments);}function _handleDeferClick(){_handleDeferClick=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee108(event,context){return _regenerator().w(function(_context109){while(1)switch(_context109.n){case 0:_context109.n=1;return handleFlexibleDateAttrClick(event,_objectSpread(_objectSpread({},context),{},{type:\"defer\"}));case 1:return _context109.a(2);}},_callee108);}));return _handleDeferClick.apply(this,arguments);}function handleFlexibleDateAttrClick(_x119,_x120){return _handleFlexibleDateAttrClick.apply(this,arguments);}function _handleFlexibleDateAttrClick(){_handleFlexibleDateAttrClick=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee109(event,context){var type,uid,set,span,_context$forcePrompt,forcePrompt,_context$allowCreate,allowCreate,block,meta,attrNames,currentDate,hasDate,label,shouldPrompt,existing,promptKey,nextIso,parsed,nextStr,childInfo,existingEntry,storedUid,labelStr;return _regenerator().w(function(_context110){while(1)switch(_context110.n){case 0:type=context.type,uid=context.uid,set=context.set,span=context.span,_context$forcePrompt=context.forcePrompt,forcePrompt=_context$forcePrompt===void 0?false:_context$forcePrompt,_context$allowCreate=context.allowCreate,allowCreate=_context$allowCreate===void 0?false:_context$allowCreate;if(!(!type||!uid||!set)){_context110.n=1;break;}return _context110.a(2);case 1:_context110.n=2;return getBlock(uid);case 2:block=_context110.v;if(block){_context110.n=3;break;}return _context110.a(2);case 3:_context110.n=4;return readRecurringMeta(block,set);case 4:meta=_context110.v;attrNames=set.attrNames;currentDate=type===\"start\"?meta.start:meta.defer;hasDate=currentDate instanceof Date&&!Number.isNaN(currentDate.getTime());if(!(!hasDate&&!allowCreate)){_context110.n=5;break;}return _context110.a(2);case 5:label=type===\"start\"?\"Start\":\"Defer\";if(!(event.shiftKey&&hasDate&&!forcePrompt)){_context110.n=7;break;}_context110.n=6;return openDatePage(currentDate,{inSidebar:true});case 6:return _context110.a(2);case 7:shouldPrompt=forcePrompt||!hasDate||event.altKey||event.metaKey||event.ctrlKey;if(!shouldPrompt){_context110.n=15;break;}existing=hasDate?formatIsoDate(currentDate,set):\"\";promptKey=\"datePrompt:\".concat(uid,\":\").concat(type);_context110.n=8;return runDatePromptOnce(promptKey,function(){return promptForDate({title:translateString(\"Edit \".concat(label,\" Date\"),getLanguageSetting()),message:translateString(\"Select the \".concat(label.toLowerCase(),\" date\"),getLanguageSetting()),initial:existing});});case 8:nextIso=_context110.v;if(nextIso){_context110.n=9;break;}return _context110.a(2);case 9:parsed=parseRoamDate(nextIso);if(!(!(parsed instanceof Date)||Number.isNaN(parsed.getTime()))){_context110.n=10;break;}toast(t([\"toasts\",\"cannotParseDate\"],getLanguageSetting())||\"Couldn't parse that date.\");return _context110.a(2);case 10:nextStr=formatDate(parsed,set);_context110.n=11;return updateBlockProps(uid,_defineProperty({},type,nextStr));case 11:_context110.n=12;return ensureChildAttrForType(uid,type,nextStr,attrNames);case 12:childInfo=_context110.v;_context110.n=13;return ensureInlineAttrForType(block,type,nextStr,attrNames);case 13:meta.childAttrMap=meta.childAttrMap||{};existingEntry=getMetaChildAttr(meta,type,attrNames,{allowFallback:false});storedUid=(childInfo===null||childInfo===void 0?void 0:childInfo.uid)||(existingEntry===null||existingEntry===void 0?void 0:existingEntry.uid)||null;setMetaChildAttr(meta,type,{value:nextStr,uid:storedUid},attrNames);meta[type]=parsed;if(span){labelStr=type===\"start\"?t([\"metadata\",\"start\"],getLanguageSetting())||\"Start\":t([\"metadata\",\"defer\"],getLanguageSetting())||\"Defer\";renderPillDateSpan(span,{icon:type===\"start\"?START_ICON:DEFER_ICON,date:parsed,set:set,label:labelStr,tooltip:\"\".concat(labelStr,\": \").concat(formatIsoDate(parsed,set))});}if(!(type===\"start\"||!isValidDateValue(meta.start))){_context110.n=14;break;}_context110.n=14;return relocateBlockForPlacement(block,meta,set);case 14:toast(\"\".concat(type===\"start\"?t([\"metadata\",\"start\"],getLanguageSetting())||\"Start\":t([\"metadata\",\"defer\"],getLanguageSetting())||\"Defer\",\" \\u2192 [[\").concat(formatRoamDateTitle(parsed),\"]]\"));void syncPillsForSurface(lastAttrSurface);return _context110.a(2,parsed);case 15:if(!hasDate){_context110.n=16;break;}_context110.n=16;return openDatePage(currentDate);case 16:return _context110.a(2);}},_callee109);}));return _handleFlexibleDateAttrClick.apply(this,arguments);}function handleDueClick(_x121,_x122){return _handleDueClick.apply(this,arguments);}function _handleDueClick(){_handleDueClick=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee110(event,context){var _due$getTime;var uid,set,span,_context$forcePrompt2,forcePrompt,_context$allowCreate2,allowCreate,block,meta,attrNames,contextSnapshot,due,hasDue,shouldPrompt,existing,promptKey,nextIso,parsed,nextStr,dueChildInfo,existingEntry,storedUid,_span$closest,_pill2,dueChanged,_translateString2;return _regenerator().w(function(_context111){while(1)switch(_context111.n){case 0:uid=context.uid,set=context.set,span=context.span,_context$forcePrompt2=context.forcePrompt,forcePrompt=_context$forcePrompt2===void 0?false:_context$forcePrompt2,_context$allowCreate2=context.allowCreate,allowCreate=_context$allowCreate2===void 0?false:_context$allowCreate2;_context111.n=1;return getBlock(uid);case 1:block=_context111.v;if(block){_context111.n=2;break;}return _context111.a(2);case 2:_context111.n=3;return readRecurringMeta(block,set);case 3:meta=_context111.v;attrNames=set.attrNames;contextSnapshot=prepareDueChangeContext(block,meta,set);due=meta.due;hasDue=due instanceof Date&&!Number.isNaN(due===null||due===void 0||(_due$getTime=due.getTime)===null||_due$getTime===void 0?void 0:_due$getTime.call(due));if(!(!hasDue&&!allowCreate)){_context111.n=4;break;}return _context111.a(2);case 4:if(!(!forcePrompt&&event.altKey&&(event.metaKey||event.ctrlKey))){_context111.n=6;break;}_context111.n=5;return snoozeDeferByDays(uid,set,1);case 5:return _context111.a(2);case 6:if(!(event.shiftKey&&hasDue&&!forcePrompt)){_context111.n=8;break;}_context111.n=7;return openDatePage(due,{inSidebar:true});case 7:return _context111.a(2);case 8:shouldPrompt=forcePrompt||!hasDue||event.altKey||event.metaKey||event.ctrlKey;if(!shouldPrompt){_context111.n=15;break;}existing=hasDue?formatIsoDate(due,set):\"\";promptKey=\"datePrompt:\".concat(uid,\":due\");_context111.n=9;return runDatePromptOnce(promptKey,function(){return promptForDate({title:\"Edit Due Date\",message:\"Select the next due date\",initial:existing});});case 9:nextIso=_context111.v;if(nextIso){_context111.n=10;break;}return _context111.a(2);case 10:parsed=parseRoamDate(nextIso);if(!(!(parsed instanceof Date)||Number.isNaN(parsed.getTime()))){_context111.n=11;break;}toast(\"Couldn't parse that date.\");return _context111.a(2);case 11:nextStr=formatDate(parsed,set);_context111.n=12;return updateBlockProps(uid,{due:nextStr});case 12:_context111.n=13;return ensureChildAttrForType(uid,\"due\",nextStr,attrNames);case 13:dueChildInfo=_context111.v;_context111.n=14;return ensureInlineAttrForType(block,\"due\",nextStr,attrNames);case 14:meta.due=parsed;meta.childAttrMap=meta.childAttrMap||{};existingEntry=getMetaChildAttr(meta,\"due\",attrNames,{allowFallback:false});storedUid=(dueChildInfo===null||dueChildInfo===void 0?void 0:dueChildInfo.uid)||(existingEntry===null||existingEntry===void 0?void 0:existingEntry.uid)||null;setMetaChildAttr(meta,\"due\",{value:nextStr,uid:storedUid},attrNames);mergeRepeatOverride(uid,{due:parsed});if(span){renderPillDateSpan(span,{icon:DUE_ICON,date:parsed,set:set,label:t([\"metadata\",\"due\"],getLanguageSetting())||\"Due\",tooltip:\"\".concat(t([\"metadata\",\"due\"],getLanguageSetting())||\"Due\",\": \").concat(formatIsoDate(parsed,set))});_pill2=(_span$closest=span.closest)===null||_span$closest===void 0?void 0:_span$closest.call(span,\".rt-pill\");if(_pill2)_pill2.title=span.title;}dueChanged=(contextSnapshot.previousDueDate?contextSnapshot.previousDueDate.getTime():null)!==parsed.getTime();if(dueChanged){registerDueUndoAction({blockUid:uid,message:((_translateString2=translateString(\"Due date changed to {{date}}\",getLanguageSetting()))===null||_translateString2===void 0?void 0:_translateString2.replace(\"{{date}}\",formatRoamDateTitle(parsed)))||\"Due date changed to \".concat(formatRoamDateTitle(parsed)),setSnapshot:_objectSpread({},set),previousDueDate:contextSnapshot.previousDueDate?new Date(contextSnapshot.previousDueDate.getTime()):null,previousDueStr:contextSnapshot.previousDueStr||null,previousInlineDue:contextSnapshot.previousInlineDue,hadInlineDue:contextSnapshot.hadInlineDue,previousInlineRepeat:contextSnapshot.previousInlineRepeat,hadInlineRepeat:contextSnapshot.hadInlineRepeat,previousChildDue:contextSnapshot.previousChildDue,previousChildDueUid:contextSnapshot.previousChildDueUid||null,hadChildDue:contextSnapshot.hadChildDue,previousChildRepeat:contextSnapshot.previousChildRepeat,previousChildRepeatUid:contextSnapshot.previousChildRepeatUid||null,previousParentUid:contextSnapshot.previousParentUid,previousOrder:contextSnapshot.previousOrder,newDue:new Date(parsed.getTime()),newDueStr:nextStr,newParentUid:contextSnapshot.previousParentUid,wasMoved:false,snapshot:contextSnapshot.snapshot});}void syncPillsForSurface(lastAttrSurface);return _context111.a(2,parsed);case 15:if(!hasDue){_context111.n=16;break;}_context111.n=16;return openDatePage(due);case 16:return _context111.a(2);}},_callee110);}));return _handleDueClick.apply(this,arguments);}function openDatePage(_x123){return _openDatePage.apply(this,arguments);}function _openDatePage(){_openDatePage=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee111(date){var options,dnpTitle,_options$inSidebar2,inSidebar,i,uid,_args112=arguments,_t99;return _regenerator().w(function(_context112){while(1)switch(_context112.p=_context112.n){case 0:options=_args112.length>1&&_args112[1]!==undefined?_args112[1]:{};if(!(!(date instanceof Date)||Number.isNaN(date.getTime()))){_context112.n=1;break;}return _context112.a(2);case 1:dnpTitle=toDnpTitle(date);_options$inSidebar2=options.inSidebar,inSidebar=_options$inSidebar2===void 0?false:_options$inSidebar2;// When creating a page then immediately navigating, Roam can be briefly inconsistent.\n// Poll for the page UID (by title) and retry navigation a few times.\ni=0;case 2:if(!(i<4)){_context112.n=8;break;}_context112.n=3;return ensurePageUid(dnpTitle);case 3:uid=_context112.v;if(uid){_context112.n=5;break;}_context112.n=4;return delay(60*(i+1));case 4:return _context112.a(3,7);case 5:_context112.p=5;if(inSidebar){window.roamAlphaAPI.ui.rightSidebar.addWindow({window:{type:\"outline\",\"page-uid\":uid,\"block-uid\":uid}});}else{window.roamAlphaAPI.ui.mainWindow.openPage({page:{uid:uid}});}return _context112.a(2);case 6:_context112.p=6;_t99=_context112.v;_context112.n=7;return delay(80*(i+1));case 7:i++;_context112.n=2;break;case 8:return _context112.a(2);}},_callee111,null,[[5,6]]);}));return _openDatePage.apply(this,arguments);}function ensurePillMenuStyles(){if(document.getElementById(\"rt-pill-menu-style\"))return;var style=document.createElement(\"style\");style.id=\"rt-pill-menu-style\";style.textContent=\"\\n        .rt-pill-menu {\\n          display: flex;\\n          flex-direction: column;\\n          gap: 8px;\\n          min-width: 220px;\\n        }\\n        .rt-pill-menu button {\\n          all: unset;\\n          cursor: pointer;\\n          padding: 6px 10px;\\n          border-radius: 6px;\\n          background: rgba(0,0,0,0.05);\\n          transition: background 0.15s ease;\\n        }\\n        .rt-pill-menu button:hover {\\n          background: rgba(0,0,0,0.1);\\n        }\\n        .rt-pill-menu button[data-danger=\\\"1\\\"] {\\n          color: #b00020;\\n          background: rgba(176,0,32,0.08);\\n        }\\n        .rt-pill-menu button[data-danger=\\\"1\\\"]:hover {\\n          background: rgba(176,0,32,0.16);\\n        }\\n        .rt-pill-menu small {\\n          color: rgba(0,0,0,0.6);\\n        }\\n      \";document.head.appendChild(style);}function showPillMenu(_ref21){var _activeDashboardContr48,_activeDashboardContr49;var uid=_ref21.uid,set=_ref21.set,_ref21$isRecurring=_ref21.isRecurring,isRecurring=_ref21$isRecurring===void 0?true:_ref21$isRecurring,_ref21$metadata=_ref21.metadata,metadata=_ref21$metadata===void 0?null:_ref21$metadata;// Ensure at most one pill menu toast is visible (defensive against multiple event handlers).\ntry{var _document$querySelect4,_document6;var now=Date.now();var k=\"pillMenu:\".concat(uid);if(typeof window!==\"undefined\"){var last=window.__btLastPillMenuOpen||{at:0,key:\"\"};if(last.key===k&&now-last.at<350)return;window.__btLastPillMenuOpen={at:now,key:k};}(_document$querySelect4=(_document6=document).querySelectorAll)===null||_document$querySelect4===void 0||(_document$querySelect4=_document$querySelect4.call(_document6,\".bt-pill-menu-toast\"))===null||_document$querySelect4===void 0||_document$querySelect4.forEach(function(toastEl){try{var _iziToast$hide;(_iziToast$hide=(izitoast__WEBPACK_IMPORTED_MODULE_0___default().hide))===null||_iziToast$hide===void 0||_iziToast$hide.call((izitoast__WEBPACK_IMPORTED_MODULE_0___default()),{},toastEl);}catch(_){// ignore\n}});}catch(_){// ignore\n}var menuId=\"rt-pill-menu-\".concat(uid,\"-\").concat(Date.now());var lang=getLanguageSetting();var pmStrings=t(\"pillMenu\",lang)||{};var metaStrings=t(\"metadata\",lang)||{};var labelOr=function labelOr(key,fallback){return escapeHtml(pmStrings[key]||fallback);};var metadataInfo=metadata||readInlineMetaCache(uid)||((_activeDashboardContr48=activeDashboardController)===null||_activeDashboardContr48===void 0||(_activeDashboardContr49=_activeDashboardContr48.getTaskMetadata)===null||_activeDashboardContr49===void 0?void 0:_activeDashboardContr49.call(_activeDashboardContr48,uid))||null;metadataInfo=metadataInfo||{};var contexts=Array.isArray(metadataInfo.context)?metadataInfo.context:[];var hasProject=!!metadataInfo.project;var hasWaiting=!!metadataInfo.waitingFor;var hasContext=contexts.length>0;var attrNamesForMenu=set.attrNames||resolveAttributeNames();var applyMetadataPatch=/*#__PURE__*/function(){var _ref22=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0(patch){var _activeDashboardContr50;var _patch$project,_patch$waitingFor,ctx,_patch$priority,_patch$energy,_patch$gtd,_window$__btInlineMet3,_activeDashboardContr51,notifier,_t1;return _regenerator().w(function(_context0){while(1)switch(_context0.p=_context0.n){case 0:if(patch){_context0.n=1;break;}return _context0.a(2);case 1:if(!((_activeDashboardContr50=activeDashboardController)!==null&&_activeDashboardContr50!==void 0&&_activeDashboardContr50.updateMetadata)){_context0.n=3;break;}_context0.n=2;return activeDashboardController.updateMetadata(uid,patch);case 2:return _context0.a(2);case 3:if(!(\"project\"in patch)){_context0.n=5;break;}_context0.n=4;return setRichAttribute(uid,\"project\",(_patch$project=patch.project)!==null&&_patch$project!==void 0?_patch$project:null,attrNamesForMenu);case 4:if(patch.project)(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption)(patch.project);case 5:if(!(\"waitingFor\"in patch)){_context0.n=6;break;}_context0.n=6;return setRichAttribute(uid,\"waitingFor\",(_patch$waitingFor=patch.waitingFor)!==null&&_patch$waitingFor!==void 0?_patch$waitingFor:null,attrNamesForMenu);case 6:if(!(\"context\"in patch)){_context0.n=7;break;}ctx=Array.isArray(patch.context)?patch.context:[];_context0.n=7;return setRichAttribute(uid,\"context\",ctx,attrNamesForMenu);case 7:if(!(\"priority\"in patch)){_context0.n=8;break;}_context0.n=8;return setRichAttribute(uid,\"priority\",(_patch$priority=patch.priority)!==null&&_patch$priority!==void 0?_patch$priority:null,attrNamesForMenu);case 8:if(!(\"energy\"in patch)){_context0.n=9;break;}_context0.n=9;return setRichAttribute(uid,\"energy\",(_patch$energy=patch.energy)!==null&&_patch$energy!==void 0?_patch$energy:null,attrNamesForMenu);case 9:if(!(\"gtd\"in patch)){_context0.n=10;break;}_context0.n=10;return setRichAttribute(uid,\"gtd\",(_patch$gtd=patch.gtd)!==null&&_patch$gtd!==void 0?_patch$gtd:null,attrNamesForMenu);case 10:if(typeof window!==\"undefined\"){(_window$__btInlineMet3=window.__btInlineMetaCache)===null||_window$__btInlineMet3===void 0||_window$__btInlineMet3[\"delete\"](uid);}_context0.p=11;notifier=((_activeDashboardContr51=activeDashboardController)===null||_activeDashboardContr51===void 0?void 0:_activeDashboardContr51.notifyBlockChange)||notifyBlockChange;if(!(typeof notifier===\"function\")){_context0.n=12;break;}_context0.n=12;return notifier(uid,{bypassFilters:true});case 12:_context0.n=14;break;case 13:_context0.p=13;_t1=_context0.v;console.warn(\"[BetterTasks] notifyBlockChange (menu) failed\",_t1);case 14:void syncPillsForSurface(lastAttrSurface);case 15:return _context0.a(2);}},_callee0,null,[[11,13]]);}));return function applyMetadataPatch(_x124){return _ref22.apply(this,arguments);};}();var metaHeading=t([\"pillMenu\",\"metaHeading\"],lang)||\"Metadata\";var metaSection=\"\\n        <small>\".concat(escapeHtml(metaHeading),\"</small>\\n        <button data-action=\\\"meta-gtd-cycle\\\">\").concat(labelOr(\"cycleGtd\",\"Cycle GTD\"),\"</button>\\n        \").concat(hasProject?\"<button data-action=\\\"meta-project-remove\\\" data-danger=\\\"1\\\">\".concat(labelOr(\"removeProject\",\"Remove project\"),\"</button>\"):\"<button data-action=\\\"meta-project-add\\\">\".concat(labelOr(\"addProject\",\"Add project\"),\"</button>\"),\"\\n        \").concat(hasContext?\"<button data-action=\\\"meta-context-remove\\\" data-danger=\\\"1\\\">\".concat(labelOr(\"removeContext\",\"Remove context\"),\"</button>\"):\"<button data-action=\\\"meta-context-add\\\">\".concat(labelOr(\"addContext\",\"Add context\"),\"</button>\"),\"\\n        \").concat(hasWaiting?\"<button data-action=\\\"meta-waiting-remove\\\" data-danger=\\\"1\\\">\".concat(labelOr(\"removeWaiting\",\"Remove waiting-for\"),\"</button>\"):\"<button data-action=\\\"meta-waiting-add\\\">\".concat(labelOr(\"addWaiting\",\"Add waiting-for\"),\"</button>\"),\"\\n        <button data-action=\\\"meta-priority-cycle\\\">\").concat(labelOr(\"cyclePriority\",\"Cycle priority\"),\"</button>\\n        <button data-action=\\\"meta-energy-cycle\\\">\").concat(labelOr(\"cycleEnergy\",\"Cycle energy\"),\"</button>\\n      \");var recurringBlock=isRecurring?\"\\n         <button data-action=\\\"skip\\\">\".concat(labelOr(\"skipOccurrence\",\"Skip this occurrence\"),\"</button>\\n         <button data-action=\\\"generate\\\">\").concat(labelOr(\"generateNext\",\"Generate next now\"),\"</button>\\n          <button data-action=\\\"end\\\" data-danger=\\\"1\\\">\").concat(labelOr(\"endRecurrence\",\"End recurrence\"),\"</button>\\n        \"):\"\";var html=\"\\n        <div class=\\\"rt-pill-menu\\\" id=\\\"\".concat(menuId,\"\\\">\\n         <button data-action=\\\"snooze-1\\\">\").concat(labelOr(\"snoozePlus1\",\"Snooze +1 day\"),\"</button>\\n         <button data-action=\\\"snooze-3\\\">\").concat(labelOr(\"snoozePlus3\",\"Snooze +3 days\"),\"</button>\\n         <button data-action=\\\"snooze-next-mon\\\">\").concat(labelOr(\"snoozeNextMon\",\"Snooze to next Monday\"),\"</button>\\n         <button data-action=\\\"snooze-pick\\\">\").concat(labelOr(\"snoozePick\",\"Snooze (pick date)\"),\"</button>\\n         \").concat(recurringBlock,\"\\n         \").concat(metaSection,\"\\n        </div>\\n      \");izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",\"class\":\"betterTasks bt-toast-strong-icon bt-pill-menu-toast\",overlay:true,timeout:false,close:true,closeOnEscape:true,drag:false,icon:\"icon-check\",iconText:\"âœ“\",iconColor:\"#1f7a34\",message:html,position:\"center\",onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);var root=toastEl.querySelector(\"#\".concat(menuId));if(!root)return;var cleanup=function cleanup(){return izitoast__WEBPACK_IMPORTED_MODULE_0___default().hide({},toastEl);};var attach=function attach(selector,handler){var btn=root.querySelector(selector);if(!btn)return;btn.addEventListener(\"click\",/*#__PURE__*/function(){var _ref23=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1(e){return _regenerator().w(function(_context1){while(1)switch(_context1.n){case 0:e.stopPropagation();cleanup();_context1.n=1;return handler();case 1:return _context1.a(2);}},_callee1);}));return function(_x125){return _ref23.apply(this,arguments);};}());};attach('[data-action=\"snooze-1\"]',function(){return snoozeDeferByDays(uid,set,1);});attach('[data-action=\"snooze-3\"]',function(){return snoozeDeferByDays(uid,set,3);});attach('[data-action=\"snooze-next-mon\"]',function(){return snoozeDeferToNextMonday(uid,set);});attach('[data-action=\"snooze-pick\"]',function(){return snoozePickDeferDate(uid,set);});attach('[data-action=\"skip\"]',function(){return skipOccurrence(uid,set);});attach('[data-action=\"generate\"]',function(){return generateNextNow(uid,set);});attach('[data-action=\"end\"]',function(){return endRecurrence(uid,set);});attach('[data-action=\"meta-gtd-cycle\"]',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee10(){var _metadataInfo;var next;return _regenerator().w(function(_context10){while(1)switch(_context10.n){case 0:next=cycleGtdStatus(((_metadataInfo=metadataInfo)===null||_metadataInfo===void 0?void 0:_metadataInfo.gtd)||null);_context10.n=1;return applyMetadataPatch({gtd:next});case 1:return _context10.a(2);}},_callee10);})));attach('[data-action=\"meta-project-add\"]',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee11(){var _metadataInfo2;var val;return _regenerator().w(function(_context11){while(1)switch(_context11.n){case 0:_context11.n=1;return (0,_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions)();case 1:_context11.n=2;return promptForProject({initialValue:((_metadataInfo2=metadataInfo)===null||_metadataInfo2===void 0?void 0:_metadataInfo2.project)||\"\"});case 2:val=_context11.v;if(!(!val||!val.trim())){_context11.n=3;break;}return _context11.a(2);case 3:_context11.n=4;return applyMetadataPatch({project:val.trim()});case 4:return _context11.a(2);}},_callee11);})));attach('[data-action=\"meta-project-remove\"]',function(){return applyMetadataPatch({project:null});});attach('[data-action=\"meta-context-add\"]',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee12(){var _metadataInfo3;var selection;return _regenerator().w(function(_context12){while(1)switch(_context12.n){case 0:_context12.n=1;return (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)();case 1:_context12.n=2;return promptForContext({initialValue:((_metadataInfo3=metadataInfo)===null||_metadataInfo3===void 0?void 0:_metadataInfo3.context)||[]});case 2:selection=_context12.v;if(!(!selection||!selection.length)){_context12.n=3;break;}return _context12.a(2);case 3:_context12.n=4;return applyMetadataPatch({context:selection});case 4:return _context12.a(2);}},_callee12);})));attach('[data-action=\"meta-context-remove\"]',function(){return applyMetadataPatch({context:[]});});attach('[data-action=\"meta-waiting-add\"]',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee13(){var _metadataInfo4;var val;return _regenerator().w(function(_context13){while(1)switch(_context13.n){case 0:_context13.n=1;return (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)();case 1:_context13.n=2;return promptForWaiting({initialValue:((_metadataInfo4=metadataInfo)===null||_metadataInfo4===void 0?void 0:_metadataInfo4.waitingFor)||\"\"});case 2:val=_context13.v;if(!(!val||!val.trim())){_context13.n=3;break;}return _context13.a(2);case 3:_context13.n=4;return applyMetadataPatch({waitingFor:val.trim()});case 4:return _context13.a(2);}},_callee13);})));attach('[data-action=\"meta-waiting-remove\"]',function(){return applyMetadataPatch({waitingFor:null});});attach('[data-action=\"meta-priority-cycle\"]',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee14(){var _metadataInfo5;var order,current,idx,next;return _regenerator().w(function(_context14){while(1)switch(_context14.n){case 0:order=[null,\"low\",\"medium\",\"high\"];current=(((_metadataInfo5=metadataInfo)===null||_metadataInfo5===void 0?void 0:_metadataInfo5.priority)||\"\").toLowerCase()||null;idx=order.indexOf(current);next=order[(idx+1)%order.length];_context14.n=1;return applyMetadataPatch({priority:next});case 1:return _context14.a(2);}},_callee14);})));attach('[data-action=\"meta-energy-cycle\"]',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee15(){var _metadataInfo6;var order,current,idx,next;return _regenerator().w(function(_context15){while(1)switch(_context15.n){case 0:order=[null,\"low\",\"medium\",\"high\"];current=(((_metadataInfo6=metadataInfo)===null||_metadataInfo6===void 0?void 0:_metadataInfo6.energy)||\"\").toLowerCase()||null;idx=order.indexOf(current);next=order[(idx+1)%order.length];_context15.n=1;return applyMetadataPatch({energy:next});case 1:return _context15.a(2);}},_callee15);})));}});}function updateStartDate(_x126,_x127,_x128){return _updateStartDate.apply(this,arguments);}function _updateStartDate(){_updateStartDate=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee112(uid,set,targetDate){var options,block,meta,attrNames,nextStr,startChildInfo,existingEntry,storedUid,_args113=arguments,_t100,_t101;return _regenerator().w(function(_context113){while(1)switch(_context113.n){case 0:options=_args113.length>3&&_args113[3]!==undefined?_args113[3]:{};if(!(!(targetDate instanceof Date)||Number.isNaN(targetDate.getTime()))){_context113.n=1;break;}return _context113.a(2);case 1:_t100=options.block;if(_t100){_context113.n=3;break;}_context113.n=2;return getBlock(uid);case 2:_t100=_context113.v;case 3:block=_t100;if(block){_context113.n=4;break;}return _context113.a(2);case 4:_t101=options.meta;if(_t101){_context113.n=6;break;}_context113.n=5;return readRecurringMeta(block,set);case 5:_t101=_context113.v;case 6:meta=_t101;attrNames=set.attrNames;nextStr=formatDate(targetDate,set);_context113.n=7;return updateBlockProps(uid,{start:nextStr});case 7:_context113.n=8;return ensureChildAttrForType(uid,\"start\",nextStr,attrNames);case 8:startChildInfo=_context113.v;meta.childAttrMap=meta.childAttrMap||{};existingEntry=getMetaChildAttr(meta,\"start\",attrNames,{allowFallback:false});storedUid=(startChildInfo===null||startChildInfo===void 0?void 0:startChildInfo.uid)||(existingEntry===null||existingEntry===void 0?void 0:existingEntry.uid)||null;setMetaChildAttr(meta,\"start\",{value:nextStr,uid:storedUid},attrNames);_context113.n=9;return ensureInlineAttrForType(block,\"start\",nextStr,attrNames);case 9:meta.start=targetDate;_context113.n=10;return relocateBlockForPlacement(block,meta,set);case 10:void syncPillsForSurface(lastAttrSurface);case 11:return _context113.a(2);}},_callee112);}));return _updateStartDate.apply(this,arguments);}function updateDeferDate(_x129,_x130,_x131){return _updateDeferDate.apply(this,arguments);}function _updateDeferDate(){_updateDeferDate=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee113(uid,set,targetDate){var options,block,meta,attrNames,nextStr,deferChildInfo,existingEntry,storedUid,_args114=arguments,_t102,_t103;return _regenerator().w(function(_context114){while(1)switch(_context114.n){case 0:options=_args114.length>3&&_args114[3]!==undefined?_args114[3]:{};if(!(!(targetDate instanceof Date)||Number.isNaN(targetDate.getTime()))){_context114.n=1;break;}return _context114.a(2);case 1:_t102=options.block;if(_t102){_context114.n=3;break;}_context114.n=2;return getBlock(uid);case 2:_t102=_context114.v;case 3:block=_t102;if(block){_context114.n=4;break;}return _context114.a(2);case 4:_t103=options.meta;if(_t103){_context114.n=6;break;}_context114.n=5;return readRecurringMeta(block,set);case 5:_t103=_context114.v;case 6:meta=_t103;attrNames=set.attrNames;nextStr=formatDate(targetDate,set);_context114.n=7;return updateBlockProps(uid,{defer:nextStr});case 7:_context114.n=8;return ensureChildAttrForType(uid,\"defer\",nextStr,attrNames);case 8:deferChildInfo=_context114.v;meta.childAttrMap=meta.childAttrMap||{};existingEntry=getMetaChildAttr(meta,\"defer\",attrNames,{allowFallback:false});storedUid=(deferChildInfo===null||deferChildInfo===void 0?void 0:deferChildInfo.uid)||(existingEntry===null||existingEntry===void 0?void 0:existingEntry.uid)||null;setMetaChildAttr(meta,\"defer\",{value:nextStr,uid:storedUid},attrNames);_context114.n=9;return ensureInlineAttrForType(block,\"defer\",nextStr,attrNames);case 9:meta.defer=targetDate;if(isValidDateValue(meta.start)){_context114.n=10;break;}_context114.n=10;return relocateBlockForPlacement(block,meta,set);case 10:if(!bulkOperationInProgress){toast(options.toastMessage||\"Snoozed to [[\".concat(formatRoamDateTitle(targetDate),\"]]\"));}void syncPillsForSurface(lastAttrSurface);case 11:return _context114.a(2);}},_callee113);}));return _updateDeferDate.apply(this,arguments);}function diffDaysLocal(a,b){if(!(a instanceof Date)||!(b instanceof Date))return 0;var aStart=startOfDayLocal(a).getTime();var bStart=startOfDayLocal(b).getTime();return Math.round((aStart-bStart)/(24*60*60*1000));}function shiftExistingDatesByDays(_x132,_x133,_x134){return _shiftExistingDatesByDays.apply(this,arguments);}function _shiftExistingDatesByDays(){_shiftExistingDatesByDays=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee114(uid,set,days){var options,block,meta,hasDue,minTarget,shifted,next,_args115=arguments,_t104,_t105;return _regenerator().w(function(_context115){while(1)switch(_context115.n){case 0:options=_args115.length>3&&_args115[3]!==undefined?_args115[3]:{};if(!(typeof days!==\"number\"||!Number.isFinite(days))){_context115.n=1;break;}return _context115.a(2);case 1:_t104=options.block;if(_t104){_context115.n=3;break;}_context115.n=2;return getBlock(uid);case 2:_t104=_context115.v;case 3:block=_t104;if(block){_context115.n=4;break;}return _context115.a(2);case 4:_t105=options.meta;if(_t105){_context115.n=6;break;}_context115.n=5;return readRecurringMeta(block,set);case 5:_t105=_context115.v;case 6:meta=_t105;hasDue=meta.due instanceof Date&&!Number.isNaN(meta.due.getTime());minTarget=addDaysLocal(todayLocal(),days);if(hasDue){_context115.n=8;break;}_context115.n=7;return updateDueDate(uid,set,minTarget,{block:block,meta:meta});case 7:return _context115.a(2);case 8:shifted=addDaysLocal(meta.due,days);next=shifted.getTime()<minTarget.getTime()?minTarget:shifted;_context115.n=9;return updateDueDate(uid,set,next,{block:block,meta:meta});case 9:return _context115.a(2);}},_callee114);}));return _shiftExistingDatesByDays.apply(this,arguments);}function updateDueDate(_x135,_x136,_x137){return _updateDueDate.apply(this,arguments);}function _updateDueDate(){_updateDueDate=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee115(uid,set,targetDate){var options,block,meta,attrNames,nextStr,dueChildInfo,existingEntry,storedUid,_args116=arguments,_t106,_t107;return _regenerator().w(function(_context116){while(1)switch(_context116.n){case 0:options=_args116.length>3&&_args116[3]!==undefined?_args116[3]:{};if(!(!(targetDate instanceof Date)||Number.isNaN(targetDate.getTime()))){_context116.n=1;break;}return _context116.a(2);case 1:_t106=options.block;if(_t106){_context116.n=3;break;}_context116.n=2;return getBlock(uid);case 2:_t106=_context116.v;case 3:block=_t106;if(block){_context116.n=4;break;}return _context116.a(2);case 4:_t107=options.meta;if(_t107){_context116.n=6;break;}_context116.n=5;return readRecurringMeta(block,set);case 5:_t107=_context116.v;case 6:meta=_t107;attrNames=set.attrNames;nextStr=formatDate(targetDate,set);_context116.n=7;return updateBlockProps(uid,{due:nextStr});case 7:_context116.n=8;return ensureChildAttrForType(uid,\"due\",nextStr,attrNames);case 8:dueChildInfo=_context116.v;meta.childAttrMap=meta.childAttrMap||{};existingEntry=getMetaChildAttr(meta,\"due\",attrNames,{allowFallback:false});storedUid=(dueChildInfo===null||dueChildInfo===void 0?void 0:dueChildInfo.uid)||(existingEntry===null||existingEntry===void 0?void 0:existingEntry.uid)||null;setMetaChildAttr(meta,\"due\",{value:nextStr,uid:storedUid},attrNames);_context116.n=9;return ensureInlineAttrForType(block,\"due\",nextStr,attrNames);case 9:meta.due=targetDate;void syncPillsForSurface(lastAttrSurface);case 10:return _context116.a(2);}},_callee115);}));return _updateDueDate.apply(this,arguments);}function snoozeDeferByDays(_x138,_x139,_x140){return _snoozeDeferByDays.apply(this,arguments);}function _snoozeDeferByDays(){_snoozeDeferByDays=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee116(uid,set,days){var block,meta;return _regenerator().w(function(_context117){while(1)switch(_context117.n){case 0:_context117.n=1;return getBlock(uid);case 1:block=_context117.v;if(block){_context117.n=2;break;}return _context117.a(2);case 2:_context117.n=3;return readRecurringMeta(block,set);case 3:meta=_context117.v;_context117.n=4;return shiftExistingDatesByDays(uid,set,days,{block:block,meta:meta});case 4:return _context117.a(2);}},_callee116);}));return _snoozeDeferByDays.apply(this,arguments);}function snoozeDeferToNextMonday(_x141,_x142){return _snoozeDeferToNextMonday.apply(this,arguments);}function _snoozeDeferToNextMonday(){_snoozeDeferToNextMonday=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee117(uid,set){var block,meta,anchor,cursor,i,days;return _regenerator().w(function(_context118){while(1)switch(_context118.n){case 0:_context118.n=1;return getBlock(uid);case 1:block=_context118.v;if(block){_context118.n=2;break;}return _context118.a(2);case 2:_context118.n=3;return readRecurringMeta(block,set);case 3:meta=_context118.v;anchor=pickPlacementDate({start:meta.start,defer:meta.defer,due:meta.due})||meta.due||meta.defer||meta.start||todayLocal();cursor=anchor;i=0;case 4:if(!(i<7)){_context118.n=6;break;}cursor=addDaysLocal(cursor,1);if(!(cursor.getDay()===1)){_context118.n=5;break;}return _context118.a(3,6);case 5:i++;_context118.n=4;break;case 6:days=diffDaysLocal(cursor,anchor);_context118.n=7;return shiftExistingDatesByDays(uid,set,days,{block:block,meta:meta});case 7:return _context118.a(2);}},_callee117);}));return _snoozeDeferToNextMonday.apply(this,arguments);}function snoozePickDeferDate(_x143,_x144){return _snoozePickDeferDate.apply(this,arguments);}function _snoozePickDeferDate(){_snoozePickDeferDate=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee118(uid,set){var block,meta,initial,nextIso,parsed,anchor,days;return _regenerator().w(function(_context119){while(1)switch(_context119.n){case 0:_context119.n=1;return getBlock(uid);case 1:block=_context119.v;if(block){_context119.n=2;break;}return _context119.a(2);case 2:_context119.n=3;return readRecurringMeta(block,set);case 3:meta=_context119.v;initial=meta.defer?formatIsoDate(meta.defer,set):\"\";_context119.n=4;return promptForDate({title:\"Snooze until\",message:\"Select the date to resume this task\",initial:initial});case 4:nextIso=_context119.v;if(nextIso){_context119.n=5;break;}return _context119.a(2);case 5:parsed=parseRoamDate(nextIso);if(!(!(parsed instanceof Date)||Number.isNaN(parsed.getTime()))){_context119.n=6;break;}toast(\"Couldn't parse that date.\");return _context119.a(2);case 6:anchor=pickPlacementDate({start:meta.start,defer:meta.defer,due:meta.due})||meta.due||meta.defer||meta.start||null;if(anchor){_context119.n=8;break;}_context119.n=7;return updateDeferDate(uid,set,parsed,{block:block,meta:meta});case 7:return _context119.a(2);case 8:days=diffDaysLocal(parsed,anchor);_context119.n=9;return shiftExistingDatesByDays(uid,set,days,{block:block,meta:meta});case 9:return _context119.a(2);}},_callee118);}));return _snoozePickDeferDate.apply(this,arguments);}function skipOccurrence(_x145,_x146){return _skipOccurrence.apply(this,arguments);}function _skipOccurrence(){_skipOccurrence=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee119(uid,set){var block,meta,contextSnapshot,nextDue,startOffsetMs,deferOffsetMs,nextStartDate,nextDeferDate,nextStr,nextStartStr,nextDeferStr,attrNames,dueChildInfo,existingEntry,storedUid,startChildInfo,deferChildInfo,skipAnchor,relocation,dueChanged;return _regenerator().w(function(_context120){while(1)switch(_context120.n){case 0:_context120.n=1;return getBlock(uid);case 1:block=_context120.v;if(block){_context120.n=2;break;}return _context120.a(2);case 2:_context120.n=3;return readRecurringMeta(block,set);case 3:meta=_context120.v;contextSnapshot=prepareDueChangeContext(block,meta,set);if(meta.repeat){_context120.n=4;break;}toast(\"No repeat rule to skip.\");return _context120.a(2);case 4:nextDue=computeNextDue(meta,set);if(nextDue){_context120.n=5;break;}toast(\"Could not compute the next occurrence.\");return _context120.a(2);case 5:startOffsetMs=meta.start instanceof Date&&meta.due instanceof Date?meta.start.getTime()-meta.due.getTime():null;deferOffsetMs=meta.defer instanceof Date&&meta.due instanceof Date?meta.defer.getTime()-meta.due.getTime():null;nextStartDate=startOffsetMs!=null?applyOffsetToDate(nextDue,startOffsetMs):null;nextDeferDate=deferOffsetMs!=null?applyOffsetToDate(nextDue,deferOffsetMs):null;nextStr=formatDate(nextDue,set);nextStartStr=nextStartDate?formatDate(nextStartDate,set):null;nextDeferStr=nextDeferDate?formatDate(nextDeferDate,set):null;_context120.n=6;return updateBlockProps(uid,{due:nextStr,start:nextStartStr||undefined,defer:nextDeferStr||undefined});case 6:attrNames=set.attrNames;_context120.n=7;return ensureChildAttrForType(uid,\"due\",nextStr,attrNames);case 7:dueChildInfo=_context120.v;meta.childAttrMap=meta.childAttrMap||{};existingEntry=getMetaChildAttr(meta,\"due\",attrNames,{allowFallback:false});storedUid=(dueChildInfo===null||dueChildInfo===void 0?void 0:dueChildInfo.uid)||(existingEntry===null||existingEntry===void 0?void 0:existingEntry.uid)||null;setMetaChildAttr(meta,\"due\",{value:nextStr,uid:storedUid},attrNames);if(!nextStartStr){_context120.n=9;break;}_context120.n=8;return ensureChildAttrForType(uid,\"start\",nextStartStr,attrNames);case 8:startChildInfo=_context120.v;setMetaChildAttr(meta,\"start\",{value:nextStartStr,uid:startChildInfo.uid},attrNames);_context120.n=11;break;case 9:_context120.n=10;return removeChildAttrsForType(uid,\"start\",attrNames);case 10:clearMetaChildAttr(meta,\"start\",attrNames);case 11:if(!nextDeferStr){_context120.n=13;break;}_context120.n=12;return ensureChildAttrForType(uid,\"defer\",nextDeferStr,attrNames);case 12:deferChildInfo=_context120.v;setMetaChildAttr(meta,\"defer\",{value:nextDeferStr,uid:deferChildInfo.uid},attrNames);_context120.n=15;break;case 13:_context120.n=14;return removeChildAttrsForType(uid,\"defer\",attrNames);case 14:clearMetaChildAttr(meta,\"defer\",attrNames);case 15:_context120.n=16;return ensureInlineAttrForType(block,\"due\",nextStr,attrNames);case 16:if(!nextStartStr){_context120.n=17;break;}_context120.n=17;return ensureInlineAttrForType(block,\"start\",nextStartStr,attrNames);case 17:if(!nextDeferStr){_context120.n=18;break;}_context120.n=18;return ensureInlineAttrForType(block,\"defer\",nextDeferStr,attrNames);case 18:meta.due=nextDue;meta.start=nextStartDate;meta.defer=nextDeferDate;mergeRepeatOverride(uid,{due:nextDue});skipAnchor=pickPlacementDate({start:nextStartDate,defer:nextDeferDate,due:nextDue})||nextDue;_context120.n=19;return relocateBlockForPlacement(block,{start:nextStartDate,defer:nextDeferDate,due:nextDue},set);case 19:relocation=_context120.v;dueChanged=(contextSnapshot.previousDueDate?contextSnapshot.previousDueDate.getTime():null)!==nextDue.getTime();if(dueChanged||relocation.moved){registerDueUndoAction({blockUid:uid,message:\"Skipped to \".concat(formatRoamDateTitle(skipAnchor)),setSnapshot:_objectSpread({},set),previousDueDate:contextSnapshot.previousDueDate?new Date(contextSnapshot.previousDueDate.getTime()):null,previousDueStr:contextSnapshot.previousDueStr||null,previousInlineDue:contextSnapshot.previousInlineDue,hadInlineDue:contextSnapshot.hadInlineDue,previousInlineRepeat:contextSnapshot.previousInlineRepeat,hadInlineRepeat:contextSnapshot.hadInlineRepeat,previousChildDue:contextSnapshot.previousChildDue,previousChildDueUid:contextSnapshot.previousChildDueUid||null,hadChildDue:contextSnapshot.hadChildDue,previousChildRepeat:contextSnapshot.previousChildRepeat,previousChildRepeatUid:contextSnapshot.previousChildRepeatUid||null,previousParentUid:contextSnapshot.previousParentUid,previousOrder:contextSnapshot.previousOrder,newDue:new Date(nextDue.getTime()),newDueStr:nextStr,newParentUid:relocation.targetUid,wasMoved:relocation.moved,snapshot:contextSnapshot.snapshot});}void syncPillsForSurface(lastAttrSurface);case 20:return _context120.a(2);}},_callee119);}));return _skipOccurrence.apply(this,arguments);}function generateNextNow(_x147,_x148){return _generateNextNow.apply(this,arguments);}function _generateNextNow(){_generateNextNow=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee120(uid,set){var block,meta,nextDue,newUid,nextStart,nextDefer,anchor;return _regenerator().w(function(_context121){while(1)switch(_context121.n){case 0:_context121.n=1;return getBlock(uid);case 1:block=_context121.v;if(block){_context121.n=2;break;}return _context121.a(2);case 2:_context121.n=3;return readRecurringMeta(block,set);case 3:meta=_context121.v;if(meta.repeat){_context121.n=4;break;}toast(\"No repeat rule found.\");return _context121.a(2);case 4:nextDue=computeNextDue(meta,set);if(nextDue){_context121.n=5;break;}toast(\"Could not compute the next occurrence.\");return _context121.a(2);case 5:_context121.n=6;return spawnNextOccurrence(block,meta,nextDue,set);case 6:newUid=_context121.v;nextStart=meta.start instanceof Date&&meta.due instanceof Date?applyOffsetToDate(nextDue,meta.start.getTime()-meta.due.getTime()):null;nextDefer=meta.defer instanceof Date&&meta.due instanceof Date?applyOffsetToDate(nextDue,meta.defer.getTime()-meta.due.getTime()):null;anchor=pickPlacementDate({start:nextStart,defer:nextDefer,due:nextDue})||nextDue;if(!bulkOperationInProgress){toast(\"Next occurrence created (\".concat(formatRoamDateTitle(anchor),\")\"));}void syncPillsForSurface(lastAttrSurface);return _context121.a(2,newUid);}},_callee120);}));return _generateNextNow.apply(this,arguments);}function endRecurrence(_x149,_x150){return _endRecurrence.apply(this,arguments);}// possible future feature: view series history\n/* \n    async function openSeriesHistory(uid, set) {\n      const history = await fetchSeriesHistory(uid);\n      if (!history.length) {\n        toast(\"No series history available.\");\n        return;\n      }\n      const html = history\n        .map((item) => {\n          const pageTitle = item.page?.title || item.page?.[\"node/title\"] || \"Unknown page\";\n          const snippet = (item.string || \"\").replace(/\\n+/g, \" \").slice(0, 120);\n          const props = parseProps(item.props);\n          const due = props.due || \"\";\n          return `<button data-uid=\"${item.uid}\">${escapeHtml(snippet)}<br/><small>${escapeHtml(\n            pageTitle\n          )}${due ? \" Â· Due \" + escapeHtml(due) : \"\"}</small></button>`;\n        })\n        .join(\"\");\n      const menuId = `rt-series-${uid}-${Date.now()}`;\n      iziToast.show({\n        theme: \"light\",\n        color: \"black\",\n        class: \"betterTasks\",\n        overlay: true,\n        timeout: false,\n        close: true,\n        message: `<div class=\"rt-pill-menu\" id=\"${menuId}\">${html}</div>`,\n        position: \"center\",\n        onOpening: (_instance, toastEl) => {\n          const root = toastEl.querySelector(`#${menuId}`);\n          if (!root) return;\n          root.querySelectorAll(\"button[data-uid]\").forEach((btn) => {\n            btn.addEventListener(\"click\", () => {\n              const targetUid = btn.getAttribute(\"data-uid\");\n              if (targetUid) {\n                window.roamAlphaAPI.ui.mainWindow.openBlock({ block: { uid: targetUid } });\n              }\n            });\n          });\n        },\n      });\n    }\n\n    async function fetchSeriesHistory(uid) {\n      const out = [];\n      const visited = new Set();\n      let current = uid;\n      while (current && !visited.has(current)) {\n        visited.add(current);\n        const block = await getBlock(current);\n        if (!block) break;\n        out.push(block);\n        const props = parseProps(block.props);\n        const parent = props.rt?.parent || null;\n        current = parent;\n      }\n      return out;\n    }\n    */function _endRecurrence(){_endRecurrence=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee121(uid,set){var block,meta,contextSnapshot,props,childMap,removalKeys,_i18,_removalKeys,key,info,targetUid,exists,cleaned,_t108;return _regenerator().w(function(_context122){while(1)switch(_context122.p=_context122.n){case 0:_context122.n=1;return getBlock(uid);case 1:block=_context122.v;if(block){_context122.n=2;break;}return _context122.a(2);case 2:_context122.n=3;return readRecurringMeta(block,set);case 3:meta=_context122.v;contextSnapshot=prepareDueChangeContext(block,meta,set);props=parseProps(block.props);delete props.repeat;delete props.due;if(props.rt){delete props.rt.id;delete props.rt.parent;delete props.rt.lastCompleted;delete props.rt.processed;delete props.rt.tz;}_context122.n=4;return setBlockProps(uid,props);case 4:childMap=parseAttrsFromChildBlocks(block.children||[]);removalKeys=[set.attrNames.repeatKey,set.attrNames.dueKey,\"rt-processed\"];_i18=0,_removalKeys=removalKeys;case 5:if(!(_i18<_removalKeys.length)){_context122.n=13;break;}key=_removalKeys[_i18];info=childMap[key];if(!(info!==null&&info!==void 0&&info.uid)){_context122.n=12;break;}_context122.p=6;targetUid=info.uid.trim();if(targetUid){_context122.n=7;break;}return _context122.a(3,12);case 7:_context122.n=8;return getBlock(targetUid);case 8:exists=_context122.v;if(exists){_context122.n=9;break;}return _context122.a(3,12);case 9:_context122.n=10;return deleteBlock(targetUid);case 10:_context122.n=12;break;case 11:_context122.p=11;_t108=_context122.v;console.warn(\"[RecurringTasks] failed to remove child attr\",_t108);case 12:_i18++;_context122.n=5;break;case 13:cleaned=removeInlineAttributes(block.string||\"\",_toConsumableArray(new Set([].concat(_toConsumableArray(set.attrNames.repeatRemovalKeys),_toConsumableArray(set.attrNames.dueRemovalKeys)))));if(!(cleaned!==block.string)){_context122.n=14;break;}_context122.n=14;return updateBlockString(uid,cleaned);case 14:repeatOverrides[\"delete\"](uid);registerDueUndoAction({blockUid:uid,message:\"Recurrence ended\",setSnapshot:_objectSpread({},set),previousDueDate:contextSnapshot.previousDueDate||null,previousDueStr:contextSnapshot.previousDueStr||null,previousInlineDue:contextSnapshot.previousInlineDue,hadInlineDue:contextSnapshot.hadInlineDue,previousInlineRepeat:contextSnapshot.previousInlineRepeat,hadInlineRepeat:contextSnapshot.hadInlineRepeat,previousChildDue:contextSnapshot.previousChildDue,previousChildDueUid:contextSnapshot.previousChildDueUid||null,hadChildDue:contextSnapshot.hadChildDue,previousChildRepeat:contextSnapshot.previousChildRepeat,previousChildRepeatUid:contextSnapshot.previousChildRepeatUid||null,previousParentUid:contextSnapshot.previousParentUid,previousOrder:contextSnapshot.previousOrder,newDue:null,newDueStr:null,newParentUid:contextSnapshot.previousParentUid,wasMoved:false,snapshot:contextSnapshot.snapshot});void syncPillsForSurface(lastAttrSurface);case 15:return _context122.a(2);}},_callee121,null,[[6,11]]);}));return _endRecurrence.apply(this,arguments);}function formatFriendlyDate(date,set){if(!(date instanceof Date)||Number.isNaN(date.getTime()))return\"\";try{var fmt=new Intl.DateTimeFormat(set.locale||undefined,{weekday:\"short\",day:\"numeric\",month:\"short\",timeZone:set.timezone||undefined});return fmt.format(date);}catch(_unused2){return\"\".concat(date.getFullYear(),\"-\").concat(String(date.getMonth()+1).padStart(2,\"0\"),\"-\").concat(String(date.getDate()).padStart(2,\"0\"));}}function formatIsoDate(date,set){if(!(date instanceof Date)||Number.isNaN(date.getTime()))return\"\";var tzDate=new Date(date.getTime());if(set.timezone&&(typeof Intl===\"undefined\"?\"undefined\":_typeof(Intl))===\"object\"&&Intl.DateTimeFormat){var parts=new Intl.DateTimeFormat(\"en-CA\",{timeZone:set.timezone,year:\"numeric\",month:\"2-digit\",day:\"2-digit\"}).formatToParts(tzDate);var map=Object.fromEntries(parts.map(function(p){return[p.type,p.value];}));if(map.year&&map.month&&map.day){return\"\".concat(map.year,\"-\").concat(map.month,\"-\").concat(map.day);}}return\"\".concat(tzDate.getFullYear(),\"-\").concat(String(tzDate.getMonth()+1).padStart(2,\"0\"),\"-\").concat(String(tzDate.getDate()).padStart(2,\"0\"));}function formatRoamDateTitle(date){var _window$roamAlphaAPI7;if(!(date instanceof Date)||Number.isNaN(date.getTime()))return\"\";var util=(_window$roamAlphaAPI7=window.roamAlphaAPI)===null||_window$roamAlphaAPI7===void 0?void 0:_window$roamAlphaAPI7.util;if(util!==null&&util!==void 0&&util.dateToPageTitle){try{return util.dateToPageTitle(date);}catch(err){console.warn(\"[RecurringTasks] dateToPageTitle failed, falling back to friendly\",err);}}var year=date.getFullYear();var month=new Intl.DateTimeFormat(\"en-US\",{month:\"long\"}).format(date);return\"\".concat(month,\" \").concat(ordinalSuffix(date.getDate()),\", \").concat(year);}function ordinalSuffix(n){var rem10=n%10;var rem100=n%100;if(rem10===1&&rem100!==11)return\"\".concat(n,\"st\");if(rem10===2&&rem100!==12)return\"\".concat(n,\"nd\");if(rem10===3&&rem100!==13)return\"\".concat(n,\"rd\");return\"\".concat(n,\"th\");}function isTaskInCodeBlock(block){var text=((block===null||block===void 0?void 0:block.string)||\"\").trim();if(!text)return false;if(text.startsWith(\"```\")||text.startsWith(\"{{[[code]]}}\")||text.startsWith(\"<code\")){return true;}return false;}function insertPillWrap(main,check,pillWrap){var _main$querySelector,_main$querySelector2,_main$querySelector3,_main$querySelector4;var inputContainer=(_main$querySelector=main.querySelector)===null||_main$querySelector===void 0?void 0:_main$querySelector.call(main,\".rm-block__input\");var inlineText=inputContainer&&inputContainer.tagName!==\"TEXTAREA\"?inputContainer.firstElementChild:null;var autocompleteWrapper=(_main$querySelector2=main.querySelector)===null||_main$querySelector2===void 0?void 0:_main$querySelector2.call(main,\".rm-autocomplete__wrapper\");var blockSelf=(_main$querySelector3=main.querySelector)===null||_main$querySelector3===void 0?void 0:_main$querySelector3.call(main,\".rm-block__self\");var blockText=(_main$querySelector4=main.querySelector)===null||_main$querySelector4===void 0?void 0:_main$querySelector4.call(main,\".rm-block-text\");if(inlineText&&inlineText.nodeType===1){inlineText.appendChild(pillWrap);pillWrap.classList.add(\"rt-pill-inline\");return;}if(inputContainer&&inputContainer.tagName!==\"TEXTAREA\"&&!pillWrap.isConnected){inputContainer.appendChild(pillWrap);pillWrap.classList.add(\"rt-pill-inline\");return;}if(blockText&&!pillWrap.isConnected){blockText.appendChild(pillWrap);pillWrap.classList.add(\"rt-pill-inline\");return;}if(blockSelf!==null&&blockSelf!==void 0&&blockSelf.parentNode&&!pillWrap.isConnected){blockSelf.parentNode.insertBefore(pillWrap,blockSelf.nextSibling);return;}if(autocompleteWrapper!==null&&autocompleteWrapper!==void 0&&autocompleteWrapper.parentNode&&!pillWrap.isConnected){autocompleteWrapper.parentNode.insertBefore(pillWrap,autocompleteWrapper.nextSibling);return;}if(check!==null&&check!==void 0&&check.parentNode&&!pillWrap.isConnected){check.parentNode.appendChild(pillWrap);return;}if(!pillWrap.isConnected){main.appendChild(pillWrap);}}// ========================= Child -> Props sync core =========================\nfunction handleAnyEdit(_x151){return _handleAnyEdit2.apply(this,arguments);}function _handleAnyEdit2(){_handleAnyEdit2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee122(evt){var set,uid,child,line,m,key,attrNames,attrType,parentUid,srcType;return _regenerator().w(function(_context123){while(1)switch(_context123.n){case 0:set=S();uid=findBlockUidFromElement(evt.target);if(uid){_context123.n=1;break;}return _context123.a(2);case 1:_context123.n=2;return getBlock(uid);case 2:child=_context123.v;line=((child===null||child===void 0?void 0:child.string)||\"\").trim();m=line.match(ATTR_RE);if(m){_context123.n=3;break;}return _context123.a(2);case 3:key=m[1].trim().toLowerCase();attrNames=set.attrNames;attrType=null;if(key===attrNames.repeatKey)attrType=\"repeat\";else if(key===attrNames.dueKey)attrType=\"due\";if(attrType){_context123.n=4;break;}return _context123.a(2);case 4:_context123.n=5;return getParentUid(uid);case 5:parentUid=_context123.v;if(parentUid){_context123.n=6;break;}return _context123.a(2);case 6:// Debounce per parent to avoid thrashing while typing, remember source event\nif(childEditDebounce.has(parentUid))clearTimeout(childEditDebounce.get(parentUid));srcType=evt.type;childEditDebounce.set(parentUid,setTimeout(function(){childEditDebounce[\"delete\"](parentUid);void syncChildAttrToParent(parentUid,attrType,{sourceEvent:srcType,suppressToast:true});},srcType===\"blur\"?0:250));case 7:return _context123.a(2);}},_callee122);}));return _handleAnyEdit2.apply(this,arguments);}function getParentUid(_x152){return _getParentUid.apply(this,arguments);}function _getParentUid(){_getParentUid=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee123(childUid){var _res$2;var safeChildUid,res;return _regenerator().w(function(_context124){while(1)switch(_context124.n){case 0:safeChildUid=escapeDatalogString(childUid);_context124.n=1;return window.roamAlphaAPI.q(\"\\n        [:find ?puid\\n         :where\\n         [?c :block/uid \\\"\".concat(safeChildUid,\"\\\"]\\n         [?c :block/parents ?p]\\n         [?p :block/uid ?puid]]\"));case 1:res=_context124.v;return _context124.a(2,(res===null||res===void 0||(_res$2=res[0])===null||_res$2===void 0?void 0:_res$2[0])||null);}},_callee123);}));return _getParentUid.apply(this,arguments);}function syncChildAttrToParent(_x153,_x154){return _syncChildAttrToParent.apply(this,arguments);}function _syncChildAttrToParent(){_syncChildAttrToParent=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee124(parentUid,attrType){var opts,sourceEvent,suppressToast,set,parent,attrNames,attrKey,childMap,attrLabel,info,rawValue,props,normalized,_props,_props2,_args125=arguments,_t109,_t110;return _regenerator().w(function(_context125){while(1)switch(_context125.p=_context125.n){case 0:opts=_args125.length>2&&_args125[2]!==undefined?_args125[2]:{};sourceEvent=(opts===null||opts===void 0?void 0:opts.sourceEvent)||\"input\";suppressToast=!!(opts!==null&&opts!==void 0&&opts.suppressToast);set=S();_context125.n=1;return getBlock(parentUid);case 1:parent=_context125.v;if(parent){_context125.n=2;break;}return _context125.a(2);case 2:attrNames=set.attrNames;attrKey=getAttrKey(attrType,attrNames);if(!deletingChildAttrs.has(\"\".concat(parentUid,\"::\").concat(attrKey))){_context125.n=3;break;}return _context125.a(2);case 3:// read current child values\nchildMap=parseAttrsFromChildBlocks(parent.children||[]);attrLabel=getAttrLabel(attrType,attrNames).toLowerCase();info=childMap[attrLabel]||null;rawValue=((info===null||info===void 0?void 0:info.value)||\"\").trim();// If empty, only remove after a blur (don't spam while user is typing).\nif(rawValue){_context125.n=7;break;}if(!(sourceEvent!==\"blur\")){_context125.n=4;break;}return _context125.a(2);case 4:props=parseProps(parent.props);if(!(props[attrType]!==undefined)){_context125.n=5;break;}delete props[attrType];_context125.n=5;return setBlockProps(parentUid,props);case 5:_context125.n=6;return ensureInlineAttrForType(parent,attrType,\"\",attrNames);case 6:// no-op unless inline exists\n// Quietly remove on blur; no toast to avoid noise.\nvoid syncPillsForSurface(lastAttrSurface);return _context125.a(2);case 7:if(!(attrType===\"repeat\")){_context125.n=15;break;}normalized=normalizeRepeatRuleText(rawValue)||rawValue;_props=parseProps(parent.props);if(!(_props.repeat!==normalized)){_context125.n=14;break;}_context125.p=8;_context125.n=9;return updateBlockProps(parentUid,{repeat:normalized});case 9:_context125.n=11;break;case 10:_context125.p=10;_t109=_context125.v;console.warn(\"[RecurringTasks] syncChildAttrToParent repeat update failed\",_t109);return _context125.a(2);case 11:_context125.n=12;return ensureChildAttrForType(parentUid,\"repeat\",normalized,attrNames);case 12:_context125.n=13;return ensureInlineAttrForType(parent,\"repeat\",normalized,attrNames);case 13:if(!suppressToast){toast(\"Repeat \\u2192 \".concat(normalized));}case 14:_context125.n=22;break;case 15:if(!(attrType===\"due\")){_context125.n=22;break;}_props2=parseProps(parent.props);if(!(_props2.due!==rawValue)){_context125.n=22;break;}_context125.p=16;_context125.n=17;return updateBlockProps(parentUid,{due:rawValue});case 17:_context125.n=19;break;case 18:_context125.p=18;_t110=_context125.v;console.warn(\"[RecurringTasks] syncChildAttrToParent due update failed\",_t110);return _context125.a(2);case 19:_context125.n=20;return ensureChildAttrForType(parentUid,\"due\",rawValue,attrNames);case 20:_context125.n=21;return ensureInlineAttrForType(parent,\"due\",rawValue,attrNames);case 21:if(!suppressToast){toast(\"Due \\u2192 \".concat(rawValue));}case 22:// Refresh pills if needed (only relevant when pills are visible)\nif(!(opts!==null&&opts!==void 0&&opts.skipRefresh)){void syncPillsForSurface(lastAttrSurface||\"Child\");}case 23:return _context125.a(2);}},_callee124,null,[[16,18],[8,10]]);}));return _syncChildAttrToParent.apply(this,arguments);}function flushChildAttrSync(_x155){return _flushChildAttrSync.apply(this,arguments);}function _flushChildAttrSync(){_flushChildAttrSync=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee125(parentUid){var options,baseOpts,_args126=arguments;return _regenerator().w(function(_context126){while(1)switch(_context126.n){case 0:options=_args126.length>1&&_args126[1]!==undefined?_args126[1]:{};if(childEditDebounce.has(parentUid)){clearTimeout(childEditDebounce.get(parentUid));childEditDebounce[\"delete\"](parentUid);}baseOpts={sourceEvent:\"flush\",skipRefresh:true,suppressToast:true};_context126.n=1;return syncChildAttrToParent(parentUid,\"repeat\",_objectSpread(_objectSpread({},baseOpts),options));case 1:_context126.n=2;return syncChildAttrToParent(parentUid,\"due\",_objectSpread(_objectSpread({},baseOpts),options));case 2:return _context126.a(2);}},_callee125);}));return _flushChildAttrSync.apply(this,arguments);}function undoTaskCompletion(_x156){return _undoTaskCompletion.apply(this,arguments);}function _undoTaskCompletion(){_undoTaskCompletion=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee126(uid){var _activeDashboardContr84,_activeDashboardContr85,block,normalized,attrNames,_t111;return _regenerator().w(function(_context127){while(1)switch(_context127.p=_context127.n){case 0:if(uid){_context127.n=1;break;}return _context127.a(2);case 1:_context127.p=1;_context127.n=2;return getBlock(uid);case 2:block=_context127.v;if(block){_context127.n=3;break;}return _context127.a(2);case 3:normalized=normalizeToTodoMacro(block.string||\"\");_context127.n=4;return updateBlockString(uid,normalized);case 4:attrNames=lastAttrNames||resolveAttributeNames();_context127.n=5;return removeChildAttrsForType(uid,\"completed\",attrNames);case 5:_context127.n=6;return updateBlockProps(uid,{rt:{processed:null,lastCompleted:null}});case 6:repeatOverrides[\"delete\"](uid);(_activeDashboardContr84=activeDashboardController)===null||_activeDashboardContr84===void 0||(_activeDashboardContr85=_activeDashboardContr84.notifyBlockChange)===null||_activeDashboardContr85===void 0||_activeDashboardContr85.call(_activeDashboardContr84,uid);_context127.n=8;break;case 7:_context127.p=7;_t111=_context127.v;console.warn(\"[RecurringTasks] undoTaskCompletion failed\",_t111);case 8:return _context127.a(2);}},_callee126,null,[[1,7]]);}));return _undoTaskCompletion.apply(this,arguments);}function createDashboardController(extensionAPI){var DASHBOARD_FULLPAGE_KEY_BASE=\"betterTasks.dashboard.fullPage\";var reviewStepSettingMap=[{viewId:\"bt_preset_next_actions\",settingId:REVIEW_STEP_NEXT_ACTIONS_SETTING},{viewId:\"bt_preset_waiting_for\",settingId:REVIEW_STEP_WAITING_FOR_SETTING},{viewId:\"bt_preset_completed_7d\",settingId:REVIEW_STEP_COMPLETED_7D_SETTING},{viewId:\"bt_preset_upcoming_7d\",settingId:REVIEW_STEP_UPCOMING_7D_SETTING},{viewId:\"bt_preset_overdue\",settingId:REVIEW_STEP_OVERDUE_SETTING},{viewId:\"bt_preset_someday\",settingId:REVIEW_STEP_SOMEDAY_SETTING}];var getDashboardFullPageKey=function getDashboardFullPageKey(){if(typeof window===\"undefined\")return DASHBOARD_FULLPAGE_KEY_BASE;var graphName=\"default\";try{var _window$roamAlphaAPI8,_window$roamAlphaAPI9;graphName=((_window$roamAlphaAPI8=window.roamAlphaAPI)===null||_window$roamAlphaAPI8===void 0||(_window$roamAlphaAPI8=_window$roamAlphaAPI8.graph)===null||_window$roamAlphaAPI8===void 0||(_window$roamAlphaAPI9=_window$roamAlphaAPI8.name)===null||_window$roamAlphaAPI9===void 0?void 0:_window$roamAlphaAPI9.call(_window$roamAlphaAPI8))||\"default\";}catch(_){// ignore\n}return\"\".concat(DASHBOARD_FULLPAGE_KEY_BASE,\".\").concat(encodeURIComponent(String(graphName)));};var readDashboardFullPageSetting=function readDashboardFullPageSetting(){if(typeof window===\"undefined\")return false;try{var _window$localStorage4;var key=getDashboardFullPageKey();var raw=(_window$localStorage4=window.localStorage)===null||_window$localStorage4===void 0?void 0:_window$localStorage4.getItem(key);// Migrate from legacy global key (if present) to per-graph key.\nif(raw==null){var _window$localStorage5;var legacy=(_window$localStorage5=window.localStorage)===null||_window$localStorage5===void 0?void 0:_window$localStorage5.getItem(DASHBOARD_FULLPAGE_KEY_BASE);if(legacy!=null){var _window$localStorage6;raw=legacy;(_window$localStorage6=window.localStorage)===null||_window$localStorage6===void 0||_window$localStorage6.setItem(key,legacy);}}var norm=typeof raw===\"string\"?raw.trim().toLowerCase():\"\";return norm===\"true\"||norm===\"1\";}catch(_){return false;}};var writeDashboardFullPageSetting=function writeDashboardFullPageSetting(enabled){if(typeof window===\"undefined\")return;try{var _window$localStorage7;(_window$localStorage7=window.localStorage)===null||_window$localStorage7===void 0||_window$localStorage7.setItem(getDashboardFullPageKey(),enabled?\"true\":\"false\");}catch(_){// ignore\n}};var getReviewStepSettings=function getReviewStepSettings(){var out={};reviewStepSettingMap.forEach(function(_ref30){var _extensionAPI$setting21,_extensionAPI$setting22;var viewId=_ref30.viewId,settingId=_ref30.settingId;var raw=extensionAPI===null||extensionAPI===void 0||(_extensionAPI$setting21=extensionAPI.settings)===null||_extensionAPI$setting21===void 0||(_extensionAPI$setting22=_extensionAPI$setting21.get)===null||_extensionAPI$setting22===void 0?void 0:_extensionAPI$setting22.call(_extensionAPI$setting21,settingId);out[viewId]=raw==null?true:normalizeBooleanSetting(raw);});return out;};var isFullPage=typeof window!==\"undefined\"?readDashboardFullPageSetting():false;var initialState={tasks:[],status:\"idle\",error:null,lastUpdated:null,isFullPage:isFullPage};var state=_objectSpread({},initialState);var subscribers=new Set();var dashViewRequestSubscribers=new Set();var dashViewsStoreSubscribers=new Set();var dashReviewRequestSubscribers=new Set();var reviewStepSettingsSubscribers=new Set();var dashReviewStartPending=false;var lastDashViewState=null;var container=null;var root=null;var refreshPromise=null;var DASHBOARD_POSITION_KEY=\"betterTasks.dashboard.position\";var savedPosition=typeof window!==\"undefined\"?loadSavedDashboardPosition():null;var dragHandle=null;var dragPointerId=null;var dragOffsetX=0;var dragOffsetY=0;var isDraggingDashboard=false;var resizeListenerAttached=false;var fullPagePrevStyleText=\"\";var fullPageHostEl=null;var fullPageObserver=null;var fullPageWindowListenerAttached=false;var fullPageRafPending=false;var lastFullPageRect=null;var didCloseLeftSidebarForMobile=false;var leftSidebarMql=null;var leftSidebarMqlListenerAttached=false;var leftSidebarMqlHandler=null;var controller={getSnapshot:function getSnapshot(){return state;},subscribe:subscribe,getTasks:function getTasks(){return state.tasks.map(function(task){return _objectSpread({},task);});},ensureInitialLoad:ensureInitialLoad,refresh:refresh,open:open,close:close,toggle:toggle,quickAdd:quickAdd,toggleTask:toggleTask,snoozeTask:snoozeTask,bulkToggleTask:bulkToggleTask,bulkSnoozeTask:bulkSnoozeTask,bulkUpdateMetadata:bulkUpdateMetadata,openBlock:openBlock,openPage:openPage,notifyBlockChange:notifyBlockChange,removeTask:removeTask,openSettings:openSettings,updateMetadata:updateMetadata,handleMetadataClick:handleMetadataClick,promptValue:promptForValue,promptProject:promptForProject,promptWaiting:promptForWaiting,promptContext:promptForContext,refreshWaitingOptions:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions,refreshContextOptions:_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions,getWaitingOptions:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.getWaitingOptions,getContextOptions:_context_store__WEBPACK_IMPORTED_MODULE_5__.getContextOptions,subscribeWaitingOptions:_waiting_store__WEBPACK_IMPORTED_MODULE_4__.subscribeToWaitingOptions,subscribeContextOptions:_context_store__WEBPACK_IMPORTED_MODULE_5__.subscribeToContextOptions,refreshProjectOptions:_project_store__WEBPACK_IMPORTED_MODULE_3__.refreshProjectOptions,getProjectOptions:_project_store__WEBPACK_IMPORTED_MODULE_3__.getProjectOptions,subscribeProjectOptions:_project_store__WEBPACK_IMPORTED_MODULE_3__.subscribeToProjectOptions,getTaskMetadata:getTaskMetadata,isOpen:function isOpen(){return!!root;},editRepeat:editRepeat,editDate:editDate,openPillMenuForTask:openPillMenuForTask,removeTaskAttribute:removeTaskAttribute,refreshLanguage:refreshLanguage,loadViewsStore:function loadViewsStore(){return (0,_dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__.loadViewsStore)(extensionAPI);},saveViewsStore:function saveViewsStore(store){return (0,_dashboard_viewsStore__WEBPACK_IMPORTED_MODULE_6__.saveViewsStore)(extensionAPI,store);},subscribeDashViewRequests:subscribeDashViewRequests,requestApplyDashViewState:requestApplyDashViewState,subscribeDashViewsStore:subscribeDashViewsStore,notifyDashViewsStoreChanged:notifyDashViewsStoreChanged,reportDashViewState:reportDashViewState,getDashViewState:getDashViewState,getReviewStepSettings:getReviewStepSettings,subscribeDashReviewRequests:subscribeDashReviewRequests,subscribeReviewStepSettings:subscribeReviewStepSettings,notifyReviewStepSettingsChanged:notifyReviewStepSettingsChanged,requestStartDashReview:requestStartDashReview,isDashboardFullPage:function isDashboardFullPage(){return!!isFullPage;},setDashboardFullPage:setDashboardFullPage,toggleDashboardFullPage:function toggleDashboardFullPage(){return setDashboardFullPage(!isFullPage);},dispose:dispose};// Ensure prompt helpers are always present for dashboard consumers.\nif(!controller.promptProject)controller.promptProject=function(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return promptForAttribute(\"project\",_objectSpread(_objectSpread({},opts),{},{allowMulti:false}));};if(!controller.promptWaiting)controller.promptWaiting=function(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return promptForAttribute(\"waitingFor\",_objectSpread(_objectSpread({},opts),{},{allowMulti:false}));};if(!controller.promptContext)controller.promptContext=function(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return promptForAttribute(\"context\",_objectSpread(_objectSpread({},opts),{},{allowMulti:true}));};function emit(){var snapshot=_objectSpread(_objectSpread({},state),{},{tasks:state.tasks.map(function(task){return _objectSpread({},task);})});subscribers.forEach(function(callback){try{callback(snapshot);}catch(err){console.warn(\"[BetterTasks] dashboard subscriber failed\",err);}});}function subscribe(listener){if(typeof listener===\"function\"){subscribers.add(listener);listener(_objectSpread(_objectSpread({},state),{},{tasks:state.tasks.map(function(task){return _objectSpread({},task);})}));}return function(){return subscribers[\"delete\"](listener);};}function subscribeDashViewRequests(listener){if(typeof listener===\"function\")dashViewRequestSubscribers.add(listener);return function(){return dashViewRequestSubscribers[\"delete\"](listener);};}function requestApplyDashViewState(nextState){dashViewRequestSubscribers.forEach(function(listener){try{listener(nextState||null);}catch(err){console.warn(\"[BetterTasks] dashboard view request subscriber failed\",err);}});}function subscribeDashViewsStore(listener){if(typeof listener===\"function\")dashViewsStoreSubscribers.add(listener);return function(){return dashViewsStoreSubscribers[\"delete\"](listener);};}function notifyDashViewsStoreChanged(){var nextStore=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;dashViewsStoreSubscribers.forEach(function(listener){try{listener(nextStore);}catch(err){console.warn(\"[BetterTasks] dashboard views store subscriber failed\",err);}});}function reportDashViewState(next){if(!next||_typeof(next)!==\"object\")return;lastDashViewState=clonePlain(next);}function getDashViewState(){return lastDashViewState?clonePlain(lastDashViewState):null;}function subscribeDashReviewRequests(listener){if(typeof listener===\"function\"){dashReviewRequestSubscribers.add(listener);if(dashReviewStartPending){dashReviewStartPending=false;try{listener({type:\"start\"});}catch(err){console.warn(\"[BetterTasks] dashboard review request subscriber failed\",err);}}}return function(){return dashReviewRequestSubscribers[\"delete\"](listener);};}function subscribeReviewStepSettings(listener){if(typeof listener===\"function\")reviewStepSettingsSubscribers.add(listener);return function(){return reviewStepSettingsSubscribers[\"delete\"](listener);};}function notifyReviewStepSettingsChanged(){reviewStepSettingsSubscribers.forEach(function(listener){try{listener();}catch(err){console.warn(\"[BetterTasks] review step settings subscriber failed\",err);}});}function requestStartDashReview(){dashReviewStartPending=true;dashReviewRequestSubscribers.forEach(function(listener){try{listener({type:\"start\"});}catch(err){console.warn(\"[BetterTasks] dashboard review request subscriber failed\",err);}});}function getTaskMetadata(uid){if(!uid)return null;var task=state.tasks.find(function(entry){return entry.uid===uid;});return(task===null||task===void 0?void 0:task.metadata)||null;}function ensureInitialLoad(){if(state.status===\"idle\"&&!refreshPromise){void refresh({reason:\"initial\"});}}function refresh(){return _refresh.apply(this,arguments);}function _refresh(){_refresh=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee17(){var _ref34,_ref34$reason,reason,attachWatches,cacheKey,bypassCache,_args17=arguments;return _regenerator().w(function(_context17){while(1)switch(_context17.n){case 0:_ref34=_args17.length>0&&_args17[0]!==undefined?_args17[0]:{},_ref34$reason=_ref34.reason,reason=_ref34$reason===void 0?\"manual\":_ref34$reason;if(!refreshPromise){_context17.n=1;break;}return _context17.a(2,refreshPromise);case 1:state=_objectSpread(_objectSpread({},state),{},{status:state.tasks.length?\"refreshing\":\"loading\",error:null});emit();attachWatches=controller.isOpen();cacheKey=\"dash:withDone\";bypassCache=reason===\"force\";refreshPromise=collectDashboardTasks({attachWatches:attachWatches,cacheKey:cacheKey,bypassCache:bypassCache}).then(function(tasks){state=_objectSpread(_objectSpread({},state),{},{tasks:tasks,status:\"ready\",error:null,lastUpdated:Date.now(),lastReason:reason});emit();})[\"catch\"](function(err){console.error(\"[BetterTasks] dashboard refresh failed\",err);state=_objectSpread(_objectSpread({},state),{},{status:\"error\",error:err});emit();})[\"finally\"](function(){refreshPromise=null;});return _context17.a(2,refreshPromise);}},_callee17);}));return _refresh.apply(this,arguments);}function quickAdd(_x157){return _quickAdd.apply(this,arguments);}function _quickAdd(){_quickAdd=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee18(inputText){var rawInput,trimmed,aiSettings,aiEnabled,parsedTask,_aiResult,_aiResult2,aiAbort,suppressAiAbort,pending,aiResult,_aiResult3,_aiResult4,created,promptResult,createdManual,_t11;return _regenerator().w(function(_context18){while(1)switch(_context18.p=_context18.n){case 0:rawInput=typeof inputText===\"string\"?inputText:\"\";trimmed=rawInput.trim();if(trimmed){_context18.n=1;break;}toast(\"Enter some task text.\");return _context18.a(2);case 1:aiSettings=getAiSettings();aiEnabled=isAiEnabled(aiSettings);parsedTask=null;if(!aiEnabled){_context18.n=8;break;}aiAbort=typeof AbortController!==\"undefined\"?new AbortController():null;suppressAiAbort=false;pending=showPersistentToast(\"Parsing task with AI\\u2026\",{onClosed:function onClosed(){if(suppressAiAbort)return;aiAbort===null||aiAbort===void 0||aiAbort.abort();}});aiResult=null;_context18.p=2;_context18.n=3;return parseTaskWithOpenAI(trimmed,aiSettings,{signal:aiAbort===null||aiAbort===void 0?void 0:aiAbort.signal});case 3:aiResult=_context18.v;_context18.n=5;break;case 4:_context18.p=4;_t11=_context18.v;console.warn(\"[BetterTasks] AI parsing threw in quickAdd\",_t11);aiResult={ok:false,error:_t11};case 5:_context18.p=5;suppressAiAbort=true;hideToastInstance(pending);return _context18.f(5);case 6:if(!(((_aiResult=aiResult)===null||_aiResult===void 0?void 0:_aiResult.reason)===\"aborted\")){_context18.n=7;break;}return _context18.a(2);case 7:if((_aiResult2=aiResult)!==null&&_aiResult2!==void 0&&_aiResult2.ok){parsedTask=aiResult.task;}else{console.warn(\"[BetterTasks] AI parsing unavailable in quickAdd\",((_aiResult3=aiResult)===null||_aiResult3===void 0?void 0:_aiResult3.error)||((_aiResult4=aiResult)===null||_aiResult4===void 0?void 0:_aiResult4.reason));toast(\"AI parsing unavailable, falling back to manual entry.\");}case 8:if(!parsedTask){_context18.n=12;break;}_context18.n=9;return createQuickTaskFromParsed(parsedTask,trimmed);case 9:created=_context18.v;if(!created){_context18.n=11;break;}_context18.n=10;return refresh({reason:\"quick-add\"});case 10:return _context18.a(2);case 11:toast(\"Couldn't create task from AI result; try manual.\");case 12:_context18.n=13;return promptForRepeatAndDue({includeTaskText:true,forceTaskInput:true,taskText:trimmed});case 13:promptResult=_context18.v;if(promptResult){_context18.n=14;break;}return _context18.a(2);case 14:_context18.n=15;return createQuickTaskFromPrompt(promptResult);case 15:createdManual=_context18.v;if(!createdManual){_context18.n=17;break;}_context18.n=16;return refresh({reason:\"quick-add\"});case 16:_context18.n=18;break;case 17:toast(\"Couldn't create task from input.\");case 18:return _context18.a(2);}},_callee18,null,[[2,4,5,6]]);}));return _quickAdd.apply(this,arguments);}function ensureContainer(){if(container&&root)return;container=document.createElement(\"div\");container.className=\"bt-dashboard-host\";document.body.appendChild(container);root=createRootCompat(container);if(!resizeListenerAttached&&typeof window!==\"undefined\"){window.addEventListener(\"resize\",handleWindowResize);resizeListenerAttached=true;}}function scheduleApplyFullPageRect(){if(fullPageRafPending)return;fullPageRafPending=true;requestAnimationFrame(function(){fullPageRafPending=false;applyFullPageRect();});}function attachFullPageObserver(host){if(fullPageObserver){try{fullPageObserver.disconnect();}catch(_){// ignore\n}fullPageObserver=null;}if(!host||typeof ResizeObserver===\"undefined\")return;fullPageObserver=new ResizeObserver(function(){return scheduleApplyFullPageRect();});try{fullPageObserver.observe(host);}catch(_){// ignore\n}}function applyFullPageRect(){if(!isFullPage||!container||typeof document===\"undefined\")return;var host=document.querySelector(\".roam-body-main\");if(!host)return;if(host!==fullPageHostEl){fullPageHostEl=host;attachFullPageObserver(host);}var rect=host.getBoundingClientRect();var next={top:Math.round(rect.top),left:Math.round(rect.left),width:Math.round(rect.width),height:Math.round(rect.height)};if(lastFullPageRect&&lastFullPageRect.top===next.top&&lastFullPageRect.left===next.left&&lastFullPageRect.width===next.width&&lastFullPageRect.height===next.height){return;}lastFullPageRect=next;container.style.position=\"fixed\";container.style.top=\"\".concat(next.top,\"px\");container.style.left=\"\".concat(next.left,\"px\");container.style.width=\"\".concat(next.width,\"px\");container.style.height=\"\".concat(next.height,\"px\");container.style.right=\"auto\";container.style.bottom=\"auto\";}function enableFullPage(){if(!container||!root||isDraggingDashboard){cleanupDragListeners();}if(!container)return;if(container.classList.contains(\"bt-dashboard-host--fullpage\"))return;fullPagePrevStyleText=container.getAttribute(\"style\")||\"\";container.classList.add(\"bt-dashboard-host--fullpage\");registerDragHandle(dragHandle);fullPageHostEl=null;lastFullPageRect=null;scheduleApplyFullPageRect();if(!fullPageWindowListenerAttached&&typeof window!==\"undefined\"){window.addEventListener(\"resize\",scheduleApplyFullPageRect);fullPageWindowListenerAttached=true;}}function disableFullPage(){var _ref31=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref31$restore=_ref31.restore,restore=_ref31$restore===void 0?true:_ref31$restore;if(fullPageObserver){try{fullPageObserver.disconnect();}catch(_){// ignore\n}fullPageObserver=null;}if(fullPageWindowListenerAttached&&typeof window!==\"undefined\"){window.removeEventListener(\"resize\",scheduleApplyFullPageRect);fullPageWindowListenerAttached=false;}fullPageHostEl=null;lastFullPageRect=null;if(!container)return;container.classList.remove(\"bt-dashboard-host--fullpage\");if(restore){if(fullPagePrevStyleText){container.setAttribute(\"style\",fullPagePrevStyleText);}else{container.removeAttribute(\"style\");}}fullPagePrevStyleText=\"\";registerDragHandle(dragHandle);if(savedPosition){requestAnimationFrame(function(){return applySavedPosition();});}}function setDashboardFullPage(enabled){var next=!!enabled;if(next===isFullPage)return;isFullPage=next;writeDashboardFullPageSetting(next);state=_objectSpread(_objectSpread({},state),{},{isFullPage:next});emit();if(!root||!container)return;if(next){enableFullPage();}else{disableFullPage({restore:true});}}function setTopbarActive(active){if(typeof document===\"undefined\")return;var button=document.getElementById(DASHBOARD_TOPBAR_BUTTON_ID);if(!button)return;if(active)button.classList.add(\"bt-dashboard-button--active\");else button.classList.remove(\"bt-dashboard-button--active\");}function isMobileDashboardLayout(){var _window$roamAlphaAPI0;if(typeof window===\"undefined\")return false;if((_window$roamAlphaAPI0=window.roamAlphaAPI)!==null&&_window$roamAlphaAPI0!==void 0&&(_window$roamAlphaAPI0=_window$roamAlphaAPI0.platform)!==null&&_window$roamAlphaAPI0!==void 0&&_window$roamAlphaAPI0.isMobileApp)return true;if(typeof window.innerWidth===\"number\"){if(window.innerWidth<=639)return true;}if(typeof window.matchMedia===\"function\"){return window.matchMedia(\"(max-width: 639px)\").matches;}return false;}function isLeftSidebarOpen(){if(typeof document===\"undefined\")return false;if(document.querySelector(\".bp3-button.bp3-minimal.bp3-icon-menu-closed\"))return true;try{var _sidebar$getBoundingC;var sidebar=document.querySelector(\".roam-sidebar-content\")||document.querySelector(\".rm-left-sidebar\")||document.querySelector(\".rm-left-sidebar__inner\");if(!sidebar)return false;var rect=(_sidebar$getBoundingC=sidebar.getBoundingClientRect)===null||_sidebar$getBoundingC===void 0?void 0:_sidebar$getBoundingC.call(sidebar);return!!(rect&&rect.width>40);}catch(_){return false;}}function closeLeftSidebarIfNeeded(){if(!isMobileDashboardLayout())return;if(!isLeftSidebarOpen())return;didCloseLeftSidebarForMobile=true;try{var _window$roamAlphaAPI1,_window$roamAlphaAPI10;(_window$roamAlphaAPI1=window.roamAlphaAPI)===null||_window$roamAlphaAPI1===void 0||(_window$roamAlphaAPI1=_window$roamAlphaAPI1.ui)===null||_window$roamAlphaAPI1===void 0||(_window$roamAlphaAPI1=_window$roamAlphaAPI1.leftSidebar)===null||_window$roamAlphaAPI1===void 0||(_window$roamAlphaAPI10=_window$roamAlphaAPI1.close)===null||_window$roamAlphaAPI10===void 0||_window$roamAlphaAPI10.call(_window$roamAlphaAPI1);}catch(_){// ignore\n}}function restoreLeftSidebarIfNeeded(){if(!didCloseLeftSidebarForMobile)return;didCloseLeftSidebarForMobile=false;try{var _window$roamAlphaAPI11,_window$roamAlphaAPI12;(_window$roamAlphaAPI11=window.roamAlphaAPI)===null||_window$roamAlphaAPI11===void 0||(_window$roamAlphaAPI11=_window$roamAlphaAPI11.ui)===null||_window$roamAlphaAPI11===void 0||(_window$roamAlphaAPI11=_window$roamAlphaAPI11.leftSidebar)===null||_window$roamAlphaAPI11===void 0||(_window$roamAlphaAPI12=_window$roamAlphaAPI11.open)===null||_window$roamAlphaAPI12===void 0||_window$roamAlphaAPI12.call(_window$roamAlphaAPI11);}catch(_){// ignore\n}}function attachLeftSidebarMqlWatcher(){if(leftSidebarMqlListenerAttached||typeof window===\"undefined\")return;if(typeof window.matchMedia!==\"function\")return;leftSidebarMql=window.matchMedia(\"(max-width: 639px)\");leftSidebarMqlHandler=function leftSidebarMqlHandler(){var _leftSidebarMql;if(!root)return;if((_leftSidebarMql=leftSidebarMql)!==null&&_leftSidebarMql!==void 0&&_leftSidebarMql.matches){closeLeftSidebarIfNeeded();}};if(typeof leftSidebarMql.addEventListener===\"function\"){leftSidebarMql.addEventListener(\"change\",leftSidebarMqlHandler);}else if(typeof leftSidebarMql.addListener===\"function\"){leftSidebarMql.addListener(leftSidebarMqlHandler);}leftSidebarMqlListenerAttached=true;}function detachLeftSidebarMqlWatcher(){if(!leftSidebarMqlListenerAttached||!leftSidebarMql)return;if(typeof leftSidebarMql.removeEventListener===\"function\"){leftSidebarMql.removeEventListener(\"change\",leftSidebarMqlHandler);}else if(typeof leftSidebarMql.removeListener===\"function\"){leftSidebarMql.removeListener(leftSidebarMqlHandler);}leftSidebarMqlListenerAttached=false;leftSidebarMql=null;leftSidebarMqlHandler=null;}function open(){if(dashboardWatchClearTimer){clearTimeout(dashboardWatchClearTimer);dashboardWatchClearTimer=null;}ensureContainer();closeLeftSidebarIfNeeded();attachLeftSidebarMqlWatcher();root.render(/*#__PURE__*/React.createElement(DashboardRoot,{controller:controller,onRequestClose:close,onHeaderReady:registerDragHandle,language:getLanguageSetting()}));ensureInitialLoad();setTopbarActive(true);if(isFullPage){requestAnimationFrame(function(){return enableFullPage();});}else if(savedPosition){requestAnimationFrame(function(){return applySavedPosition();});}}function refreshLanguage(){if(!root)return;ensureContainer();root.render(/*#__PURE__*/React.createElement(DashboardRoot,{controller:controller,onRequestClose:close,onHeaderReady:registerDragHandle,language:getLanguageSetting()}));}function close(){cleanupDragListeners();registerDragHandle(null);if(isFullPage){disableFullPage({restore:false});}setTopbarActive(false);restoreLeftSidebarIfNeeded();detachLeftSidebarMqlWatcher();if(dashboardWatchClearTimer){clearTimeout(dashboardWatchClearTimer);dashboardWatchClearTimer=null;}clearDashboardWatches();if(root){root.unmount();root=null;}if(container){container.remove();container=null;}if(resizeListenerAttached&&typeof window!==\"undefined\"){window.removeEventListener(\"resize\",handleWindowResize);resizeListenerAttached=false;}}function toggle(){if(root){close();}else{open();}}function toggleTask(_x158,_x159){return _toggleTask.apply(this,arguments);}function _toggleTask(){_toggleTask=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee19(uid,action){var _t12;return _regenerator().w(function(_context19){while(1)switch(_context19.p=_context19.n){case 0:if(uid){_context19.n=1;break;}return _context19.a(2);case 1:_context19.p=1;if(!(action===\"complete\")){_context19.n=3;break;}_context19.n=2;return setTaskTodoState(uid,\"DONE\");case 2:_context19.n=5;break;case 3:_context19.n=4;return setTaskTodoState(uid,\"TODO\");case 4:_context19.n=5;return undoTaskCompletion(uid);case 5:_context19.n=7;break;case 6:_context19.p=6;_t12=_context19.v;console.error(\"[BetterTasks] toggleTask failed\",_t12);toast(\"Unable to update task.\");case 7:_context19.n=8;return refresh({reason:\"toggle\"});case 8:// If the user is on the DNP, keep the Today widget in sync with dashboard completions.\nrequestTodayWidgetRenderOnDnp(120,true);case 9:return _context19.a(2);}},_callee19,null,[[1,6]]);}));return _toggleTask.apply(this,arguments);}function updateMetadata(_x160,_x161){return _updateMetadata.apply(this,arguments);}function _updateMetadata(){_updateMetadata=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee20(uid,patch){var set,attrNames,ctxArr,_window$__btInlineMet4,_activeDashboardContr52,notifier,_t13,_t14;return _regenerator().w(function(_context20){while(1)switch(_context20.p=_context20.n){case 0:if(!(!uid||!patch)){_context20.n=1;break;}return _context20.a(2);case 1:set=S();attrNames=set.attrNames;_context20.p=2;if(!(\"project\"in patch)){_context20.n=4;break;}_context20.n=3;return setRichAttribute(uid,\"project\",patch.project,attrNames);case 3:if(patch.project)(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption)(patch.project);case 4:if(!(\"waitingFor\"in patch)){_context20.n=6;break;}_context20.n=5;return setRichAttribute(uid,\"waitingFor\",patch.waitingFor,attrNames);case 5:if(patch.waitingFor){(0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.addWaitingOption)(patch.waitingFor);}else{void (0,_waiting_store__WEBPACK_IMPORTED_MODULE_4__.refreshWaitingOptions)(true);}case 6:if(!(\"context\"in patch)){_context20.n=10;break;}ctxArr=Array.isArray(patch.context)?patch.context:[];_context20.n=7;return setRichAttribute(uid,\"context\",ctxArr,attrNames);case 7:if(!ctxArr.length){_context20.n=8;break;}ctxArr.forEach(function(ctx){return (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.addContextOption)(ctx);});_context20.n=10;break;case 8:_context20.n=9;return removeChildAttrsForType(uid,\"context\",attrNames);case 9:void (0,_context_store__WEBPACK_IMPORTED_MODULE_5__.refreshContextOptions)(true);case 10:if(!(\"priority\"in patch)){_context20.n=11;break;}_context20.n=11;return setRichAttribute(uid,\"priority\",patch.priority,attrNames);case 11:if(!(\"energy\"in patch)){_context20.n=12;break;}_context20.n=12;return setRichAttribute(uid,\"energy\",patch.energy,attrNames);case 12:if(!(\"gtd\"in patch)){_context20.n=13;break;}_context20.n=13;return setRichAttribute(uid,\"gtd\",patch.gtd,attrNames);case 13:_context20.n=15;break;case 14:_context20.p=14;_t13=_context20.v;console.warn(\"[BetterTasks] updateMetadata failed\",_t13);toast(\"Could not update metadata.\");case 15:if(typeof window!==\"undefined\"){(_window$__btInlineMet4=window.__btInlineMetaCache)===null||_window$__btInlineMet4===void 0||_window$__btInlineMet4[\"delete\"](uid);}_context20.p=16;notifier=((_activeDashboardContr52=activeDashboardController)===null||_activeDashboardContr52===void 0?void 0:_activeDashboardContr52.notifyBlockChange)||notifyBlockChange;if(!(typeof notifier===\"function\")){_context20.n=17;break;}_context20.n=17;return notifier(uid,{bypassFilters:true});case 17:_context20.n=19;break;case 18:_context20.p=18;_t14=_context20.v;console.warn(\"[BetterTasks] notifyBlockChange (inline meta) failed\",_t14);case 19:void syncPillsForSurface(lastAttrSurface);case 20:return _context20.a(2);}},_callee20,null,[[16,18],[2,14]]);}));return _updateMetadata.apply(this,arguments);}function snoozeTask(_x162,_x163){return _snoozeTask.apply(this,arguments);}// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Bulk Operations\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nfunction _snoozeTask(){_snoozeTask=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee21(uid,preset){var _activeDashboardContr53,_activeDashboardContr54,set,_t15;return _regenerator().w(function(_context21){while(1)switch(_context21.p=_context21.n){case 0:if(uid){_context21.n=1;break;}return _context21.a(2);case 1:_context21.p=1;set=S();if(!(preset===\"pick\")){_context21.n=3;break;}_context21.n=2;return snoozePickDeferDate(uid,set);case 2:_context21.n=6;break;case 3:if(!(typeof preset===\"number\")){_context21.n=5;break;}_context21.n=4;return snoozeDeferByDays(uid,set,preset);case 4:_context21.n=6;break;case 5:_context21.n=6;return snoozeDeferByDays(uid,set,1);case 6:(_activeDashboardContr53=activeDashboardController)===null||_activeDashboardContr53===void 0||(_activeDashboardContr54=_activeDashboardContr53.notifyBlockChange)===null||_activeDashboardContr54===void 0||_activeDashboardContr54.call(_activeDashboardContr53,uid);_context21.n=8;break;case 7:_context21.p=7;_t15=_context21.v;console.error(\"[BetterTasks] snoozeTask failed\",_t15);toast(\"Could not snooze task.\");case 8:_context21.n=9;return refresh({reason:\"snooze\"});case 9:requestTodayWidgetRenderOnDnp(120,true);case 10:return _context21.a(2);}},_callee21,null,[[1,7]]);}));return _snoozeTask.apply(this,arguments);}function readTaskMetadataFromBlock(_x164,_x165){return _readTaskMetadataFromBlock.apply(this,arguments);}function _readTaskMetadataFromBlock(){_readTaskMetadataFromBlock=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee22(uid,set){var block,children,childAttrMap,attrNames,startChild,startText,startOriginalKey,deferChild,deferText,deferOriginalKey,dueChild,dueText,dueOriginalKey,richMeta;return _regenerator().w(function(_context22){while(1)switch(_context22.n){case 0:_context22.n=1;return getBlock(uid);case 1:block=_context22.v;if(block){_context22.n=2;break;}return _context22.a(2,null);case 2:children=block.children||[];childAttrMap=parseAttrsFromChildBlocks(children);attrNames=set.attrNames;// Read start date (capture both value and original key for case preservation)\nstartChild=pickChildAttr(childAttrMap,attrNames.startAliases,{allowFallback:false});startText=(startChild===null||startChild===void 0?void 0:startChild.value)||null;startOriginalKey=(startChild===null||startChild===void 0?void 0:startChild.originalKey)||null;// Read defer date (capture both value and original key for case preservation)\ndeferChild=pickChildAttr(childAttrMap,attrNames.deferAliases,{allowFallback:false});deferText=(deferChild===null||deferChild===void 0?void 0:deferChild.value)||null;deferOriginalKey=(deferChild===null||deferChild===void 0?void 0:deferChild.originalKey)||null;// Read due date (capture both value and original key for case preservation)\ndueChild=pickChildAttr(childAttrMap,attrNames.dueAliases,{allowFallback:false});dueText=(dueChild===null||dueChild===void 0?void 0:dueChild.value)||null;dueOriginalKey=(dueChild===null||dueChild===void 0?void 0:dueChild.originalKey)||null;// Read rich metadata\nrichMeta=parseRichMetadata(childAttrMap,attrNames);return _context22.a(2,{startText:startText,startOriginalKey:startOriginalKey,deferText:deferText,deferOriginalKey:deferOriginalKey,dueText:dueText,dueOriginalKey:dueOriginalKey,project:richMeta.project,waitingFor:richMeta.waitingFor,context:richMeta.context,priority:richMeta.priority,energy:richMeta.energy,gtd:richMeta.gtd});}},_callee22);}));return _readTaskMetadataFromBlock.apply(this,arguments);}function bulkToggleTask(_x166,_x167){return _bulkToggleTask.apply(this,arguments);}function _bulkToggleTask(){_bulkToggleTask=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee24(uids,action){var previousStates,_iterator16,_step16,uid,block,wasCompleted,errors,_iterator17,_step17,_uid4,successCount,lang,bulkStrings,msg,_t17,_t18,_t19,_t20;return _regenerator().w(function(_context24){while(1)switch(_context24.p=_context24.n){case 0:if(!(!Array.isArray(uids)||!uids.length)){_context24.n=1;break;}return _context24.a(2);case 1:// Clear any prior cooldown to prevent race with consecutive bulk ops\nif(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}bulkOperationInProgress=true;_context24.p=2;previousStates=[];// Capture previous states for undo\n_iterator16=_createForOfIteratorHelper(uids);_context24.p=3;_iterator16.s();case 4:if((_step16=_iterator16.n()).done){_context24.n=9;break;}uid=_step16.value;_context24.p=5;_context24.n=6;return getBlock(uid);case 6:block=_context24.v;wasCompleted=isBlockCompleted(block);previousStates.push({uid:uid,wasCompleted:wasCompleted});_context24.n=8;break;case 7:_context24.p=7;_t17=_context24.v;previousStates.push({uid:uid,wasCompleted:false});case 8:_context24.n=4;break;case 9:_context24.n=11;break;case 10:_context24.p=10;_t18=_context24.v;_iterator16.e(_t18);case 11:_context24.p=11;_iterator16.f();return _context24.f(11);case 12:// Apply action\nerrors=[];_iterator17=_createForOfIteratorHelper(uids);_context24.p=13;_iterator17.s();case 14:if((_step17=_iterator17.n()).done){_context24.n=22;break;}_uid4=_step17.value;_context24.p=15;if(!(action===\"complete\")){_context24.n=17;break;}_context24.n=16;return setTaskTodoState(_uid4,\"DONE\");case 16:_context24.n=19;break;case 17:_context24.n=18;return setTaskTodoState(_uid4,\"TODO\");case 18:_context24.n=19;return undoTaskCompletion(_uid4);case 19:_context24.n=21;break;case 20:_context24.p=20;_t19=_context24.v;errors.push({uid:_uid4,err:_t19});case 21:_context24.n=14;break;case 22:_context24.n=24;break;case 23:_context24.p=23;_t20=_context24.v;_iterator17.e(_t20);case 24:_context24.p=24;_iterator17.f();return _context24.f(24);case 25:// Show undo toast\nsuccessCount=uids.length-errors.length;lang=getLanguageSetting();bulkStrings=t([\"dashboard\",\"bulk\"],lang)||{};msg=action===\"complete\"?typeof bulkStrings.completedCount===\"function\"?bulkStrings.completedCount(successCount):\"Completed \".concat(successCount,\" task\").concat(successCount===1?\"\":\"s\"):typeof bulkStrings.reopenedCount===\"function\"?bulkStrings.reopenedCount(successCount):\"Reopened \".concat(successCount,\" task\").concat(successCount===1?\"\":\"s\");showBulkUndoToast({message:msg,undo:function(){var _undo=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee23(){var _i6,_previousStates,_previousStates$_i,uid,wasCompleted,_t16;return _regenerator().w(function(_context23){while(1)switch(_context23.p=_context23.n){case 0:// Clear any prior cooldown to prevent race\nif(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}bulkOperationInProgress=true;_context23.p=1;_i6=0,_previousStates=previousStates;case 2:if(!(_i6<_previousStates.length)){_context23.n=10;break;}_previousStates$_i=_previousStates[_i6],uid=_previousStates$_i.uid,wasCompleted=_previousStates$_i.wasCompleted;_context23.p=3;if(!wasCompleted){_context23.n=5;break;}_context23.n=4;return setTaskTodoState(uid,\"DONE\");case 4:_context23.n=7;break;case 5:_context23.n=6;return setTaskTodoState(uid,\"TODO\");case 6:_context23.n=7;return undoTaskCompletion(uid);case 7:_context23.n=9;break;case 8:_context23.p=8;_t16=_context23.v;console.warn(\"[BetterTasks] bulk undo item failed\",uid,_t16);case 9:_i6++;_context23.n=2;break;case 10:_context23.n=11;return refresh({reason:\"force\"});case 11:requestTodayWidgetRenderOnDnp(120,true);case 12:_context23.p=12;// Keep suppression active briefly to catch async pull watch callbacks\nif(bulkOperationCooldownTimer)clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=setTimeout(function(){bulkOperationInProgress=false;bulkOperationCooldownTimer=null;},BULK_OPERATION_COOLDOWN_MS);return _context23.f(12);case 13:return _context23.a(2);}},_callee23,null,[[3,8],[1,,12,13]]);}));function undo(){return _undo.apply(this,arguments);}return undo;}()});_context24.n=26;return refresh({reason:\"force\"});case 26:requestTodayWidgetRenderOnDnp(120,true);case 27:_context24.p=27;// Keep toast suppression active briefly to catch async completion handlers\nif(bulkOperationCooldownTimer)clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=setTimeout(function(){bulkOperationInProgress=false;bulkOperationCooldownTimer=null;},BULK_OPERATION_COOLDOWN_MS);return _context24.f(27);case 28:return _context24.a(2);}},_callee24,null,[[15,20],[13,23,24,25],[5,7],[3,10,11,12],[2,,27,28]]);}));return _bulkToggleTask.apply(this,arguments);}function bulkSnoozeTask(_x168,_x169){return _bulkSnoozeTask.apply(this,arguments);}function _bulkSnoozeTask(){_bulkSnoozeTask=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee26(uids,days){var set,attrNames,previousStates,_iterator18,_step18,uid,meta,errors,_iterator19,_step19,_uid5,successCount,lang,bulkStrings,msg,_t22,_t23,_t24,_t25;return _regenerator().w(function(_context26){while(1)switch(_context26.p=_context26.n){case 0:if(!(!Array.isArray(uids)||!uids.length)){_context26.n=1;break;}return _context26.a(2);case 1:if(!(typeof days!==\"number\")){_context26.n=2;break;}return _context26.a(2);case 2:// Clear any prior cooldown to prevent race with consecutive bulk ops\nif(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}bulkOperationInProgress=true;_context26.p=3;set=S();attrNames=set.attrNames;previousStates=[];// Capture previous start/defer/due dates for undo (snooze can shift all existing dates)\n// Also capture original keys to preserve case (e.g., BT_attrDefer vs bt_attrdefer)\n_iterator18=_createForOfIteratorHelper(uids);_context26.p=4;_iterator18.s();case 5:if((_step18=_iterator18.n()).done){_context26.n=10;break;}uid=_step18.value;_context26.p=6;_context26.n=7;return readTaskMetadataFromBlock(uid,set);case 7:meta=_context26.v;previousStates.push({uid:uid,previousStart:(meta===null||meta===void 0?void 0:meta.startText)||null,startKey:(meta===null||meta===void 0?void 0:meta.startOriginalKey)||attrNames.startKey,previousDefer:(meta===null||meta===void 0?void 0:meta.deferText)||null,deferKey:(meta===null||meta===void 0?void 0:meta.deferOriginalKey)||attrNames.deferKey,previousDue:(meta===null||meta===void 0?void 0:meta.dueText)||null,dueKey:(meta===null||meta===void 0?void 0:meta.dueOriginalKey)||attrNames.dueKey});_context26.n=9;break;case 8:_context26.p=8;_t22=_context26.v;previousStates.push({uid:uid,previousStart:null,startKey:attrNames.startKey,previousDefer:null,deferKey:attrNames.deferKey,previousDue:null,dueKey:attrNames.dueKey});case 9:_context26.n=5;break;case 10:_context26.n=12;break;case 11:_context26.p=11;_t23=_context26.v;_iterator18.e(_t23);case 12:_context26.p=12;_iterator18.f();return _context26.f(12);case 13:// Apply snooze\nerrors=[];_iterator19=_createForOfIteratorHelper(uids);_context26.p=14;_iterator19.s();case 15:if((_step19=_iterator19.n()).done){_context26.n=20;break;}_uid5=_step19.value;_context26.p=16;_context26.n=17;return snoozeDeferByDays(_uid5,set,days);case 17:_context26.n=19;break;case 18:_context26.p=18;_t24=_context26.v;errors.push({uid:_uid5,err:_t24});case 19:_context26.n=15;break;case 20:_context26.n=22;break;case 21:_context26.p=21;_t25=_context26.v;_iterator19.e(_t25);case 22:_context26.p=22;_iterator19.f();return _context26.f(22);case 23:// Show undo toast\nsuccessCount=uids.length-errors.length;lang=getLanguageSetting();bulkStrings=t([\"dashboard\",\"bulk\"],lang)||{};msg=typeof bulkStrings.snoozedCount===\"function\"?bulkStrings.snoozedCount(successCount,days):\"Snoozed \".concat(successCount,\" task\").concat(successCount===1?\"\":\"s\",\" by \").concat(days,\" day\").concat(days===1?\"\":\"s\");showBulkUndoToast({message:msg,undo:function(){var _undo2=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee25(){var _i7,_previousStates2,_previousStates2$_i,uid,previousStart,startKey,previousDefer,deferKey,previousDue,dueKey,_t21;return _regenerator().w(function(_context25){while(1)switch(_context25.p=_context25.n){case 0:// Clear any prior cooldown to prevent race\nif(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}bulkOperationInProgress=true;_context25.p=1;_i7=0,_previousStates2=previousStates;case 2:if(!(_i7<_previousStates2.length)){_context25.n=13;break;}_previousStates2$_i=_previousStates2[_i7],uid=_previousStates2$_i.uid,previousStart=_previousStates2$_i.previousStart,startKey=_previousStates2$_i.startKey,previousDefer=_previousStates2$_i.previousDefer,deferKey=_previousStates2$_i.deferKey,previousDue=_previousStates2$_i.previousDue,dueKey=_previousStates2$_i.dueKey;_context25.p=3;if(!previousStart){_context25.n=5;break;}_context25.n=4;return ensureChildAttr(uid,startKey,previousStart);case 4:_context25.n=6;break;case 5:_context25.n=6;return removeChildAttrsForType(uid,\"start\",attrNames);case 6:if(!previousDefer){_context25.n=8;break;}_context25.n=7;return ensureChildAttr(uid,deferKey,previousDefer);case 7:_context25.n=9;break;case 8:_context25.n=9;return removeChildAttrsForType(uid,\"defer\",attrNames);case 9:if(!previousDue){_context25.n=10;break;}_context25.n=10;return ensureChildAttr(uid,dueKey,previousDue);case 10:_context25.n=12;break;case 11:_context25.p=11;_t21=_context25.v;console.warn(\"[BetterTasks] bulk snooze undo item failed\",uid,_t21);case 12:_i7++;_context25.n=2;break;case 13:_context25.n=14;return refresh({reason:\"force\"});case 14:requestTodayWidgetRenderOnDnp(120,true);case 15:_context25.p=15;// Keep suppression active briefly to catch async pull watch callbacks\nif(bulkOperationCooldownTimer)clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=setTimeout(function(){bulkOperationInProgress=false;bulkOperationCooldownTimer=null;},BULK_OPERATION_COOLDOWN_MS);return _context25.f(15);case 16:return _context25.a(2);}},_callee25,null,[[3,11],[1,,15,16]]);}));function undo(){return _undo2.apply(this,arguments);}return undo;}()});_context26.n=24;return refresh({reason:\"force\"});case 24:requestTodayWidgetRenderOnDnp(120,true);case 25:_context26.p=25;// Keep toast suppression active briefly to catch async handlers\nif(bulkOperationCooldownTimer)clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=setTimeout(function(){bulkOperationInProgress=false;bulkOperationCooldownTimer=null;},BULK_OPERATION_COOLDOWN_MS);return _context26.f(25);case 26:return _context26.a(2);}},_callee26,null,[[16,18],[14,21,22,23],[6,8],[4,11,12,13],[3,,25,26]]);}));return _bulkSnoozeTask.apply(this,arguments);}function bulkUpdateMetadata(_x170,_x171){return _bulkUpdateMetadata.apply(this,arguments);}function _bulkUpdateMetadata(){_bulkUpdateMetadata=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee28(uids,patch){var _bulkStrings$fieldLab,set,attrNames,field,previousStates,_iterator20,_step20,uid,meta,errors,_iterator21,_step21,_uid6,ctxArr,successCount,lang,bulkStrings,fieldLabel,msg,_t27,_t28,_t29,_t30;return _regenerator().w(function(_context28){while(1)switch(_context28.p=_context28.n){case 0:if(!(!Array.isArray(uids)||!uids.length||!patch)){_context28.n=1;break;}return _context28.a(2);case 1:// Clear any prior cooldown to prevent race with consecutive bulk ops\nif(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}bulkOperationInProgress=true;_context28.p=2;set=S();attrNames=set.attrNames;field=Object.keys(patch)[0];if(field){_context28.n=3;break;}return _context28.a(2);case 3:previousStates=[];// Capture previous values for undo\n_iterator20=_createForOfIteratorHelper(uids);_context28.p=4;_iterator20.s();case 5:if((_step20=_iterator20.n()).done){_context28.n=10;break;}uid=_step20.value;_context28.p=6;_context28.n=7;return readTaskMetadataFromBlock(uid,set);case 7:meta=_context28.v;previousStates.push({uid:uid,previousValue:(meta===null||meta===void 0?void 0:meta[field])||null});_context28.n=9;break;case 8:_context28.p=8;_t27=_context28.v;previousStates.push({uid:uid,previousValue:null});case 9:_context28.n=5;break;case 10:_context28.n=12;break;case 11:_context28.p=11;_t28=_context28.v;_iterator20.e(_t28);case 12:_context28.p=12;_iterator20.f();return _context28.f(12);case 13:// Apply patch\nerrors=[];_iterator21=_createForOfIteratorHelper(uids);_context28.p=14;_iterator21.s();case 15:if((_step21=_iterator21.n()).done){_context28.n=30;break;}_uid6=_step21.value;_context28.p=16;if(!(field===\"project\")){_context28.n=18;break;}_context28.n=17;return setRichAttribute(_uid6,\"project\",patch.project,attrNames);case 17:_context28.n=27;break;case 18:if(!(field===\"waitingFor\")){_context28.n=20;break;}_context28.n=19;return setRichAttribute(_uid6,\"waitingFor\",patch.waitingFor,attrNames);case 19:_context28.n=27;break;case 20:if(!(field===\"context\")){_context28.n=22;break;}ctxArr=Array.isArray(patch.context)?patch.context:[];_context28.n=21;return setRichAttribute(_uid6,\"context\",ctxArr,attrNames);case 21:_context28.n=27;break;case 22:if(!(field===\"priority\")){_context28.n=24;break;}_context28.n=23;return setRichAttribute(_uid6,\"priority\",patch.priority,attrNames);case 23:_context28.n=27;break;case 24:if(!(field===\"energy\")){_context28.n=26;break;}_context28.n=25;return setRichAttribute(_uid6,\"energy\",patch.energy,attrNames);case 25:_context28.n=27;break;case 26:if(!(field===\"gtd\")){_context28.n=27;break;}_context28.n=27;return setRichAttribute(_uid6,\"gtd\",patch.gtd,attrNames);case 27:_context28.n=29;break;case 28:_context28.p=28;_t29=_context28.v;errors.push({uid:_uid6,err:_t29});case 29:_context28.n=15;break;case 30:_context28.n=32;break;case 31:_context28.p=31;_t30=_context28.v;_iterator21.e(_t30);case 32:_context28.p=32;_iterator21.f();return _context28.f(32);case 33:// Show undo toast\nsuccessCount=uids.length-errors.length;lang=getLanguageSetting();bulkStrings=t([\"dashboard\",\"bulk\"],lang)||{};fieldLabel=((_bulkStrings$fieldLab=bulkStrings.fieldLabels)===null||_bulkStrings$fieldLab===void 0?void 0:_bulkStrings$fieldLab[field])||field;msg=typeof bulkStrings.updatedCount===\"function\"?bulkStrings.updatedCount(fieldLabel,successCount):\"Updated \".concat(fieldLabel,\" on \").concat(successCount,\" task\").concat(successCount===1?\"\":\"s\");showBulkUndoToast({message:msg,undo:function(){var _undo3=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee27(){var _i8,_previousStates3,_previousStates3$_i,uid,previousValue,ctxArr,_t26;return _regenerator().w(function(_context27){while(1)switch(_context27.p=_context27.n){case 0:// Clear any prior cooldown to prevent race\nif(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}bulkOperationInProgress=true;_context27.p=1;_i8=0,_previousStates3=previousStates;case 2:if(!(_i8<_previousStates3.length)){_context27.n=17;break;}_previousStates3$_i=_previousStates3[_i8],uid=_previousStates3$_i.uid,previousValue=_previousStates3$_i.previousValue;_context27.p=3;if(!(field===\"project\")){_context27.n=5;break;}_context27.n=4;return setRichAttribute(uid,\"project\",previousValue,attrNames);case 4:_context27.n=14;break;case 5:if(!(field===\"waitingFor\")){_context27.n=7;break;}_context27.n=6;return setRichAttribute(uid,\"waitingFor\",previousValue,attrNames);case 6:_context27.n=14;break;case 7:if(!(field===\"context\")){_context27.n=9;break;}ctxArr=Array.isArray(previousValue)?previousValue:[];_context27.n=8;return setRichAttribute(uid,\"context\",ctxArr,attrNames);case 8:_context27.n=14;break;case 9:if(!(field===\"priority\")){_context27.n=11;break;}_context27.n=10;return setRichAttribute(uid,\"priority\",previousValue,attrNames);case 10:_context27.n=14;break;case 11:if(!(field===\"energy\")){_context27.n=13;break;}_context27.n=12;return setRichAttribute(uid,\"energy\",previousValue,attrNames);case 12:_context27.n=14;break;case 13:if(!(field===\"gtd\")){_context27.n=14;break;}_context27.n=14;return setRichAttribute(uid,\"gtd\",previousValue,attrNames);case 14:_context27.n=16;break;case 15:_context27.p=15;_t26=_context27.v;console.warn(\"[BetterTasks] bulk metadata undo item failed\",uid,_t26);case 16:_i8++;_context27.n=2;break;case 17:_context27.n=18;return refresh({reason:\"force\"});case 18:requestTodayWidgetRenderOnDnp(120,true);case 19:_context27.p=19;// Keep suppression active briefly to catch async pull watch callbacks\nif(bulkOperationCooldownTimer)clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=setTimeout(function(){bulkOperationInProgress=false;bulkOperationCooldownTimer=null;},BULK_OPERATION_COOLDOWN_MS);return _context27.f(19);case 20:return _context27.a(2);}},_callee27,null,[[3,15],[1,,19,20]]);}));function undo(){return _undo3.apply(this,arguments);}return undo;}()});_context28.n=34;return refresh({reason:\"force\"});case 34:requestTodayWidgetRenderOnDnp(120,true);case 35:_context28.p=35;// Keep toast suppression active briefly to catch async handlers\nif(bulkOperationCooldownTimer)clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=setTimeout(function(){bulkOperationInProgress=false;bulkOperationCooldownTimer=null;},BULK_OPERATION_COOLDOWN_MS);return _context28.f(35);case 36:return _context28.a(2);}},_callee28,null,[[16,28],[14,31,32,33],[6,8],[4,11,12,13],[2,,35,36]]);}));return _bulkUpdateMetadata.apply(this,arguments);}function showBulkUndoToast(_ref32){var message=_ref32.message,undo=_ref32.undo;var lang=getLanguageSetting();var bulkStrings=t([\"dashboard\",\"bulk\"],lang)||{};izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",\"class\":\"betterTasks bt-toast-undo\",position:\"center\",message:message,timeout:6000,close:true,closeOnEscape:true,closeOnClick:false,buttons:[[\"<button>\".concat(escapeHtml(bulkStrings.undo||\"Undo\"),\"</button>\"),(/*#__PURE__*/function(){var _ref33=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee16(instance,toastEl){var _t10;return _regenerator().w(function(_context16){while(1)switch(_context16.p=_context16.n){case 0:instance.hide({transitionOut:\"fadeOut\"},toastEl,\"button\");_context16.p=1;_context16.n=2;return undo();case 2:izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",\"class\":\"betterTasks bt-toast-info\",message:bulkStrings.undoSuccess||\"Changes undone\",position:\"center\",timeout:2000,close:false,closeOnEscape:true,closeOnClick:true,onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);}});_context16.n=4;break;case 3:_context16.p=3;_t10=_context16.v;console.error(\"[BetterTasks] bulk undo failed\",_t10);izitoast__WEBPACK_IMPORTED_MODULE_0___default().show({theme:\"light\",color:\"black\",\"class\":\"betterTasks bt-toast-info\",message:bulkStrings.undoFailed||\"Undo failed\",position:\"center\",timeout:3000,close:false,closeOnEscape:true,closeOnClick:true,onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);}});case 4:return _context16.a(2);}},_callee16,null,[[1,3]]);}));return function(_x172,_x173){return _ref33.apply(this,arguments);};}()),true]],onOpening:function onOpening(_instance,toastEl){applyToastA11y(toastEl);}});}function removeTask(uid){if(!uid)return;removeDashboardWatch(uid);var tasks=state.tasks.filter(function(task){return task.uid!==uid;});if(tasks.length===state.tasks.length)return;state=_objectSpread(_objectSpread({},state),{},{tasks:tasks});emit();}function openBlock(uid){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!uid)return;if(options.skipCompletionToast){processedMap.set(uid,Date.now());setTimeout(function(){return processedMap[\"delete\"](uid);},2000);}try{var _window$roamAlphaAPI13,_window$roamAlphaAPI14;(_window$roamAlphaAPI13=window.roamAlphaAPI)===null||_window$roamAlphaAPI13===void 0||(_window$roamAlphaAPI13=_window$roamAlphaAPI13.ui)===null||_window$roamAlphaAPI13===void 0||(_window$roamAlphaAPI13=_window$roamAlphaAPI13.mainWindow)===null||_window$roamAlphaAPI13===void 0||(_window$roamAlphaAPI14=_window$roamAlphaAPI13.openBlock)===null||_window$roamAlphaAPI14===void 0||_window$roamAlphaAPI14.call(_window$roamAlphaAPI13,{block:{uid:uid}});}catch(err){console.warn(\"[BetterTasks] openBlock failed\",err);}}function openPage(pageUid){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!pageUid)return;var _options$inSidebar=options.inSidebar,inSidebar=_options$inSidebar===void 0?false:_options$inSidebar;try{if(inSidebar){var _window$roamAlphaAPI15,_window$roamAlphaAPI16;(_window$roamAlphaAPI15=window.roamAlphaAPI)===null||_window$roamAlphaAPI15===void 0||(_window$roamAlphaAPI15=_window$roamAlphaAPI15.ui)===null||_window$roamAlphaAPI15===void 0||(_window$roamAlphaAPI15=_window$roamAlphaAPI15.rightSidebar)===null||_window$roamAlphaAPI15===void 0||(_window$roamAlphaAPI16=_window$roamAlphaAPI15.addWindow)===null||_window$roamAlphaAPI16===void 0||_window$roamAlphaAPI16.call(_window$roamAlphaAPI15,{window:{type:\"outline\",\"page-uid\":pageUid,\"block-uid\":pageUid}});}else{var _window$roamAlphaAPI17,_window$roamAlphaAPI18;(_window$roamAlphaAPI17=window.roamAlphaAPI)===null||_window$roamAlphaAPI17===void 0||(_window$roamAlphaAPI17=_window$roamAlphaAPI17.ui)===null||_window$roamAlphaAPI17===void 0||(_window$roamAlphaAPI17=_window$roamAlphaAPI17.mainWindow)===null||_window$roamAlphaAPI17===void 0||(_window$roamAlphaAPI18=_window$roamAlphaAPI17.openPage)===null||_window$roamAlphaAPI18===void 0||_window$roamAlphaAPI18.call(_window$roamAlphaAPI17,{page:{uid:pageUid}});}}catch(err){console.warn(\"[BetterTasks] openPage failed\",err);}}function openSettings(){try{var _extensionAPI$setting23;if(extensionAPI!==null&&extensionAPI!==void 0&&(_extensionAPI$setting23=extensionAPI.settings)!==null&&_extensionAPI$setting23!==void 0&&_extensionAPI$setting23.open){extensionAPI.settings.open();}else{toast(\"Open the Roam Depot settings for Better Tasks to adjust options.\");}}catch(err){console.warn(\"[BetterTasks] openSettings failed\",err);}}function notifyBlockChange(_x174){return _notifyBlockChange.apply(this,arguments);}function _notifyBlockChange(){_notifyBlockChange=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee29(uid){var options,set,block,meta,_window$__btInlineMet5,task,tasks,index,dashOpen,_activeDashboardContr55,_activeDashboardContr56,_args29=arguments,_t31;return _regenerator().w(function(_context29){while(1)switch(_context29.p=_context29.n){case 0:options=_args29.length>1&&_args29[1]!==undefined?_args29[1]:{};if(uid){_context29.n=1;break;}return _context29.a(2);case 1:if(!bulkOperationInProgress){_context29.n=2;break;}return _context29.a(2);case 2:_context29.p=2;set=S();_context29.n=3;return getBlock(uid);case 3:block=_context29.v;if(block){_context29.n=4;break;}removeTask(uid);return _context29.a(2);case 4:if(isTaskBlock(block)){_context29.n=5;break;}return _context29.a(2);case 5:_context29.n=6;return readRecurringMeta(block,set);case 6:meta=_context29.v;if(isBetterTasksTask(meta)){_context29.n=7;break;}removeTask(uid);if(typeof window!==\"undefined\"){(_window$__btInlineMet5=window.__btInlineMetaCache)===null||_window$__btInlineMet5===void 0||_window$__btInlineMet5[\"delete\"](uid);}repeatOverrides[\"delete\"](uid);scheduleSurfaceSync(lastAttrSurface||\"Child\");return _context29.a(2);case 7:task=deriveDashboardTask(block,meta,set);if(task){_context29.n=8;break;}return _context29.a(2);case 8:tasks=state.tasks.slice();index=tasks.findIndex(function(entry){return entry.uid===uid;});if(index>=0){tasks[index]=task;}else{tasks.push(task);}state=_objectSpread(_objectSpread({},state),{},{tasks:sortDashboardTasksList(tasks)});emit();if(controller.isOpen()){ensureDashboardWatch(uid);}else{removeDashboardWatch(uid);}scheduleTodayBadgeRefresh(60,true);// When the dashboard is open, many edits can happen in quick succession.\n// Debounce Today widget refreshes to avoid tripping the circuit breaker.\ndashOpen=false;try{dashOpen=!!((_activeDashboardContr55=activeDashboardController)!==null&&_activeDashboardContr55!==void 0&&(_activeDashboardContr56=_activeDashboardContr55.isOpen)!==null&&_activeDashboardContr56!==void 0&&_activeDashboardContr56.call(_activeDashboardContr55));}catch(_){dashOpen=false;}requestTodayWidgetRenderOnDnp(dashOpen?900:160,false);_context29.n=10;break;case 9:_context29.p=9;_t31=_context29.v;console.warn(\"[BetterTasks] notifyBlockChange failed\",_t31);case 10:return _context29.a(2);}},_callee29,null,[[2,9]]);}));return _notifyBlockChange.apply(this,arguments);}function dispose(){subscribers.clear();close();state=_objectSpread({},initialState);}function registerDragHandle(node){if(dragHandle){dragHandle.removeEventListener(\"pointerdown\",handlePointerDown);dragHandle.classList.remove(\"bt-dashboard__header--dragging\");dragHandle.classList.remove(\"bt-dashboard__header--draggable\");}dragHandle=node;if(dragHandle&&!isFullPage){dragHandle.classList.add(\"bt-dashboard__header--draggable\");dragHandle.addEventListener(\"pointerdown\",handlePointerDown);}}function handlePointerDown(event){var _event$target5,_event$target5$closes;if(isFullPage)return;if(!container||!dragHandle)return;if(event.button!==undefined&&event.button!==0)return;var blocker=(_event$target5=event.target)===null||_event$target5===void 0||(_event$target5$closes=_event$target5.closest)===null||_event$target5$closes===void 0?void 0:_event$target5$closes.call(_event$target5,\"button, a, input, textarea, select\");if(blocker)return;isDraggingDashboard=true;dragPointerId=event.pointerId;var rect=container.getBoundingClientRect();dragOffsetX=event.clientX-rect.left;dragOffsetY=event.clientY-rect.top;container.classList.add(\"bt-dashboard-host--dragging\");dragHandle.classList.add(\"bt-dashboard__header--dragging\");if(dragHandle.setPointerCapture&&dragPointerId!=null){try{dragHandle.setPointerCapture(dragPointerId);}catch(_){// best effort only\n}}if(typeof window!==\"undefined\"){window.addEventListener(\"pointermove\",handlePointerMove);window.addEventListener(\"pointerup\",handlePointerUp);}event.preventDefault();}function handlePointerMove(event){if(!isDraggingDashboard||event.pointerId!==dragPointerId)return;if(!container)return;var desired={left:event.clientX-dragOffsetX,top:event.clientY-dragOffsetY};var clamped=clampPosition(desired);if(!clamped)return;setContainerPosition(clamped);}function handlePointerUp(event){var _dragHandle,_container,_dragHandle2;if(!isDraggingDashboard||event.pointerId!==dragPointerId)return;if((_dragHandle=dragHandle)!==null&&_dragHandle!==void 0&&_dragHandle.releasePointerCapture&&dragPointerId!=null){try{dragHandle.releasePointerCapture(dragPointerId);}catch(_){// ignore release failures\n}}isDraggingDashboard=false;dragPointerId=null;(_container=container)===null||_container===void 0||(_container=_container.classList)===null||_container===void 0||_container.remove(\"bt-dashboard-host--dragging\");(_dragHandle2=dragHandle)===null||_dragHandle2===void 0||(_dragHandle2=_dragHandle2.classList)===null||_dragHandle2===void 0||_dragHandle2.remove(\"bt-dashboard__header--dragging\");if(typeof window!==\"undefined\"){window.removeEventListener(\"pointermove\",handlePointerMove);window.removeEventListener(\"pointerup\",handlePointerUp);}if(savedPosition){persistDashboardPosition(savedPosition);}}function cleanupDragListeners(){var _container2,_dragHandle3;if(typeof window!==\"undefined\"){window.removeEventListener(\"pointermove\",handlePointerMove);window.removeEventListener(\"pointerup\",handlePointerUp);}isDraggingDashboard=false;dragPointerId=null;(_container2=container)===null||_container2===void 0||(_container2=_container2.classList)===null||_container2===void 0||_container2.remove(\"bt-dashboard-host--dragging\");(_dragHandle3=dragHandle)===null||_dragHandle3===void 0||(_dragHandle3=_dragHandle3.classList)===null||_dragHandle3===void 0||_dragHandle3.remove(\"bt-dashboard__header--dragging\");}function loadSavedDashboardPosition(){if(typeof window===\"undefined\")return null;try{var _window$localStorage8;var raw=(_window$localStorage8=window.localStorage)===null||_window$localStorage8===void 0?void 0:_window$localStorage8.getItem(DASHBOARD_POSITION_KEY);if(!raw)return null;var parsed=JSON.parse(raw);if(parsed&&typeof parsed.top===\"number\"&&Number.isFinite(parsed.top)&&typeof parsed.left===\"number\"&&Number.isFinite(parsed.left)){return{top:parsed.top,left:parsed.left};}}catch(err){console.warn(\"[BetterTasks] failed to read dashboard position\",err);}return null;}function persistDashboardPosition(pos){if(typeof window===\"undefined\"||!pos)return;try{var _window$localStorage9;(_window$localStorage9=window.localStorage)===null||_window$localStorage9===void 0||_window$localStorage9.setItem(DASHBOARD_POSITION_KEY,JSON.stringify(pos));}catch(err){console.warn(\"[BetterTasks] failed to store dashboard position\",err);}}function clampNumber(value,min,max){if(!Number.isFinite(value))return min;if(value<min)return min;if(value>max)return max;return value;}function clampPosition(pos){if(!container||!pos||typeof window===\"undefined\")return null;var margin=12;var rect=container.getBoundingClientRect();var width=rect.width||600;var height=rect.height||Math.min(window.innerHeight-margin*2,700);var maxLeft=Math.max(margin,window.innerWidth-width-margin);var maxTop=Math.max(margin,window.innerHeight-height-margin);var left=clampNumber(pos.left,margin,maxLeft);var top=clampNumber(pos.top,margin,maxTop);return{left:left,top:top};}function setContainerPosition(pos){if(!container||!pos)return;container.style.left=\"\".concat(pos.left,\"px\");container.style.top=\"\".concat(pos.top,\"px\");container.style.right=\"auto\";container.style.bottom=\"auto\";savedPosition=pos;}function applySavedPosition(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!savedPosition)return;var clamped=clampPosition(savedPosition);if(!clamped)return;setContainerPosition(clamped);if(options.persist){persistDashboardPosition(clamped);}}function handleWindowResize(){if(!container)return;if(isFullPage){scheduleApplyFullPageRect();return;}if(savedPosition){applySavedPosition({persist:true});}}return controller;}function editRepeat(_x175,_x176){return _editRepeat.apply(this,arguments);}function _editRepeat(){_editRepeat=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee127(uid,event){var _activeDashboardContr86,_activeDashboardContr87,_activeDashboardContr88,_activeDashboardContr89;var options,set,result,_args128=arguments;return _regenerator().w(function(_context128){while(1)switch(_context128.n){case 0:options=_args128.length>2&&_args128[2]!==undefined?_args128[2]:{};if(uid){_context128.n=1;break;}return _context128.a(2);case 1:set=S();_context128.n=2;return handleRepeatEdit(event||new MouseEvent(\"click\"),{uid:uid,set:set,span:null});case 2:result=_context128.v;if(!(typeof result===\"string\"&&result)){_context128.n=3;break;}_context128.n=3;return waitForRepeatState(uid,set,{expectedValue:result},6,getBlock,readRecurringMeta);case 3:_context128.n=4;return delay(250);case 4:_context128.n=5;return(_activeDashboardContr86=activeDashboardController)===null||_activeDashboardContr86===void 0||(_activeDashboardContr87=_activeDashboardContr86.notifyBlockChange)===null||_activeDashboardContr87===void 0?void 0:_activeDashboardContr87.call(_activeDashboardContr86,uid,{bypassFilters:true});case 5:_context128.n=6;return delay(120);case 6:_context128.n=7;return(_activeDashboardContr88=activeDashboardController)===null||_activeDashboardContr88===void 0||(_activeDashboardContr89=_activeDashboardContr88.refresh)===null||_activeDashboardContr89===void 0?void 0:_activeDashboardContr89.call(_activeDashboardContr88,{reason:\"pill-repeat\"});case 7:return _context128.a(2);}},_callee127);}));return _editRepeat.apply(this,arguments);}function editDate(_x177,_x178){return _editDate.apply(this,arguments);}function _editDate(){_editDate=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee128(uid,type){var _activeDashboardContr90,_activeDashboardContr91,_activeDashboardContr92,_activeDashboardContr93;var options,set,handler,intent,forcePrompt,allowCreate,baseEvent,syntheticEvent,resultDate,_args129=arguments;return _regenerator().w(function(_context129){while(1)switch(_context129.n){case 0:options=_args129.length>2&&_args129[2]!==undefined?_args129[2]:{};if(!(!uid||![\"start\",\"defer\",\"due\"].includes(type))){_context129.n=1;break;}return _context129.a(2);case 1:set=S();handler=type===\"start\"?handleStartClick:type===\"defer\"?handleDeferClick:handleDueClick;intent=options.intent||\"direct\";forcePrompt=intent===\"menu-edit\"||intent===\"menu-add\";allowCreate=intent===\"menu-add\";baseEvent=options.event||{};syntheticEvent={altKey:!!baseEvent.altKey,metaKey:!!baseEvent.metaKey,ctrlKey:!!baseEvent.ctrlKey,shiftKey:!!baseEvent.shiftKey};_context129.n=2;return handler(syntheticEvent,{uid:uid,set:set,span:null,forcePrompt:forcePrompt,allowCreate:allowCreate});case 2:resultDate=_context129.v;if(!(resultDate instanceof Date)){_context129.n=3;break;}_context129.n=3;return waitForAttrDate(uid,type,resultDate,set,6,getBlock,readRecurringMeta);case 3:_context129.n=4;return delay(120);case 4:_context129.n=5;return(_activeDashboardContr90=activeDashboardController)===null||_activeDashboardContr90===void 0||(_activeDashboardContr91=_activeDashboardContr90.notifyBlockChange)===null||_activeDashboardContr91===void 0?void 0:_activeDashboardContr91.call(_activeDashboardContr90,uid,{bypassFilters:true});case 5:_context129.n=6;return(_activeDashboardContr92=activeDashboardController)===null||_activeDashboardContr92===void 0||(_activeDashboardContr93=_activeDashboardContr92.refresh)===null||_activeDashboardContr93===void 0?void 0:_activeDashboardContr93.call(_activeDashboardContr92,{reason:\"pill-\".concat(type)});case 6:return _context129.a(2);}},_callee128);}));return _editDate.apply(this,arguments);}function parseMetadataFromPrompt(promptResult){if(!promptResult)return{};var projectRaw=typeof promptResult.project===\"string\"?promptResult.project.trim():\"\";var project=(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.normalizeProjectValue)(projectRaw);var waitingFor=typeof promptResult.waitingFor===\"string\"?promptResult.waitingFor.trim():\"\";var contextRaw=typeof promptResult.context===\"string\"?promptResult.context:\"\";var priority=typeof promptResult.priority===\"string\"?promptResult.priority.trim().toLowerCase():\"\";var energy=typeof promptResult.energy===\"string\"?promptResult.energy.trim().toLowerCase():\"\";var gtd=typeof promptResult.gtd===\"string\"?promptResult.gtd.trim():\"\";var contexts=contextRaw?normalizeContextList(contextRaw):[];return{project:project,waitingFor:waitingFor,contexts:contexts,priority:priority,energy:energy,gtd:gtd};}function applyMetadataFromPrompt(_x179,_x180,_x181){return _applyMetadataFromPrompt.apply(this,arguments);}function _applyMetadataFromPrompt(){_applyMetadataFromPrompt=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee129(uid,promptResult,attrNames){var options,initial,_parseMetadataFromPro,project,waitingFor,contexts,priority,energy,gtd,gtdNormalized,_args130=arguments;return _regenerator().w(function(_context130){while(1)switch(_context130.n){case 0:options=_args130.length>3&&_args130[3]!==undefined?_args130[3]:{};if(!(!uid||!promptResult)){_context130.n=1;break;}return _context130.a(2);case 1:initial=options.initial||{};_parseMetadataFromPro=parseMetadataFromPrompt(promptResult),project=_parseMetadataFromPro.project,waitingFor=_parseMetadataFromPro.waitingFor,contexts=_parseMetadataFromPro.contexts,priority=_parseMetadataFromPro.priority,energy=_parseMetadataFromPro.energy,gtd=_parseMetadataFromPro.gtd;if(!(project||initial.project)){_context130.n=3;break;}_context130.n=2;return setRichAttribute(uid,\"project\",project||null,attrNames);case 2:if(project)(0,_project_store__WEBPACK_IMPORTED_MODULE_3__.addProjectOption)(project);case 3:if(!(waitingFor||initial.waitingFor)){_context130.n=4;break;}_context130.n=4;return setRichAttribute(uid,\"waitingFor\",waitingFor||null,attrNames);case 4:if(!(contexts&&contexts.length||(initial.context||[]).length)){_context130.n=5;break;}_context130.n=5;return setRichAttribute(uid,\"context\",contexts&&contexts.length?contexts:[],attrNames);case 5:if(!(priority||initial.priority)){_context130.n=6;break;}_context130.n=6;return setRichAttribute(uid,\"priority\",priority||null,attrNames);case 6:if(!(energy||initial.energy)){_context130.n=7;break;}_context130.n=7;return setRichAttribute(uid,\"energy\",energy||null,attrNames);case 7:gtdNormalized=gtd?normalizeGtdStatus(gtd):null;if(!(gtdNormalized||initial.gtd)){_context130.n=8;break;}_context130.n=8;return setRichAttribute(uid,\"gtd\",gtdNormalized||null,attrNames);case 8:return _context130.a(2);}},_callee129);}));return _applyMetadataFromPrompt.apply(this,arguments);}function openPillMenuForTask(_x182){return _openPillMenuForTask.apply(this,arguments);}function _openPillMenuForTask(){_openPillMenuForTask=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee130(uid){var set,metadata,isRecurring,block,meta,_t112;return _regenerator().w(function(_context131){while(1)switch(_context131.p=_context131.n){case 0:if(uid){_context131.n=1;break;}return _context131.a(2);case 1:set=S();metadata=null;isRecurring=true;_context131.p=2;_context131.n=3;return getBlock(uid);case 3:block=_context131.v;if(!block){_context131.n=5;break;}_context131.n=4;return readRecurringMeta(block,set);case 4:meta=_context131.v;metadata=(meta===null||meta===void 0?void 0:meta.metadata)||parseRichMetadata((meta===null||meta===void 0?void 0:meta.childAttrMap)||{},set.attrNames);isRecurring=!!(meta!==null&&meta!==void 0&&meta.repeat);if(typeof window!==\"undefined\"){writeInlineMetaCache(uid,metadata||{});}case 5:_context131.n=7;break;case 6:_context131.p=6;_t112=_context131.v;case 7:showPillMenu({uid:uid,set:set,isRecurring:isRecurring,metadata:metadata});case 8:return _context131.a(2);}},_callee130,null,[[2,6]]);}));return _openPillMenuForTask.apply(this,arguments);}function removeTaskAttribute(_x183,_x184){return _removeTaskAttribute.apply(this,arguments);}function _removeTaskAttribute(){_removeTaskAttribute=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee131(uid,type){var _activeDashboardContr94,_activeDashboardContr95,_activeDashboardContr96,_activeDashboardContr97,_set2,cleared,labels,_t113;return _regenerator().w(function(_context132){while(1)switch(_context132.p=_context132.n){case 0:if(!(!uid||![\"repeat\",\"start\",\"defer\",\"due\"].includes(type))){_context132.n=1;break;}return _context132.a(2);case 1:_context132.p=1;_set2=S();_context132.n=2;return clearAttrForType(uid,type,{set:_set2});case 2:cleared=_context132.v;if(!cleared){_context132.n=4;break;}_context132.n=3;return waitForAttrClear(uid,type,_set2,6,getBlock,readRecurringMeta);case 3:void syncPillsForSurface(lastAttrSurface||\"Child\");case 4:_context132.n=5;return delay(120);case 5:_context132.n=6;return(_activeDashboardContr94=activeDashboardController)===null||_activeDashboardContr94===void 0||(_activeDashboardContr95=_activeDashboardContr94.notifyBlockChange)===null||_activeDashboardContr95===void 0?void 0:_activeDashboardContr95.call(_activeDashboardContr94,uid,{bypassFilters:true});case 6:_context132.n=7;return(_activeDashboardContr96=activeDashboardController)===null||_activeDashboardContr96===void 0||(_activeDashboardContr97=_activeDashboardContr96.refresh)===null||_activeDashboardContr97===void 0?void 0:_activeDashboardContr97.call(_activeDashboardContr96,{reason:\"remove-\".concat(type)});case 7:labels={repeat:\"Repeat rule removed\",start:\"Start date removed\",defer:\"Defer date removed\",due:\"Due date removed\"};toast(labels[type]||\"Attribute removed\");_context132.n=9;break;case 8:_context132.p=8;_t113=_context132.v;console.error(\"[BetterTasks] removeTaskAttribute failed\",_t113);toast(\"Unable to remove that attribute.\");case 9:return _context132.a(2);}},_callee131,null,[[1,8]]);}));return _removeTaskAttribute.apply(this,arguments);}var dashboardTaskCache=function(){var lastKey=null;var lastAt=0;var lastValue=null;var TTL_MS=5000;return{get:function get(key){var now=Date.now();if(lastKey===key&&now-lastAt<TTL_MS)return lastValue;return null;},set:function set(key,value){lastKey=key;lastAt=Date.now();lastValue=value;return value;},clear:function clear(){lastKey=null;lastAt=0;lastValue=null;}};}();function collectDashboardTasks(){return _collectDashboardTasks.apply(this,arguments);}function _collectDashboardTasks(){_collectDashboardTasks=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee132(){var options,_options$includeCompl,includeCompleted,_options$attachWatche,attachWatches,_options$cacheKey,cacheKey,_options$bypassCache,bypassCache,memoKey,cached,set,_yield$Promise$all,_yield$Promise$all2,todoRows,doneRows,attrRows,blockMap,_i19,_arr2,rows,_iterator34,_step34,row,block,tasks,_iterator35,_step35,_block2,meta,task,_args133=arguments,_t114,_t115;return _regenerator().w(function(_context133){while(1)switch(_context133.p=_context133.n){case 0:options=_args133.length>0&&_args133[0]!==undefined?_args133[0]:{};_options$includeCompl=options.includeCompleted,includeCompleted=_options$includeCompl===void 0?true:_options$includeCompl,_options$attachWatche=options.attachWatches,attachWatches=_options$attachWatche===void 0?true:_options$attachWatche,_options$cacheKey=options.cacheKey,cacheKey=_options$cacheKey===void 0?null:_options$cacheKey,_options$bypassCache=options.bypassCache,bypassCache=_options$bypassCache===void 0?false:_options$bypassCache;memoKey=cacheKey||\"tasks:\".concat(includeCompleted?\"withDone\":\"noDone\");if(bypassCache){_context133.n=1;break;}cached=dashboardTaskCache.get(memoKey);if(!cached){_context133.n=1;break;}return _context133.a(2,cached);case 1:set=S();_context133.n=2;return Promise.all([fetchBlocksByPageRef(\"TODO\"),includeCompleted?fetchBlocksByPageRef(\"DONE\"):Promise.resolve([]),fetchBlocksByAttributes(set)]);case 2:_yield$Promise$all=_context133.v;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);todoRows=_yield$Promise$all2[0];doneRows=_yield$Promise$all2[1];attrRows=_yield$Promise$all2[2];blockMap=new Map();for(_i19=0,_arr2=[todoRows,doneRows,attrRows];_i19<_arr2.length;_i19++){rows=_arr2[_i19];_iterator34=_createForOfIteratorHelper(rows||[]);try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){row=_step34.value;block=row===null||row===void 0?void 0:row[0];if(block!==null&&block!==void 0&&block.uid){blockMap.set(block.uid,block);}}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}}tasks=[];_iterator35=_createForOfIteratorHelper(blockMap.values());_context133.p=3;_iterator35.s();case 4:if((_step35=_iterator35.n()).done){_context133.n=11;break;}_block2=_step35.value;_context133.p=5;if(!(!includeCompleted&&isBlockCompleted(_block2))){_context133.n=6;break;}return _context133.a(3,10);case 6:_context133.n=7;return readRecurringMeta(_block2,set);case 7:meta=_context133.v;if(!(!isBetterTasksTask(meta)||!isTaskBlock(_block2))){_context133.n=8;break;}return _context133.a(3,10);case 8:task=deriveDashboardTask(_block2,meta,set);if(task){tasks.push(task);if(attachWatches&&!task.isCompleted)ensureDashboardWatch(task.uid);}_context133.n=10;break;case 9:_context133.p=9;_t114=_context133.v;console.warn(\"[BetterTasks] deriveDashboardTask failed\",_t114);case 10:_context133.n=4;break;case 11:_context133.n=13;break;case 12:_context133.p=12;_t115=_context133.v;_iterator35.e(_t115);case 13:_context133.p=13;_iterator35.f();return _context133.f(13);case 14:return _context133.a(2,dashboardTaskCache.set(memoKey,sortDashboardTasksList(tasks)));}},_callee132,null,[[5,9],[3,12,13,14]]);}));return _collectDashboardTasks.apply(this,arguments);}function fetchBlocksByPageRef(_x185){return _fetchBlocksByPageRef.apply(this,arguments);}function _fetchBlocksByPageRef(){_fetchBlocksByPageRef=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee133(title){var pull,safeTitle,query,_t116,_t117;return _regenerator().w(function(_context134){while(1)switch(_context134.p=_context134.n){case 0:pull=\"[:block/uid :block/string :block/props :block/order :block/open\\n        {:block/children [:block/uid :block/string]}\\n        {:block/page [:block/uid :node/title]}\\n        {:block/parents [:block/uid]}]\";safeTitle=escapeDatalogString(title);query=\"\\n        [:find (pull ?b \".concat(pull,\")\\n         :where\\n           [?b :block/refs ?ref]\\n           [?ref :node/title \\\"\").concat(safeTitle,\"\\\"]]\");_context134.p=1;_context134.n=2;return window.roamAlphaAPI.q(query);case 2:_t116=_context134.v;if(_t116){_context134.n=3;break;}_t116=[];case 3:return _context134.a(2,_t116);case 4:_context134.p=4;_t117=_context134.v;console.warn(\"[BetterTasks] fetchBlocksByPageRef failed\",_t117);return _context134.a(2,[]);}},_callee133,null,[[1,4]]);}));return _fetchBlocksByPageRef.apply(this,arguments);}function fetchBlocksByAttributes(_x186){return _fetchBlocksByAttributes.apply(this,arguments);}function _fetchBlocksByAttributes(){_fetchBlocksByAttributes=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee134(set){var attrNames,labels,pull,safeLabels,labelSet,query,rows,_t118;return _regenerator().w(function(_context135){while(1)switch(_context135.p=_context135.n){case 0:attrNames=(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames();labels=new Set([getAttrLabel(\"repeat\",attrNames),getAttrLabel(\"start\",attrNames),getAttrLabel(\"defer\",attrNames),getAttrLabel(\"due\",attrNames),getAttrLabel(\"completed\",attrNames),getAttrLabel(\"project\",attrNames),getAttrLabel(\"gtd\",attrNames),getAttrLabel(\"waitingFor\",attrNames),getAttrLabel(\"context\",attrNames),getAttrLabel(\"priority\",attrNames),getAttrLabel(\"energy\",attrNames)].filter(Boolean));if(labels.size){_context135.n=1;break;}return _context135.a(2,[]);case 1:pull=\"[:block/uid :block/string :block/props :block/order :block/open\\n        {:block/children [:block/uid :block/string]}\\n        {:block/page [:block/uid :node/title]}\\n        {:block/parents [:block/uid]}]\";safeLabels=Array.from(labels).map(function(label){return label.replace(/\\\\/g,\"\\\\\\\\\").replace(/\"/g,'\\\\\"');});labelSet=safeLabels.map(function(l){return\"\\\"\".concat(l,\"\\\"\");}).join(\" \");query=\"\\n        [:find (pull ?b \".concat(pull,\")\\n         :where\\n          [?attr :node/title ?title]\\n          [(contains? #{\").concat(labelSet,\"} ?title)]\\n          [?c :block/refs ?attr]\\n          [?b :block/children ?c]]\");_context135.p=2;_context135.n=3;return window.roamAlphaAPI.q(query);case 3:rows=_context135.v;return _context135.a(2,Array.isArray(rows)?rows:[]);case 4:_context135.p=4;_t118=_context135.v;console.warn(\"[BetterTasks] fetchBlocksByAttributes failed\",_t118);return _context135.a(2,[]);}},_callee134,null,[[2,4]]);}));return _fetchBlocksByAttributes.apply(this,arguments);}function deriveDashboardTask(block,meta,set){var _meta$childAttrMap,_meta$childAttrMap2,_block$page2,_block$page3,_block$page4;if(!block)return null;var title=formatDashboardTitle(block.string||\"\");var attrCompleted=(meta===null||meta===void 0?void 0:meta.completed)||(meta===null||meta===void 0||(_meta$childAttrMap=meta.childAttrMap)===null||_meta$childAttrMap===void 0||(_meta$childAttrMap=_meta$childAttrMap.completed)===null||_meta$childAttrMap===void 0?void 0:_meta$childAttrMap.value)||null;var isCompleted=isBlockCompleted(block)||!!attrCompleted;var completedAtRaw=(meta===null||meta===void 0||(_meta$childAttrMap2=meta.childAttrMap)===null||_meta$childAttrMap2===void 0||(_meta$childAttrMap2=_meta$childAttrMap2.completed)===null||_meta$childAttrMap2===void 0?void 0:_meta$childAttrMap2.value)||null;var completedAtParsed=completedAtRaw?parseRoamDate(completedAtRaw):null;var completedAt=completedAtParsed instanceof Date&&!Number.isNaN(completedAtParsed.getTime())?completedAtParsed:null;var startAt=(meta===null||meta===void 0?void 0:meta.start)instanceof Date&&!Number.isNaN(meta.start.getTime())?meta.start:null;var deferUntil=(meta===null||meta===void 0?void 0:meta.defer)instanceof Date&&!Number.isNaN(meta.defer.getTime())?meta.defer:null;var dueAt=(meta===null||meta===void 0?void 0:meta.due)instanceof Date&&!Number.isNaN(meta.due.getTime())?meta.due:null;var now=new Date();var startBucket=startAt&&now<startAt?\"not-started\":\"started\";var deferBucket=deferUntil&&now<deferUntil?\"deferred\":\"available\";var dueBucket=computeDueBucket(dueAt,now);var recurrenceBucket=meta!==null&&meta!==void 0&&meta.repeat?\"recurring\":\"one-off\";var availabilityLabel=isCompleted?null:startBucket===\"not-started\"?translateString(\"Not started\",getLanguageSetting()):deferBucket===\"deferred\"?translateString(\"Deferred\",getLanguageSetting()):translateString(\"Available\",getLanguageSetting());var richMeta=(meta===null||meta===void 0?void 0:meta.metadata)||parseRichMetadata((meta===null||meta===void 0?void 0:meta.childAttrMap)||{},(set===null||set===void 0?void 0:set.attrNames)||resolveAttributeNames());var metaPills=buildDashboardPills({startAt:startAt,deferUntil:deferUntil,dueAt:dueAt,repeatText:meta===null||meta===void 0?void 0:meta.repeat,metadata:richMeta},set);return _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({uid:block.uid,text:block.string||\"\",title:title,pageUid:((_block$page2=block.page)===null||_block$page2===void 0?void 0:_block$page2.uid)||null,pageTitle:((_block$page3=block.page)===null||_block$page3===void 0?void 0:_block$page3.title)||((_block$page4=block.page)===null||_block$page4===void 0?void 0:_block$page4[\"node/title\"])||\"\",repeatText:(meta===null||meta===void 0?void 0:meta.repeat)||\"\",isRecurring:!!(meta!==null&&meta!==void 0&&meta.repeat),isCompleted:isCompleted,startAt:startAt,deferUntil:deferUntil,dueAt:dueAt,startBucket:startBucket,deferBucket:deferBucket,dueBucket:dueBucket,recurrenceBucket:recurrenceBucket,availabilityLabel:availabilityLabel},\"isCompleted\",isCompleted),\"completedAt\",completedAt),\"startDisplay\",formatDateDisplay(startAt,set)),\"deferDisplay\",formatDateDisplay(deferUntil,set)),\"dueDisplay\",formatDateDisplay(dueAt,set)),\"metaPills\",metaPills),\"metadata\",richMeta);}function buildDashboardPills(info,set){var _info$metadata,_info$metadata2,_info$metadata3,_info$metadata4,_info$metadata5,_info$metadata6;var pills=[];var lang=getLanguageSetting();var metaLabels=t([\"metadata\"],lang)||{};if(info.repeatText){var label=metaLabels.repeatRule||metaLabels.repeat||\"Repeat\";pills.push({type:\"repeat\",icon:\"â†»\",value:info.repeatText,label:\"\".concat(label,\": \").concat(info.repeatText)});}if(info.startAt instanceof Date&&!Number.isNaN(info.startAt.getTime())){pills.push({type:\"start\",icon:START_ICON,value:formatPillDateText(info.startAt,set),label:\"\".concat(metaLabels.start||\"Start\",\": \").concat(formatIsoDate(info.startAt,set))});}if(info.deferUntil instanceof Date&&!Number.isNaN(info.deferUntil.getTime())){pills.push({type:\"defer\",icon:DEFER_ICON,value:formatPillDateText(info.deferUntil,set),label:\"\".concat(metaLabels.defer||\"Defer\",\": \").concat(formatIsoDate(info.deferUntil,set))});}if(info.dueAt instanceof Date&&!Number.isNaN(info.dueAt.getTime())){pills.push({type:\"due\",icon:DUE_ICON,value:formatPillDateText(info.dueAt,set),label:\"\".concat(metaLabels.due||\"Due\",\": \").concat(formatIsoDate(info.dueAt,set))});}if((_info$metadata=info.metadata)!==null&&_info$metadata!==void 0&&_info$metadata.project){pills.push({type:\"project\",icon:\"ðŸ“\",value:info.metadata.project,label:\"\".concat(metaLabels.projectLabel||metaLabels.project||\"Project\",\": \").concat(info.metadata.project),raw:info.metadata.project});}if((_info$metadata2=info.metadata)!==null&&_info$metadata2!==void 0&&_info$metadata2.waitingFor){pills.push({type:\"waitingFor\",icon:\"âŒ›\",value:info.metadata.waitingFor,label:\"\".concat(metaLabels.waitingLabel||metaLabels.waitingFor||\"Waiting for\",\": \").concat(info.metadata.waitingFor),raw:info.metadata.waitingFor});}if((_info$metadata3=info.metadata)!==null&&_info$metadata3!==void 0&&(_info$metadata3=_info$metadata3.context)!==null&&_info$metadata3!==void 0&&_info$metadata3.length){var display=info.metadata.context.slice(0,1).join(\", \");var more=info.metadata.context.length>1?\" (+\".concat(info.metadata.context.length-1,\")\"):\"\";pills.push({type:\"context\",icon:\"@\",value:\"\".concat(display).concat(more),label:\"\".concat(metaLabels.contextLabel||metaLabels.context||\"Context\",\": \").concat(info.metadata.context.join(\", \")),rawList:info.metadata.context});}if((_info$metadata4=info.metadata)!==null&&_info$metadata4!==void 0&&_info$metadata4.gtd){var _display2=formatGtdStatusDisplay(info.metadata.gtd,lang);var next=cycleGtdStatus(info.metadata.gtd);pills.push({type:\"gtd\",icon:\"âž¡\",value:_display2,label:\"\".concat(metaLabels.gtdLabel||metaLabels.gtd||\"GTD\",\": \").concat(_display2),nextValue:next});}if((_info$metadata5=info.metadata)!==null&&_info$metadata5!==void 0&&_info$metadata5.priority){var order=[\"low\",\"medium\",\"high\",null];var currentIdx=order.indexOf(info.metadata.priority||null);var _next3=order[(currentIdx+1)%order.length]||null;pills.push({type:\"priority\",icon:\"!\",value:formatPriorityEnergyDisplay(info.metadata.priority,lang),label:\"\".concat(metaLabels.priorityLabel||metaLabels.priority||\"Priority\",\": \").concat(formatPriorityEnergyDisplay(info.metadata.priority,lang),\" (click to cycle)\"),nextValue:_next3});}if((_info$metadata6=info.metadata)!==null&&_info$metadata6!==void 0&&_info$metadata6.energy){var _order=[\"low\",\"medium\",\"high\",null];var _currentIdx=_order.indexOf(info.metadata.energy||null);var _next4=_order[(_currentIdx+1)%_order.length]||null;pills.push({type:\"energy\",icon:\"ðŸ”‹\",value:formatPriorityEnergyDisplay(info.metadata.energy,lang),label:\"\".concat(metaLabels.energyLabel||metaLabels.energy||\"Energy\",\": \").concat(formatPriorityEnergyDisplay(info.metadata.energy,lang),\" (click to cycle)\"),nextValue:_next4});}return pills;}function formatDashboardTitle(text){if(!text)return\"\";return text.replace(/^\\s*\\{\\{\\s*\\[\\[\\s*(?:TODO|DONE)\\s*\\]\\]\\s*\\}\\}\\s*/i,\"\").replace(/^\\s*(?:TODO|DONE)\\s+/i,\"\").trim();}function formatDateDisplay(date,set){if(!(date instanceof Date)||Number.isNaN(date.getTime()))return\"\";return formatFriendlyDate(date,set);}function computeDueBucket(dueDate){var now=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Date();if(!(dueDate instanceof Date)||Number.isNaN(dueDate.getTime()))return\"none\";if(now>endOfDay(dueDate))return\"overdue\";if(isSameDay(dueDate,now))return\"today\";if(dueDate>endOfDay(now))return\"upcoming\";return\"none\";}function endOfDay(date){var d=new Date(date.getTime());d.setHours(23,59,59,999);return d;}function isSameDay(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate();}function isBetterTasksTask(meta){if(!meta)return false;return!!(meta.repeat||meta.hasTimingAttrs||meta.hasMetadata);}function buildTodaySections(tasks){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var includeOverdue=!!options.includeOverdue;var showCompleted=!!options.showCompleted;var today=todayLocal();var startToday=startOfDayLocal(today);var sections={startingToday:[],deferredToToday:[],dueToday:[],overdue:[]};var _iterator22=_createForOfIteratorHelper(Array.isArray(tasks)?tasks:[]),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var task=_step22.value;if(!task)continue;if(task.isCompleted&&!showCompleted)continue;var start=task.startAt instanceof Date?task.startAt:null;var defer=task.deferUntil instanceof Date?task.deferUntil:null;var due=task.dueAt instanceof Date?task.dueAt:null;var isDueToday=due&&isSameDay(due,today);var isDeferToday=defer&&isSameDay(defer,today);var isStartToday=start&&isSameDay(start,today);if(isDueToday){sections.dueToday.push(task);}else if(isDeferToday){sections.deferredToToday.push(task);}else if(isStartToday){sections.startingToday.push(task);}else if(includeOverdue&&!task.isCompleted&&due&&due<startToday){sections.overdue.push(task);}}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}return sections;}function getTodayAnchorText(){var configured=getTodaySetting(TODAY_WIDGET_TITLE_SETTING);if(typeof configured===\"string\"&&configured.trim()){var _t32=configured.trim();noteTodayAnchorText(_t32);return _t32;}var lang=getLanguageSetting();var translated=t([\"today\",\"title\"],lang);var out=typeof translated===\"string\"&&translated.trim()?translated:TODAY_WIDGET_ANCHOR_TEXT_DEFAULT;noteTodayAnchorText(out);return out;}function stripMarkdownDecorations(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";var s=String(text||\"\").trim();// Remove surrounding bold/italic/code markers, multiple times if nested.\nvar stripEdge=function stripEdge(str){return str.replace(/^(?:\\*+|_+|`+)+|(?:\\*+|_+|`+)+$/g,\"\").trim();};s=stripEdge(s);s=stripEdge(s);// run twice to catch combos like **_text_**\n// Remove wrapping Roam links [[...]]\nvar linkMatch=s.match(/^\\[\\[(.*)\\]\\]$/);if(linkMatch)s=linkMatch[1].trim();return s.trim();}function normalizeMatchText(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";return stripMarkdownDecorations(text).replace(/\\s+/g,\" \").trim().toLowerCase();}function noteTodayAnchorText(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";var normalized=normalizeMatchText(text);if(normalized){todayAnchorTextHistory.add(normalized);pruneSetMax(todayAnchorTextHistory,MAX_TODAY_ANCHOR_TEXT_HISTORY);}}function matchesTodayAnchor(){var str=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";var anchorText=normalizeMatchText(getTodayAnchorText());var trimmed=normalizeMatchText(str);if(trimmed===anchorText)return true;if(todayAnchorTextHistory.has(trimmed))return true;return TODAY_WIDGET_ANCHOR_TEXT_LEGACY.some(function(legacy){return trimmed===normalizeMatchText(legacy);});}function findHeadingBlockUid(_x187,_x188){return _findHeadingBlockUid.apply(this,arguments);}function _findHeadingBlockUid(){_findHeadingBlockUid=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee136(dnpUid,headingText){var cache,target,visited,checked,MAX_NODES,MAX_DEPTH,dfs,_dfs,dnp,children,_iterator36,_step36,child,hit,_args137=arguments,_t120;return _regenerator().w(function(_context137){while(1)switch(_context137.p=_context137.n){case 0:_dfs=function _dfs3(){_dfs=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee135(uid){var depth,block,text,children,_iterator37,_step37,child,hit,_args136=arguments,_t119;return _regenerator().w(function(_context136){while(1)switch(_context136.p=_context136.n){case 0:depth=_args136.length>1&&_args136[1]!==undefined?_args136[1]:0;if(!(!uid||depth>MAX_DEPTH||visited.has(uid)||checked>=MAX_NODES)){_context136.n=1;break;}return _context136.a(2,null);case 1:visited.add(uid);checked+=1;_context136.n=2;return getBlockCached(uid,cache);case 2:block=_context136.v;if(block){_context136.n=3;break;}return _context136.a(2,null);case 3:text=normalizeMatchText(block.string||\"\");if(!(text===target)){_context136.n=4;break;}return _context136.a(2,block.uid);case 4:children=Array.isArray(block===null||block===void 0?void 0:block.children)?block.children:[];_iterator37=_createForOfIteratorHelper(children);_context136.p=5;_iterator37.s();case 6:if((_step37=_iterator37.n()).done){_context136.n=9;break;}child=_step37.value;_context136.n=7;return dfs(child===null||child===void 0?void 0:child.uid,depth+1);case 7:hit=_context136.v;if(!hit){_context136.n=8;break;}return _context136.a(2,hit);case 8:_context136.n=6;break;case 9:_context136.n=11;break;case 10:_context136.p=10;_t119=_context136.v;_iterator37.e(_t119);case 11:_context136.p=11;_iterator37.f();return _context136.f(11);case 12:return _context136.a(2,null);}},_callee135,null,[[5,10,11,12]]);}));return _dfs.apply(this,arguments);};dfs=function _dfs2(_x207){return _dfs.apply(this,arguments);};cache=_args137.length>2&&_args137[2]!==undefined?_args137[2]:null;if(!(!dnpUid||!headingText)){_context137.n=1;break;}return _context137.a(2,null);case 1:target=normalizeMatchText(headingText);visited=new Set();checked=0;MAX_NODES=200;MAX_DEPTH=6;// Start from top-level children of the DNP.\n_context137.n=2;return getBlockCached(dnpUid,cache);case 2:dnp=_context137.v;children=Array.isArray(dnp===null||dnp===void 0?void 0:dnp.children)?dnp.children:[];_iterator36=_createForOfIteratorHelper(children);_context137.p=3;_iterator36.s();case 4:if((_step36=_iterator36.n()).done){_context137.n=7;break;}child=_step36.value;_context137.n=5;return dfs(child===null||child===void 0?void 0:child.uid,1);case 5:hit=_context137.v;if(!hit){_context137.n=6;break;}return _context137.a(2,hit);case 6:_context137.n=4;break;case 7:_context137.n=9;break;case 8:_context137.p=8;_t120=_context137.v;_iterator36.e(_t120);case 9:_context137.p=9;_iterator36.f();return _context137.f(9);case 10:return _context137.a(2,null);}},_callee136,null,[[3,8,9,10]]);}));return _findHeadingBlockUid.apply(this,arguments);}function getTodayParentInfo(){return _getTodayParentInfo.apply(this,arguments);}function _getTodayParentInfo(){_getTodayParentInfo=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee137(){var cache,dnpTitle,dnpUid,headingText,headingUid,parentUid,parent,children,_args138=arguments;return _regenerator().w(function(_context138){while(1)switch(_context138.n){case 0:cache=_args138.length>0&&_args138[0]!==undefined?_args138[0]:null;dnpTitle=toDnpTitle(todayLocal());_context138.n=1;return getOrCreatePageUidCached(dnpTitle,cache);case 1:dnpUid=_context138.v;headingText=getTodayAnchorText();headingUid=null;if(!headingText){_context138.n=3;break;}_context138.n=2;return findHeadingBlockUid(dnpUid,headingText,cache);case 2:headingUid=_context138.v;case 3:if(headingUid){todayHeadingRecheckPending=false;todayHeadingRetryCount=0;}else if(headingText&&!todayHeadingRecheckPending&&todayHeadingRetryCount<MAX_TODAY_HEADING_RETRIES){todayHeadingRecheckPending=true;todayHeadingRetryCount+=1;setTimeout(function(){todayHeadingRecheckPending=false;scheduleTodayWidgetRender(40,true);},600+400*todayHeadingRetryCount);}parentUid=headingUid||dnpUid;_context138.n=4;return getBlockCached(parentUid,cache);case 4:parent=_context138.v;children=Array.isArray(parent===null||parent===void 0?void 0:parent.children)?parent.children:[];return _context138.a(2,{dnpUid:dnpUid,parentUid:parentUid,parent:parent,children:children,headingUid:headingUid,headingText:headingText});}},_callee137);}));return _getTodayParentInfo.apply(this,arguments);}function findTodayAnchorUid(){return _findTodayAnchorUid.apply(this,arguments);}function _findTodayAnchorUid(){_findTodayAnchorUid=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee138(){var cache,_yield$getTodayParent3,dnpUid,parentUid,children,headingUid,anchor,_root,rootChildren,legacy,heading,headingChildren,_legacy,_args139=arguments;return _regenerator().w(function(_context139){while(1)switch(_context139.n){case 0:cache=_args139.length>0&&_args139[0]!==undefined?_args139[0]:null;_context139.n=1;return getTodayParentInfo(cache);case 1:_yield$getTodayParent3=_context139.v;dnpUid=_yield$getTodayParent3.dnpUid;parentUid=_yield$getTodayParent3.parentUid;children=_yield$getTodayParent3.children;headingUid=_yield$getTodayParent3.headingUid;if(!headingUid){_context139.n=2;break;}return _context139.a(2,headingUid);case 2:// Use user heading as anchor.\nanchor=children.find(function(c){return matchesTodayAnchor((c===null||c===void 0?void 0:c.string)||\"\");});if(!(anchor!==null&&anchor!==void 0&&anchor.uid)){_context139.n=3;break;}return _context139.a(2,anchor.uid);case 3:if(!(headingUid&&parentUid===headingUid)){_context139.n=5;break;}_context139.n=4;return getBlockCached(dnpUid,cache);case 4:_root=_context139.v;rootChildren=Array.isArray(_root===null||_root===void 0?void 0:_root.children)?_root.children:[];legacy=rootChildren.find(function(c){return matchesTodayAnchor((c===null||c===void 0?void 0:c.string)||\"\");});return _context139.a(2,(legacy===null||legacy===void 0?void 0:legacy.uid)||null);case 5:if(!headingUid){_context139.n=7;break;}_context139.n=6;return getBlockCached(headingUid,cache);case 6:heading=_context139.v;headingChildren=Array.isArray(heading===null||heading===void 0?void 0:heading.children)?heading.children:[];_legacy=headingChildren.find(function(c){return matchesTodayAnchor((c===null||c===void 0?void 0:c.string)||\"\");});return _context139.a(2,(_legacy===null||_legacy===void 0?void 0:_legacy.uid)||null);case 7:return _context139.a(2,null);}},_callee138);}));return _findTodayAnchorUid.apply(this,arguments);}function ensureTodayWidgetAnchor(){return _ensureTodayWidgetAnchor.apply(this,arguments);}function _ensureTodayWidgetAnchor(){_ensureTodayWidgetAnchor=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee139(){var _existing;var placement,heading,cache,opts,_ref50,_ref50$allowMoves,allowMoves,_yield$getTodayParent4,dnpUid,parentUid,children,headingUid,anchorText,existingIndex,existing,rootParentUid,altParent,altChildren,altIndex,desiredOrder,_existing$parents,currentOrder,order,uid,_args140=arguments,_t121,_t122,_t123,_t124,_t125;return _regenerator().w(function(_context140){while(1)switch(_context140.p=_context140.n){case 0:placement=_args140.length>0&&_args140[0]!==undefined?_args140[0]:\"Top\";heading=_args140.length>1&&_args140[1]!==undefined?_args140[1]:0;cache=_args140.length>2&&_args140[2]!==undefined?_args140[2]:null;opts=_args140.length>3&&_args140[3]!==undefined?_args140[3]:{};_ref50=opts||{},_ref50$allowMoves=_ref50.allowMoves,allowMoves=_ref50$allowMoves===void 0?true:_ref50$allowMoves;_context140.n=1;return getTodayParentInfo(cache);case 1:_yield$getTodayParent4=_context140.v;dnpUid=_yield$getTodayParent4.dnpUid;parentUid=_yield$getTodayParent4.parentUid;children=_yield$getTodayParent4.children;headingUid=_yield$getTodayParent4.headingUid;anchorText=stripMarkdownDecorations(getTodayAnchorText());if(!anchorText)anchorText=TODAY_WIDGET_ANCHOR_TEXT_DEFAULT;existingIndex=children.findIndex(function(c){return matchesTodayAnchor((c===null||c===void 0?void 0:c.string)||\"\");});existing=existingIndex>=0?children[existingIndex]:null;// If an anchor exists on the alternate parent (root/heading), prefer to move it.\nif(!(!existing&&headingUid)){_context140.n=3;break;}rootParentUid=parentUid===headingUid?dnpUid:headingUid;_context140.n=2;return getBlockCached(rootParentUid,cache);case 2:altParent=_context140.v;altChildren=Array.isArray(altParent===null||altParent===void 0?void 0:altParent.children)?altParent.children:[];altIndex=altChildren.findIndex(function(c){return matchesTodayAnchor((c===null||c===void 0?void 0:c.string)||\"\");});if(altIndex>=0){existing=altChildren[altIndex];}case 3:desiredOrder=placement===\"Bottom\"?Math.max(children.length,0):0;if(!headingUid){_context140.n=4;break;}lastTodayAnchorIsHeading=true;return _context140.a(2,headingUid);case 4:if(!((_existing=existing)!==null&&_existing!==void 0&&_existing.uid)){_context140.n=21;break;}if(!((existing.string||\"\").trim()!==anchorText)){_context140.n=8;break;}_context140.p=5;_context140.n=6;return window.roamAlphaAPI.updateBlock({block:{uid:existing.uid,string:anchorText}});case 6:_context140.n=8;break;case 7:_context140.p=7;_t121=_context140.v;case 8:_context140.p=8;_context140.n=9;return window.roamAlphaAPI.updateBlock({block:{uid:existing.uid,heading:heading}});case 9:_context140.n=11;break;case 10:_context140.p=10;_t122=_context140.v;case 11:if(!allowMoves){_context140.n=20;break;}currentOrder=typeof existing.order===\"number\"?existing.order:children.findIndex(function(c){return(c===null||c===void 0?void 0:c.uid)===existing.uid;});if(!((_existing$parents=existing.parents)!==null&&_existing$parents!==void 0&&(_existing$parents=_existing$parents[0])!==null&&_existing$parents!==void 0&&_existing$parents.uid&&existing.parents[0].uid!==parentUid)){_context140.n=16;break;}_context140.p=12;_context140.n=13;return window.roamAlphaAPI.moveBlock({location:{\"parent-uid\":parentUid,order:desiredOrder},block:{uid:existing.uid}});case 13:_context140.n=15;break;case 14:_context140.p=14;_t123=_context140.v;case 15:_context140.n=20;break;case 16:if(!(typeof desiredOrder===\"number\"&&desiredOrder>=0&&currentOrder!==desiredOrder)){_context140.n=20;break;}_context140.p=17;_context140.n=18;return window.roamAlphaAPI.moveBlock({location:{\"parent-uid\":parentUid,order:desiredOrder},block:{uid:existing.uid}});case 18:_context140.n=20;break;case 19:_context140.p=19;_t124=_context140.v;case 20:return _context140.a(2,existing.uid);case 21:order=desiredOrder;uid=window.roamAlphaAPI.util.generateUID();_context140.n=22;return createBlock(parentUid,order,anchorText,uid);case 22:_context140.p=22;_context140.n=23;return window.roamAlphaAPI.updateBlock({block:{uid:uid,heading:heading}});case 23:_context140.n=25;break;case 24:_context140.p=24;_t125=_context140.v;case 25:lastTodayAnchorIsHeading=false;return _context140.a(2,uid);}},_callee139,null,[[22,24],[17,19],[12,14],[8,10],[5,7]]);}));return _ensureTodayWidgetAnchor.apply(this,arguments);}function clearTodayInlineChildren(_x189){return _clearTodayInlineChildren.apply(this,arguments);}function _clearTodayInlineChildren(){_clearTodayInlineChildren=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee140(anchorUid){var panelChildUid,cache,targets,block,children,_iterator38,_step38,child,_iterator39,_step39,uid,_args141=arguments,_t126,_t127,_t128,_t129;return _regenerator().w(function(_context141){while(1)switch(_context141.p=_context141.n){case 0:panelChildUid=_args141.length>1&&_args141[1]!==undefined?_args141[1]:null;cache=_args141.length>2&&_args141[2]!==undefined?_args141[2]:null;targets=new Set(todayInlineChildUids);if(!anchorUid){_context141.n=9;break;}_context141.n=1;return getBlockCached(anchorUid,cache);case 1:block=_context141.v;children=Array.isArray(block===null||block===void 0?void 0:block.children)?block.children:[];_iterator38=_createForOfIteratorHelper(children);_context141.p=2;_iterator38.s();case 3:if((_step38=_iterator38.n()).done){_context141.n=6;break;}child=_step38.value;if(!(panelChildUid&&(child===null||child===void 0?void 0:child.uid)===panelChildUid)){_context141.n=4;break;}return _context141.a(3,5);case 4:if(child!==null&&child!==void 0&&child.uid)targets.add(child.uid);case 5:_context141.n=3;break;case 6:_context141.n=8;break;case 7:_context141.p=7;_t126=_context141.v;_iterator38.e(_t126);case 8:_context141.p=8;_iterator38.f();return _context141.f(8);case 9:_iterator39=_createForOfIteratorHelper(targets);_context141.p=10;_iterator39.s();case 11:if((_step39=_iterator39.n()).done){_context141.n=20;break;}uid=_step39.value;_context141.p=12;_context141.n=13;return deleteBlock(uid);case 13:_context141.n=18;break;case 14:_context141.p=14;_t127=_context141.v;_context141.p=15;_context141.n=16;return window.roamAlphaAPI.updateBlock({block:{uid:uid,string:\"\"}});case 16:_context141.n=18;break;case 17:_context141.p=17;_t128=_context141.v;console.warn(\"[BetterTasks] failed to clear Today widget child\",_t127);case 18:_context141.p=18;todayInlineChildUids[\"delete\"](uid);return _context141.f(18);case 19:_context141.n=11;break;case 20:_context141.n=22;break;case 21:_context141.p=21;_t129=_context141.v;_iterator39.e(_t129);case 22:_context141.p=22;_iterator39.f();return _context141.f(22);case 23:return _context141.a(2);}},_callee140,null,[[15,17],[12,14,18,19],[10,21,22,23],[2,7,8,9]]);}));return _clearTodayInlineChildren.apply(this,arguments);}function findBlockHost(_x190){return _findBlockHost.apply(this,arguments);}function _findBlockHost(){_findBlockHost=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee141(uid){var attempts,delayMs,i,host,inputNode,_args142=arguments;return _regenerator().w(function(_context142){while(1)switch(_context142.n){case 0:attempts=_args142.length>1&&_args142[1]!==undefined?_args142[1]:120;delayMs=_args142.length>2&&_args142[2]!==undefined?_args142[2]:120;if(!(!uid||typeof document===\"undefined\")){_context142.n=1;break;}return _context142.a(2,null);case 1:i=0;case 2:if(!(i<attempts)){_context142.n=5;break;}host=document.querySelector(\".rm-sidebar-window [data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-sidebar-window [block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-sidebar-window [data-block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-sidebar-outline [data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-sidebar-outline [block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-sidebar-outline [data-block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-block-main[data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".roam-block[data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-block__self[data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\"div[block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\"[data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".roam-block-container[data-block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".block-outline[block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".block-outline[data-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\"[data-block-uid=\\\"\".concat(uid,\"\\\"]\"))||document.querySelector(\".rm-reference-item[data-link-uid=\\\"\".concat(uid,\"\\\"]\"));if(!host){inputNode=document.querySelector(\"div[id^=\\\"block-input-\".concat(uid,\"\\\"]\"))||document.querySelector(\"div[id$=\\\"-\".concat(uid,\"\\\"]\"));if(inputNode){host=inputNode.closest(\".roam-block-container\")||inputNode.closest(\".rm-block-main\")||inputNode.closest(\".rm-block__self\");}}if(!host){_context142.n=3;break;}return _context142.a(2,host);case 3:_context142.n=4;return delay(delayMs);case 4:i++;_context142.n=2;break;case 5:return _context142.a(2,null);}},_callee141);}));return _findBlockHost.apply(this,arguments);}function getTodayPanelContainer(_x191){return _getTodayPanelContainer.apply(this,arguments);}function _getTodayPanelContainer(){_getTodayPanelContainer=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee142(blockUid){var _host$querySelector5,_host$querySelector6,_host$querySelector7,_mountPoint$querySele;var opts,attempts,delayMs,host,children,mountPoint,container,_args143=arguments;return _regenerator().w(function(_context143){while(1)switch(_context143.n){case 0:opts=_args143.length>1&&_args143[1]!==undefined?_args143[1]:{};if(!(!blockUid||typeof document===\"undefined\")){_context143.n=1;break;}return _context143.a(2,null);case 1:attempts=typeof opts.attempts===\"number\"?opts.attempts:60;delayMs=typeof opts.delayMs===\"number\"?opts.delayMs:120;_context143.n=2;return findBlockHost(blockUid,attempts,delayMs);case 2:host=_context143.v;if(host){_context143.n=3;break;}return _context143.a(2,null);case 3:host.classList.add(\"bt-today-panel-block\");// Prefer to render inside the children area so the panel has full width and normal block spacing.\nchildren=((_host$querySelector5=host.querySelector)===null||_host$querySelector5===void 0?void 0:_host$querySelector5.call(host,\".rm-block-children\"))||((_host$querySelector6=host.querySelector)===null||_host$querySelector6===void 0?void 0:_host$querySelector6.call(host,\".rm-block__children\"))||((_host$querySelector7=host.querySelector)===null||_host$querySelector7===void 0?void 0:_host$querySelector7.call(host,\".rm-children\"))||null;mountPoint=children||host;container=(_mountPoint$querySele=mountPoint.querySelector)===null||_mountPoint$querySele===void 0?void 0:_mountPoint$querySele.call(mountPoint,\".bt-today-panel-root\");if(container){_context143.n=6;break;}container=document.createElement(\"div\");container.className=\"bt-today-panel-root\";if(!mountPoint.appendChild){_context143.n=4;break;}mountPoint.appendChild(container);_context143.n=6;break;case 4:if(!mountPoint.insertBefore){_context143.n=5;break;}mountPoint.insertBefore(container,mountPoint.firstChild||null);_context143.n=6;break;case 5:return _context143.a(2,null);case 6:return _context143.a(2,container);}},_callee142);}));return _getTodayPanelContainer.apply(this,arguments);}function teardownTodayPanel(){return _teardownTodayPanel.apply(this,arguments);}function _teardownTodayPanel(){_teardownTodayPanel=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee143(){var _todayWidgetPanelCont;var _todayWidgetPanelRoot,_todayWidgetPanelRoot2;return _regenerator().w(function(_context144){while(1)switch(_context144.n){case 0:if(todayWidgetPanelRoot){try{(_todayWidgetPanelRoot=(_todayWidgetPanelRoot2=todayWidgetPanelRoot).unmount)===null||_todayWidgetPanelRoot===void 0||_todayWidgetPanelRoot.call(_todayWidgetPanelRoot2);}catch(_){}todayWidgetPanelRoot=null;}if((_todayWidgetPanelCont=todayWidgetPanelContainer)!==null&&_todayWidgetPanelCont!==void 0&&_todayWidgetPanelCont.parentNode){todayWidgetPanelContainer.parentNode.removeChild(todayWidgetPanelContainer);}todayWidgetPanelContainer=null;case 1:return _context144.a(2);}},_callee143);}));return _teardownTodayPanel.apply(this,arguments);}teardownTodayPanelGlobal=teardownTodayPanel;function renderTodayInline(_x192,_x193){return _renderTodayInline.apply(this,arguments);}function _renderTodayInline(){_renderTodayInline=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee145(anchorUid,sections){var options,layoutSignature,cache,perfInline,lang,todayStrings,signatureParts,pushSection,signature,isEmpty,emptyText,emptyUid,order,trackUid,writeSection,label,_args146=arguments;return _regenerator().w(function(_context146){while(1)switch(_context146.p=_context146.n){case 0:options=_args146.length>2&&_args146[2]!==undefined?_args146[2]:{};layoutSignature=_args146.length>3&&_args146[3]!==undefined?_args146[3]:\"\";cache=_args146.length>4&&_args146[4]!==undefined?_args146[4]:null;if(!todayInlineRenderInFlight){_context146.n=1;break;}scheduleTodayWidgetRender(120,true);return _context146.a(2);case 1:todayInlineRenderInFlight=true;_context146.p=2;if(anchorUid){_context146.n=3;break;}return _context146.a(2);case 3:perfInline=perfMark(\"renderTodayInline\");_context146.n=4;return teardownTodayPanel();case 4:lang=getLanguageSetting();todayStrings=t([\"today\"],lang)||{};signatureParts=[];pushSection=function pushSection(arr){return signatureParts.push.apply(signatureParts,_toConsumableArray((arr||[]).map(function(t){return\"\".concat(t.uid,\":\").concat(t.isCompleted?\"done\":\"todo\");})));};pushSection(sections.startingToday);pushSection(sections.deferredToToday);pushSection(sections.dueToday);if(options.includeOverdue)pushSection(sections.overdue);signature=\"\".concat(layoutSignature,\"|\").concat(signatureParts.join(\"|\"));if(!(signature&&signature===lastTodayInlineSignature)){_context146.n=5;break;}return _context146.a(2);case 5:isEmpty=!sections.startingToday.length&&!sections.deferredToToday.length&&!sections.dueToday.length&&!sections.overdue.length;if(!isEmpty){_context146.n=8;break;}emptyText=String(t([\"today\",\"empty\"],lang)||todayStrings.empty||\"All clear for today. Enjoy your day!\").trim();_context146.n=6;return clearTodayInlineChildren(anchorUid,null,cache);case 6:todayInlineChildUids.clear();emptyUid=window.roamAlphaAPI.util.generateUID();_context146.n=7;return createBlock(anchorUid,0,emptyText,emptyUid);case 7:todayInlineChildUids.add(emptyUid);lastTodayInlineSignature=\"\".concat(layoutSignature,\"|empty\");lastTodayRenderAt=Date.now();return _context146.a(2);case 8:_context146.n=9;return clearTodayInlineChildren(anchorUid,null,cache);case 9:lastTodayInlineSignature=signature;todayInlineChildUids.clear();order=0;trackUid=function trackUid(uid){if(uid)todayInlineChildUids.add(uid);};writeSection=/*#__PURE__*/function(){var _ref51=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee144(label,tasks){var sectionUid,childOrder,_iterator40,_step40,task,childUid,_t130;return _regenerator().w(function(_context145){while(1)switch(_context145.p=_context145.n){case 0:if(tasks!==null&&tasks!==void 0&&tasks.length){_context145.n=1;break;}return _context145.a(2);case 1:sectionUid=window.roamAlphaAPI.util.generateUID();_context145.n=2;return createBlock(anchorUid,order++,\"**\".concat(label,\"**\"),sectionUid);case 2:trackUid(sectionUid);childOrder=0;_iterator40=_createForOfIteratorHelper(tasks);_context145.p=3;_iterator40.s();case 4:if((_step40=_iterator40.n()).done){_context145.n=7;break;}task=_step40.value;childUid=window.roamAlphaAPI.util.generateUID();_context145.n=5;return createBlock(sectionUid,childOrder++,\"((\".concat(task.uid,\"))\"),childUid);case 5:trackUid(childUid);case 6:_context145.n=4;break;case 7:_context145.n=9;break;case 8:_context145.p=8;_t130=_context145.v;_iterator40.e(_t130);case 9:_context145.p=9;_iterator40.f();return _context145.f(9);case 10:return _context145.a(2);}},_callee144,null,[[3,8,9,10]]);}));return function writeSection(_x208,_x209){return _ref51.apply(this,arguments);};}();_context146.n=10;return writeSection(todayStrings.starting||\"Starting Today\",sections.startingToday);case 10:_context146.n=11;return writeSection(todayStrings.deferred||\"Deferred Until Today\",sections.deferredToToday);case 11:_context146.n=12;return writeSection(todayStrings.due||\"Due Today\",sections.dueToday);case 12:if(!options.includeOverdue){_context146.n=13;break;}label=typeof todayStrings.overdue===\"function\"?todayStrings.overdue(sections.overdue.length):\"Overdue (\".concat(sections.overdue.length,\")\");_context146.n=13;return writeSection(label,sections.overdue);case 13:perfLog(perfInline,\"totalBlocks=\".concat(order));lastTodayRenderAt=Date.now();case 14:_context146.p=14;todayInlineRenderInFlight=false;return _context146.f(14);case 15:return _context146.a(2);}},_callee145,null,[[2,,14,15]]);}));return _renderTodayInline.apply(this,arguments);}function renderTodayBadge(){return _renderTodayBadge.apply(this,arguments);}function _renderTodayBadge(){_renderTodayBadge=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee146(){var force,_activeDashboardContr98,_activeDashboardContr99,_readTodayConfig,widgetOverdue,includeOverdue,attachWatches,cacheKey,tasks,sections,count,labelText,colors,signature,needsDom,_args147=arguments,_t131;return _regenerator().w(function(_context147){while(1)switch(_context147.p=_context147.n){case 0:force=_args147.length>0&&_args147[0]!==undefined?_args147[0]:false;if(getTodayBadgeEnabled()){_context147.n=1;break;}return _context147.a(2);case 1:_context147.p=1;_readTodayConfig=readTodayConfig(),widgetOverdue=_readTodayConfig.includeOverdue;includeOverdue=getTodayBadgeIncludeOverdue();attachWatches=((_activeDashboardContr98=activeDashboardController)===null||_activeDashboardContr98===void 0||(_activeDashboardContr99=_activeDashboardContr98.isOpen)===null||_activeDashboardContr99===void 0?void 0:_activeDashboardContr99.call(_activeDashboardContr98))||false;cacheKey=\"badge:\".concat(includeOverdue?\"withOverdue\":\"todayOnly\");_context147.n=2;return collectDashboardTasks({includeCompleted:false,attachWatches:attachWatches,cacheKey:cacheKey,bypassCache:force});case 2:tasks=_context147.v;sections=buildTodaySections(tasks,{includeOverdue:includeOverdue,showCompleted:false});count=sections.startingToday.length+sections.deferredToToday.length+sections.dueToday.length+sections.overdue.length;labelText=translateString(getTodayBadgeLabel(),getLanguageSetting())||getTodayAnchorText();colors=getTodayBadgeColors();signature=\"\".concat(includeOverdue?\"o\":\"t\",\"|\").concat(labelText,\"|\").concat(colors.bg||\"\",\"|\").concat(colors.fg||\"\",\"|\").concat(count);needsDom=!todayBadgeNode||!todayBadgeNode.parentNode;if(!(!force&&!needsDom&&signature===lastTodayBadgeSignature)){_context147.n=3;break;}return _context147.a(2);case 3:ensureTodayBadgeDom(count,{labelText:labelText,colors:colors});lastTodayBadgeSignature=signature;_context147.n=5;break;case 4:_context147.p=4;_t131=_context147.v;console.warn(\"[BetterTasks] renderTodayBadge failed\",_t131);case 5:return _context147.a(2);}},_callee146,null,[[1,4]]);}));return _renderTodayBadge.apply(this,arguments);}function ensureTodayBadgeDom(){var count=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(typeof document===\"undefined\")return;var sidebar=document.querySelector(\".roam-sidebar-content .roam-sidebar-container\")||document.querySelector(\".roam-sidebar-content\");var daily=document.querySelector(\".rm-left-sidebar__daily-notes, .log-button.rm-left-sidebar__daily-notes\");if(!sidebar||!daily)return;// Remove any stray copies we created earlier.\ndocument.querySelectorAll(\".bt-today-badge\").forEach(function(node){if(node!==todayBadgeNode&&node.parentNode)node.parentNode.removeChild(node);});if(!todayBadgeNode){var container=document.createElement(\"div\");container.className=\"log-button bt-today-badge\";var icon=document.createElement(\"span\");icon.className=\"bp3-icon bp3-icon-small bp3-icon-time bt-today-badge__icon\";var label=document.createElement(\"span\");label.className=\"bt-today-badge__label\";var badge=document.createElement(\"span\");badge.className=\"bt-today-badge__count\";container.appendChild(icon);container.appendChild(label);container.appendChild(badge);container.addEventListener(\"click\",/*#__PURE__*/function(){var _ref36=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee30(e){var anchorUid,widgetEnabled,_window$roamAlphaAPI19,_window$roamAlphaAPI20,_yield$getTodayParent,dnpUid,_window$roamAlphaAPI21,_window$roamAlphaAPI22,_t33,_t34;return _regenerator().w(function(_context30){while(1)switch(_context30.p=_context30.n){case 0:e.preventDefault();_context30.p=1;_t33=lastTodayAnchorUid;if(_t33){_context30.n=3;break;}_context30.n=2;return ensureTodayWidgetAnchor(getTodayWidgetPlacement(),getTodayWidgetHeadingLevel(),null,{allowMoves:true});case 2:_t33=_context30.v;case 3:anchorUid=_t33;widgetEnabled=getTodayWidgetEnabled();if(!(widgetEnabled&&anchorUid)){_context30.n=5;break;}(_window$roamAlphaAPI19=window.roamAlphaAPI)===null||_window$roamAlphaAPI19===void 0||(_window$roamAlphaAPI19=_window$roamAlphaAPI19.ui)===null||_window$roamAlphaAPI19===void 0||(_window$roamAlphaAPI19=_window$roamAlphaAPI19.mainWindow)===null||_window$roamAlphaAPI19===void 0||(_window$roamAlphaAPI20=_window$roamAlphaAPI19.openBlock)===null||_window$roamAlphaAPI20===void 0||_window$roamAlphaAPI20.call(_window$roamAlphaAPI19,{block:{uid:anchorUid}});_context30.n=4;return renderTodayWidget(true);case 4:_context30.n=7;break;case 5:_context30.n=6;return getTodayParentInfo();case 6:_yield$getTodayParent=_context30.v;dnpUid=_yield$getTodayParent.dnpUid;if(dnpUid){(_window$roamAlphaAPI21=window.roamAlphaAPI)===null||_window$roamAlphaAPI21===void 0||(_window$roamAlphaAPI21=_window$roamAlphaAPI21.ui)===null||_window$roamAlphaAPI21===void 0||(_window$roamAlphaAPI21=_window$roamAlphaAPI21.mainWindow)===null||_window$roamAlphaAPI21===void 0||(_window$roamAlphaAPI22=_window$roamAlphaAPI21.openPage)===null||_window$roamAlphaAPI22===void 0||_window$roamAlphaAPI22.call(_window$roamAlphaAPI21,{page:{uid:dnpUid}});}case 7:_context30.n=9;break;case 8:_context30.p=8;_t34=_context30.v;console.warn(\"[BetterTasks] today badge open failed\",_t34);case 9:return _context30.a(2);}},_callee30,null,[[1,8]]);}));return function(_x194){return _ref36.apply(this,arguments);};}());todayBadgeNode=container;todayBadgeLabelNode=label;todayBadgeCountNode=badge;}var labelText=opts.labelText||translateString(getTodayBadgeLabel(),getLanguageSetting())||getTodayAnchorText();todayBadgeLabelNode.textContent=labelText;todayBadgeCountNode.textContent=String(count);todayBadgeCountNode.style.display=count>0?\"inline-flex\":\"none\";var colors=opts.colors||getTodayBadgeColors();todayBadgeCountNode.style.backgroundColor=colors.bg||\"\";todayBadgeCountNode.style.color=colors.fg||\"\";if(!todayBadgeNode.parentNode){var _daily$parentNode;(_daily$parentNode=daily.parentNode)===null||_daily$parentNode===void 0||_daily$parentNode.insertBefore(todayBadgeNode,daily.nextSibling);}}function renderTodayPanelDom(_x195,_x196){return _renderTodayPanelDom.apply(this,arguments);}function _renderTodayPanelDom(){_renderTodayPanelDom=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee150(container,sections){var options,layoutSignature,perfPanel,hasAny,signatureParts,pushSection,signature,lang,todayStrings,empty,renderSection,label,_args151=arguments;return _regenerator().w(function(_context151){while(1)switch(_context151.n){case 0:options=_args151.length>2&&_args151[2]!==undefined?_args151[2]:{};layoutSignature=_args151.length>3&&_args151[3]!==undefined?_args151[3]:\"\";if(!(!container||typeof container.appendChild!==\"function\")){_context151.n=1;break;}return _context151.a(2);case 1:perfPanel=perfMark(\"renderTodayPanelDom\");ensureTodayPanelStyles();container.style.display=\"block\";hasAny=sections.startingToday.length||sections.deferredToToday.length||sections.dueToday.length||options.includeOverdue&&sections.overdue.length;signatureParts=[];pushSection=function pushSection(arr){return signatureParts.push.apply(signatureParts,_toConsumableArray((arr||[]).map(function(t){return\"\".concat(t.uid,\":\").concat(t.isCompleted?\"done\":\"todo\");})));};pushSection(sections.startingToday);pushSection(sections.deferredToToday);pushSection(sections.dueToday);if(options.includeOverdue)pushSection(sections.overdue);signature=\"\".concat(layoutSignature,\"|\").concat(signatureParts.join(\"|\"));lastTodayWidgetSignature=signature;container.innerHTML=\"\";lang=getLanguageSetting();todayStrings=t([\"today\"],lang)||{};if(hasAny){_context151.n=2;break;}empty=document.createElement(\"div\");empty.textContent=todayStrings.empty||\"No tasks for today.\";empty.className=\"bt-today-panel__empty\";container.appendChild(empty);return _context151.a(2);case 2:renderSection=function renderSection(label,tasks,highlight){if(!(tasks!==null&&tasks!==void 0&&tasks.length))return;var section=document.createElement(\"div\");section.className=\"bt-today-panel__section\";var h=document.createElement(\"div\");h.className=\"bt-today-panel__section-header\";if(highlight===\"due\")h.classList.add(\"bt-today-panel__section-header--due\");if(highlight===\"overdue\")h.classList.add(\"bt-today-panel__section-header--overdue\");h.textContent=label;section.appendChild(h);var list=document.createElement(\"ul\");list.className=\"bt-today-panel__list\";var _iterator41=_createForOfIteratorHelper(tasks),_step41;try{var _loop4=function _loop4(){var task=_step41.value;var li=document.createElement(\"li\");li.className=\"bt-today-panel__item\";if(task.isCompleted)li.classList.add(\"bt-today-panel__item--completed\");var row=document.createElement(\"div\");row.className=\"bt-today-panel__row\";var titleBtn=document.createElement(\"button\");titleBtn.type=\"button\";titleBtn.className=\"bt-today-panel__row-title\";titleBtn.textContent=task.title||todayStrings.untitled||\"(Untitled)\";titleBtn.addEventListener(\"click\",function(e){var _activeDashboardContr100;var openInSidebar=!!(e!==null&&e!==void 0&&e.shiftKey);if(openInSidebar){try{var _window$roamAlphaAPI29,_window$roamAlphaAPI30;(_window$roamAlphaAPI29=window.roamAlphaAPI)===null||_window$roamAlphaAPI29===void 0||(_window$roamAlphaAPI29=_window$roamAlphaAPI29.ui)===null||_window$roamAlphaAPI29===void 0||(_window$roamAlphaAPI29=_window$roamAlphaAPI29.rightSidebar)===null||_window$roamAlphaAPI29===void 0||(_window$roamAlphaAPI30=_window$roamAlphaAPI29.addWindow)===null||_window$roamAlphaAPI30===void 0||_window$roamAlphaAPI30.call(_window$roamAlphaAPI29,{window:{type:\"block\",\"block-uid\":task.uid}});return;}catch(_){/* fall through to main open */}}if((_activeDashboardContr100=activeDashboardController)!==null&&_activeDashboardContr100!==void 0&&_activeDashboardContr100.openBlock){activeDashboardController.openBlock(task.uid);}else{try{var _window$roamAlphaAPI31,_window$roamAlphaAPI32;(_window$roamAlphaAPI31=window.roamAlphaAPI)===null||_window$roamAlphaAPI31===void 0||(_window$roamAlphaAPI31=_window$roamAlphaAPI31.ui)===null||_window$roamAlphaAPI31===void 0||(_window$roamAlphaAPI31=_window$roamAlphaAPI31.mainWindow)===null||_window$roamAlphaAPI31===void 0||(_window$roamAlphaAPI32=_window$roamAlphaAPI31.openBlock)===null||_window$roamAlphaAPI32===void 0||_window$roamAlphaAPI32.call(_window$roamAlphaAPI31,{block:{uid:task.uid}});}catch(_){}}});row.appendChild(titleBtn);if(!task.isCompleted){var actions=document.createElement(\"div\");actions.className=\"bt-today-panel__row-actions\";var doneBtn=document.createElement(\"button\");doneBtn.type=\"button\";doneBtn.className=\"bt-today-panel__icon-btn\";doneBtn.textContent=\"âœ“\";doneBtn.title=todayStrings.complete||\"Complete\";doneBtn.setAttribute(\"aria-label\",doneBtn.title);var snoozeBtn=document.createElement(\"button\");snoozeBtn.type=\"button\";snoozeBtn.className=\"bt-today-panel__icon-btn\";snoozeBtn.textContent=\"â±\";snoozeBtn.title=todayStrings.snoozeShort||\"Snooze +1d\";snoozeBtn.setAttribute(\"aria-label\",snoozeBtn.title);var snoozeWeekBtn=document.createElement(\"button\");snoozeWeekBtn.type=\"button\";snoozeWeekBtn.className=\"bt-today-panel__icon-btn\";snoozeWeekBtn.textContent=\"â±+7\";snoozeWeekBtn.title=todayStrings.snoozeWeek||\"Snooze +7d\";snoozeWeekBtn.setAttribute(\"aria-label\",snoozeWeekBtn.title);var disableActions=function disableActions(){doneBtn.disabled=true;snoozeBtn.disabled=true;snoozeWeekBtn.disabled=true;};var reenableActions=function reenableActions(){doneBtn.disabled=false;snoozeBtn.disabled=false;snoozeWeekBtn.disabled=false;};snoozeBtn.addEventListener(\"click\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee147(){var _activeDashboardContr101,_activeDashboardContr102;return _regenerator().w(function(_context148){while(1)switch(_context148.p=_context148.n){case 0:disableActions();_context148.p=1;_context148.n=2;return(_activeDashboardContr101=activeDashboardController)===null||_activeDashboardContr101===void 0||(_activeDashboardContr102=_activeDashboardContr101.snoozeTask)===null||_activeDashboardContr102===void 0?void 0:_activeDashboardContr102.call(_activeDashboardContr101,task.uid,1);case 2:_context148.p=2;scheduleTodayWidgetRender(30,true);reenableActions();return _context148.f(2);case 3:return _context148.a(2);}},_callee147,null,[[1,,2,3]]);})));snoozeWeekBtn.addEventListener(\"click\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee148(){var _activeDashboardContr103,_activeDashboardContr104;return _regenerator().w(function(_context149){while(1)switch(_context149.p=_context149.n){case 0:disableActions();_context149.p=1;_context149.n=2;return(_activeDashboardContr103=activeDashboardController)===null||_activeDashboardContr103===void 0||(_activeDashboardContr104=_activeDashboardContr103.snoozeTask)===null||_activeDashboardContr104===void 0?void 0:_activeDashboardContr104.call(_activeDashboardContr103,task.uid,7);case 2:_context149.p=2;scheduleTodayWidgetRender(30,true);reenableActions();return _context149.f(2);case 3:return _context149.a(2);}},_callee148,null,[[1,,2,3]]);})));doneBtn.addEventListener(\"click\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee149(){var _activeDashboardContr105,_activeDashboardContr106;return _regenerator().w(function(_context150){while(1)switch(_context150.p=_context150.n){case 0:disableActions();_context150.p=1;_context150.n=2;return(_activeDashboardContr105=activeDashboardController)===null||_activeDashboardContr105===void 0||(_activeDashboardContr106=_activeDashboardContr105.toggleTask)===null||_activeDashboardContr106===void 0?void 0:_activeDashboardContr106.call(_activeDashboardContr105,task.uid,\"complete\");case 2:_context150.p=2;scheduleTodayWidgetRender(30,true);reenableActions();return _context150.f(2);case 3:return _context150.a(2);}},_callee149,null,[[1,,2,3]]);})));actions.appendChild(doneBtn);actions.appendChild(snoozeBtn);actions.appendChild(snoozeWeekBtn);row.appendChild(actions);}li.appendChild(row);list.appendChild(li);};for(_iterator41.s();!(_step41=_iterator41.n()).done;){_loop4();}}catch(err){_iterator41.e(err);}finally{_iterator41.f();}section.appendChild(list);container.appendChild(section);};renderSection(todayStrings.starting||\"Starting Today\",sections.startingToday);renderSection(todayStrings.deferred||\"Deferred Until Today\",sections.deferredToToday);renderSection(todayStrings.due||\"Due Today\",sections.dueToday,\"due\");if(options.includeOverdue){label=typeof todayStrings.overdue===\"function\"?todayStrings.overdue(sections.overdue.length):\"Overdue (\".concat(sections.overdue.length,\")\");renderSection(label,sections.overdue,\"overdue\");}perfLog(perfPanel);case 3:return _context151.a(2);}},_callee150);}));return _renderTodayPanelDom.apply(this,arguments);}function renderTodayWidget(){return _renderTodayWidget.apply(this,arguments);}// ========================= Housekeeping =========================\nfunction _renderTodayWidget(){_renderTodayWidget=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee151(){var force,options,_ref55,_ref55$bypassPageGuar,bypassPageGuard,_ref55$targetUid,targetUid,_ref55$source,source,_ref55$forceInline,forceInline,_activeDashboardContr107,_activeDashboardContr108,now,MIN_INTERVAL,_dashboardTaskCache$c2,_readTodayConfig2,layout,includeOverdue,showCompleted,placement,heading,layoutSignature,perfRenderToday,perfTasks,renderCache,shouldRender,includeCompleted,tasks,dashSnapshot,shouldBypassCache,_activeDashboardContr109,_activeDashboardContr110,attachWatches,cacheKey,sections,anchorUid,isLegacyPanelLabel,anchorBlock,panelChild,perfInline,panelHost,container,_perfInline,perfPanel,_args152=arguments,_t132,_t133,_t134,_t135,_t136;return _regenerator().w(function(_context152){while(1)switch(_context152.p=_context152.n){case 0:force=_args152.length>0&&_args152[0]!==undefined?_args152[0]:false;options=_args152.length>1&&_args152[1]!==undefined?_args152[1]:{};_ref55=options||{},_ref55$bypassPageGuar=_ref55.bypassPageGuard,bypassPageGuard=_ref55$bypassPageGuar===void 0?false:_ref55$bypassPageGuar,_ref55$targetUid=_ref55.targetUid,targetUid=_ref55$targetUid===void 0?null:_ref55$targetUid,_ref55$source=_ref55.source,source=_ref55$source===void 0?\"unknown\":_ref55$source,_ref55$forceInline=_ref55.forceInline,forceInline=_ref55$forceInline===void 0?false:_ref55$forceInline;if(!(!TODAY_WIDGET_ENABLED||!getTodayWidgetEnabled())){_context152.n=1;break;}return _context152.a(2);case 1:_context152.p=1;now=Date.now();MIN_INTERVAL=1200;if(!(!force&&now-lastTodayRenderAt<MIN_INTERVAL)){_context152.n=2;break;}scheduleTodayWidgetRender(MIN_INTERVAL-(now-lastTodayRenderAt),true);return _context152.a(2);case 2:if(force)todayWidgetForceNext=true;if(force){lastTodayWidgetSignature=null;lastTodayInlineSignature=null;dashboardTaskCache===null||dashboardTaskCache===void 0||(_dashboardTaskCache$c2=dashboardTaskCache.clear)===null||_dashboardTaskCache$c2===void 0||_dashboardTaskCache$c2.call(dashboardTaskCache);}_readTodayConfig2=readTodayConfig(),layout=_readTodayConfig2.layout,includeOverdue=_readTodayConfig2.includeOverdue,showCompleted=_readTodayConfig2.showCompleted,placement=_readTodayConfig2.placement,heading=_readTodayConfig2.heading,layoutSignature=_readTodayConfig2.signature;perfRenderToday=perfMark(\"renderTodayWidget \".concat(layout));perfTasks=perfMark(\"renderTodayWidget:collectTasks\");renderCache=createTodayRenderCache();if(!bypassPageGuard){_context152.n=3;break;}_t132=true;_context152.n=5;break;case 3:_context152.n=4;return shouldRenderTodayWidgetNow(renderCache);case 4:_t132=_context152.v;case 5:shouldRender=_t132;if(!(!shouldRender&&!force)){_context152.n=6;break;}todayWidgetForceNext=true;scheduleTodayWidgetRender(320,true);return _context152.a(2);case 6:includeCompleted=!!showCompleted;tasks=null;dashSnapshot=(_activeDashboardContr107=activeDashboardController)===null||_activeDashboardContr107===void 0||(_activeDashboardContr108=_activeDashboardContr107.getSnapshot)===null||_activeDashboardContr108===void 0?void 0:_activeDashboardContr108.call(_activeDashboardContr107);shouldBypassCache=force||todayWidgetForceNext;todayWidgetForceNext=false;if(!(!shouldBypassCache&&(dashSnapshot===null||dashSnapshot===void 0?void 0:dashSnapshot.status)===\"ready\"&&Array.isArray(dashSnapshot.tasks))){_context152.n=7;break;}tasks=dashSnapshot.tasks.slice();_context152.n=9;break;case 7:attachWatches=((_activeDashboardContr109=activeDashboardController)===null||_activeDashboardContr109===void 0||(_activeDashboardContr110=_activeDashboardContr109.isOpen)===null||_activeDashboardContr110===void 0?void 0:_activeDashboardContr110.call(_activeDashboardContr109))||false;cacheKey=\"today:\".concat(includeCompleted?\"withDone\":\"noDone\");_context152.n=8;return collectDashboardTasks({includeCompleted:includeCompleted,attachWatches:attachWatches,cacheKey:cacheKey,bypassCache:shouldBypassCache});case 8:tasks=_context152.v;case 9:if(!includeCompleted&&Array.isArray(tasks)){tasks=tasks.filter(function(t){return!(t!==null&&t!==void 0&&t.isCompleted);});}perfLog(perfTasks,\"tasks=\".concat(Array.isArray(tasks)?tasks.length:0));if(Array.isArray(tasks)){_context152.n=10;break;}return _context152.a(2);case 10:sections=buildTodaySections(tasks,{includeOverdue:includeOverdue,showCompleted:showCompleted});perfLog(perfMark(\"renderTodayWidget:sections\"),\"\");scheduleTodayBadgeRefresh(10,true);_t133=targetUid;if(_t133){_context152.n=12;break;}_context152.n=11;return ensureTodayWidgetAnchor(placement,heading,renderCache,{allowMoves:!(options!==null&&options!==void 0&&options.bypassPageGuard)});case 11:_t133=_context152.v;case 12:anchorUid=_t133;lastTodayAnchorUid=anchorUid||null;if(anchorUid){_context152.n=13;break;}return _context152.a(2);case 13:_context152.p=13;_context152.n=14;return window.roamAlphaAPI.updateBlock({block:{uid:anchorUid,open:true}});case 14:_context152.n=16;break;case 15:_context152.p=15;_t134=_context152.v;case 16:isLegacyPanelLabel=function isLegacyPanelLabel(){var str=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";var trimmed=str.trim();if(trimmed===TODAY_WIDGET_PANEL_CHILD_TEXT)return true;return TODAY_WIDGET_PANEL_CHILD_TEXT_LEGACY.some(function(legacy){return trimmed===legacy;});};if(!(layout===\"roamInline\"||forceInline)){_context152.n=23;break;}_context152.p=17;_context152.n=18;return getBlockCached(anchorUid,renderCache);case 18:anchorBlock=_context152.v;panelChild=((anchorBlock===null||anchorBlock===void 0?void 0:anchorBlock.children)||[]).find(function(c){return isLegacyPanelLabel((c===null||c===void 0?void 0:c.string)||\"\");});if(!(panelChild!==null&&panelChild!==void 0&&panelChild.uid)){_context152.n=19;break;}_context152.n=19;return deleteBlock(panelChild.uid);case 19:_context152.n=21;break;case 20:_context152.p=20;_t135=_context152.v;case 21:perfInline=perfMark(\"renderTodayWidget:inline\");_context152.n=22;return renderTodayInline(anchorUid,sections,{includeOverdue:includeOverdue},layoutSignature,renderCache);case 22:perfLog(perfInline);perfLog(perfRenderToday);return _context152.a(2);case 23:_context152.n=24;return clearTodayInlineChildren(anchorUid,null,renderCache);case 24:_context152.n=25;return findBlockHost(anchorUid);case 25:panelHost=_context152.v;panelHost===null||panelHost===void 0||panelHost.classList.add(\"bt-today-panel-block\");panelHost===null||panelHost===void 0||panelHost.classList.remove(\"bt-today-panel-inline-hidden\");_context152.n=26;return getTodayPanelContainer(anchorUid,{attempts:options!==null&&options!==void 0&&options.bypassPageGuard?60:60,delayMs:options!==null&&options!==void 0&&options.bypassPageGuard?120:120});case 26:container=_context152.v;if(container){_context152.n=29;break;}if(!(options!==null&&options!==void 0&&options.forceInline||options!==null&&options!==void 0&&options.bypassPageGuard)){_context152.n=28;break;}// Fallback to inline render inside the anchor when panel mount is unavailable (e.g., sidebar focus quirks).\n_perfInline=perfMark(\"renderTodayWidget:inline-fallback\");_context152.n=27;return renderTodayInline(anchorUid,sections,{includeOverdue:includeOverdue},layoutSignature,renderCache);case 27:perfLog(_perfInline);perfLog(perfRenderToday);lastTodayRenderAt=Date.now();return _context152.a(2);case 28:scheduleTodayWidgetRender(400,true);return _context152.a(2);case 29:todayWidgetPanelContainer=container;perfPanel=perfMark(\"renderTodayWidget:panel\");renderTodayPanelDom(container,sections,{includeOverdue:includeOverdue},layoutSignature);perfLog(perfPanel);perfLog(perfRenderToday);lastTodayRenderAt=Date.now();_context152.n=31;break;case 30:_context152.p=30;_t136=_context152.v;console.warn(\"[BetterTasks] renderTodayWidget failed\",_t136);case 31:return _context152.a(2);}},_callee151,null,[[17,20],[13,15],[1,30]]);}));return _renderTodayWidget.apply(this,arguments);}function sweepProcessed(){var now=Date.now();if(now-lastSweep<60000)return;// once per minute\nlastSweep=now;var _iterator23=_createForOfIteratorHelper(processedMap),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var _step23$value=_slicedToArray(_step23.value,2),k=_step23$value[0],v=_step23$value[1];if(now-v>5*60000)processedMap[\"delete\"](k);// 5 min TTL\n}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}}function sortDashboardTasksList(tasks){var bucketWeight={overdue:0,today:1,upcoming:2,none:3};return tasks.slice().sort(function(a,b){var _bucketWeight$a$dueBu,_bucketWeight$b$dueBu;var bucketDiff=((_bucketWeight$a$dueBu=bucketWeight[a.dueBucket])!==null&&_bucketWeight$a$dueBu!==void 0?_bucketWeight$a$dueBu:99)-((_bucketWeight$b$dueBu=bucketWeight[b.dueBucket])!==null&&_bucketWeight$b$dueBu!==void 0?_bucketWeight$b$dueBu:99);if(bucketDiff!==0)return bucketDiff;var dueA=a.dueAt?a.dueAt.getTime():Number.MAX_SAFE_INTEGER;var dueB=b.dueAt?b.dueAt.getTime():Number.MAX_SAFE_INTEGER;if(dueA!==dueB)return dueA-dueB;return(a.title||\"\").localeCompare(b.title||\"\");});}},onunload:function(){var _onunload=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee152(){var _window$roamAlphaAPI33;var _window$__RecurringTa2,_window2,slashCommandAPI,_detachTodayNavigatio,_activeDashboardContr111,_activeDashboardContr112,_t137,_t138;return _regenerator().w(function(_context153){while(1)switch(_context153.p=_context153.n){case 0:if(typeof window!==\"undefined\"){try{(_window$__RecurringTa2=(_window2=window).__RecurringTasksCleanup)===null||_window$__RecurringTa2===void 0||_window$__RecurringTa2.call(_window2);}finally{delete window.__RecurringTasksCleanup;}}slashCommandAPI=(_window$roamAlphaAPI33=window.roamAlphaAPI)===null||_window$roamAlphaAPI33===void 0||(_window$roamAlphaAPI33=_window$roamAlphaAPI33.ui)===null||_window$roamAlphaAPI33===void 0?void 0:_window$roamAlphaAPI33.slashCommand;slashCommandAPI===null||slashCommandAPI===void 0||slashCommandAPI.removeCommand({label:\"Create a Better Task\"});slashCommandAPI===null||slashCommandAPI===void 0||slashCommandAPI.removeCommand({label:\"Convert TODO to Better Task\"});removeDashboardTopbarButton();disconnectTopbarObserver();clearDashboardWatches();if(todayWidgetRenderTimer)clearTimeout(todayWidgetRenderTimer);todayWidgetRenderTimer=null;if(todayWidgetRefreshTimer)clearTimeout(todayWidgetRefreshTimer);todayWidgetRefreshTimer=null;todayWidgetRefreshForcePending=false;if(dashboardNotifyTimer)clearTimeout(dashboardNotifyTimer);dashboardNotifyTimer=null;if(dashboardRefreshTimer){clearInterval(dashboardRefreshTimer);if(window.__btDebugRefreshTimer){console.debug(\"[BetterTasks] dashboard refresh timer cleared\");}}dashboardRefreshTimer=null;if(completionQueueTimer){clearTimeout(completionQueueTimer);completionQueueTimer=null;}if(pillRefreshTimer){clearTimeout(pillRefreshTimer);pillRefreshTimer=null;}if(todayTitleChangeDebounceTimer){clearTimeout(todayTitleChangeDebounceTimer);todayTitleChangeDebounceTimer=null;}if(childEditDebounce&&typeof childEditDebounce.forEach===\"function\"){childEditDebounce.forEach(function(timer){return clearTimeout(timer);});childEditDebounce.clear();}if(bulkOperationCooldownTimer){clearTimeout(bulkOperationCooldownTimer);bulkOperationCooldownTimer=null;}dashboardNotifyQueue.clear();try{(_detachTodayNavigatio=detachTodayNavigationListenerGlobal)===null||_detachTodayNavigatio===void 0||_detachTodayNavigatio();}catch(_){// ignore\n}finally{detachTodayNavigationListenerGlobal=null;}_context153.p=1;_context153.n=2;return disableTodayWidgetUI();case 2:_context153.n=4;break;case 3:_context153.p=3;_t137=_context153.v;case 4:removeTodayBadge();_context153.p=5;todayInlineChildUids.clear();lastTodayAnchorUid=null;lastTodayAnchorIsHeading=false;_context153.n=6;return removeAllTodayAnchorsByQuery({includeHeading:true});case 6:_context153.n=8;break;case 7:_context153.p=7;_t138=_context153.v;case 8:if(!(typeof teardownTodayPanelGlobal===\"function\")){_context153.n=9;break;}_context153.n=9;return teardownTodayPanelGlobal();case 9:if(activeDashboardController){try{(_activeDashboardContr111=(_activeDashboardContr112=activeDashboardController).dispose)===null||_activeDashboardContr111===void 0||_activeDashboardContr111.call(_activeDashboardContr112);}catch(_){// ignore dispose errors\n}activeDashboardController=null;}window.roamAlphaAPI.ui.blockContextMenu.removeCommand({label:\"Convert TODO to Better Task\"});window.roamAlphaAPI.ui.blockContextMenu.removeCommand({label:\"Create a Better Task\"});// window.roamAlphaAPI.ui.blockContextMenu.removeCommand({label: \"Convert Better Task to plain TODO\",});\ndisconnectThemeObserver();if(pillScrollHandlerAttached&&pillScrollHandler&&typeof document!==\"undefined\"){try{document.removeEventListener(\"scroll\",pillScrollHandler,{passive:true,capture:true});}catch(_){// ignore detach errors\n}finally{pillScrollHandlerAttached=false;pillScrollHandler=null;}}case 10:return _context153.a(2);}},_callee152,null,[[5,7],[1,3]]);}));function onunload(){return _onunload.apply(this,arguments);}return onunload;}()});function ordFromText(value){var _ORD_MAP$value$toLowe;if(!value)return null;var numeric=Number(value.replace(/(st|nd|rd|th)$/i,\"\"));if(!Number.isNaN(numeric)&&numeric>=1&&numeric<=31)return numeric;return(_ORD_MAP$value$toLowe=ORD_MAP[value.toLowerCase()])!==null&&_ORD_MAP$value$toLowe!==void 0?_ORD_MAP$value$toLowe:null;}function dowFromAlias(token){if(!token)return null;var norm=(DOW_ALIASES[token.toLowerCase()]||token).toLowerCase();return DOW_MAP[norm]||null;}function tGlobal(path){var lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:currentLanguage||\"en\";var parts=Array.isArray(path)?path:String(path||\"\").split(\".\");var resolve=function resolve(obj){return parts.reduce(function(acc,key){return acc&&Object.prototype.hasOwnProperty.call(acc,key)?acc[key]:undefined;},obj);};var primary=resolve(_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===null||_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===void 0?void 0:_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n[lang]);if(primary!==undefined)return primary;if(lang!==\"en\"){var fallback=resolve(_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===null||_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n===void 0?void 0:_i18n__WEBPACK_IMPORTED_MODULE_2__.i18n.en);if(fallback!==undefined)return fallback;}return undefined;}function debugLog(message,err){if(typeof window!==\"undefined\"&&window.__btDebug){if(err)console.debug(\"[BetterTasks]\",message,err);else console.debug(\"[BetterTasks]\",message);return;}if(!DEBUG_BT)return;if(err)console.debug(\"[BetterTasks]\",message,err);else console.debug(\"[BetterTasks]\",message);}function perfMark(label){if(!DEBUG_BT_PERF||typeof performance===\"undefined\")return null;return{label:label,t:performance.now()};}function perfLog(mark){var extra=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";if(!DEBUG_BT_PERF||!mark||typeof performance===\"undefined\")return;var delta=performance.now()-mark.t;var suffix=extra?\" \".concat(extra):\"\";console.log(\"[BetterTasks][perf] \".concat(mark.label,\": \").concat(delta.toFixed(1),\"ms\").concat(suffix));}function normalizeWeekStartCode(value){if(typeof value===\"string\"){var code=dowFromAlias(value);if(code)return code;}if(typeof value===\"string\"&&DOW_ORDER.includes(value.toUpperCase())){return value.toUpperCase();}return DEFAULT_WEEK_START_CODE;}function getDowOrderForWeekStart(weekStartCode){var code=weekStartCode&&DOW_ORDER.includes(weekStartCode)?weekStartCode:DEFAULT_WEEK_START_CODE;var idx=DOW_ORDER.indexOf(code);if(idx<=0)return DOW_ORDER;return[].concat(_toConsumableArray(DOW_ORDER.slice(idx)),_toConsumableArray(DOW_ORDER.slice(0,idx)));}function getOrderedWeekdayOffsets(byDay,weekStartCode){var order=getDowOrderForWeekStart(weekStartCode);var seen=new Set();var offsets=[];var _iterator42=_createForOfIteratorHelper(Array.isArray(byDay)?byDay:[]),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var code=_step42.value;if(typeof code!==\"string\")continue;var idx=order.indexOf(code);if(idx===-1||seen.has(code))continue;seen.add(code);offsets.push(idx);}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}offsets.sort(function(a,b){return a-b;});return offsets;}function monthFromText(x){if(!x)return null;var m=MONTH_MAP[x.toLowerCase()];return m||null;}function expandDowRange(startISO,endISO){var dowOrder=arguments.length>2&&arguments[2]!==undefined?arguments[2]:DOW_ORDER;var s=dowOrder.indexOf(startISO),e=dowOrder.indexOf(endISO);if(s===-1||e===-1)return[];if(s<=e)return dowOrder.slice(s,e+1);return[].concat(_toConsumableArray(dowOrder.slice(s)),_toConsumableArray(dowOrder.slice(0,e+1)));// wrap\n}function splitList(str){return str.replace(/&/g,\",\").replace(/\\band\\b/gi,\",\").split(/[,\\s/]+/).filter(Boolean);}function createRootCompat(container){if(!container)throw new Error(\"Container required for dashboard\");// Prefer global ReactDOM.createRoot if available (React 18); otherwise skip straight to legacy render.\nvar createRootFn=ReactDOMGlobal&&typeof ReactDOMGlobal.createRoot===\"function\"?ReactDOMGlobal.createRoot:null;if(createRootFn){try{return createRootFn(container);}catch(err){console.warn(\"[BetterTasks] createRoot failed, falling back to legacy render\",err);}}var dom=ReactDOMGlobal;if(!dom)throw new Error(\"ReactDOM not available in this environment\");return{render:function render(node){return dom.render(node,container);},unmount:function unmount(){return dom.unmountComponentAtNode(container);}};}// Recognize MWF / TTh sets\nfunction parseAbbrevSet(token){var t=token.toLowerCase();if(t===\"mwf\")return[\"MO\",\"WE\",\"FR\"];if(t===\"tth\"||t===\"tu/th\"||t===\"t/th\")return[\"TU\",\"TH\"];return null;}// Turn mixed text, ranges, and shorthands into ISO DOW array\nfunction normalizeByDayList(raw){var weekStartCode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_WEEK_START_CODE;var tokens=splitList(raw.replace(/[-â€“â€”]/g,\"-\"));var dowOrder=getDowOrderForWeekStart(weekStartCode);var out=[];var _iterator43=_createForOfIteratorHelper(tokens),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var tok=_step43.value;if(tok.includes(\"-\")){var _tok$split=tok.split(\"-\"),_tok$split2=_slicedToArray(_tok$split,2),a=_tok$split2[0],b=_tok$split2[1];var A=dowFromAlias(a),B=dowFromAlias(b);if(A&&B){out.push.apply(out,_toConsumableArray(expandDowRange(A,B,dowOrder)));continue;}}var _set3=parseAbbrevSet(tok);if(_set3){out.push.apply(out,_toConsumableArray(_set3));continue;}var d=dowFromAlias(tok);if(d){out.push(d);continue;}}}catch(err){_iterator43.e(err);}finally{_iterator43.f();}var seen=new Set();return out.filter(function(d){return seen.has(d)?false:(seen.add(d),true);});}function keywordIntervalFromText(text){return MONTH_KEYWORD_INTERVAL_LOOKUP[text]||null;}function ensureDashboardTopbarButton(){var retry=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(typeof document===\"undefined\")return;if(!activeDashboardController)return;var button=document.getElementById(DASHBOARD_TOPBAR_BUTTON_ID);if(!button){button=document.createElement(\"span\");button.id=DASHBOARD_TOPBAR_BUTTON_ID;button.className=\"bp3-button bp3-minimal bp3-small bp3-icon-form\";button.setAttribute(\"role\",\"button\");button.addEventListener(\"click\",function(){var _activeDashboardContr113;return(_activeDashboardContr113=activeDashboardController)===null||_activeDashboardContr113===void 0?void 0:_activeDashboardContr113.toggle();});}var lang=currentLanguage||\"en\";var topbarTitle=tGlobal([\"dashboard\",\"topbarTitle\"],lang)||\"Better Tasks Dashboard\";button.setAttribute(\"title\",topbarTitle);button.setAttribute(\"aria-label\",topbarTitle);var spacer=document.getElementById(DASHBOARD_TOPBAR_SPACER_ID);if(!spacer){spacer=document.createElement(\"div\");spacer.id=DASHBOARD_TOPBAR_SPACER_ID;spacer.className=\"rm-topbar__spacer-sm\";}var placed=insertDashboardButton(button,spacer);if(!placed&&retry){setTimeout(function(){return ensureDashboardTopbarButton(false);},600);}}function insertDashboardButton(button,spacer){var _mainTopbar$childNode;var helpButtonWrapper=document.querySelector(\".rm-topbar__help\");if(helpButtonWrapper!==null&&helpButtonWrapper!==void 0&&helpButtonWrapper.parentNode){var parent=helpButtonWrapper.parentNode;var afterHelp=helpButtonWrapper.nextSibling;parent.insertBefore(spacer,afterHelp);parent.insertBefore(button,afterHelp);return true;}var sidebarBtn=document.querySelector(\".rm-open-left-sidebar-btn\");if(sidebarBtn!==null&&sidebarBtn!==void 0&&sidebarBtn.parentNode){sidebarBtn.parentNode.insertBefore(spacer,sidebarBtn.nextSibling);sidebarBtn.parentNode.insertBefore(button,spacer.nextSibling);return true;}var topbar=document.querySelector(\".rm-topbar\");if(topbar){topbar.appendChild(spacer);topbar.appendChild(button);return true;}var mainTopbar=document.querySelector(\"#app > div > div > div.flex-h-box > div.roam-main > div.rm-files-dropzone > div\");var row=mainTopbar===null||mainTopbar===void 0||(_mainTopbar$childNode=mainTopbar.childNodes)===null||_mainTopbar$childNode===void 0?void 0:_mainTopbar$childNode[1];if(row!==null&&row!==void 0&&row.parentNode){row.parentNode.insertBefore(spacer,row);row.parentNode.insertBefore(button,row);return true;}return false;}function removeDashboardTopbarButton(){if(typeof document===\"undefined\")return;var existing=document.getElementById(DASHBOARD_TOPBAR_BUTTON_ID);if(existing)existing.remove();var spacer=document.getElementById(DASHBOARD_TOPBAR_SPACER_ID);if(spacer)spacer.remove();}function removeTodayBadge(){var _todayBadgeNode;if(todayBadgeRefreshTimer){clearTimeout(todayBadgeRefreshTimer);todayBadgeRefreshTimer=null;}if((_todayBadgeNode=todayBadgeNode)!==null&&_todayBadgeNode!==void 0&&_todayBadgeNode.parentNode){todayBadgeNode.parentNode.removeChild(todayBadgeNode);}todayBadgeNode=todayBadgeLabelNode=todayBadgeCountNode=null;lastTodayBadgeSignature=null;}function observeTopbarButton(){if(typeof document===\"undefined\")return;if(topbarButtonObserver)return;var target=document.querySelector(\".rm-topbar\")||document.body;if(!target)return;topbarButtonObserver=new MutationObserver(function(){if(!activeDashboardController)return;if(!document.getElementById(DASHBOARD_TOPBAR_BUTTON_ID)){ensureDashboardTopbarButton(false);}});try{topbarButtonObserver.observe(target,{childList:true,subtree:true});}catch(_){topbarButtonObserver=null;}}function disconnectThemeObserver(){if(themeObserver){try{themeObserver.disconnect();}catch(_){// ignore\n}themeObserver=null;}if(themeSyncTimer){clearTimeout(themeSyncTimer);themeSyncTimer=null;}if(typeof window!==\"undefined\"&&window.__btThemeMediaQuery){var _window$__btThemeMedi,_window$__btThemeMedi2;(_window$__btThemeMedi=(_window$__btThemeMedi2=window.__btThemeMediaQuery).removeEventListener)===null||_window$__btThemeMedi===void 0||_window$__btThemeMedi.call(_window$__btThemeMedi2,\"change\",syncDashboardThemeVars);window.__btThemeMediaQuery=null;}}function pickColorValue(defaultValue){for(var _len=arguments.length,candidates=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){candidates[_key-1]=arguments[_key];}for(var _i20=0,_candidates3=candidates;_i20<_candidates3.length;_i20++){var candidate=_candidates3[_i20];if(!candidate)continue;var value=typeof candidate===\"function\"?candidate():candidate;if(typeof value!==\"string\"){if(value!=null){var str=String(value).trim();if(str&&str!==\"initial\"&&str!==\"inherit\")return str;}continue;}var trimmed=value.trim();if(trimmed&&trimmed!==\"initial\"&&trimmed!==\"inherit\")return trimmed;}return defaultValue;}function syncDashboardThemeVars(){var _lastThemeSample;if(typeof document===\"undefined\")return;var body=document.body;var root=document.documentElement;if(!body||!root)return;var usingBlueprint=!!document.querySelector(\".blueprint-dm-toggle\");var usingRoamStudio=!!document.querySelector(\".roamstudio-dm-toggle\");var computed=window.getComputedStyle(body);var systemPrefersDark=typeof window!==\"undefined\"&&window.matchMedia&&window.matchMedia(\"(prefers-color-scheme: dark)\").matches;var explicitDark=body.classList.contains(\"bp3-dark\")||root.classList.contains(\"bp3-dark\")||body.dataset.theme===\"dark\"||root.dataset.theme===\"dark\";var externalMode=getExternalAppearanceFromToggle();// \"dark\" | \"light\" | \"auto\" | null\nvar finalIsDark;if(externalMode===\"dark\"){finalIsDark=true;}else if(externalMode===\"light\"){finalIsDark=false;}else if(externalMode===\"auto\"){finalIsDark=explicitDark||systemPrefersDark;}else{finalIsDark=explicitDark||systemPrefersDark;}var layoutBg=sampleBackgroundColor([\".roam-main\",\".roam-body .bp3-card\",\".roam-body\",\"#app\"]);// Theme-specific dark fallback for the panel surface\nvar darkFallbackSurface=usingBlueprint?\"#202B33\":\"#1f2428\";var baseSurfaceCandidate=pickColorValue(finalIsDark?darkFallbackSurface:\"#ffffff\",computed.getPropertyValue(\"--bt-surface\"),computed.getPropertyValue(\"--bp3-surface\"),computed.getPropertyValue(\"--background-color\"),layoutBg,computed.backgroundColor);if(!btPendingRoamStudioTheme&&baseSurfaceCandidate===(((_lastThemeSample=lastThemeSample)===null||_lastThemeSample===void 0?void 0:_lastThemeSample.surface)||null)){return;}if(btPendingRoamStudioTheme){btPendingRoamStudioTheme=false;}// Clamp overly-light surfaces in dark mode so the panel actually looks dark\nvar baseSurface=baseSurfaceCandidate;var panelRgb=parseColorToRgb(baseSurfaceCandidate);if(finalIsDark&&panelRgb){var lum=computeLuminance(panelRgb);if(lum>0.6){baseSurface=darkFallbackSurface;panelRgb=parseColorToRgb(baseSurface);}}// Stronger defaults for Blueprint dark to improve legibility\nvar fallbackTextDark=usingBlueprint?\"#F5F8FA\":\"#f5f8fa\";var fallbackBorderDark=usingBlueprint?\"rgba(255,255,255,0.24)\":\"rgba(255,255,255,0.12)\";var fallbackMutedDark=usingBlueprint?\"rgba(255,255,255,0.82)\":\"rgba(255,255,255,0.65)\";var fallbackPillBgDark=usingBlueprint?\"rgba(255,255,255,0.18)\":\"rgba(255,255,255,0.08)\";var textColor=pickColorValue(finalIsDark?fallbackTextDark:\"#111111\",computed.getPropertyValue(\"--bt-text\"),computed.getPropertyValue(\"--bp3-text-color\"),computed.color);var borderColor=pickColorValue(finalIsDark?fallbackBorderDark:\"rgba(0,0,0,0.08)\",computed.getPropertyValue(\"--bt-border-color\"),computed.getPropertyValue(\"--bp3-border-color\"),computed.getPropertyValue(\"--border-color\"));var mutedColor=pickColorValue(finalIsDark?fallbackMutedDark:\"rgba(0,0,0,0.6)\",computed.getPropertyValue(\"--bt-muted-color\"),computed.getPropertyValue(\"--text-color-muted\"));var pillBg=pickColorValue(finalIsDark?fallbackPillBgDark:\"rgba(0,0,0,0.07)\",computed.getPropertyValue(\"--bt-pill-bg\"));body.classList.toggle(\"bt-theme-dark\",finalIsDark);body.classList.toggle(\"bt-theme-light\",!finalIsDark);var adjustedPanel=adjustColor(panelRgb,finalIsDark?-0.06:0.03)||baseSurface;var borderStrong=adjustColor(panelRgb,finalIsDark?-0.22:0.15)||borderColor;root.style.setProperty(\"--bt-panel-bg\",adjustedPanel);root.style.setProperty(\"--bt-panel-text\",textColor);root.style.setProperty(\"--bt-border\",borderColor);root.style.setProperty(\"--bt-border-strong\",borderStrong);root.style.setProperty(\"--bt-muted\",mutedColor);root.style.setProperty(\"--bt-pill-bg\",pillBg);lastThemeSample={surface:baseSurface,dark:finalIsDark};}function getExternalAppearanceFromToggle(){if(typeof document===\"undefined\")return null;// Try to find a concrete button/icon element for *either* theme\nvar btn=// Roam Studio icon button\ndocument.querySelector(\".bp3-button.roamstudio-dm-toggle\")||document.querySelector(\".roamstudio-dm-toggle .bp3-button\")||// Blueprint icon button\ndocument.querySelector(\".bp3-button.blueprint-dm-toggle\")||document.querySelector(\".blueprint-dm-toggle .bp3-button\");if(!btn){// Debug info if needed\nvar rsWrapper=document.querySelector(\".roamstudio-dm-toggle\");var bpWrapper=document.querySelector(\".blueprint-dm-toggle\");return null;}var className=btn.className||\"\";var hasMoon=btn.classList.contains(\"bp3-icon-moon\");var hasFlash=btn.classList.contains(\"bp3-icon-flash\");var hasClean=btn.classList.contains(\"bp3-icon-clean\");// Order matters: if both clean+moon are present, treat as dark.\nif(hasFlash){return\"light\";}if(hasMoon){return\"dark\";}if(hasClean){return\"auto\";}return null;}function parseColorToRgb(value){if(!value||typeof value!==\"string\")return null;var str=value.trim();if(!str)return null;if(str.startsWith(\"#\")){var hex=str.slice(1);if(hex.length===3){hex=hex.split(\"\").map(function(ch){return ch+ch;}).join(\"\");}if(hex.length===6){var num=parseInt(hex,16);if(Number.isNaN(num))return null;return{r:num>>16&255,g:num>>8&255,b:num&255};}return null;}var rgbMatch=str.match(/rgba?\\(\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*,\\s*([\\d.]+)(?:\\s*,\\s*([\\d.]+))?\\s*\\)/i);if(rgbMatch){return{r:Number(rgbMatch[1]),g:Number(rgbMatch[2]),b:Number(rgbMatch[3])};}return null;}function computeLuminance(rgb){if(!rgb)return null;var toLinear=function toLinear(channel){var c=channel/255;return c<=0.03928?c/12.92:Math.pow((c+0.055)/1.055,2.4);};var r=toLinear(rgb.r);var g=toLinear(rgb.g);var b=toLinear(rgb.b);return 0.2126*r+0.7152*g+0.0722*b;}function adjustColor(rgb){var delta=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!rgb||typeof delta!==\"number\"||delta===0)return null;var mix=function mix(channel){var target=delta>0?255:0;var ratio=Math.min(Math.abs(delta),1);return Math.round(channel+(target-channel)*ratio);};var r=mix(rgb.r);var g=mix(rgb.g);var b=mix(rgb.b);return\"#\".concat(((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1));}function sampleBackgroundColor(){var selectors=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(typeof document===\"undefined\")return null;var _iterator44=_createForOfIteratorHelper(selectors),_step44;try{for(_iterator44.s();!(_step44=_iterator44.n()).done;){var selector=_step44.value;var node=typeof selector===\"string\"?document.querySelector(selector):selector;if(!node)continue;var style=window.getComputedStyle(node);var color=style===null||style===void 0?void 0:style.backgroundColor;if(color&&color!==\"rgba(0, 0, 0, 0)\"&&color!==\"transparent\"){return color;}}}catch(err){_iterator44.e(err);}finally{_iterator44.f();}return null;}function waitForAttrDate(_x210,_x211,_x212,_x213){return _waitForAttrDate.apply(this,arguments);}function _waitForAttrDate(){_waitForAttrDate=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee154(uid,attr,targetDate,set){var retries,getBlockFn,readMetaFn,sleep,i,block,meta,metaDate,_args155=arguments;return _regenerator().w(function(_context155){while(1)switch(_context155.n){case 0:retries=_args155.length>4&&_args155[4]!==undefined?_args155[4]:6;getBlockFn=_args155.length>5?_args155[5]:undefined;readMetaFn=_args155.length>6?_args155[6]:undefined;if(!(!uid||!(targetDate instanceof Date)||Number.isNaN(targetDate.getTime()))){_context155.n=1;break;}return _context155.a(2);case 1:if(!(typeof getBlockFn!==\"function\"||typeof readMetaFn!==\"function\")){_context155.n=2;break;}return _context155.a(2);case 2:sleep=function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};i=0;case 3:if(!(i<retries)){_context155.n=9;break;}_context155.n=4;return sleep(150);case 4:_context155.n=5;return getBlockFn(uid);case 5:block=_context155.v;if(block){_context155.n=6;break;}return _context155.a(3,9);case 6:_context155.n=7;return readMetaFn(block,set);case 7:meta=_context155.v;metaDate=(meta===null||meta===void 0?void 0:meta[attr])instanceof Date?meta[attr]:null;if(!(metaDate&&!Number.isNaN(metaDate.getTime()))){_context155.n=8;break;}if(!(Math.abs(metaDate.getTime()-targetDate.getTime())<1000)){_context155.n=8;break;}return _context155.a(2);case 8:i++;_context155.n=3;break;case 9:return _context155.a(2);}},_callee154);}));return _waitForAttrDate.apply(this,arguments);}function waitForAttrClear(_x214,_x215,_x216){return _waitForAttrClear.apply(this,arguments);}function _waitForAttrClear(){_waitForAttrClear=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee155(uid,attr,set){var retries,getBlockFn,readMetaFn,sleep,i,block,meta,hasValue,val,_args156=arguments;return _regenerator().w(function(_context156){while(1)switch(_context156.n){case 0:retries=_args156.length>3&&_args156[3]!==undefined?_args156[3]:6;getBlockFn=_args156.length>4?_args156[4]:undefined;readMetaFn=_args156.length>5?_args156[5]:undefined;if(!(!uid||typeof getBlockFn!==\"function\"||typeof readMetaFn!==\"function\")){_context156.n=1;break;}return _context156.a(2);case 1:sleep=function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};i=0;case 2:if(!(i<retries)){_context156.n=9;break;}_context156.n=3;return sleep(150);case 3:_context156.n=4;return getBlockFn(uid);case 4:block=_context156.v;if(block){_context156.n=5;break;}return _context156.a(3,9);case 5:_context156.n=6;return readMetaFn(block,set);case 6:meta=_context156.v;if(meta){_context156.n=7;break;}return _context156.a(3,9);case 7:hasValue=false;if(attr===\"repeat\"){hasValue=!!meta.repeat;}else if([\"start\",\"defer\",\"due\"].includes(attr)){val=meta[attr];hasValue=val instanceof Date&&!Number.isNaN(val.getTime());}if(hasValue){_context156.n=8;break;}return _context156.a(2);case 8:i++;_context156.n=2;break;case 9:return _context156.a(2);}},_callee155);}));return _waitForAttrClear.apply(this,arguments);}function waitForRepeatState(_x217,_x218){return _waitForRepeatState.apply(this,arguments);}function _waitForRepeatState(){_waitForRepeatState=_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee156(uid,set){var options,retries,getBlockFn,readMetaFn,expectValue,expectPresence,sleep,i,block,meta,repeatVal,_args157=arguments;return _regenerator().w(function(_context157){while(1)switch(_context157.n){case 0:options=_args157.length>2&&_args157[2]!==undefined?_args157[2]:{};retries=_args157.length>3&&_args157[3]!==undefined?_args157[3]:6;getBlockFn=_args157.length>4?_args157[4]:undefined;readMetaFn=_args157.length>5?_args157[5]:undefined;if(!(!uid||typeof getBlockFn!==\"function\"||typeof readMetaFn!==\"function\")){_context157.n=1;break;}return _context157.a(2);case 1:expectValue=typeof options.expectedValue===\"string\"&&options.expectedValue?options.expectedValue.trim():null;expectPresence=typeof options.expectPresence===\"boolean\"?options.expectPresence:null;sleep=function sleep(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};i=0;case 2:if(!(i<retries)){_context157.n=12;break;}_context157.n=3;return sleep(150);case 3:_context157.n=4;return getBlockFn(uid);case 4:block=_context157.v;if(block){_context157.n=5;break;}return _context157.a(3,12);case 5:_context157.n=6;return readMetaFn(block,set);case 6:meta=_context157.v;repeatVal=((meta===null||meta===void 0?void 0:meta.repeat)||\"\").trim();if(!(expectValue!=null)){_context157.n=8;break;}if(!(repeatVal===expectValue)){_context157.n=7;break;}return _context157.a(2,repeatVal);case 7:_context157.n=11;break;case 8:if(!(expectPresence!=null)){_context157.n=10;break;}if(!(!!repeatVal===expectPresence)){_context157.n=9;break;}return _context157.a(2,repeatVal);case 9:_context157.n=11;break;case 10:if(!repeatVal){_context157.n=11;break;}return _context157.a(2,repeatVal);case 11:i++;_context157.n=2;break;case 12:return _context157.a(2);}},_callee156);}));return _waitForRepeatState.apply(this,arguments);}function observeThemeChanges(){if(typeof document===\"undefined\")return;syncDashboardThemeVars();if(!document.body)return;if(!themeObserver){var cb=function cb(){return triggerThemeResync(180);};themeObserver=new MutationObserver(cb);try{var targets=[document.body,document.documentElement,document.head].filter(Boolean);var _iterator45=_createForOfIteratorHelper(targets),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var _target2=_step45.value;var opts=_target2===document.head?{childList:true,subtree:true,attributes:true,attributeFilter:[\"href\",\"data-theme\"]}:{attributes:true,attributeFilter:[\"class\",\"data-theme\"],subtree:true};themeObserver.observe(_target2,opts);}}catch(err){_iterator45.e(err);}finally{_iterator45.f();}}catch(_){themeObserver=null;}}if(typeof window!==\"undefined\"&&window.matchMedia){if(!window.__btThemeMediaQuery){var _window$__btThemeMedi3,_window$__btThemeMedi4;window.__btThemeMediaQuery=window.matchMedia(\"(prefers-color-scheme: dark)\");(_window$__btThemeMedi3=(_window$__btThemeMedi4=window.__btThemeMediaQuery).addEventListener)===null||_window$__btThemeMedi3===void 0||_window$__btThemeMedi3.call(_window$__btThemeMedi4,\"change\",function(){triggerThemeResync(0);});}}observeThemeToggleClicks();observeRoamStudioToggleAttributes();}function triggerThemeResync(){var delay=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(themeSyncTimer)clearTimeout(themeSyncTimer);themeSyncTimer=setTimeout(function(){syncDashboardThemeVars();themeSyncTimer=null;},Math.max(250,delay||0));}function observeThemeToggleClicks(){if(typeof document===\"undefined\"||!document.body)return;if(window.__btThemeToggleClickHandlerAttached)return;var handler=function handler(e){var toggle=e.target.closest(\".roamstudio-dm-toggle, .blueprint-dm-toggle\");if(!toggle)return;btPendingRoamStudioTheme=true;// Still give the theme extension time to rebuild CSS\ntriggerThemeResync(650);};document.body.addEventListener(\"click\",handler,true);window.__btThemeToggleClickHandlerAttached=true;}function observeRoamStudioToggleAttributes(){if(typeof document===\"undefined\")return;if(roamStudioToggleObserver)return;var toggle=document.querySelector(\".roamstudio-dm-toggle\");if(!toggle){// Try again later â€“ RS might not have injected the button yet\nsetTimeout(observeRoamStudioToggleAttributes,1000);return;}roamStudioToggleObserver=new MutationObserver(function(mutations){if(mutations.some(function(m){return m.type===\"attributes\"&&m.attributeName===\"class\";})){triggerThemeResync(120);var msg=t([\"metadata\",\"themeChanged\"],getLanguageSetting())||translateString(\"Detected change to themes. Reloading page to apply changes.\",getLanguageSetting())||\"Detected change to themes. Reloading page to apply changes.\";toast(msg,3500);}});roamStudioToggleObserver.observe(toggle,{attributes:true,attributeFilter:[\"class\"]});}function disconnectTopbarObserver(){if(!topbarButtonObserver)return;try{topbarButtonObserver.disconnect();}catch(_){// ignore\n}topbarButtonObserver=null;}function ensureDashboardWatch(uid){var _window$roamAlphaAPI34;if(!uid||dashboardWatchers.has(uid))return;if(!((_window$roamAlphaAPI34=window.roamAlphaAPI)!==null&&_window$roamAlphaAPI34!==void 0&&(_window$roamAlphaAPI34=_window$roamAlphaAPI34.data)!==null&&_window$roamAlphaAPI34!==void 0&&_window$roamAlphaAPI34.addPullWatch))return;var pattern=\"[:block/uid]\";var selector=[\":block/uid\",uid];try{window.roamAlphaAPI.data.addPullWatch(pattern,selector,function(_,after){if(!after){var _activeDashboardContr114,_activeDashboardContr115;removeDashboardWatch(uid);(_activeDashboardContr114=activeDashboardController)===null||_activeDashboardContr114===void 0||(_activeDashboardContr115=_activeDashboardContr114.removeTask)===null||_activeDashboardContr115===void 0||_activeDashboardContr115.call(_activeDashboardContr114,uid);}else{var _activeDashboardContr116,_activeDashboardContr117;(_activeDashboardContr116=activeDashboardController)===null||_activeDashboardContr116===void 0||(_activeDashboardContr117=_activeDashboardContr116.notifyBlockChange)===null||_activeDashboardContr117===void 0||_activeDashboardContr117.call(_activeDashboardContr116,uid,{bypassFilters:true});}});dashboardWatchers.set(uid,{pattern:pattern,selector:selector});}catch(err){console.warn(\"[BetterTasks] addPullWatch failed\",err);}}function removeDashboardWatch(uid){if(!uid)return;var entry=dashboardWatchers.get(uid);if(!entry)return;try{var _window$roamAlphaAPI35,_window$roamAlphaAPI36;(_window$roamAlphaAPI35=window.roamAlphaAPI)===null||_window$roamAlphaAPI35===void 0||(_window$roamAlphaAPI35=_window$roamAlphaAPI35.data)===null||_window$roamAlphaAPI35===void 0||(_window$roamAlphaAPI36=_window$roamAlphaAPI35.removePullWatch)===null||_window$roamAlphaAPI36===void 0||_window$roamAlphaAPI36.call(_window$roamAlphaAPI35,entry.pattern,entry.selector);}catch(err){console.warn(\"[BetterTasks] removePullWatch failed\",err);}dashboardWatchers[\"delete\"](uid);}function clearDashboardWatches(){for(var _i21=0,_Array$from=Array.from(dashboardWatchers.keys());_i21<_Array$from.length;_i21++){var uid=_Array$from[_i21];removeDashboardWatch(uid);}}\n\n//# sourceURL=webpack://better-tasks/./src/index.js?\n}");

/***/ },

/***/ "./src/picklist-excludes.js"
/*!**********************************!*\
  !*** ./src/picklist-excludes.js ***!
  \**********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizePageTitle: () => (/* binding */ normalizePageTitle),\n/* harmony export */   parseExcludedPicklistPages: () => (/* binding */ parseExcludedPicklistPages),\n/* harmony export */   shouldExcludePicklistSourcePage: () => (/* binding */ shouldExcludePicklistSourcePage)\n/* harmony export */ });\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nvar DEFAULT_EXCLUDED_PREFIX = \"roam/\";\nfunction stripWrappingBrackets(value) {\n  var v = String(value || \"\").trim();\n  var match = v.match(/^\\[\\[(.*)\\]\\]$/);\n  return match ? match[1].trim() : v;\n}\nfunction normalizePageTitle(raw) {\n  return stripWrappingBrackets(raw).trim().toLowerCase();\n}\nfunction splitCommaSeparatedPageTitles(raw) {\n  var s = String(raw || \"\");\n  var parts = [];\n  var current = \"\";\n  var inDoubleBrackets = false;\n  for (var i = 0; i < s.length; i++) {\n    var c = s[i];\n    var next = s[i + 1];\n    if (!inDoubleBrackets && c === \"[\" && next === \"[\") {\n      inDoubleBrackets = true;\n      current += \"[[\";\n      i++;\n      continue;\n    }\n    if (inDoubleBrackets && c === \"]\" && next === \"]\") {\n      inDoubleBrackets = false;\n      current += \"]]\";\n      i++;\n      continue;\n    }\n    if (!inDoubleBrackets && c === \",\") {\n      parts.push(current);\n      current = \"\";\n      continue;\n    }\n    current += c;\n  }\n  parts.push(current);\n  return parts;\n}\nfunction parseExcludedPicklistPages(raw) {\n  var set = new Set();\n  var _iterator = _createForOfIteratorHelper(splitCommaSeparatedPageTitles(raw)),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var part = _step.value;\n      var normalized = normalizePageTitle(part);\n      if (normalized) set.add(normalized);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return set;\n}\nfunction shouldExcludePicklistSourcePage(pageTitle, enabled, userExcludedSet) {\n  var t = normalizePageTitle(pageTitle);\n  if (t.startsWith(DEFAULT_EXCLUDED_PREFIX)) return true;\n  if (!enabled) return false;\n  if (!userExcludedSet || typeof userExcludedSet.has !== \"function\") return false;\n  return userExcludedSet.has(t);\n}\n\n//# sourceURL=webpack://better-tasks/./src/picklist-excludes.js?\n}");

/***/ },

/***/ "./src/project-store.js"
/*!******************************!*\
  !*** ./src/project-store.js ***!
  \******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addProjectOption: () => (/* binding */ addProjectOption),\n/* harmony export */   getProjectAttrName: () => (/* binding */ getProjectAttrName),\n/* harmony export */   getProjectOptions: () => (/* binding */ getProjectOptions),\n/* harmony export */   initProjectStore: () => (/* binding */ initProjectStore),\n/* harmony export */   normalizeProjectValue: () => (/* binding */ normalizeProjectValue),\n/* harmony export */   refreshProjectOptions: () => (/* binding */ refreshProjectOptions),\n/* harmony export */   removeProjectOption: () => (/* binding */ removeProjectOption),\n/* harmony export */   subscribeToProjectOptions: () => (/* binding */ subscribeToProjectOptions)\n/* harmony export */ });\n/* harmony import */ var _picklist_excludes__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./picklist-excludes */ \"./src/picklist-excludes.js\");\nfunction _regeneratorValues(e) { if (null != e) { var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"], r = 0; if (t) return t.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) return { next: function next() { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e }; } }; } throw new TypeError(_typeof(e) + \" is not iterable\"); }\nfunction _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nvar DEFAULT_PROJECT_ATTR = \"BT_attrProject\";\nvar CACHE_TTL_MS = 8 * 60 * 1000; // long-lived cache; caller can force refresh\n\n\nvar extensionAPI = null;\nvar lastRefreshed = 0;\nvar refreshPromise = null;\nvar projects = [];\nvar subscribers = new Set();\nfunction sanitizeAttrName(value, fallback) {\n  if (value == null) return fallback;\n  var trimmed = String(value).trim().replace(/:+$/, \"\");\n  return trimmed || fallback;\n}\nfunction escapeForQuery(str) {\n  return String(str || \"\").replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"');\n}\nfunction normalizeProjectValue(raw) {\n  if (typeof raw !== \"string\") return \"\";\n  var v = raw.trim();\n  if (!v) return \"\";\n  if (v.startsWith(\"#\")) v = v.slice(1).trim();\n  var pageMatch = v.match(/^\\[\\[(.*)\\]\\]$/);\n  if (pageMatch) return pageMatch[1].trim();\n  return v;\n}\nfunction getProjectAttrName() {\n  var _extensionAPI, _extensionAPI$get;\n  var configured = (_extensionAPI = extensionAPI) === null || _extensionAPI === void 0 || (_extensionAPI = _extensionAPI.settings) === null || _extensionAPI === void 0 || (_extensionAPI$get = _extensionAPI.get) === null || _extensionAPI$get === void 0 ? void 0 : _extensionAPI$get.call(_extensionAPI, \"bt-attr-project\");\n  return sanitizeAttrName(configured !== null && configured !== void 0 ? configured : DEFAULT_PROJECT_ATTR, DEFAULT_PROJECT_ATTR);\n}\nfunction getPicklistExcludeConfig() {\n  var _extensionAPI2, _extensionAPI2$get, _extensionAPI3, _extensionAPI3$get;\n  var enabledRaw = (_extensionAPI2 = extensionAPI) === null || _extensionAPI2 === void 0 || (_extensionAPI2 = _extensionAPI2.settings) === null || _extensionAPI2 === void 0 || (_extensionAPI2$get = _extensionAPI2.get) === null || _extensionAPI2$get === void 0 ? void 0 : _extensionAPI2$get.call(_extensionAPI2, \"bt_excludePicklistPagesEnabled\");\n  var enabled = enabledRaw === true || enabledRaw === \"true\" || enabledRaw === \"1\";\n  var raw = ((_extensionAPI3 = extensionAPI) === null || _extensionAPI3 === void 0 || (_extensionAPI3 = _extensionAPI3.settings) === null || _extensionAPI3 === void 0 || (_extensionAPI3$get = _extensionAPI3.get) === null || _extensionAPI3$get === void 0 ? void 0 : _extensionAPI3$get.call(_extensionAPI3, \"bt_excludePicklistPages\")) || \"\";\n  return {\n    enabled: enabled,\n    excluded: (0,_picklist_excludes__WEBPACK_IMPORTED_MODULE_0__.parseExcludedPicklistPages)(raw)\n  };\n}\nfunction notifySubscribers() {\n  var snapshot = projects.slice();\n  subscribers.forEach(function (cb) {\n    try {\n      cb(snapshot);\n    } catch (err) {\n      console.warn(\"[BetterTasks] project-store subscriber failed\", err);\n    }\n  });\n}\nfunction setProjects(next) {\n  projects = Array.from(new Set((next || []).map(normalizeProjectValue).filter(Boolean))).sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  notifySubscribers();\n}\nfunction getProjectOptions() {\n  return projects.slice();\n}\nfunction removeProjectOption(name) {\n  var normalized = normalizeProjectValue(name);\n  if (!normalized) return;\n  var next = projects.filter(function (p) {\n    return p !== normalized;\n  });\n  if (next.length === projects.length) return;\n  projects = next;\n  notifySubscribers();\n}\nfunction addProjectOption(name) {\n  var normalized = normalizeProjectValue(name);\n  if (!normalized) return;\n  if (projects.includes(normalized)) return;\n  projects = [].concat(_toConsumableArray(projects), [normalized]).sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  notifySubscribers();\n}\nfunction queryProjectsFromGraph() {\n  return _queryProjectsFromGraph.apply(this, arguments);\n}\nfunction _queryProjectsFromGraph() {\n  _queryProjectsFromGraph = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n    var _window$roamAlphaAPI;\n    var _ref,\n      _ref$includeRegex,\n      includeRegex,\n      attrName,\n      excludeCfg,\n      safeAttr,\n      defaultSafe,\n      labels,\n      pull,\n      refQuery,\n      inlineRegexQuery,\n      refRows,\n      rows,\n      pattern,\n      regexRows,\n      values,\n      getField,\n      getPageTitleFromEntry,\n      _iterator2,\n      _step2,\n      _loop,\n      _ret,\n      _args2 = arguments,\n      _t,\n      _t2,\n      _t3;\n    return _regenerator().w(function (_context2) {\n      while (1) switch (_context2.p = _context2.n) {\n        case 0:\n          _ref = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {}, _ref$includeRegex = _ref.includeRegex, includeRegex = _ref$includeRegex === void 0 ? true : _ref$includeRegex;\n          attrName = getProjectAttrName();\n          if (!(!attrName || typeof window === \"undefined\" || !((_window$roamAlphaAPI = window.roamAlphaAPI) !== null && _window$roamAlphaAPI !== void 0 && _window$roamAlphaAPI.q))) {\n            _context2.n = 1;\n            break;\n          }\n          return _context2.a(2, []);\n        case 1:\n          excludeCfg = getPicklistExcludeConfig();\n          safeAttr = escapeForQuery(attrName);\n          defaultSafe = escapeForQuery(DEFAULT_PROJECT_ATTR);\n          labels = Array.from(new Set([safeAttr, defaultSafe])).filter(Boolean);\n          pull = \"[:block/string {:block/refs [:node/title]} {:block/page [:node/title]}]\"; // Query for blocks that reference the attribute page(s)\n          refQuery = \"\\n    [:find (pull ?c \".concat(pull, \") ?pageTitle\\n     :in $ [?label ...]\\n     :where\\n       [?attr :node/title ?label]\\n       [?c :block/refs ?attr]\\n       [?c :block/page ?p]\\n       [?p :node/title ?pageTitle]]\"); // Regex query for inline attr (case-insensitive), allowing leading whitespace.\n          inlineRegexQuery = \"\\n    [:find (pull ?c \".concat(pull, \") ?pageTitle\\n     :in $ ?pattern\\n     :where\\n       [?c :block/string ?s]\\n       [(re-pattern ?pattern) ?rp]\\n       [(re-find ?rp ?s)]\\n       [?c :block/page ?p]\\n       [?p :node/title ?pageTitle]]\");\n          _context2.p = 2;\n          _context2.n = 3;\n          return window.roamAlphaAPI.q(refQuery, labels);\n        case 3:\n          refRows = _context2.v;\n          rows = _toConsumableArray(refRows || []);\n          if (!includeRegex) {\n            _context2.n = 7;\n            break;\n          }\n          // Regex scan (case-insensitive) for attr label at start of line (with optional leading spaces)\n          pattern = \"(?i)^\\\\s*(?:\".concat(labels.join(\"|\"), \")\\\\s*::\");\n          _context2.p = 4;\n          _context2.n = 5;\n          return window.roamAlphaAPI.q(inlineRegexQuery, pattern);\n        case 5:\n          regexRows = _context2.v;\n          if (Array.isArray(regexRows)) {\n            rows = [].concat(_toConsumableArray(rows), _toConsumableArray(regexRows || []));\n          }\n          _context2.n = 7;\n          break;\n        case 6:\n          _context2.p = 6;\n          _t = _context2.v;\n          console.warn(\"[BetterTasks] project-store regex query failed\", _t);\n        case 7:\n          values = [];\n          getField = function getField(obj, candidates) {\n            var _iterator = _createForOfIteratorHelper(candidates),\n              _step;\n            try {\n              for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                var key = _step.value;\n                if (obj && obj[key] != null) return obj[key];\n              }\n            } catch (err) {\n              _iterator.e(err);\n            } finally {\n              _iterator.f();\n            }\n            return undefined;\n          };\n          getPageTitleFromEntry = function getPageTitleFromEntry(entryObj) {\n            var raw = getField(entryObj, [\"block/page\", \"page\", \":block/page\"]);\n            var pageObj = Array.isArray(raw) ? raw[0] : raw;\n            if (!pageObj || _typeof(pageObj) !== \"object\") return \"\";\n            return pageObj[\"node/title\"] || pageObj[\":node/title\"] || \"\";\n          };\n          _iterator2 = _createForOfIteratorHelper(rows || []);\n          _context2.p = 8;\n          _loop = /*#__PURE__*/_regenerator().m(function _loop() {\n            var row, entry, pageTitleFromQuery, pageTitle, excluded, stringVal, refsVal, refs, refTitles, attrTitleSet, nonAttrRef, parts, valuePart, normalized;\n            return _regenerator().w(function (_context) {\n              while (1) switch (_context.n) {\n                case 0:\n                  row = _step2.value;\n                  // roamAlphaAPI.q can return either [entry] or entry directly depending on the query\n                  entry = (row === null || row === void 0 ? void 0 : row[0]) || row;\n                  if (entry) {\n                    _context.n = 1;\n                    break;\n                  }\n                  return _context.a(2, 0);\n                case 1:\n                  pageTitleFromQuery = Array.isArray(row) && typeof row[1] === \"string\" ? row[1] : \"\";\n                  pageTitle = pageTitleFromQuery || getPageTitleFromEntry(entry);\n                  excluded = (0,_picklist_excludes__WEBPACK_IMPORTED_MODULE_0__.shouldExcludePicklistSourcePage)(pageTitle, excludeCfg.enabled, excludeCfg.excluded);\n                  if (!excluded) {\n                    _context.n = 2;\n                    break;\n                  }\n                  return _context.a(2, 0);\n                case 2:\n                  stringVal = getField(entry, [\"block/string\", \"string\", \":block/string\"]) || \"\";\n                  refsVal = getField(entry, [\"block/refs\", \"refs\", \":block/refs\"]) || [];\n                  refs = Array.isArray(refsVal) ? refsVal : [];\n                  refTitles = refs.map(function (ref) {\n                    return (ref === null || ref === void 0 ? void 0 : ref[\"node/title\"]) || (ref === null || ref === void 0 ? void 0 : ref[\":node/title\"]);\n                  }).filter(function (t) {\n                    return typeof t === \"string\";\n                  }).map(function (t) {\n                    return t.trim();\n                  }).filter(Boolean);\n                  attrTitleSet = new Set([attrName, DEFAULT_PROJECT_ATTR]);\n                  nonAttrRef = refTitles.find(function (title) {\n                    return !attrTitleSet.has(title);\n                  });\n                  if (!nonAttrRef) {\n                    _context.n = 3;\n                    break;\n                  }\n                  values.push(nonAttrRef);\n                  return _context.a(2, 0);\n                case 3:\n                  parts = String(stringVal || \"\").split(\"::\");\n                  if (parts.length >= 2) {\n                    valuePart = parts.slice(1).join(\"::\");\n                    normalized = normalizeProjectValue(valuePart);\n                    if (normalized) {\n                      values.push(normalized);\n                    }\n                  }\n                case 4:\n                  return _context.a(2);\n              }\n            }, _loop);\n          });\n          _iterator2.s();\n        case 9:\n          if ((_step2 = _iterator2.n()).done) {\n            _context2.n = 12;\n            break;\n          }\n          return _context2.d(_regeneratorValues(_loop()), 10);\n        case 10:\n          _ret = _context2.v;\n          if (!(_ret === 0)) {\n            _context2.n = 11;\n            break;\n          }\n          return _context2.a(3, 11);\n        case 11:\n          _context2.n = 9;\n          break;\n        case 12:\n          _context2.n = 14;\n          break;\n        case 13:\n          _context2.p = 13;\n          _t2 = _context2.v;\n          _iterator2.e(_t2);\n        case 14:\n          _context2.p = 14;\n          _iterator2.f();\n          return _context2.f(14);\n        case 15:\n          return _context2.a(2, values);\n        case 16:\n          _context2.p = 16;\n          _t3 = _context2.v;\n          console.warn(\"[BetterTasks] project-store query failed\", _t3);\n          return _context2.a(2, []);\n      }\n    }, _callee, null, [[8, 13, 14, 15], [4, 6], [2, 16]]);\n  }));\n  return _queryProjectsFromGraph.apply(this, arguments);\n}\nfunction refreshProjectOptions() {\n  return _refreshProjectOptions.apply(this, arguments);\n}\nfunction _refreshProjectOptions() {\n  _refreshProjectOptions = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n    var force,\n      now,\n      _args3 = arguments;\n    return _regenerator().w(function (_context3) {\n      while (1) switch (_context3.n) {\n        case 0:\n          force = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : false;\n          now = Date.now();\n          if (!(!force && refreshPromise)) {\n            _context3.n = 1;\n            break;\n          }\n          return _context3.a(2, refreshPromise);\n        case 1:\n          if (!(!force && now - lastRefreshed < CACHE_TTL_MS && projects.length)) {\n            _context3.n = 2;\n            break;\n          }\n          return _context3.a(2, Promise.resolve());\n        case 2:\n          queryProjectsFromGraph({\n            includeRegex: false\n          }).then(function (values) {\n            if (!values.length) return;\n            setProjects(values);\n          });\n          refreshPromise = queryProjectsFromGraph({\n            includeRegex: true\n          }).then(function (values) {\n            lastRefreshed = Date.now();\n            setProjects(values);\n          })[\"finally\"](function () {\n            refreshPromise = null;\n          });\n          return _context3.a(2, refreshPromise);\n      }\n    }, _callee2);\n  }));\n  return _refreshProjectOptions.apply(this, arguments);\n}\nfunction subscribeToProjectOptions(cb) {\n  if (typeof cb !== \"function\") return function () {};\n  subscribers.add(cb);\n  cb(projects.slice());\n  return function () {\n    return subscribers[\"delete\"](cb);\n  };\n}\nfunction initProjectStore(api) {\n  extensionAPI = api || null;\n  void refreshProjectOptions(true);\n  // In some cases settings populate just after onload; a small delayed refresh helps catch them.\n  setTimeout(function () {\n    return void refreshProjectOptions(true);\n  }, 500);\n}\n\n\n//# sourceURL=webpack://better-tasks/./src/project-store.js?\n}");

/***/ },

/***/ "./src/waiting-store.js"
/*!******************************!*\
  !*** ./src/waiting-store.js ***!
  \******************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addWaitingOption: () => (/* binding */ addWaitingOption),\n/* harmony export */   getWaitingAttrName: () => (/* binding */ getWaitingAttrName),\n/* harmony export */   getWaitingOptions: () => (/* binding */ getWaitingOptions),\n/* harmony export */   initWaitingStore: () => (/* binding */ initWaitingStore),\n/* harmony export */   normalizeWaitingValue: () => (/* binding */ normalizeWaitingValue),\n/* harmony export */   refreshWaitingOptions: () => (/* binding */ refreshWaitingOptions),\n/* harmony export */   removeWaitingOption: () => (/* binding */ removeWaitingOption),\n/* harmony export */   subscribeToWaitingOptions: () => (/* binding */ subscribeToWaitingOptions)\n/* harmony export */ });\n/* harmony import */ var _picklist_excludes__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./picklist-excludes */ \"./src/picklist-excludes.js\");\nfunction _regeneratorValues(e) { if (null != e) { var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"], r = 0; if (t) return t.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) return { next: function next() { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e }; } }; } throw new TypeError(_typeof(e) + \" is not iterable\"); }\nfunction _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nvar DEFAULT_WAITING_ATTR = \"BT_attrWaitingFor\";\nvar CACHE_TTL_MS = 8 * 60 * 1000;\n\nvar extensionAPI = null;\nvar lastRefreshed = 0;\nvar refreshPromise = null;\nvar values = [];\nvar subscribers = new Set();\nfunction sanitizeAttrName(value, fallback) {\n  if (value == null) return fallback;\n  var trimmed = String(value).trim().replace(/:+$/, \"\");\n  return trimmed || fallback;\n}\nfunction escapeForQuery(str) {\n  return String(str || \"\").replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"');\n}\nfunction normalizeWaitingValue(raw) {\n  if (typeof raw !== \"string\") return \"\";\n  return raw.trim();\n}\nfunction getWaitingAttrName() {\n  var _extensionAPI, _extensionAPI$get;\n  var configured = (_extensionAPI = extensionAPI) === null || _extensionAPI === void 0 || (_extensionAPI = _extensionAPI.settings) === null || _extensionAPI === void 0 || (_extensionAPI$get = _extensionAPI.get) === null || _extensionAPI$get === void 0 ? void 0 : _extensionAPI$get.call(_extensionAPI, \"bt-attr-waitingFor\");\n  return sanitizeAttrName(configured !== null && configured !== void 0 ? configured : DEFAULT_WAITING_ATTR, DEFAULT_WAITING_ATTR);\n}\nfunction getPicklistExcludeConfig() {\n  var _extensionAPI2, _extensionAPI2$get, _extensionAPI3, _extensionAPI3$get;\n  var enabledRaw = (_extensionAPI2 = extensionAPI) === null || _extensionAPI2 === void 0 || (_extensionAPI2 = _extensionAPI2.settings) === null || _extensionAPI2 === void 0 || (_extensionAPI2$get = _extensionAPI2.get) === null || _extensionAPI2$get === void 0 ? void 0 : _extensionAPI2$get.call(_extensionAPI2, \"bt_excludePicklistPagesEnabled\");\n  var enabled = enabledRaw === true || enabledRaw === \"true\" || enabledRaw === \"1\";\n  var raw = ((_extensionAPI3 = extensionAPI) === null || _extensionAPI3 === void 0 || (_extensionAPI3 = _extensionAPI3.settings) === null || _extensionAPI3 === void 0 || (_extensionAPI3$get = _extensionAPI3.get) === null || _extensionAPI3$get === void 0 ? void 0 : _extensionAPI3$get.call(_extensionAPI3, \"bt_excludePicklistPages\")) || \"\";\n  return {\n    enabled: enabled,\n    excluded: (0,_picklist_excludes__WEBPACK_IMPORTED_MODULE_0__.parseExcludedPicklistPages)(raw)\n  };\n}\nfunction notifySubscribers() {\n  var snapshot = values.slice();\n  subscribers.forEach(function (cb) {\n    try {\n      cb(snapshot);\n    } catch (err) {\n      console.warn(\"[BetterTasks] waiting-store subscriber failed\", err);\n    }\n  });\n}\nfunction setValues(next) {\n  values = Array.from(new Set((next || []).map(normalizeWaitingValue).filter(Boolean))).sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  notifySubscribers();\n}\nfunction getWaitingOptions() {\n  return values.slice();\n}\nfunction addWaitingOption(name) {\n  var normalized = normalizeWaitingValue(name);\n  if (!normalized || values.includes(normalized)) return;\n  values = [].concat(_toConsumableArray(values), [normalized]).sort(function (a, b) {\n    return a.localeCompare(b, undefined, {\n      sensitivity: \"base\"\n    });\n  });\n  notifySubscribers();\n}\nfunction removeWaitingOption(name) {\n  var normalized = normalizeWaitingValue(name);\n  if (!normalized) return;\n  var next = values.filter(function (v) {\n    return v !== normalized;\n  });\n  if (next.length === values.length) return;\n  values = next;\n  notifySubscribers();\n}\nfunction queryWaitingFromGraph() {\n  return _queryWaitingFromGraph.apply(this, arguments);\n}\nfunction _queryWaitingFromGraph() {\n  _queryWaitingFromGraph = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n    var _window$roamAlphaAPI;\n    var _ref,\n      _ref$includeRegex,\n      includeRegex,\n      attrName,\n      excludeCfg,\n      safeAttr,\n      defaultSafe,\n      labels,\n      pull,\n      refQuery,\n      inlineRegexQuery,\n      refRows,\n      rows,\n      pattern,\n      regexRows,\n      getField,\n      getPageTitleFromEntry,\n      out,\n      _iterator2,\n      _step2,\n      _loop,\n      _ret,\n      _args2 = arguments,\n      _t,\n      _t2,\n      _t3;\n    return _regenerator().w(function (_context2) {\n      while (1) switch (_context2.p = _context2.n) {\n        case 0:\n          _ref = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {}, _ref$includeRegex = _ref.includeRegex, includeRegex = _ref$includeRegex === void 0 ? true : _ref$includeRegex;\n          attrName = getWaitingAttrName();\n          if (!(!attrName || typeof window === \"undefined\" || !((_window$roamAlphaAPI = window.roamAlphaAPI) !== null && _window$roamAlphaAPI !== void 0 && _window$roamAlphaAPI.q))) {\n            _context2.n = 1;\n            break;\n          }\n          return _context2.a(2, []);\n        case 1:\n          excludeCfg = getPicklistExcludeConfig();\n          _context2.p = 2;\n          safeAttr = escapeForQuery(attrName);\n          defaultSafe = escapeForQuery(DEFAULT_WAITING_ATTR);\n          labels = Array.from(new Set([safeAttr, defaultSafe])).filter(Boolean);\n          pull = \"[:block/string {:block/refs [:node/title]} {:block/page [:node/title]}]\";\n          refQuery = \"\\n      [:find (pull ?c \".concat(pull, \") ?pageTitle\\n       :in $ [?label ...]\\n       :where\\n         [?attr :node/title ?label]\\n         [?c :block/refs ?attr]\\n         [?c :block/page ?p]\\n         [?p :node/title ?pageTitle]]\");\n          inlineRegexQuery = \"\\n      [:find (pull ?c \".concat(pull, \") ?pageTitle\\n       :in $ ?pattern\\n       :where\\n         [?c :block/string ?s]\\n         [(re-pattern ?pattern) ?rp]\\n         [(re-find ?rp ?s)]\\n         [?c :block/page ?p]\\n         [?p :node/title ?pageTitle]]\");\n          _context2.n = 3;\n          return window.roamAlphaAPI.q(refQuery, labels);\n        case 3:\n          refRows = _context2.v;\n          rows = _toConsumableArray(refRows || []);\n          if (!includeRegex) {\n            _context2.n = 7;\n            break;\n          }\n          pattern = \"(?i)^\\\\s*(?:\".concat(labels.join(\"|\"), \")\\\\s*::\");\n          _context2.p = 4;\n          _context2.n = 5;\n          return window.roamAlphaAPI.q(inlineRegexQuery, pattern);\n        case 5:\n          regexRows = _context2.v;\n          if (Array.isArray(regexRows)) rows = [].concat(_toConsumableArray(rows), _toConsumableArray(regexRows || []));\n          _context2.n = 7;\n          break;\n        case 6:\n          _context2.p = 6;\n          _t = _context2.v;\n          console.warn(\"[BetterTasks] waiting-store regex query failed\", _t);\n        case 7:\n          getField = function getField(obj, candidates) {\n            var _iterator = _createForOfIteratorHelper(candidates),\n              _step;\n            try {\n              for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                var key = _step.value;\n                if (obj && obj[key] != null) return obj[key];\n              }\n            } catch (err) {\n              _iterator.e(err);\n            } finally {\n              _iterator.f();\n            }\n            return undefined;\n          };\n          getPageTitleFromEntry = function getPageTitleFromEntry(entryObj) {\n            var raw = getField(entryObj, [\"block/page\", \"page\", \":block/page\"]);\n            var pageObj = Array.isArray(raw) ? raw[0] : raw;\n            if (!pageObj || _typeof(pageObj) !== \"object\") return \"\";\n            return pageObj[\"node/title\"] || pageObj[\":node/title\"] || \"\";\n          };\n          out = [];\n          _iterator2 = _createForOfIteratorHelper(rows || []);\n          _context2.p = 8;\n          _loop = /*#__PURE__*/_regenerator().m(function _loop() {\n            var row, entry, pageTitleFromQuery, pageTitle, excluded, stringVal, refsVal, refs, refTitles, attrTitleSet, nonAttrRef, parts, valuePart, normalized;\n            return _regenerator().w(function (_context) {\n              while (1) switch (_context.n) {\n                case 0:\n                  row = _step2.value;\n                  entry = (row === null || row === void 0 ? void 0 : row[0]) || row;\n                  if (entry) {\n                    _context.n = 1;\n                    break;\n                  }\n                  return _context.a(2, 0);\n                case 1:\n                  pageTitleFromQuery = Array.isArray(row) && typeof row[1] === \"string\" ? row[1] : \"\";\n                  pageTitle = pageTitleFromQuery || getPageTitleFromEntry(entry);\n                  excluded = (0,_picklist_excludes__WEBPACK_IMPORTED_MODULE_0__.shouldExcludePicklistSourcePage)(pageTitle, excludeCfg.enabled, excludeCfg.excluded);\n                  if (!excluded) {\n                    _context.n = 2;\n                    break;\n                  }\n                  return _context.a(2, 0);\n                case 2:\n                  stringVal = getField(entry, [\"block/string\", \"string\", \":block/string\"]) || \"\";\n                  refsVal = getField(entry, [\"block/refs\", \"refs\", \":block/refs\"]) || [];\n                  refs = Array.isArray(refsVal) ? refsVal : [];\n                  refTitles = refs.map(function (ref) {\n                    return (ref === null || ref === void 0 ? void 0 : ref[\"node/title\"]) || (ref === null || ref === void 0 ? void 0 : ref[\":node/title\"]);\n                  }).filter(function (t) {\n                    return typeof t === \"string\";\n                  }).map(function (t) {\n                    return t.trim();\n                  }).filter(Boolean);\n                  attrTitleSet = new Set([attrName, DEFAULT_WAITING_ATTR]);\n                  nonAttrRef = refTitles.find(function (title) {\n                    return !attrTitleSet.has(title);\n                  });\n                  if (!nonAttrRef) {\n                    _context.n = 3;\n                    break;\n                  }\n                  out.push(nonAttrRef);\n                  return _context.a(2, 0);\n                case 3:\n                  parts = stringVal.split(\"::\");\n                  if (parts.length >= 2) {\n                    valuePart = parts.slice(1).join(\"::\");\n                    normalized = normalizeWaitingValue(valuePart);\n                    if (normalized) out.push(normalized);\n                  }\n                case 4:\n                  return _context.a(2);\n              }\n            }, _loop);\n          });\n          _iterator2.s();\n        case 9:\n          if ((_step2 = _iterator2.n()).done) {\n            _context2.n = 12;\n            break;\n          }\n          return _context2.d(_regeneratorValues(_loop()), 10);\n        case 10:\n          _ret = _context2.v;\n          if (!(_ret === 0)) {\n            _context2.n = 11;\n            break;\n          }\n          return _context2.a(3, 11);\n        case 11:\n          _context2.n = 9;\n          break;\n        case 12:\n          _context2.n = 14;\n          break;\n        case 13:\n          _context2.p = 13;\n          _t2 = _context2.v;\n          _iterator2.e(_t2);\n        case 14:\n          _context2.p = 14;\n          _iterator2.f();\n          return _context2.f(14);\n        case 15:\n          return _context2.a(2, out);\n        case 16:\n          _context2.p = 16;\n          _t3 = _context2.v;\n          console.warn(\"[BetterTasks] waiting-store query failed\", _t3);\n          return _context2.a(2, []);\n      }\n    }, _callee, null, [[8, 13, 14, 15], [4, 6], [2, 16]]);\n  }));\n  return _queryWaitingFromGraph.apply(this, arguments);\n}\nfunction refreshWaitingOptions() {\n  return _refreshWaitingOptions.apply(this, arguments);\n}\nfunction _refreshWaitingOptions() {\n  _refreshWaitingOptions = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n    var force,\n      now,\n      _args3 = arguments;\n    return _regenerator().w(function (_context3) {\n      while (1) switch (_context3.n) {\n        case 0:\n          force = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : false;\n          now = Date.now();\n          if (!(!force && refreshPromise)) {\n            _context3.n = 1;\n            break;\n          }\n          return _context3.a(2, refreshPromise);\n        case 1:\n          if (!(!force && now - lastRefreshed < CACHE_TTL_MS && values.length)) {\n            _context3.n = 2;\n            break;\n          }\n          return _context3.a(2, Promise.resolve());\n        case 2:\n          queryWaitingFromGraph({\n            includeRegex: false\n          }).then(function (list) {\n            if (!list.length) return;\n            setValues(list);\n          });\n          refreshPromise = queryWaitingFromGraph({\n            includeRegex: true\n          }).then(function (list) {\n            lastRefreshed = Date.now();\n            setValues(list);\n          })[\"finally\"](function () {\n            refreshPromise = null;\n          });\n          return _context3.a(2, refreshPromise);\n      }\n    }, _callee2);\n  }));\n  return _refreshWaitingOptions.apply(this, arguments);\n}\nfunction subscribeToWaitingOptions(cb) {\n  if (typeof cb !== \"function\") return function () {};\n  subscribers.add(cb);\n  cb(values.slice());\n  return function () {\n    return subscribers[\"delete\"](cb);\n  };\n}\nfunction initWaitingStore(api) {\n  extensionAPI = api || null;\n  void refreshWaitingOptions(true);\n  setTimeout(function () {\n    return void refreshWaitingOptions(true);\n  }, 500);\n}\n\n\n//# sourceURL=webpack://better-tasks/./src/waiting-store.js?\n}");

/***/ },

/***/ "react"
/*!************************!*\
  !*** external "React" ***!
  \************************/
(module) {

module.exports = window["React"];

/***/ },

/***/ "react-dom"
/*!***************************!*\
  !*** external "ReactDOM" ***!
  \***************************/
(module) {

module.exports = window["ReactDOM"];

/***/ }

/******/ });
/************************************************************************/
/******/ // The module cache
/******/ var __webpack_module_cache__ = {};
/******/ 
/******/ // The require function
/******/ function __webpack_require__(moduleId) {
/******/ 	// Check if module is in cache
/******/ 	var cachedModule = __webpack_module_cache__[moduleId];
/******/ 	if (cachedModule !== undefined) {
/******/ 		return cachedModule.exports;
/******/ 	}
/******/ 	// Check if module exists (development only)
/******/ 	if (__webpack_modules__[moduleId] === undefined) {
/******/ 		var e = new Error("Cannot find module '" + moduleId + "'");
/******/ 		e.code = 'MODULE_NOT_FOUND';
/******/ 		throw e;
/******/ 	}
/******/ 	// Create a new module (and put it into the cache)
/******/ 	var module = __webpack_module_cache__[moduleId] = {
/******/ 		// no module.id needed
/******/ 		// no module.loaded needed
/******/ 		exports: {}
/******/ 	};
/******/ 
/******/ 	// Execute the module function
/******/ 	__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 
/******/ 	// Return the exports of the module
/******/ 	return module.exports;
/******/ }
/******/ 
/************************************************************************/
/******/ /* webpack/runtime/compat get default export */
/******/ (() => {
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = (module) => {
/******/ 		var getter = module && module.__esModule ?
/******/ 			() => (module['default']) :
/******/ 			() => (module);
/******/ 		__webpack_require__.d(getter, { a: getter });
/******/ 		return getter;
/******/ 	};
/******/ })();
/******/ 
/******/ /* webpack/runtime/define property getters */
/******/ (() => {
/******/ 	// define getter functions for harmony exports
/******/ 	__webpack_require__.d = (exports, definition) => {
/******/ 		for(var key in definition) {
/******/ 			if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 				Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 			}
/******/ 		}
/******/ 	};
/******/ })();
/******/ 
/******/ /* webpack/runtime/global */
/******/ (() => {
/******/ 	__webpack_require__.g = (function() {
/******/ 		if (typeof globalThis === 'object') return globalThis;
/******/ 		try {
/******/ 			return this || new Function('return this')();
/******/ 		} catch (e) {
/******/ 			if (typeof window === 'object') return window;
/******/ 		}
/******/ 	})();
/******/ })();
/******/ 
/******/ /* webpack/runtime/hasOwnProperty shorthand */
/******/ (() => {
/******/ 	__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ })();
/******/ 
/******/ /* webpack/runtime/make namespace object */
/******/ (() => {
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = (exports) => {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/ })();
/******/ 
/************************************************************************/
/******/ 
/******/ // startup
/******/ // Load entry module and return exports
/******/ // This entry module can't be inlined because the eval devtool is used.
/******/ var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ const __webpack_exports__default = __webpack_exports__["default"];
/******/ export { __webpack_exports__default as default };
/******/ 
